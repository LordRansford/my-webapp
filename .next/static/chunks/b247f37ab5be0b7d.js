;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="052f3832-f0bc-1b2d-2ecf-0f36c7e7afed")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,984378,e=>{"use strict";var t=e.i(843476),i=e.i(271645);let s=[{id:1,title:"First Steps",description:"Learn the basics. Survive the initial wave.",briefing:"Welcome, agent. This is your first mission. Charis has prepared a simple test. Survive for 60 seconds and prove you're ready for what comes next.",durationMs:6e4,objectives:[{id:"survive",description:"Survive for 60 seconds",type:"survive",target:6e4,completed:!1},{id:"collect-5",description:"Collect 5 bonus items",type:"collect",target:5,completed:!1}],sideQuests:[{id:"combo-3",description:"Achieve a 3x combo",reward:50,completed:!1}],difficulty:.2},{id:2,title:"Rising Tension",description:"The pace quickens. Stay focused.",briefing:"Good work. Charis is impressed, but she's not done with you yet. The obstacles will come faster now. Can you handle the pressure?",durationMs:6e4,objectives:[{id:"survive",description:"Survive for 60 seconds",type:"survive",target:6e4,completed:!1},{id:"combo-5",description:"Achieve a 5x combo",type:"combo",target:5,completed:!1}],sideQuests:[{id:"collect-10",description:"Collect 10 bonus items",reward:100,completed:!1},{id:"no-hits",description:"Complete without taking damage (if shield available)",reward:200,completed:!1}],difficulty:.3,unlockRequirement:1},{id:3,title:"Pattern Recognition",description:"See the patterns. Predict the danger.",briefing:"Charis says: 'You're learning, but can you see what's coming?' Watch the patterns. They're not random. Survive and show me you understand.",durationMs:75e3,objectives:[{id:"survive",description:"Survive for 75 seconds",type:"survive",target:75e3,completed:!1},{id:"collect-15",description:"Collect 15 bonus items",type:"collect",target:15,completed:!1}],sideQuests:[{id:"perfect-10",description:"Perform 10 perfect dodges",type:"perfect",target:10,completed:!1,reward:150},{id:"combo-8",description:"Achieve an 8x combo",reward:120,completed:!1}],difficulty:.4,unlockRequirement:2},{id:4,title:"Speed Test",description:"Everything moves faster. Can you keep up?",briefing:"Charis laughs: 'Too slow! Everything moves faster now. Keep up or fail.' This is where many agents break. Don't be one of them.",durationMs:9e4,objectives:[{id:"survive",description:"Survive for 90 seconds",type:"survive",target:9e4,completed:!1},{id:"combo-10",description:"Achieve a 10x combo",type:"combo",target:10,completed:!1}],sideQuests:[{id:"collect-20",description:"Collect 20 bonus items",reward:200,completed:!1},{id:"speed-run",description:"Complete in under 85 seconds",type:"time",target:85e3,completed:!1,reward:250}],difficulty:.5,unlockRequirement:3},{id:5,title:"The Gauntlet",description:"Multiple threats. One path forward.",briefing:"Charis warns: 'This is where it gets real. Multiple obstacles. Tight windows. One mistake and you're done. Are you ready?'",durationMs:9e4,objectives:[{id:"survive",description:"Survive for 90 seconds",type:"survive",target:9e4,completed:!1},{id:"perfect-15",description:"Perform 15 perfect dodges",type:"perfect",target:15,completed:!1}],sideQuests:[{id:"combo-12",description:"Achieve a 12x combo",reward:300,completed:!1},{id:"collect-25",description:"Collect 25 bonus items",reward:250,completed:!1}],difficulty:.6,unlockRequirement:4},{id:6,title:"Midpoint Crisis",description:"Halfway there. The real challenge begins.",briefing:"Charis: 'You've made it halfway. Most don't. But I'm not done testing you. The next phase will push you to your limits.'",durationMs:12e4,objectives:[{id:"survive",description:"Survive for 120 seconds",type:"survive",target:12e4,completed:!1},{id:"combo-15",description:"Achieve a 15x combo",type:"combo",target:15,completed:!1},{id:"collect-30",description:"Collect 30 bonus items",type:"collect",target:30,completed:!1}],sideQuests:[{id:"perfect-20",description:"Perform 20 perfect dodges",type:"perfect",target:20,completed:!1,reward:400},{id:"no-powerups",description:"Complete without using power-ups",reward:500,completed:!1}],difficulty:.65,unlockRequirement:5},{id:7,title:"Adaptation",description:"The rules change. You must adapt.",briefing:"Charis: 'I'm changing the rules. Adapt or fail. The obstacles will come from unexpected angles. Trust your instincts.'",durationMs:12e4,objectives:[{id:"survive",description:"Survive for 120 seconds",type:"survive",target:12e4,completed:!1},{id:"perfect-25",description:"Perform 25 perfect dodges",type:"perfect",target:25,completed:!1}],sideQuests:[{id:"combo-18",description:"Achieve an 18x combo",reward:450,completed:!1},{id:"collect-35",description:"Collect 35 bonus items",reward:350,completed:!1}],difficulty:.7,unlockRequirement:6},{id:8,title:"Pressure Cooker",description:"Maximum intensity. Hold the line.",briefing:"Charis: 'This is where most agents break. Maximum pressure. No room for error. Can you hold the line?'",durationMs:15e4,objectives:[{id:"survive",description:"Survive for 150 seconds",type:"survive",target:15e4,completed:!1},{id:"combo-20",description:"Achieve a 20x combo",type:"combo",target:20,completed:!1}],sideQuests:[{id:"perfect-30",description:"Perform 30 perfect dodges",type:"perfect",target:30,completed:!1,reward:600},{id:"collect-40",description:"Collect 40 bonus items",reward:400,completed:!1}],difficulty:.75,unlockRequirement:7},{id:9,title:"The Test",description:"Charis's personal challenge for you.",briefing:"Charis: 'I've designed this one myself. This is my test. Pass it, and you'll have proven yourself worthy. Fail, and start over.'",durationMs:18e4,objectives:[{id:"survive",description:"Survive for 180 seconds",type:"survive",target:18e4,completed:!1},{id:"combo-25",description:"Achieve a 25x combo",type:"combo",target:25,completed:!1},{id:"perfect-35",description:"Perform 35 perfect dodges",type:"perfect",target:35,completed:!1}],sideQuests:[{id:"collect-50",description:"Collect 50 bonus items",reward:500,completed:!1},{id:"flawless",description:"Complete with zero mistakes (perfect run)",reward:1e3,completed:!1}],difficulty:.8,unlockRequirement:8},{id:10,title:"Endurance",description:"Long haul. Mental fortitude required.",briefing:"Charis: 'Endurance. That's what this is about. Can you maintain focus for the long haul? Most can't. Show me you're different.'",durationMs:24e4,objectives:[{id:"survive",description:"Survive for 240 seconds",type:"survive",target:24e4,completed:!1},{id:"combo-30",description:"Achieve a 30x combo",type:"combo",target:30,completed:!1}],sideQuests:[{id:"perfect-40",description:"Perform 40 perfect dodges",type:"perfect",target:40,completed:!1,reward:800},{id:"collect-60",description:"Collect 60 bonus items",reward:600,completed:!1}],difficulty:.85,unlockRequirement:9},{id:11,title:"The Final Gauntlet",description:"Everything you've learned. One final test.",briefing:"Charis: 'Everything you've learned comes down to this. One final gauntlet. Pass this, and you're ready for the ultimate challenge.'",durationMs:3e5,objectives:[{id:"survive",description:"Survive for 300 seconds",type:"survive",target:3e5,completed:!1},{id:"combo-35",description:"Achieve a 35x combo",type:"combo",target:35,completed:!1},{id:"perfect-50",description:"Perform 50 perfect dodges",type:"perfect",target:50,completed:!1}],sideQuests:[{id:"collect-75",description:"Collect 75 bonus items",reward:750,completed:!1},{id:"master",description:"Complete all objectives and side quests",reward:1500,completed:!1}],difficulty:.9,unlockRequirement:10},{id:12,title:"Charis's Challenge",description:"The ultimate test. Dedicated to Charis Chung Amponsah.",briefing:"Charis: 'This is it. My ultimate challenge. Dedicated to me, designed by me, perfected for you. Survive this, and you've earned my respect. Good luck, agent. You'll need it.'",durationMs:3e5,objectives:[{id:"survive",description:"Survive for 300 seconds",type:"survive",target:3e5,completed:!1},{id:"combo-40",description:"Achieve a 40x combo",type:"combo",target:40,completed:!1},{id:"perfect-60",description:"Perform 60 perfect dodges",type:"perfect",target:60,completed:!1},{id:"collect-100",description:"Collect 100 bonus items",type:"collect",target:100,completed:!1}],sideQuests:[{id:"legend",description:"Complete with 3 stars and all side quests",reward:2e3,completed:!1},{id:"dedication",description:"Complete in honor of Charis Chung Amponsah",reward:5e3,completed:!1}],difficulty:.95,unlockRequirement:11}];function a(e){return s.find(t=>t.id===e)??null}let r={currentMission:1,missions:{},totalStars:0,totalPoints:0,badges:[]},o="campaign_progress";function l(e){let t=()=>{let t=e.get(o,r),i={...t.missions||{}};for(let e of s)i[e.id]||(i[e.id]={missionId:e.id,status:1===e.id?"available":"locked",stars:0,objectivesCompleted:[],sideQuestsCompleted:[],attempts:0});return{...t,missions:i}},i=t=>{e.set(o,t)};return{get:()=>t(),getMissionProgress:e=>t().missions[e]??{missionId:e,status:1===e?"available":"locked",stars:0,objectivesCompleted:[],sideQuestsCompleted:[],attempts:0},updateMissionStatus:(e,s)=>{let a=t(),r=a.missions[e];r&&(r.status=s,i(a))},completeMission:(e,s,a,r,o)=>{let l=t(),n=l.missions[e];if(n){n.status="completed",n.stars=Math.max(n.stars,s),(!n.bestTimeMs||o<n.bestTimeMs)&&(n.bestTimeMs=o),n.objectivesCompleted=[...new Set([...n.objectivesCompleted,...a])],n.sideQuestsCompleted=[...new Set([...n.sideQuestsCompleted,...r])],n.completedAt=Date.now(),l.totalStars=Object.values(l.missions).reduce((e,t)=>e+t.stars,0);let t=e+1;t<=12&&l.missions[t]&&(l.missions[t].status="available"),t<=12&&l.currentMission<t&&(l.currentMission=t),i(l)}},incrementAttempts:e=>{let s=t(),a=s.missions[e];a&&(a.attempts+=1,i(s))},addPoints:e=>{let s=t();s.totalPoints+=e,i(s)},addBadge:e=>{let s=t();s.badges.includes(e)||(s.badges.push(e),i(s))}}}var n=e.i(270756),d=e.i(870273),c=e.i(595468);function u({onSelectMission:e,store:a}){let r=(0,i.useMemo)(()=>l(a),[a]).get();return(0,t.jsxs)("div",{className:"w-full max-w-6xl mx-auto p-6",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Campaign: Charis's Challenge"}),(0,t.jsx)("p",{className:"text-slate-600 mb-8",children:"12 missions dedicated to Charis Chung Amponsah"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:s.map(i=>{var s,a;let o,l,u=(s=i.id,(o=r.missions[s])?o.status:"locked"),h=(a=i.id,l=r.missions[a],l?.stars??0),m="locked"===u,p="completed"===u;return(0,t.jsxs)("button",{onClick:()=>!m&&e(i.id),disabled:m,className:`relative p-6 rounded-xl border-2 transition-all text-left ${m?"border-slate-200 bg-slate-50 opacity-60 cursor-not-allowed":p?"border-green-500 bg-green-50 hover:border-green-600 hover:shadow-lg":"available"===u||"in-progress"===u?"border-blue-500 bg-blue-50 hover:border-blue-600 hover:shadow-lg":"border-slate-300 bg-white hover:border-slate-400"}`,children:[m&&(0,t.jsx)("div",{className:"absolute top-4 right-4",children:(0,t.jsx)(n.Lock,{className:"w-5 h-5 text-slate-400"})}),p&&(0,t.jsx)("div",{className:"absolute top-4 right-4",children:(0,t.jsx)(c.CheckCircle2,{className:"w-5 h-5 text-green-600"})}),(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsxs)("div",{className:"text-sm font-semibold text-slate-500",children:["Mission ",i.id]}),(0,t.jsx)("div",{className:"text-lg font-bold text-slate-900",children:i.title})]}),(0,t.jsx)("p",{className:"text-sm text-slate-600 mb-4",children:i.description}),h>0&&(0,t.jsx)("div",{className:"flex items-center gap-1 mb-2",children:[1,2,3].map(e=>(0,t.jsx)(d.Star,{className:`w-4 h-4 ${e<=h?"fill-yellow-400 text-yellow-400":"text-slate-300"}`},e))}),(0,t.jsxs)("div",{className:"text-xs text-slate-500",children:["~",Math.round(i.durationMs/1e3/60)," min"]})]},i.id)})}),(0,t.jsx)("div",{className:"mt-8 p-4 bg-slate-50 rounded-xl",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-slate-700",children:"Total Progress"}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-slate-900",children:[r.totalStars," / ",3*s.length," Stars"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-slate-700",children:"Total Points"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-slate-900",children:r.totalPoints.toLocaleString()})]})]})})]})}let h={agent:{name:"Agent",description:"Balanced. Reliable. The standard choice.",stats:{speed:1,shieldDuration:1,comboMultiplier:1,collectibleMagnet:0,perfectDodgeWindow:100}},speedster:{name:"Speedster",description:"Fast movement, but harder to control. Perfect for those who like speed.",stats:{speed:1.2,shieldDuration:.8,comboMultiplier:1.1,collectibleMagnet:20,perfectDodgeWindow:80}},tank:{name:"Tank",description:"Slower but more durable. Shield power-ups last longer.",stats:{speed:.85,shieldDuration:1.5,comboMultiplier:.9,collectibleMagnet:0,perfectDodgeWindow:120}},collector:{name:"Collector",description:"Magnet for collectibles, but slightly slower. Great for side quests.",stats:{speed:.9,shieldDuration:1,comboMultiplier:1.2,collectibleMagnet:50,perfectDodgeWindow:100}},perfectionist:{name:"Perfectionist",description:"Larger perfect dodge window, but lower combo multiplier. For precision players.",stats:{speed:1,shieldDuration:.9,comboMultiplier:.95,collectibleMagnet:10,perfectDodgeWindow:150}}},m=[{id:"none",name:"Standard",description:"No modifier. Balanced gameplay.",advantage:"No penalties",disadvantage:"No bonuses",intensityMultiplier:1,pointMultiplier:1},{id:"hard-mode",name:"Hard Mode",description:"20% harder obstacles, but 30% more points.",advantage:"+30% points",disadvantage:"20% harder",intensityMultiplier:1.2,pointMultiplier:1.3},{id:"easy-mode",name:"Easy Mode",description:"20% easier obstacles, but 20% fewer points.",advantage:"20% easier",disadvantage:"-20% points",intensityMultiplier:.8,pointMultiplier:.8},{id:"nightmare",name:"Nightmare",description:"50% harder obstacles, but 100% more points. For the truly brave.",advantage:"+100% points",disadvantage:"50% harder",intensityMultiplier:1.5,pointMultiplier:2}];var p=e.i(431343),f=e.i(39312),x=e.i(98919),g=e.i(620278);function v({onStart:e,onCancel:s}){let[a,r]=(0,i.useState)("agent"),[o,l]=(0,i.useState)("none"),[n,c]=(0,i.useState)({slowTime:!0,shield:!0,doublePoints:!0,speedBoost:!0}),u=m.find(e=>e.id===o)||m[0],v=h[a];return(0,t.jsxs)("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-2xl shadow-lg",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Prepare for Mission"}),(0,t.jsxs)("section",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-700 mb-4",children:"Choose Your Character"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(h).map(([e,i])=>(0,t.jsxs)("button",{onClick:()=>r(e),className:`p-4 rounded-xl border-2 transition-all ${a===e?"border-blue-500 bg-blue-50 shadow-md":"border-slate-200 bg-white hover:border-slate-300"}`,children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900 mb-1",children:i.name}),(0,t.jsx)("div",{className:"text-sm text-slate-600 mb-3",children:i.description}),(0,t.jsxs)("div",{className:"space-y-1 text-xs text-slate-500",children:[(0,t.jsxs)("div",{children:["Speed: ",(100*i.stats.speed).toFixed(0),"%"]}),(0,t.jsxs)("div",{children:["Shield: ",(100*i.stats.shieldDuration).toFixed(0),"%"]}),(0,t.jsxs)("div",{children:["Combo: ",(100*i.stats.comboMultiplier).toFixed(0),"%"]}),i.stats.collectibleMagnet>0&&(0,t.jsxs)("div",{children:["Magnet: ",i.stats.collectibleMagnet,"px"]})]})]},e))})]}),(0,t.jsxs)("section",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-700 mb-4",children:"Difficulty Modifier"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:m.map(e=>(0,t.jsxs)("button",{onClick:()=>l(e.id),className:`p-4 rounded-xl border-2 transition-all text-left ${o===e.id?"border-blue-500 bg-blue-50 shadow-md":"border-slate-200 bg-white hover:border-slate-300"}`,children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900 mb-1",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-slate-600 mb-2",children:e.description}),(0,t.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,t.jsxs)("div",{className:"text-green-600",children:["✓ ",e.advantage]}),(0,t.jsxs)("div",{className:"text-red-600",children:["✗ ",e.disadvantage]})]})]},e.id))})]}),(0,t.jsxs)("section",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-700 mb-4",children:"Power-up Preferences"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{key:"slowTime",label:"Slow Time",icon:f.Zap},{key:"shield",label:"Shield",icon:x.Shield},{key:"doublePoints",label:"Double Points",icon:d.Star},{key:"speedBoost",label:"Speed Boost",icon:g.Target}].map(({key:e,label:i,icon:s})=>(0,t.jsxs)("label",{className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${n[e]?"border-blue-500 bg-blue-50":"border-slate-200 bg-white hover:border-slate-300"}`,children:[(0,t.jsx)("input",{type:"checkbox",checked:n[e],onChange:t=>c(i=>({...i,[e]:t.target.checked})),className:"sr-only"}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)(s,{className:"w-6 h-6 text-slate-700"}),(0,t.jsx)("div",{className:"text-sm font-medium text-slate-900",children:i})]})]},e))})]}),(0,t.jsxs)("div",{className:"mb-6 p-4 bg-slate-50 rounded-xl",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"Your Setup:"}),(0,t.jsxs)("div",{className:"text-sm text-slate-600 space-y-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Character:"})," ",v.name," - ",v.description]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Modifier:"})," ",u.name," - ",u.description]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Power-ups enabled:"})," ",Object.values(n).filter(Boolean).length,"/4"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-4 justify-end",children:[(0,t.jsx)("button",{onClick:s,className:"px-6 py-3 rounded-xl border border-slate-300 bg-white text-slate-700 font-semibold hover:bg-slate-50 transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{e({character:a,difficultyModifier:"none"===o?void 0:o,powerUpPreferences:n})},className:"px-6 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg flex items-center gap-2",children:[(0,t.jsx)(p.Play,{className:"w-5 h-5"}),"Start Mission"]})]})]})}var b=e.i(37727),y=e.i(503116);function w({mission:e,onStart:s,onSkip:a,charisVoice:r}){let[o,l]=(0,i.useState)(!0),[n,c]=(0,i.useState)(5);(0,i.useEffect)(()=>{if(r&&o&&"speak"in r&&"function"==typeof r.speak)try{r.speak(e.briefing,10,!0)}catch{r.speak(e.briefing)}let t=setInterval(()=>{c(e=>e<=1?(clearInterval(t),u(),0):e-1)},1e3);return()=>clearInterval(t)},[e.briefing,r,o]);let u=()=>{l(!1),s()};return o?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl mx-4 bg-white rounded-2xl shadow-2xl p-8 relative",children:[(0,t.jsx)("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-slate-100 transition-colors","aria-label":"Skip briefing",children:(0,t.jsx)(b.X,{className:"w-5 h-5 text-slate-600"})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:["Mission ",e.id,": ",e.title]}),(0,t.jsx)("p",{className:"text-lg text-slate-600",children:e.description})]}),(0,t.jsxs)("div",{className:"mb-6 p-6 bg-slate-50 rounded-xl",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[(0,t.jsx)(g.Target,{className:"w-5 h-5"}),"Briefing"]}),(0,t.jsx)("p",{className:"text-slate-700 leading-relaxed",children:e.briefing})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-700 mb-3",children:"Objectives"}),(0,t.jsx)("div",{className:"space-y-2",children:e.objectives.map(e=>(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-white border border-slate-200 rounded-lg",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-600"})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("div",{className:"font-medium text-slate-900",children:e.description})})]},e.id))})]}),e.sideQuests.length>0&&(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[(0,t.jsx)(d.Star,{className:"w-5 h-5"}),"Side Quests"]}),(0,t.jsx)("div",{className:"space-y-2",children:e.sideQuests.map(e=>(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,t.jsx)(d.Star,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium text-slate-900",children:e.description}),(0,t.jsxs)("div",{className:"text-sm text-slate-600 mt-1",children:["Reward: ",e.reward," points"]})]})]},e.id))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-slate-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-slate-600",children:[(0,t.jsx)(y.Clock,{className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-sm",children:["Duration: ~",Math.round(e.durationMs/1e3/60)," minutes"]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:a,className:"px-6 py-2 rounded-xl border border-slate-300 bg-white text-slate-700 font-semibold hover:bg-slate-50 transition-colors",children:"Skip"}),(0,t.jsx)("button",{onClick:u,className:"px-6 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg",children:n>0?`Start in ${n}s`:"Start Now"})]})]})]})}):null}function M({isOpen:e,onClose:s,children:a,title:r}){let o=(0,i.useRef)(null),[l,n]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!e)return;(async()=>{let e=o.current;if(e)try{e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.msRequestFullscreen&&await e.msRequestFullscreen(),n(!0)}catch(e){console.log("Fullscreen not available:",e),n(!1)}})();let t=()=>{n(!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[e]);let d=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.log("Error exiting fullscreen:",e)}s()};return e?(0,t.jsx)("div",{ref:o,className:"fixed inset-0 z-50 flex items-center justify-center bg-black",style:{display:e?"flex":"none"},children:(0,t.jsxs)("div",{className:"relative w-full h-full flex flex-col",children:[r&&(0,t.jsx)("div",{className:"absolute top-0 left-0 right-0 z-10 bg-black/80 backdrop-blur-sm border-b border-white/10 p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[(0,t.jsx)("h2",{className:"text-white font-semibold text-lg",children:r}),(0,t.jsx)("button",{onClick:d,className:"p-2 rounded-lg hover:bg-white/10 transition-colors","aria-label":"Close",children:(0,t.jsx)(b.X,{className:"w-5 h-5 text-white"})})]})}),(0,t.jsx)("div",{className:"flex-1 w-full h-full overflow-hidden",children:a})]})}):null}let j={left:["ArrowLeft","a"],right:["ArrowRight","d"],up:["ArrowUp","w"],down:["ArrowDown","s"],pause:["Escape","p"]};function k(e,t={}){let i={...j,...t},s=new Set,a=!1,r=!1,o=!1,l=!1,n={moveX:0,moveY:0,pausePressed:!1,actionPressed:!1,shootPressed:!1,shootJustPressed:!1},d=()=>{let e=i.left.some(e=>s.has(e)),t=i.right.some(e=>s.has(e)),a=i.up.some(e=>s.has(e)),r=i.down.some(e=>s.has(e));if(h){let e=f-m,t=x-p,i=Math.sqrt(e*e+t*t);if(i>v){let s=Math.min(1,i/100);n.moveX=e/i*s,n.moveY=t/i*s;return}}n.moveX=+!!t+(e?-1:0),n.moveY=+!!r+(a?-1:0)},c=e=>{s.add(e.key),i.pause.includes(e.key)&&(a=!0),(" "===e.key||"Enter"===e.key||"z"===e.key||"Z"===e.key||"x"===e.key||"X"===e.key)&&(l||(o=!0),r=!0,l=!0),d()},u=e=>{s.delete(e.key),(" "===e.key||"Enter"===e.key||"z"===e.key||"Z"===e.key||"x"===e.key||"X"===e.key)&&(r=!1,l=!1),d()},h=!1,m=0,p=0,f=0,x=0,g=null,v=5,b=e=>{("mouse"!==e.pointerType||0===e.button)&&("touch"===e.pointerType&&(h=!0,m=e.clientX,p=e.clientY,f=e.clientX,x=e.clientY),g={x:e.clientX,y:e.clientY,t:Date.now()})},y=e=>{h&&"touch"===e.pointerType&&(f=e.clientX,x=e.clientY)},w=e=>{if(!g){h=!1,n.moveX=0,n.moveY=0;return}let t=Date.now()-g.t,i=e.clientX-g.x,s=e.clientY-g.y;if(h&&"touch"===e.pointerType){h=!1;let e=x-p;if(Math.abs(f-m)>v||Math.abs(e)>v){g=null,n.moveX=0,n.moveY=0;return}}if(g=null,h=!1,t>700)return;let a=Math.abs(i),l=Math.abs(s);if(t<=350&&10>=Math.max(a,l)){r=!0,o=!0;return}22>Math.max(a,l)||(a>=l?(n.moveX=i>0?1:-1,n.moveY=0):(n.moveY=s>0?1:-1,n.moveX=0))},M=()=>{h=!1,g=null,n.moveX=0,n.moveY=0};(e.addEventListener("keydown",c,void 0),e.addEventListener("keyup",u,void 0),"function"==typeof e.addEventListener)&&(e.addEventListener("pointerdown",b,{passive:!0}),e.addEventListener("pointermove",y,{passive:!0}),e.addEventListener("pointerup",w,{passive:!0}),e.addEventListener("pointercancel",M,{passive:!0}));return{bindings:i,getState:()=>(d(),n.pausePressed=a,n.actionPressed=r,n.shootPressed=r,n.shootJustPressed=o,{moveX:n.moveX,moveY:n.moveY,pausePressed:n.pausePressed,actionPressed:n.actionPressed,shootPressed:n.shootPressed,shootJustPressed:n.shootJustPressed}),resetFrame:()=>{a=!1,r=!1,o=!1,d()},dispose:()=>{(e.removeEventListener("keydown",c,void 0),e.removeEventListener("keyup",u,void 0),"function"==typeof e.removeEventListener)&&(e.removeEventListener("pointerdown",b,{passive:!0}),e.removeEventListener("pointermove",y,{passive:!0}),e.removeEventListener("pointerup",w,{passive:!0}),e.removeEventListener("pointercancel",M,{passive:!0}));h=!1,g=null}}}function S(e){return Number.isFinite(e)?Math.max(0,Math.min(1,e)):0}var P=e.i(803039),C=e.i(387746);let T={common:10,rare:25,epic:50},N={"slow-time":5e3,shield:8e3,"double-points":1e4,"speed-boost":6e3,"rapid-fire":8e3,"explosive-shots":1e4,"life-extension":0,"star-mode":7e3},A={briefing:["Welcome, agent. This mission won't be easy, but I believe you can do it.","Charis here. I've prepared something special for you. Don't disappoint me.","Listen carefully. The obstacles are getting smarter. Stay sharp.","This is your moment to prove yourself. Show me what you're made of.","I've seen many agents attempt this. Most fail. Will you be different?"],warning:["Watch out! Danger ahead!","Incoming! Move now!","That was close. Stay focused.","Don't get complacent. It gets harder.","Multiple threats detected. Be careful."],encouragement:["Good work! Keep it up!","You're doing great. Stay calm.","Excellent dodge! That's what I like to see.","You're getting the hang of this. Don't stop now.","Impressive. Charis would be proud."],taunt:["Too slow! Can you keep up?","Is that the best you can do?","I expected more from you.","Come on, agent. Show me something.","This is too easy for you, isn't it?"],victory:["Outstanding! You've completed the mission!","Well done, agent. You've earned my respect.","Congratulations! Charis is impressed.","Mission complete. You're ready for the next challenge.","Excellent work. You've proven yourself worthy."],failure:["Mission failed. Try again when you're ready.","Not this time. Learn from your mistakes.","You were close. Don't give up.","Failure is part of learning. Try again.","Charis says: one more attempt. You can do this."],milestone:["Quarter way there. Keep going!","Halfway point. You're doing well.","Three quarters done. Almost there!","Final stretch. Don't give up now!","You're in the home stretch. Finish strong!"]};class q{synth=null;currentUtterance=null;queue=[];isSpeaking=!1;voice=null;constructor(){"speechSynthesis"in window&&(this.synth=window.speechSynthesis,this.initializeVoice())}initializeVoice(){if(!this.synth)return;let e=this.synth.getVoices();for(let t of["Google UK English Female","Microsoft Zira - English (United States)","Samantha","Victoria","Karen"]){let i=e.find(e=>e.name.includes(t)||e.name.toLowerCase().includes("female"));if(i){this.voice=i;break}}!this.voice&&e.length>0&&(this.voice=e[0]),0===e.length&&(this.synth.onvoiceschanged=()=>{this.initializeVoice()})}speak(e,t=0,i=!1){if(!this.synth||!this.voice)return;let s={type:"briefing",text:e,priority:t};i?(this.stop(),this.queue=[s],this.processQueue()):(this.queue.push(s),this.queue.sort((e,t)=>t.priority-e.priority),this.isSpeaking||this.processQueue())}speakLine(e,t=!1){let i=A[e];if(0===i.length)return;let s=i[Math.floor(Math.random()*i.length)];this.speak(s,this.getPriority(e),t)}speakCustom(e,t,i=!1){this.speak(t,this.getPriority(e),i)}getPriority(e){switch(e){case"briefing":return 10;case"warning":return 8;case"victory":return 9;case"failure":return 7;case"milestone":return 5;case"encouragement":return 4;case"taunt":return 3;default:return 0}}processQueue(){if(0===this.queue.length||!this.synth||!this.voice){this.isSpeaking=!1;return}let e=this.queue.shift();this.isSpeaking=!0;let t=new window.SpeechSynthesisUtterance(e.text);t.voice=this.voice,t.rate=1,t.pitch=1,t.volume=.8,t.onend=()=>{this.isSpeaking=!1,this.processQueue()},t.onerror=()=>{this.isSpeaking=!1,this.processQueue()},this.currentUtterance=t,this.synth.speak(t)}stop(){this.synth&&this.currentUtterance&&(this.synth.cancel(),this.currentUtterance=null,this.isSpeaking=!1,this.queue=[])}dispose(){this.stop(),this.synth=null,this.voice=null}}var E=e.i(726982);let D={destructible:1,indestructible:1/0,homing:2,zigzag:1,spiral:1,formation:1,kamikaze:1},L={basic:{type:"basic",damage:1,speed:400,cooldown:200,projectileCount:1},spread:{type:"spread",damage:1,speed:400,cooldown:250,projectileCount:3,spreadAngle:Math.PI/6},multi:{type:"multi",damage:1,speed:400,cooldown:300,projectileCount:5,directions:[Math.PI/2,Math.PI/2+Math.PI/4,Math.PI/2-Math.PI/4,Math.PI,0]},laser:{type:"laser",damage:2,speed:600,cooldown:100,projectileCount:1,duration:500},homing:{type:"homing",damage:1,speed:350,cooldown:350,projectileCount:1,homingStrength:.15}},R={basic:0,spread:500,multi:1500,laser:3e3,homing:5e3},I=["basic","spread","multi","laser","homing"];function F(e){let t=I.indexOf(e.currentWeapon);if(-1===t||t>=I.length-1)return!1;let i=R[I[t+1]];return e.upgradePoints>=i}function Y(e){if(!F(e))return!1;let t=I.indexOf(e.currentWeapon),i=I[t+1],s=R[i];return e.currentWeapon=i,e.upgradePoints-=s,!0}var $=e.i(440796);function z({missionId:e,playerChoice:s,onComplete:r,onCancel:o}){let n=(0,i.useRef)(null),d=(0,i.useMemo)(()=>new P.PersistStore({prefix:"rn_games",version:"v1"}),[]),c=(0,i.useMemo)(()=>l(d),[d]),[u,p]=(0,i.useState)(!1),{prefs:f}=(0,$.useAccessibility)(),[x,g]=(0,i.useState)(()=>({muted:d.get("muted",!1),reduceMotion:d.get("reduceMotion",!1),highContrast:d.get("highContrast",!0)}));return(0,i.useEffect)(()=>{g(e=>({...e,reduceMotion:f.reducedMotion,highContrast:f.highContrast??e.highContrast??!0}))},[f.reducedMotion,f.highContrast]),(0,i.useEffect)(()=>{var t;let i,o,l,d,f,g,v,b,y,w,M,j,P,A,R,I,$,z,B,X,W,Q,O,V=n.current;if(!V)return;let H=function(e){let t=e.getContext("2d",{alpha:!0,desynchronized:!0});if(!t)throw Error("Canvas 2D context unavailable");let i={canvas:e,ctx2d:t,width:1,height:1,dpr:1,dispose:()=>{}},s=()=>{let s=e.getBoundingClientRect(),a=Math.max(1,Math.min(3,window.devicePixelRatio||1)),r=Math.max(1,Math.round(s.width)),o=Math.max(1,Math.round(s.height));i.dpr=a,i.width=r,i.height=o,e.width=Math.max(1,Math.round(r*a)),e.height=Math.max(1,Math.round(o*a)),t.setTransform(a,0,0,a,0,0)},a=new ResizeObserver(()=>s());return a.observe(e),s(),i.dispose=()=>{try{a.disconnect()}catch{}},i}(V),U=k(V),G=k(window),J={getState:()=>{let e=U.getState(),t=G.getState();return{moveX:e.moveX||t.moveX,moveY:e.moveY||t.moveY,pausePressed:e.pausePressed||t.pausePressed,actionPressed:e.actionPressed||t.actionPressed,shootPressed:e.shootPressed||t.shootPressed,shootJustPressed:e.shootJustPressed||t.shootJustPressed}},resetFrame:()=>{U.resetFrame(),G.resetFrame()},dispose:()=>{U.dispose(),G.dispose()},bindings:U.bindings},K=(i=!1,o=null,l=null,d=null,f=null,g=null,v=null,b=null,y=null,w=null,M=!1,j=0,P=0,A=()=>{if(o)return o;let e=window.AudioContext||window.webkitAudioContext;if(!e)return null;let t=new e;return o=t,(l=t.createGain()).gain.value=0,l.connect(t.destination),t},R=()=>{if(!o||!l||!d||!g||!b||!v||!f)return;let e=o.currentTime,t=.85*!i;l.gain.cancelScheduledValues(e),l.gain.setTargetAtTime(t,e,.06);let s=S(j),a=S(P);g.frequency.cancelScheduledValues(e),g.frequency.setTargetAtTime(420+1200*s,e,.08),b.frequency.cancelScheduledValues(e),b.frequency.setTargetAtTime(200+140*s,e,.08),v.frequency.cancelScheduledValues(e),v.frequency.setTargetAtTime(96+48*s,e,.08),f.gain.cancelScheduledValues(e),f.gain.setTargetAtTime(i?0:.06*a,e,.08)},{setMuted:e=>{i=!!e,R()},start:()=>{if(M)return;let e=(()=>{let e=A();if(!e)return null;if(d&&g&&v&&b&&y&&w&&f&&l)return e;(d=e.createGain()).gain.value=.06,(f=e.createGain()).gain.value=0,(g=e.createBiquadFilter()).type="lowpass",g.frequency.value=520,g.Q.value=.7,(v=e.createOscillator()).type="sine",v.frequency.value=110,(b=e.createOscillator()).type="triangle",b.frequency.value=220,(y=e.createOscillator()).type="sine",y.frequency.value=.8,(w=e.createGain()).gain.value=12,y.connect(w),w.connect(b.frequency),v.connect(g),b.connect(g),g.connect(d);let t=e.createOscillator();return t.type="sine",t.frequency.value=660,t.connect(f),f.connect(l),d.connect(l),v.start(),b.start(),y.start(),t.start(),e})();if(e){M=!0;try{"suspended"===e.state&&e.resume().catch(()=>{})}catch{}R()}},stop:()=>{if(!o||!l)return;let e=o.currentTime;try{l.gain.cancelScheduledValues(e),l.gain.setTargetAtTime(0,e,.08)}catch{}},setIntensity:e=>{j=S(e),R()},setTension:e=>{P=S(e),R()},cueMilestone:()=>{if(i)return;let e=A();if(e)try{let t=e.createOscillator(),i=e.createGain();t.type="sine",t.frequency.value=880,i.gain.value=1e-4,t.connect(i),i.connect(e.destination);let s=e.currentTime;i.gain.setValueAtTime(1e-4,s),i.gain.exponentialRampToValueAtTime(.03,s+.02),i.gain.exponentialRampToValueAtTime(1e-4,s+.18),t.start(s),t.stop(s+.2)}catch{}},cueFail:()=>{if(!o||!l)return;let e=o.currentTime;try{l.gain.cancelScheduledValues(e),l.gain.setTargetAtTime(0,e,.04)}catch{}},playClick:()=>{if(i)return;let e=A();if(e)try{let t=e.createOscillator(),i=e.createGain();t.type="triangle",t.frequency.value=440,i.gain.value=1e-4,t.connect(i),i.connect(e.destination);let s=e.currentTime;i.gain.setValueAtTime(1e-4,s),i.gain.exponentialRampToValueAtTime(.05,s+.01),i.gain.exponentialRampToValueAtTime(1e-4,s+.08),t.start(s),t.stop(s+.09)}catch{}},dispose:()=>{try{o?.close()}catch{}o=null,l=null,d=null,f=null,g=null,v=null,b=null,y=null,w=null,M=!1}});K.setMuted(x.muted),K.start(),c.incrementAttempts(e),c.updateMissionStatus(e,"in-progress");let Z=function(e){let t,i=e?.missionId??1,s=a(i);if(!s)throw Error(`Mission ${i} not found`);let r=e?.playerChoice??{character:"agent",powerUpPreferences:{slowTime:!0,shield:!0,doublePoints:!0,speedBoost:!0}},o=h[r.character],l=r.difficultyModifier?m.find(e=>e.id===r.difficultyModifier):null,n=(0,E.hashStringToUint32)(`rn:mission:${i}:${Date.now()}`),d=(0,E.mulberry32)(n),c=0,u=0,p=!1,f=!1,x=0,g=0,v=0,b=[],y=0,w=0,M=[],j=[],k=new Map,S=[],P={currentWeapon:"basic",points:0,upgradePoints:0,rapidFireActive:!1},A=0,R=1,I=(t={lastPosition:{x:0,y:0},lastMoveTime:0,stationaryTime:0,totalDistance:0,movementBonus:1},{update(e,i,s){let a=e-t.lastPosition.x,r=i-t.lastPosition.y,o=Math.sqrt(a*a+r*r);o>5?(t.lastMoveTime=s,t.stationaryTime=0,t.totalDistance+=o,t.lastPosition={x:e,y:i},s-(t.lastMoveTime-3e3)<3e3?t.movementBonus=Math.min(1.5,1+t.totalDistance/200*.1):(t.totalDistance=0,t.movementBonus=1)):t.stationaryTime=s-t.lastMoveTime;let l=t.stationaryTime>1500,n=l&&t.stationaryTime>1500;return{isStationary:l,shouldSpawnDangerZone:n,movementBonus:t.movementBonus,stationaryTime:t.stationaryTime}},reset(e,i,s){t.lastPosition={x:e,y:i},t.lastMoveTime=s,t.stationaryTime=0,t.totalDistance=0,t.movementBonus=1},getTracker:()=>t}),$=[],z=0,B=0,X=o.stats.perfectDodgeWindow,W=0,Q=0,O=[],V=null,H=null,U=[],G=[],J=[],K=[],Z=0,_=0,ee=new q,et=Math.min(1,s.difficulty*(l?.intensityMultiplier??1)),ei=(e,t,i,s=!1,a=0)=>{let r,o=Math.round(e/6*(Math.floor(5*d())+1)),l=(18+Math.round(22*d()))*(.9+.3*i),n=(80+120*d())*(.8+.6*i),c="destructible",u=d();if(u<.6)c="destructible";else if(u<.6+.3)c="indestructible";else(s&&a>2e3?.30000000000000004>Math.random():.1>Math.random())&&(c="homing");let h="straight",m=d();m<.5?h="straight":m<.8?h="homing":m<.9?h="zigzag":m<.9500000000000001?h="spiral":m<.9700000000000001&&(h="kamikaze");let p=0;if("destructible"===c){let e=d();e<.5?(r="points",p=10+Math.floor(20*d())):r=e<.7?"powerup":e<.85?"weapon":e<.95?"star":"life"}let f=D[c],v={id:`enemy-${Date.now()}-${d()}`,x:o,y:-l-6,w:l,h:l,speed:n,type:c,pattern:h,health:f,maxHealth:f,dropReward:r,rewardValue:p};"zigzag"===h?v.patternData={zigzag:{direction:.5>d()?1:-1,amplitude:40,frequency:2}}:"spiral"===h?v.patternData={spiral:{angle:0,radius:30,centerX:o,centerY:-l-6}}:("homing"===h||"homing"===c)&&(v.patternData={homing:{targetX:x||e/2,targetY:g||.75*t,prediction:.3}}),b.push(v)},es=(e,t,i,s)=>{let a=s.x-s.w/2,r=s.y-s.h/2,o=Math.max(a,Math.min(e,a+s.w)),l=Math.max(r,Math.min(t,r+s.h)),n=e-o,d=t-l;return n*n+d*d<=i*i},ea=(e,t)=>{let i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)<e.radius+Math.max(t.w,t.h)/2},er=(e,t,i,s,a,r)=>{let o=e-s,l=t-a;return Math.sqrt(o*o+l*l)<i+r},eo=(e,t,i,s=10)=>{for(let a=0;a<s;a++)O.push({x:e,y:t,vx:(d()-.5)*200,vy:(d()-.5)*200,life:1,maxLife:.5+.5*d(),size:2+4*d(),color:i,alpha:1})},el=(e,t)=>{V={intensity:e,duration:t,startTime:u}},en=(e,t,i)=>{H={color:e,intensity:t,duration:i,startTime:u}},ed=(e,t,i,s=0)=>{if("life"===i)R<3&&(R++,eo(e,t,"#00ff00",20),en("#00ff00",.3,200),ee.speak("Life extended!",8,!1));else if("star"===i)k.set("star-mode",{startTime:u,duration:N["star-mode"]}),eo(e,t,"#ffff00",25),en("#ffff00",.4,300),ee.speak("Star mode activated!",9,!1);else if("weapon"===i)Y(P)?(eo(e,t,"#ff00ff",20),en("#ff00ff",.3,200),ee.speak("Weapon upgraded!",9,!1)):Q+=100;else if("powerup"===i){let i=["slow-time","shield","double-points","speed-boost","rapid-fire","explosive-shots"],s=i[Math.floor(d()*i.length)];j.push({id:`powerup-drop-${Date.now()}-${d()}`,x:e,y:t,radius:12,type:s,collected:!1,spawnTime:u,active:!1,duration:N[s]*o.stats.shieldDuration})}else"points"===i&&(Q+=s)},ec=()=>{let e=s.objectives.find(e=>"survive"===e.type);e&&u>=e.target&&!J.includes(e.id)&&J.push(e.id);let t=s.objectives.find(e=>"collect"===e.type);t&&Z>=t.target&&!J.includes(t.id)&&J.push(t.id);let i=s.objectives.find(e=>"combo"===e.type);i&&z>=i.target&&!J.includes(i.id)&&J.push(i.id);let a=s.objectives.find(e=>"perfect"===e.type);for(let e of(a&&W>=a.target&&!J.includes(a.id)&&J.push(a.id),s.sideQuests)){if(K.includes(e.id))continue;let t=!1;if(e.id.includes("combo-")){let i=parseInt(e.id.match(/combo-(\d+)/)?.[1]||"0");z>=i&&(t=!0)}else if(e.id.includes("collect-")){let i=parseInt(e.id.match(/collect-(\d+)/)?.[1]||"0");Z>=i&&(t=!0)}else if(e.id.includes("perfect-")){let i=parseInt(e.id.match(/perfect-(\d+)/)?.[1]||"0");W>=i&&(t=!0)}else if(e.id.includes("no-hits")||e.id.includes("no-powerups")||e.id.includes("flawless")||e.id.includes("master")||e.id.includes("dedication")||e.id.includes("legend"))continue;t&&(K.push(e.id),Q+=e.reward)}},eu=()=>{let e=J.length,t=K.length,i=s.objectives.length,a=s.sideQuests.length;return e===i&&t===a?3:e===i?2:+(e>=.7*i)};return{init(){d=(0,E.mulberry32)(n),c=0,u=0,p=!1,f=!1,v=0,b.length=0,M.length=0,j.length=0,k.clear(),y=400,x=0,g=0,z=0,W=0,Q=0,Z=0,_=0,J.length=0,K.length=0,O.length=0,U.length=0,S.length=0,$.length=0,G.length=0,V=null,H=null,w=0,A=0,R=1,P.currentWeapon="basic",P.upgradePoints=0,I.reset(x||0,g||0,0)},update(t){let i;if(!c){c=t.nowMs,x=t.width/2,g=.75*t.height;return}if(f)return;let a=t.dtMs;v+=a,u=t.nowMs-c;let l=k.has("slow-time"),n=l?.5*a:a;for(let[e,t]of k.entries())u-t.startTime>=t.duration&&k.delete(e);let{phase:h,intensity:m}={phase:Math.floor(5*(i=u/s.durationMs))+1,intensity:Math.min(.99,.3+.7*et+.4*i)};if(v>=y){let e,i,s,a=I.update(x,g,u);ei(t.width,t.height,m,a.isStationary,a.stationaryTime);let l=400+300*d();y=v+Math.min(Math.max(150,500-u/1e3*8*m),l),.4>d()&&(ev=t.width,t.height,e=d(),i="common",e<.05?i="epic":e<.3&&(i="rare"),s=Math.round(ev/6*(Math.floor(5*d())+1)),M.push({id:`collect-${Date.now()}-${d()}`,x:s,y:-20,radius:8,rarity:i,value:T[i],collected:!1,spawnTime:u,magnetRadius:o.stats.collectibleMagnet})),((e,t)=>{if(d()>.15)return;let i=[];if(r.powerUpPreferences.slowTime&&i.push("slow-time"),r.powerUpPreferences.shield&&i.push("shield"),r.powerUpPreferences.doublePoints&&i.push("double-points"),r.powerUpPreferences.speedBoost&&i.push("speed-boost"),0===i.length)return;let s=i[Math.floor(d()*i.length)],a=Math.round(e/6*(Math.floor(5*d())+1));j.push({id:`powerup-${Date.now()}-${d()}`,x:a,y:-20,radius:12,type:s,collected:!1,spawnTime:u,active:!1,duration:N[s]*o.stats.shieldDuration})})(t.width,t.height),h>=3&&.3>d()&&ei(t.width,t.height,m,a.isStationary,a.stationaryTime),h>=5&&.2>d()&&ei(t.width,t.height,m,a.isStationary,a.stationaryTime)}let C=Math.max(0,Math.min(1,u/s.durationMs)),q=Math.max(0,Math.min(1,1-Math.max(0,s.durationMs-u)/(.2*s.durationMs)));e?.onAudio?.({intensity:C,tension:q});let E=Math.floor(u/1e3/(s.durationMs/1e3/4))*(s.durationMs/1e3/4);E>w&&E>0&&(w=E,e?.onMilestone?.(E),ee.speakLine("milestone",!1));let D=k.has("speed-boost")?1.3:1,eh=(t.settings.reduceMotion?200:260)*o.stats.speed*D;x+=t.input.moveX*eh*n/1e3,g+=t.input.moveY*eh*n/1e3,x=Math.max(14,Math.min(t.width-14,x)),g=Math.max(14,Math.min(t.height-14,g));let em=I.update(x,g,u);em.shouldSpawnDangerZone&&$.length<3&&$.push((eb=x,ey=g,ew=u,{id:`danger-${Date.now()}-${Math.random()}`,x:eb,y:ey,radius:20,maxRadius:80,expansionRate:30,damage:1,startTime:ew,duration:2e3,active:!0}));let ep=k.has("rapid-fire")?.5:1,ef=L[P.currentWeapon].cooldown*ep,ex=u-A>=ef;if((t.input.shootPressed||t.input.shootJustPressed)&&ex){let e=function(e,t,i,s,a){let r=L[e],o=[];switch(e){case"basic":{let s=Math.PI/2;o.push({id:`proj-${Date.now()}-${Math.random()}`,x:t,y:i,vx:Math.cos(s)*r.speed,vy:-Math.sin(s)*r.speed,speed:r.speed,damage:r.damage,radius:4,life:1,maxLife:2,weaponType:e});break}case"spread":{let s=Math.PI/2,a=r.spreadAngle||Math.PI/6;for(let l=0;l<r.projectileCount;l++){let n=s-a/2+a/(r.projectileCount-1)*l;o.push({id:`proj-${Date.now()}-${l}-${Math.random()}`,x:t,y:i,vx:Math.cos(n)*r.speed,vy:-Math.sin(n)*r.speed,speed:r.speed,damage:r.damage,radius:4,life:1,maxLife:2,weaponType:e})}break}case"multi":{let s=r.directions||[Math.PI/2];for(let a=0;a<s.length;a++){let l=s[a];o.push({id:`proj-${Date.now()}-${a}-${Math.random()}`,x:t,y:i,vx:Math.cos(l)*r.speed,vy:-Math.sin(l)*r.speed,speed:r.speed,damage:r.damage,radius:4,life:1,maxLife:2,weaponType:e})}break}case"laser":o.push({id:`proj-${Date.now()}-${Math.random()}`,x:t,y:i,vx:0,vy:-r.speed,speed:r.speed,damage:r.damage,radius:6,life:1,maxLife:(r.duration||500)/1e3,weaponType:e});break;case"homing":{let s=Math.PI/2;o.push({id:`proj-${Date.now()}-${Math.random()}`,x:t,y:i,vx:Math.cos(s)*r.speed,vy:-Math.sin(s)*r.speed,speed:r.speed,damage:r.damage,radius:5,life:1,maxLife:3,weaponType:e,targetX:void 0,targetY:void 0})}}return o}(P.currentWeapon,x,g);S.push(...e),A=u,eo(x,g-10,"#ffffff",5)}let eg=l?.5:1;for(let e of b)if("indestructible"===e.type||e.health>0){!function(e,t,i,s,a,r){switch(e.pattern){case"straight":break;case"homing":{e.patternData?.homing||(e.patternData={homing:{targetX:t,targetY:i,prediction:.3}});let a=e.patternData.homing;if(!a)break;let r=t-e.x,o=i-e.y,l=e.speed;a.prediction,a.targetX=t,a.targetY=i;let n=a.targetX-e.x,d=a.targetY-e.y,c=Math.sqrt(n*n+d*d);c>5?(e.x+=n/c*l*(s/1e3),e.y+=d/c*l*(s/1e3)*1.2):e.y+=s/1e3*l;break}case"zigzag":{e.patternData?.zigzag||(e.patternData={zigzag:{direction:1,amplitude:40,frequency:2}});let t=e.patternData.zigzag;if(!t)break;let i=Math.sin(Date.now()/1e3*t.frequency*Math.PI*2)*t.amplitude;e.x+=s/1e3*i*t.direction,e.y+=e.speed*(s/1e3),(e.x<e.w/2||e.x>a-e.w/2)&&(t.direction*=-1);break}case"spiral":{e.patternData?.spiral||(e.patternData={spiral:{angle:0,radius:30,centerX:e.x,centerY:e.y}});let t=e.patternData.spiral;if(!t)break;t.angle+=s/1e3*3,t.radius+=s/1e3*20,e.x=t.centerX+Math.cos(t.angle)*t.radius,e.y=t.centerY+Math.sin(t.angle)*t.radius,t.centerY+=e.speed*(s/1e3);break}case"formation":e.y+=e.speed*(s/1e3);break;case"kamikaze":{let a=t-e.x,r=i-e.y,o=Math.sqrt(a*a+r*r);if(o>5){let t=1.5*e.speed;e.x+=a/o*t*(s/1e3),e.y+=r/o*t*(s/1e3)}}}}(e,x,g,n,t.width,t.height);let i=e.speed*(t.settings.reduceMotion?.9:1)*eg;"straight"===e.pattern&&(e.y+=i*n/1e3)}for(;b.length&&b[0].y-b[0].h/2>t.height+40;)b.shift();for(let e=S.length-1;e>=0;e--){let i,s=S[e],a=1/0;for(let e of b)if("indestructible"!==e.type&&e.health>0){let t=e.x-s.x,r=e.y-s.y,o=Math.sqrt(t*t+r*r);o<a&&(a=o,i={x:e.x,y:e.y,id:e.id})}if(!function(e,t,i,s,a){if("homing"===e.weaponType&&void 0!==e.targetX&&void 0!==e.targetY){let t=e.targetX-e.x,i=e.targetY-e.y;if(Math.sqrt(t*t+i*i)>5&&a){e.targetX=a.x,e.targetY=a.y;let t=L.homing.homingStrength||.15,i=e.targetX-e.x,s=e.targetY-e.y,r=Math.sqrt(i*i+s*s);if(r>0){let a=i/r*e.speed,o=s/r*e.speed;e.vx+=(a-e.vx)*t,e.vy+=(o-e.vy)*t;let l=Math.sqrt(e.vx*e.vx+e.vy*e.vy);if(l>0){let t=e.speed/l;e.vx*=t,e.vy*=t}}}}return e.x+=e.vx*t/1e3,e.y+=e.vy*t/1e3,e.life-=t/1e3/e.maxLife,!(e.x<-50)&&!(e.x>i+50)&&!(e.y<-50)&&!(e.y>s+50)&&!(e.life<=0)}(s,n,t.width,t.height,i)){S.splice(e,1);continue}for(let t=b.length-1;t>=0;t--){let i=b[t];if("indestructible"!==i.type&&!(i.health<=0)&&ea(s,i)){if(i.health-=s.damage,k.has("explosive-shots")){for(let e of b)if(e.id!==i.id&&"indestructible"!==e.type&&e.health>0){let t=e.x-i.x,a=e.y-i.y;60>Math.sqrt(t*t+a*a)&&(e.health-=.5*s.damage)}}if(G.push(function(e,t,i="#ff8800",s=1){return{x:e,y:t,radius:10,maxRadius:30+20*s,life:1,maxLife:.3,color:i,intensity:s}}(i.x,i.y,"#ff8800",1)),O.push(...function(e,t,i,s=15){let a=[];for(let r=0;r<s;r++){let o=2*Math.PI*r/s+.5*Math.random(),l=100+150*Math.random();a.push({x:e,y:t,vx:Math.cos(o)*l,vy:Math.sin(o)*l,life:1,maxLife:.5+.5*Math.random(),size:2+4*Math.random(),color:i,alpha:1})}return a}(i.x,i.y,"#ff8800",15)),el(.2,150),i.health<=0){var ev,eb,ey,ew;for(_++,i.dropReward&&ed(i.x,i.y,i.dropReward,i.rewardValue),P.upgradePoints+=10;F(P);)Y(P);z++,Q+=20*(1+.1*z)*em.movementBonus,b.splice(t,1)}S.splice(e,1);break}}}for(let t=$.length-1;t>=0;t--){let i=$[t];if(!function(e,t,i){if(!e.active)return!1;if(t-e.startTime>=e.duration)return e.active=!1,!1;let s=e.expansionRate*i/1e3;return e.radius=Math.min(e.maxRadius,e.radius+s),!0}(i,u,n)){$.splice(t,1);continue}if(function(e,t,i,s){if(!e.active)return!1;let a=t-e.x,r=i-e.y;return Math.sqrt(a*a+r*r)<e.radius+9}(i,x,g,0)&&!k.has("star-mode")&&!k.has("shield")){if(--R<=0){f=!0,p=!1,z=0,el(.5,300),en("#ff0000",.5,300),ee.speakLine("failure",!0);let t=eu();ec(),e?.onComplete?.(!1,t,J,K,u)}else en("#ff8800",.3,200),ee.speak("Life lost!",7,!1);$.splice(t,1)}}for(let e=G.length-1;e>=0;e--)!function(e,t){e.life-=t/1e3/e.maxLife;let i=1-e.life;return e.radius=e.maxRadius*(1-i*i),e.life>0}(G[e],n)&&G.splice(e,1);for(let e of M)if(!e.collected){if(e.magnetRadius&&e.magnetRadius>0){let t=x-e.x,i=g-e.y,s=Math.sqrt(t*t+i*i);if(s<e.magnetRadius){let a=(e.magnetRadius-s)/e.magnetRadius;e.x+=t/s*a*300*(n/1e3),e.y+=i/s*a*300*(n/1e3)}}if(e.y+=n/1e3*100,er(x,g,9,e.x,e.y,e.radius)){e.collected=!0,Z++;let t=e.value*(k.has("double-points")?2:1)*o.stats.comboMultiplier*(1+.1*z);Q+=t,z++,eo(e.x,e.y,"epic"===e.rarity?"#ff00ff":"rare"===e.rarity?"#00ffff":"#ffff00",8),el(.1,100)}}for(let e of(M.filter(e=>!e.collected&&e.y>t.height+40).forEach(e=>e.collected=!0),j))!e.collected&&(e.y+=n/1e3*100,er(x,g,9,e.x,e.y,e.radius)&&(e.collected=!0,e.active=!0,e.startTime=u,"life-extension"===e.type?R<3&&(R++,eo(e.x,e.y,"#00ff00",20),en("#00ff00",.3,200),ee.speak("Life extended!",8,!1)):(k.set(e.type,{startTime:u,duration:e.duration}),eo(e.x,e.y,"#00ff00",15),el(.2,150),en("#00ff00",.3,200),ee.speakLine("encouragement",!1))));for(let e of(j.filter(e=>!e.collected&&e.y>t.height+40).forEach(e=>e.collected=!0),b)){if("indestructible"===e.type||e.health<=0)continue;let t=x-e.x,i=g-e.y,s=Math.sqrt(t*t+i*i),a=9+Math.max(e.w,e.h)/2;s<a+25&&s>a-5&&!es(x,g,9,e)&&u-B>X&&(W++,z++,B=u,eo(e.x,e.y,"#ffffff",12),U.push({combo:z,x:e.x,y:e.y,life:1,maxLife:1}),ee.speakLine("encouragement",!1))}if(!k.has("shield")&&!k.has("star-mode")){for(let t of b)if("indestructible"!==t.type&&!(t.health<=0)&&es(x,g,9,t)){if(--R<=0){f=!0,p=!1,z=0,el(.5,300),en("#ff0000",.5,300),ee.speakLine("failure",!0);let t=eu();ec(),e?.onComplete?.(!1,t,J,K,u)}else{en("#ff8800",.3,200),ee.speak("Life lost!",7,!1);let e=b.indexOf(t);e>=0&&b.splice(e,1)}break}}if(!f&&u>=s.durationMs){for(let e of(f=!0,p=!0,ec(),s.sideQuests))if(!K.includes(e.id))if("no-hits"===e.id&&W>0)K.push(e.id),Q+=e.reward;else if("no-powerups"===e.id&&0===k.size)K.push(e.id),Q+=e.reward;else if("flawless"===e.id){let t=s.objectives.find(e=>"perfect"===e.type);t&&W>=t.target&&(K.push(e.id),Q+=e.reward)}else"master"===e.id&&J.length===s.objectives.length&&K.length===s.sideQuests.length-1?(K.push(e.id),Q+=e.reward):("dedication"===e.id||"legend"===e.id)&&(K.push(e.id),Q+=e.reward);let t=eu();el(.3,400),en("#00ff00",.4,500),ee.speakLine("victory",!0),e?.onComplete?.(!0,t,J,K,u)}for(let e=O.length-1;e>=0;e--){let t=O[e];t.x+=t.vx*(n/1e3),t.y+=t.vy*(n/1e3),t.life-=n/1e3/t.maxLife,t.alpha=t.life,t.life<=0&&O.splice(e,1)}for(let e=U.length-1;e>=0;e--){let t=U[e];t.y-=n/1e3*50,t.life-=n/1e3/t.maxLife,t.life<=0&&U.splice(e,1)}V&&u-V.startTime>=V.duration&&(V=null),H&&u-H.startTime>=H.duration&&(H=null),u-B>2e3&&(z=0)},render(e){(0,C.clear)(e.ctx2d,e.width,e.height);let t=0,i=0;if(V&&!e.settings.reduceMotion){let e=(u-V.startTime)/V.duration,s=V.intensity*(1-e);t=(d()-.5)*s*20,i=(d()-.5)*s*20}if(e.ctx2d.save(),e.ctx2d.translate(t,i),e.ctx2d.save(),e.ctx2d.fillStyle="rgba(2,6,23,0.96)",e.ctx2d.fillRect(0,0,e.width,e.height),e.ctx2d.restore(),H&&!e.settings.reduceMotion){let t=(u-H.startTime)/H.duration,i=H.intensity*(1-t);e.ctx2d.save(),e.ctx2d.fillStyle=H.color,e.ctx2d.globalAlpha=i,e.ctx2d.fillRect(0,0,e.width,e.height),e.ctx2d.restore()}for(let t of $){if(!t.active)continue;e.ctx2d.save();let i=.3+.2*Math.sin((u-t.startTime)/100);e.ctx2d.globalAlpha=i,e.ctx2d.strokeStyle="#ff0000",e.ctx2d.lineWidth=3,e.ctx2d.beginPath(),e.ctx2d.arc(t.x,t.y,t.radius,0,2*Math.PI),e.ctx2d.stroke(),e.ctx2d.fillStyle="#ff0000",e.ctx2d.globalAlpha=.2*i,e.ctx2d.fill(),e.ctx2d.restore()}e.ctx2d.save();let a=["#00ffff","#ffff00","#ff00ff","#00ff00","#ff8800","#ff0088"];for(let t of b){if(t.health<=0)continue;let i=Math.floor((t.x+t.y)/50)%a.length,s=a[i];if("indestructible"===t.type?(s="#ff0000",e.ctx2d.shadowBlur=30):"homing"===t.type?(s="#ff0088",e.ctx2d.shadowBlur=30):e.ctx2d.shadowBlur=25,e.ctx2d.shadowColor=s,e.ctx2d.fillStyle=s,e.ctx2d.fillRect(t.x-t.w/2,t.y-t.h/2,t.w,t.h),e.ctx2d.strokeStyle="#ffffff",e.ctx2d.lineWidth=3,e.ctx2d.strokeRect(t.x-t.w/2,t.y-t.h/2,t.w,t.h),"indestructible"!==t.type&&t.maxHealth>1){let i=t.health/t.maxHealth;e.ctx2d.fillStyle="#ff0000",e.ctx2d.fillRect(t.x-t.w/2,t.y-t.h/2-8,t.w,4),e.ctx2d.fillStyle="#00ff00",e.ctx2d.fillRect(t.x-t.w/2,t.y-t.h/2-8,t.w*i,4)}}for(let t of(e.ctx2d.restore(),S)){var r=e.ctx2d,o=e.settings.reduceMotion;switch(r.save(),t.weaponType){case"basic":r.fillStyle="#00ffff",r.shadowBlur=10,r.shadowColor="#00ffff",r.beginPath(),r.arc(t.x,t.y,t.radius,0,2*Math.PI),r.fill();break;case"spread":r.fillStyle="#ffff00",r.shadowBlur=12,r.shadowColor="#ffff00",r.beginPath(),r.arc(t.x,t.y,t.radius,0,2*Math.PI),r.fill();break;case"multi":r.fillStyle="#ff00ff",r.shadowBlur=15,r.shadowColor="#ff00ff",r.beginPath(),r.arc(t.x,t.y,t.radius,0,2*Math.PI),r.fill();break;case"laser":r.strokeStyle="#00ff00",r.lineWidth=8,r.shadowBlur=20,r.shadowColor="#00ff00",r.beginPath(),r.moveTo(t.x,t.y+100),r.lineTo(t.x,t.y),r.stroke(),r.fillStyle="#00ff00",r.beginPath(),r.arc(t.x,t.y,t.radius,0,2*Math.PI),r.fill();break;case"homing":r.fillStyle="#ff8800",r.shadowBlur=15,r.shadowColor="#ff8800",r.beginPath(),r.arc(t.x,t.y,t.radius,0,2*Math.PI),r.fill(),o||(r.strokeStyle="#ff8800",r.lineWidth=2,r.globalAlpha=.5,r.beginPath(),r.moveTo(t.x-.1*t.vx,t.y-.1*t.vy),r.lineTo(t.x,t.y),r.stroke())}r.restore()}for(let t of G)!function(e,t,i){if(i)return;e.save();let s=t.life;e.globalAlpha=s;let a=e.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);a.addColorStop(0,t.color),a.addColorStop(.5,t.color+"80"),a.addColorStop(1,t.color+"00"),e.fillStyle=a,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.globalAlpha=.8*s,e.beginPath(),e.arc(t.x,t.y,.3*t.radius,0,2*Math.PI),e.fill(),e.restore()}(e.ctx2d,t,e.settings.reduceMotion);for(let t of M){if(t.collected)continue;e.ctx2d.save();let i="epic"===t.rarity?"#ff00ff":"rare"===t.rarity?"#00ffff":"#ffff00";e.ctx2d.shadowBlur=15,e.ctx2d.shadowColor=i,e.ctx2d.fillStyle=i,e.ctx2d.beginPath(),e.ctx2d.arc(t.x,t.y,t.radius,0,2*Math.PI),e.ctx2d.fill(),e.ctx2d.restore()}for(let t of j){if(t.collected)continue;e.ctx2d.save();let i="slow-time"===t.type?"#00ffff":"shield"===t.type?"#0000ff":"double-points"===t.type?"#ffff00":"#00ff00";e.ctx2d.shadowBlur=20,e.ctx2d.shadowColor=i,e.ctx2d.fillStyle=i,e.ctx2d.beginPath(),e.ctx2d.arc(t.x,t.y,t.radius,0,2*Math.PI),e.ctx2d.fill(),e.ctx2d.strokeStyle="#ffffff",e.ctx2d.lineWidth=2,e.ctx2d.stroke(),e.ctx2d.restore()}if(!e.settings.reduceMotion&&(u%3e4<2e3||z>10)){e.ctx2d.save();let t=e.width-60,i=.2*Math.sin(u/500%(2*Math.PI))+1;e.ctx2d.globalAlpha=.8,e.ctx2d.shadowBlur=20,e.ctx2d.shadowColor="#ff00ff",e.ctx2d.fillStyle="#ff00ff",e.ctx2d.beginPath(),e.ctx2d.arc(t,60,15*i,0,2*Math.PI),e.ctx2d.fill(),e.ctx2d.strokeStyle="#ffffff",e.ctx2d.lineWidth=2,e.ctx2d.stroke(),e.ctx2d.fillStyle="#ffffff",e.ctx2d.font="bold 16px system-ui",e.ctx2d.textAlign="center",e.ctx2d.textBaseline="middle",e.ctx2d.fillText("C",t,60),e.ctx2d.restore()}if(e.ctx2d.save(),k.has("star-mode")){let t=.3*Math.sin(u/200%(2*Math.PI))+.7;e.ctx2d.shadowBlur=40,e.ctx2d.shadowColor="#ffff00",e.ctx2d.strokeStyle="#ffff00",e.ctx2d.lineWidth=5,e.ctx2d.globalAlpha=t,e.ctx2d.beginPath(),e.ctx2d.arc(x,g,17,0,2*Math.PI),e.ctx2d.stroke(),e.ctx2d.globalAlpha=1}if(k.has("shield")&&(e.ctx2d.shadowBlur=30,e.ctx2d.shadowColor="#0000ff",e.ctx2d.strokeStyle="#0000ff",e.ctx2d.lineWidth=4,e.ctx2d.beginPath(),e.ctx2d.arc(x,g,14,0,2*Math.PI),e.ctx2d.stroke()),e.ctx2d.shadowBlur=20,e.ctx2d.shadowColor="#6366f1",e.ctx2d.fillStyle="rgba(99,102,241,0.95)",e.ctx2d.beginPath(),e.ctx2d.arc(x,g,9,0,2*Math.PI),e.ctx2d.fill(),e.ctx2d.strokeStyle="#ffffff",e.ctx2d.lineWidth=3,e.ctx2d.stroke(),e.ctx2d.restore(),!e.settings.reduceMotion)for(let t of O)e.ctx2d.save(),e.ctx2d.globalAlpha=t.alpha,e.ctx2d.fillStyle=t.color,e.ctx2d.beginPath(),e.ctx2d.arc(t.x,t.y,t.size,0,2*Math.PI),e.ctx2d.fill(),e.ctx2d.restore();for(let t of U){e.ctx2d.save(),e.ctx2d.globalAlpha=t.life,e.ctx2d.font="bold 24px system-ui",e.ctx2d.fillStyle="#ffffff",e.ctx2d.strokeStyle="#000000",e.ctx2d.lineWidth=4;let i=`${t.combo}x COMBO!`;e.ctx2d.strokeText(i,t.x-60,t.y),e.ctx2d.fillText(i,t.x-60,t.y),e.ctx2d.restore()}e.ctx2d.restore();let l=Math.max(0,Math.ceil(Math.max(0,s.durationMs-u)/1e3)),n=Math.min(1,u/s.durationMs);if((0,C.drawHudText)(e.ctx2d,`Mission ${s.id}: ${s.title}`,16,26),(0,C.drawHudText)(e.ctx2d,`Time: ${l}s`,16,48),(0,C.drawHudText)(e.ctx2d,`Points: ${Math.floor(Q)}`,16,70),(0,C.drawHudText)(e.ctx2d,`Lives: ${R}/3`,16,92),(0,C.drawHudText)(e.ctx2d,`Weapon: ${P.currentWeapon.toUpperCase()}`,16,114),z>0&&(0,C.drawHudText)(e.ctx2d,`Combo: ${z}x`,16,136),k.size>0){let t=[];k.has("slow-time")&&t.push("SLOW"),k.has("shield")&&t.push("SHIELD"),k.has("double-points")&&t.push("2X"),k.has("speed-boost")&&t.push("SPEED"),k.has("rapid-fire")&&t.push("RAPID"),k.has("explosive-shots")&&t.push("EXPLOSIVE"),k.has("star-mode")&&t.push("STAR"),(0,C.drawHudText)(e.ctx2d,`Active: ${t.join(", ")}`,16,158)}e.ctx2d.save(),e.ctx2d.fillStyle="rgba(255,255,255,0.2)",e.ctx2d.fillRect(16,e.height-40,e.width-32,8),e.ctx2d.fillStyle="#00ff00",e.ctx2d.fillRect(16,e.height-40,(e.width-32)*n,8),e.ctx2d.restore();let c=180;for(let t of s.objectives){let i=J.includes(t.id),s=`${i?"✓":"○"} ${t.description}`;e.ctx2d.save(),e.ctx2d.fillStyle=i?"rgba(0,255,0,0.9)":"rgba(255,255,255,0.7)",e.ctx2d.font="600 12px system-ui",e.ctx2d.fillText(s,16,c),e.ctx2d.restore(),c+=18}if(f){e.ctx2d.save(),e.ctx2d.fillStyle="rgba(0,0,0,0.55)",e.ctx2d.fillRect(0,0,e.width,e.height),e.ctx2d.restore();let t=p?"Mission Complete!":"Mission Failed";if((0,C.drawHudText)(e.ctx2d,t,16,84),p){let t=eu();(0,C.drawHudText)(e.ctx2d,`Stars: ${"★".repeat(t)}${"☆".repeat(3-t)}`,16,106),(0,C.drawHudText)(e.ctx2d,`Points: ${Math.floor(Q)}`,16,128)}(0,C.drawHudText)(e.ctx2d,"Return to the hub for another mission.",16,150)}},dispose(){ee.dispose()}}}({missionId:e,playerChoice:s,onComplete:(t,i,s,a,o)=>{t&&(c.completeMission(e,i,s,a,o),c.addPoints(Math.floor(o/100)+100*i)),c.updateMissionStatus(e,t?"completed":"available"),r(t,i,s,a,o)},onAudio:e=>{K.setIntensity(e.intensity),K.setTension(e.tension)},onMilestone:()=>K.cueMilestone()}),_=(t={canvas:H.canvas,ctx2d:H.ctx2d,getSize:()=>({width:H.width,height:H.height,dpr:H.dpr}),scene:Z,getInput:()=>J.getState(),getSettings:()=>x,onFrameEnd:()=>{J.resetFrame()}},I=1e3/60,$=!1,z=!1,B=0,X=0,W=0,Q=()=>{"hidden"===document.visibilityState&&(W=0,X=performance.now())},document.addEventListener("visibilitychange",Q),O=e=>{if(!$||(B=requestAnimationFrame(O),z))return;X||(X=e);let i=Math.min(100,Math.max(0,e-X));X=e,W+=i;let s=t.getSize(),a=t.getInput(),r=t.getSettings(),o=0;for(;W>=I&&o<6;){let i={nowMs:e,dtMs:I,canvas:t.canvas,ctx2d:t.ctx2d,width:s.width,height:s.height,dpr:s.dpr,input:a,settings:r};t.onStep?.(i),t.scene.update(i),W-=I,o+=1}let l={nowMs:e,dtMs:I,canvas:t.canvas,ctx2d:t.ctx2d,width:s.width,height:s.height,dpr:s.dpr,input:a,settings:r};t.onRender?.(l),t.scene.render(l),t.onFrameEnd?.()},{start:()=>{$||($=!0,z=!1,X=0,W=0,t.scene.init(),B=requestAnimationFrame(O))},stop:()=>{$=!1,z=!1,B&&cancelAnimationFrame(B),B=0,W=0,X=0},setPaused:e=>{(z=!!e)||(W=0,X=performance.now())},isPaused:()=>z,dispose:()=>{$=!1,B&&cancelAnimationFrame(B),document.removeEventListener("visibilitychange",Q)}});_.start(),_.setPaused(u);let ee=e=>{"Escape"===e.key&&p(e=>!e)};return window.addEventListener("keydown",ee),()=>{window.removeEventListener("keydown",ee),_.dispose(),_.stop(),Z.dispose(),H.dispose(),J.dispose(),K.stop(),K.dispose()}},[e,s,x,u,c,r]),(0,t.jsxs)("div",{className:"relative w-full h-full flex flex-col",children:[(0,t.jsx)("div",{className:"absolute top-0 left-0 right-0 z-10 bg-black/80 backdrop-blur-sm border-b border-white/10 p-4",children:(0,t.jsx)("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:o,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white font-semibold transition-colors",children:"Exit"}),(0,t.jsx)("button",{onClick:()=>p(e=>!e),className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white font-semibold transition-colors",children:u?"Resume":"Pause"}),(0,t.jsx)("button",{onClick:()=>g(e=>({...e,muted:!e.muted})),className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white font-semibold transition-colors",children:x.muted?"Unmute":"Mute"})]})})}),(0,t.jsx)("div",{className:"flex-1 w-full h-full overflow-hidden",children:(0,t.jsx)("canvas",{ref:n,className:"w-full h-full touch-none","aria-label":"Game canvas",role:"img"})})]})}function B(){let e=(0,i.useMemo)(()=>new P.PersistStore({prefix:"rn_games",version:"v1"}),[]),[s,r]=(0,i.useState)(null),[o,l]=(0,i.useState)(null),[n,d]=(0,i.useState)(!1),[c,h]=(0,i.useState)(!1),[m]=(0,i.useState)(()=>new q),p=()=>{d(!1),h(!0)},f=()=>{r(null),l(null),d(!1),h(!1)};if(c&&s&&o)return(0,t.jsx)(M,{isOpen:!0,onClose:f,title:`Mission ${s}`,children:(0,t.jsx)(z,{missionId:s,playerChoice:o,onComplete:(e,t,i,s,a)=>{h(!1),r(null),l(null)},onCancel:f})});if(n&&s){let e=a(s);if(e)return(0,t.jsx)(w,{mission:e,onStart:p,onSkip:p,charisVoice:m})}return s&&!o?(0,t.jsx)("div",{className:"min-h-screen bg-slate-50 py-8",children:(0,t.jsx)("div",{className:"container mx-auto px-4",children:(0,t.jsx)(v,{onStart:e=>{l(e),d(!0)},onCancel:f})})}):(0,t.jsx)("div",{className:"min-h-screen bg-slate-50 py-8",children:(0,t.jsx)("div",{className:"container mx-auto px-4",children:(0,t.jsx)(u,{onSelectMission:e=>{r(e),l(null),d(!1),h(!1)},store:e})})})}e.s(["default",()=>B],984378)}]);

//# debugId=052f3832-f0bc-1b2d-2ecf-0f36c7e7afed
//# sourceMappingURL=9e44ec4d1eef6529.js.map