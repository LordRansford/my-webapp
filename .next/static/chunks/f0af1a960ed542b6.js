;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="5122f6dc-a952-671e-2bcf-ec6a62c84fc8")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,363327,248361,e=>{"use strict";var t=e.i(191788),s=e.i(486533);let a="ransfords-notes-cpd-v1",n=()=>({version:1,sections:[],activity:[]}),c={cyber:{foundations:{"foundations-f0-what-security-is":["foundations-why-cyber-matters"],"foundations-f2-data-and-integrity":["foundations-data-and-bits"],"foundations-f3-networks-and-transport":["foundations-networks-and-packets"],"foundations-f4-cia-and-simple-attacks":["foundations-cia-and-simple-attacks"],"foundations-f8-foundations-capstone":["foundations-checkpoint-capstone"]},applied:{"applied-a1-threat-modelling-as-design":["applied-threat-modelling"],"applied-a2-identity-and-access-control":["applied-auth-sessions-access"],"applied-a6-logging-and-detection-basics":["applied-logging-and-risk"]},practice:{"practice-p2-exposure-reduction-zero-trust":["practice-p1-secure-architecture-zero-trust","advanced-secure-architecture"],"practice-p3-runtime-and-cloud-security":["practice-p0-crypto-in-practice","advanced-crypto-practice"],"practice-p4-supply-chain-security":["practice-p3-supply-chain-risk","advanced-supply-chain-risk"],"practice-p6-detection-and-incident-response":["practice-p2-detection-and-incident-response","advanced-detection-response"],"practice-p7-privacy-ethics-auditability":["practice-p5-governance-and-professional-practice","advanced-governance-career"],"practice-p8-system-ilities":["practice-p4-adversarial-tradeoffs","advanced-adversarial-tradeoffs"],"practice-p9-capstone-professional-practice":["practice-p6-capstone"]}}};function i(e,t,s){let a=String(s||"").trim();if(!a)return[];let n=c?.[e]?.[t]?.[a]??[];return Array.from(new Set([a,...n].map(e=>String(e).trim()).filter(Boolean)))}let r=e=>{if(!e||"object"!=typeof e)return null;let{trackId:t,levelId:s,sectionId:a,completed:n,minutes:c,lastUpdated:i}=e;return t&&s&&a?{trackId:t,levelId:s,sectionId:a,completed:!!n,minutes:Math.max(0,Number(c)||0),lastUpdated:"string"==typeof i&&i.length>0?i:new Date().toISOString()}:null},l=e=>{if(!e||"object"!=typeof e)return null;let{id:t,trackId:s,levelId:a,sectionId:n,minutesDelta:c,timestamp:i,note:r}=e;return t&&s&&a&&n&&i?{id:String(t),trackId:s,levelId:a,sectionId:n,minutesDelta:Number(c)||0,timestamp:String(i),note:"string"==typeof r?r:void 0}:null};function o(){try{let e=window.localStorage.getItem(a);if(!e)return n();let t=JSON.parse(e);if(!t||"object"!=typeof t)return n();let s=Number(t.version)||1,c=Array.isArray(t.sections)?t.sections.map(r).filter(Boolean):[],i=Array.isArray(t.activity)?t.activity.map(l).filter(Boolean):[];return{version:s,sections:c,activity:i}}catch{return n()}}function d(e){try{window.localStorage.setItem(a,JSON.stringify(e))}catch{}}function u(e,t){let s={...e,sections:[...e.sections]},a=s.sections.findIndex(e=>e.trackId===t.trackId&&e.levelId===t.levelId&&e.sectionId===t.sectionId),n=new Date().toISOString(),c=a>=0?s.sections[a]:null,i=Math.max(0,(c?.minutes||0)+(t.minutesDelta||0)),r={trackId:t.trackId,levelId:t.levelId,sectionId:t.sectionId,completed:t.completed??c?.completed??!1,minutes:i,lastUpdated:n};return a>=0?s.sections[a]=r:s.sections.push(r),s}function p(e,t){let s=e.sections.filter(e=>e.trackId===t),a=s.reduce((e,t)=>e+t.minutes,0);return{totalMinutes:a,completedSections:s.filter(e=>e.completed).length,totalSections:s.length}}function m(e){return"cybersecurity"===e||"cyber"===e?"cyber":"software-architecture"===e||"architecture"===e?"software-architecture":"digitalisation"===e?"digitalisation":"data"===e?"data":"ai"}function h(e,t,s,a=[]){let n=a.filter(a=>{let n;return 0!==(n=i(t,s,a)).length&&n.some(a=>e.sections.some(e=>e.trackId===t&&e.levelId===s&&e.sectionId===a&&e.completed))}).length,c=a.length,r=0===c?0:Math.round(n/c*100);return{completedCount:n,totalCount:c,percent:r}}function f(e,t,s,a){let n=(a&&a.length>0?a:Object.keys(s||{})).reduce((a,n)=>{let c=s?.[n]||[],i=h(e,t,n,c);return a.completed+=i.completedCount,a.total+=i.totalCount,a},{completed:0,total:0}),c=0===n.total?0:Math.round(n.completed/n.total*100);return{completedCount:n.completed,totalCount:n.total,percent:c}}function g(e,t){let s={...t,id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,timestamp:new Date().toISOString()};return{...e,activity:[s,...e.activity].slice(0,200)}}function y(){let[e,a]=(0,t.useState)(()=>({version:1,sections:[],activity:[]})),{data:n,status:c}=(0,s.useSession)(),i=!!n?.user?.id;(0,t.useEffect)(()=>{a(o())},[]),(0,t.useEffect)(()=>{if(!i)return;let t=!1;return(async()=>{try{let s=await fetch("/api/progress/cpd",{method:"GET"});if(!s.ok)return;let n=await s.json();if(t)return;n?.state?(a(n.state),d(n.state)):await fetch("/api/progress/cpd",{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({state:e})})}catch{}})(),()=>{t=!0}},[i,c]);let r=(0,t.useCallback)(e=>{n?.user?.id&&a(t=>{let s=u(t,e);return e.minutesDelta&&0!==e.minutesDelta&&(s=g(s,{trackId:e.trackId,levelId:e.levelId,sectionId:e.sectionId,minutesDelta:e.minutesDelta,note:e.note??""})),d(s),fetch("/api/progress/cpd",{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({state:s})}).catch(()=>{}),!0===e.completed&&fetch("/api/cpd/evidence",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({courseId:"cyber"===e.trackId?"cybersecurity":String(e.trackId||""),evidenceType:"progress",payload:{trackId:e.trackId,levelId:e.levelId,sectionId:e.sectionId,completed:!0}})}).catch(()=>{}),s})},[n?.user?.id]),l=(0,t.useCallback)(t=>p(e,t),[e]);return{state:e,updateSection:r,getTrackTotals:l,isAuthed:i}}e.s(["addActivityEntry",()=>g,"getCompletionForCourse",()=>f,"getCompletionForLevel",()=>h,"getInitialCPDState",()=>o,"getSectionAliases",()=>i,"getTotalsForTrack",()=>p,"resolveTrackId",()=>m,"saveCPDState",()=>d,"upsertSection",()=>u],248361),e.s(["useCPD",()=>y],363327)},215125,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a={VALID_LOADERS:function(){return c},imageConfigDefault:function(){return i}};for(var n in a)Object.defineProperty(s,n,{enumerable:!0,get:a[n]});let c=["default","imgix","cloudinary","akamai","custom"],i={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},813521,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"ImageConfigContext",{enumerable:!0,get:function(){return c}});let a=e.r(741705)._(e.r(191788)),n=e.r(215125),c=a.default.createContext(n.imageConfigDefault)},667467,e=>{"use strict";var t=e.i(391398),s=e.i(191788),a=e.i(41158),n=e.i(486533),c=e.i(277774),i=e.i(363327);function r(){let{data:e,status:r}=(0,n.useSession)(),l=e?.user,o=!!l?.id,{state:d}=(0,i.useCPD)(),[u,p]=(0,s.useState)("free"),[m,h]=(0,s.useState)(null),[f,g]=(0,s.useState)(null),[y,x]=(0,s.useState)(null),[j,b]=(0,s.useState)(null),[N,v]=(0,s.useState)([]),[S,k]=(0,s.useState)(!1),[A,w]=(0,s.useState)({termsAccepted:!1,privacyAccepted:!1,cpdDataUseAccepted:!1}),[C,I]=(0,s.useState)(""),[D,P]=(0,s.useState)(!1),[T,O]=(0,s.useState)(null),E=(0,s.useMemo)(()=>o?"pro"===u?"Professional":"supporter"===u?"Supporter":"Registered learner":"Visitor",[o,u]);(0,s.useEffect)(()=>{o&&fetch("/api/account/profile").then(e=>e.json()).then(e=>{p(e?.plan||"free");let t=e?.user?.consent||{};w({termsAccepted:!!t.termsAcceptedAt,privacyAccepted:!!t.privacyAcceptedAt,cpdDataUseAccepted:!!t.cpdDataUseAcceptedAt})}).catch(()=>p("free"))},[o]),(0,s.useEffect)(()=>{o&&(fetch("/api/analytics/me").then(e=>e.json()).then(e=>h(e)).catch(()=>h(null)),fetch("/api/account/learning-summary").then(e=>e.json()).then(e=>g(e)).catch(()=>g(null)),fetch("/api/credits/status").then(e=>e.ok?e.json():null).then(e=>{x("number"==typeof e?.balance?e.balance:0),b("string"==typeof e?.expiresAt?e.expiresAt:e?.expiresAt?String(e.expiresAt):null),v(Array.isArray(e?.usage)?e.usage:[])}).catch(()=>x(0)))},[o,A.cpdDataUseAccepted]);let _=async e=>{k(!0),O(null);try{let t=await fetch("/api/account/consent",{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(t.ok)O("Consent settings saved.");else{let e=await t.json().catch(()=>({}));O(e?.message||"Could not save consent settings.")}}catch{O("Could not save consent settings.")}finally{k(!1)}},U=async()=>{if(l?.email){P(!0),O(null);try{let e=await fetch("/api/account/delete",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({confirmEmail:C})}),t=await e.json().catch(()=>({}));if(!e.ok)return void O(t?.message||"Account deletion failed.");O("Account deleted. Signing out."),await (0,n.signOut)({callbackUrl:"/"})}catch{O("Account deletion failed.")}finally{P(!1)}}};return"loading"===r?(0,t.jsx)(c.default,{title:"Account",description:"Your account and consent settings.",children:(0,t.jsx)("main",{className:"page",children:(0,t.jsxs)("header",{className:"page-header",children:[(0,t.jsx)("p",{className:"eyebrow",children:"Account"}),(0,t.jsx)("h1",{children:"Account"}),(0,t.jsx)("p",{className:"lead",children:"Loading."})]})})}):o?(0,t.jsx)(c.default,{title:"Account",description:"Your account and consent settings.",children:(0,t.jsxs)("main",{className:"page",children:[(0,t.jsxs)("header",{className:"page-header",children:[(0,t.jsx)("p",{className:"eyebrow",children:"Account"}),(0,t.jsx)("h1",{children:"Account"}),(0,t.jsx)("p",{className:"lead",children:"Minimal identity. No passwords. No profile data required."})]}),(0,t.jsxs)("section",{className:"section",children:[(0,t.jsx)("h2",{children:"Details"}),(0,t.jsxs)("ul",{className:"list",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Email"}),": ",l?.email]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Tier"}),": ",E]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Credits"}),": ",y??0]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Credits expiry"}),": ",j?new Date(j).toLocaleDateString():"Not set yet"]}),f?.displayName?(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Name"}),": ",f.displayName]}):null]}),(0,t.jsx)("p",{className:"muted",children:"Payments are not enabled yet. Learning stays free. Credits only apply to compute above the free tier. When payments launch, the minimum top-up will be £10 and credits will expire after a set period."}),N?.length?(0,t.jsxs)("div",{className:"mt-3 rounded-2xl border border-slate-200 bg-white p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"Recent credit usage"}),(0,t.jsx)("ul",{className:"mt-2 space-y-1 text-sm text-slate-700",children:N.slice(0,8).map(e=>(0,t.jsxs)("li",{children:[new Date(e.occurredAt||e.submittedAt||Date.now()).toLocaleDateString()," - ",e.toolId," - ",e.consumed," credits"]},e.id))})]}):null,(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap gap-3",children:[(0,t.jsx)(a.default,{href:"/account/history",className:"button",children:"View history"}),(0,t.jsx)(a.default,{href:"/my-cpd",className:"button",children:"My CPD"}),(0,t.jsx)("button",{type:"button",className:"button",onClick:()=>(0,n.signOut)({callbackUrl:"/"}),children:"Sign out"})]})]}),(0,t.jsxs)("section",{className:"section",children:[(0,t.jsx)("h2",{children:"Learning insights"}),(0,t.jsx)("p",{className:"muted",children:"These are learning signals from your progress, quizzes, and tool use. They are not ad tracking."}),m?.consented===!1?(0,t.jsx)("p",{className:"muted",children:"Turn on CPD tracking consent below to enable insights."}):null,(0,t.jsxs)("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Progress signals"}),(0,t.jsxs)("p",{className:"muted",children:["Sections: ",d.sections.filter(e=>e.completed).length," completed"]}),(0,t.jsxs)("p",{className:"muted",children:["Courses started: ",f?.coursesStarted??0," · Courses completed: ",f?.coursesCompleted??0]}),(0,t.jsxs)("p",{className:"muted",children:["Certificates earned: ",f?.certificatesEarned??0]}),(0,t.jsxs)("p",{className:"muted",children:["Total CPD hours: ",f?.totalCpdHours??0]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Exploration"}),(0,t.jsxs)("p",{className:"muted",children:["Tools explored: ",m?.summary?.toolsExplored??0]}),(0,t.jsxs)("p",{className:"muted",children:["Quizzes attempted: ",m?.summary?.quizzesAttempted??0]})]})]})]}),(0,t.jsxs)("section",{className:"section",children:[(0,t.jsx)("h2",{children:"Consent"}),(0,t.jsx)("p",{className:"muted",children:"These flags exist so your CPD record is defensible and your preferences are explicit. You can change them at any time."}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsxs)("label",{className:"flex items-start gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:A.termsAccepted,onChange:e=>{let t={...A,termsAccepted:e.target.checked};w(t),_(t)},disabled:S}),(0,t.jsxs)("span",{children:["I accept the ",(0,t.jsx)(a.default,{href:"/terms",className:"link",children:"terms"}),"."]})]}),(0,t.jsxs)("label",{className:"flex items-start gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:A.privacyAccepted,onChange:e=>{let t={...A,privacyAccepted:e.target.checked};w(t),_(t)},disabled:S}),(0,t.jsxs)("span",{children:["I accept the ",(0,t.jsx)(a.default,{href:"/privacy",className:"link",children:"privacy policy"}),"."]})]}),(0,t.jsxs)("label",{className:"flex items-start gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:A.cpdDataUseAccepted,onChange:e=>{let t={...A,cpdDataUseAccepted:e.target.checked};w(t),_(t)},disabled:S}),(0,t.jsx)("span",{children:"I consent to CPD tracking being stored to my account."})]})]}),T?(0,t.jsx)("p",{className:"mt-3 text-sm",children:T}):null]}),(0,t.jsxs)("section",{className:"section",children:[(0,t.jsx)("h2",{children:"Delete account"}),(0,t.jsx)("p",{className:"muted",children:"This deletes your account and server-side records for progress and history. It does not affect Stripe records held by Stripe."}),(0,t.jsx)("p",{className:"muted",children:"To confirm, type your email address and then delete."}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-3",children:[(0,t.jsx)("input",{className:"input",value:C,onChange:e=>I(e.target.value),placeholder:"Email confirmation","aria-label":"Confirm email for deletion"}),(0,t.jsx)("button",{type:"button",className:"button",disabled:D||C.trim().toLowerCase()!==String(l?.email||"").toLowerCase(),onClick:U,children:D?"Deleting":"Delete account"})]})]})]})}):(0,t.jsx)(c.default,{title:"Account",description:"Sign in to manage your account.",children:(0,t.jsxs)("main",{className:"page",children:[(0,t.jsxs)("header",{className:"page-header",children:[(0,t.jsx)("p",{className:"eyebrow",children:"Account"}),(0,t.jsx)("h1",{children:"Account"}),(0,t.jsx)("p",{className:"lead",children:"Sign in to track progress, CPD hours, and tool usage."})]}),(0,t.jsx)("section",{className:"section",children:(0,t.jsx)(a.default,{href:"/signin",className:"button primary",children:"Sign in"})})]})})}e.s(["default",()=>r])},54063,(e,t,s)=>{let a="/account";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(667467)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})},648761,e=>{e.v(t=>Promise.all(["static/chunks/076d71697cf8418f.js"].map(t=>e.l(t))).then(()=>t(493594)))},828805,e=>{e.v(t=>Promise.all(["static/chunks/9598a04aeb8d39c4.js"].map(t=>e.l(t))).then(()=>t(879466)))},401042,e=>{e.v(t=>Promise.all(["static/chunks/240263eebbec9d80.js"].map(t=>e.l(t))).then(()=>t(79936)))}]);

//# debugId=5122f6dc-a952-671e-2bcf-ec6a62c84fc8
//# sourceMappingURL=14a6fe0b7bef68a8.js.map