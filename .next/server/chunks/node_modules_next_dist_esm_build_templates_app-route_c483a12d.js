;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="46c5b48b-2b4f-3c3e-4c3b-8a75c43fbcd5")}catch(e){}}();
module.exports=[555227,e=>{"use strict";var t=e.i(747909),r=e.i(174017),o=e.i(996250),n=e.i(759756),a=e.i(561916),i=e.i(114444),s=e.i(837092),l=e.i(869741),u=e.i(316795),c=e.i(487718),d=e.i(995169),h=e.i(47587),p=e.i(666012),f=e.i(570101),g=e.i(626937),m=e.i(10372),w=e.i(193695);e.i(52474);var y=e.i(600220),x=e.i(89171),b=e.i(657194),v=e.i(936426),R=e.i(895968);let E=["medical","doctor","diagnosis","legal","lawsuit","attorney","politics","election","crypto","stock"];var O=e.i(385725);let A=[{id:"cyber_game_trust_boundary",title:"Spot the trust boundary",route:"/cybersecurity/summary",tips:["Pick one real system you use daily","Mark where identity or trust changes","Write the first log you would want at that boundary"]},{id:"ai-summary-scenario-triage",title:"AI scenario triage",route:"/ai/summary",tips:["Name the real system (search, recommendations, moderation, automation)","List the quiet failure mode","Decide the smallest safe change"]}];var T=e.i(902157),k=e.i(750227);let $=new Set(["a","an","and","are","as","at","be","by","can","do","does","for","from","how","i","in","is","it","of","on","or","the","this","to","what","when","where","why","with","you","your"]);var C=e.i(666680);let S=null;function P(e,t){let r=C.default.createHash("sha256").update(e).digest(),o=new Float32Array(t);for(let e=0;e<t;e+=1)o[e]=r[e%r.length]/255*2-1;return Array.from(o)}async function N(e,t){let r=process.env.OPENAI_API_KEY||"";if(!r)return P(e,t);let o=await fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({input:e,model:"text-embedding-3-small"})});if(!o.ok)return P(e,t);let n=await o.json(),a=n?.data?.[0]?.embedding;return Array.isArray(a)?a.map(e=>Number(e)):P(e,t)}async function I(e,t,r=6){let o=function(){if(S)return S;let e=k.default.join(process.cwd(),"data","mentor","embeddings.json");if(!T.default.existsSync(e))throw Error("Missing data/mentor/embeddings.json. Run npm run build:mentor-embeddings.");return S=JSON.parse(T.default.readFileSync(e,"utf8"))}(),n=o.embeddingDim||128,a=await N(e.slice(0,8e3),n),i=String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(Boolean),s=o.vectors.map(e=>{let t=function(e,t){let r=0,o=0,n=0,a=Math.min(e.length,t.length);for(let i=0;i<a;i+=1)r+=e[i]*t[i],o+=e[i]*e[i],n+=t[i]*t[i];return o&&n?r/Math.sqrt(o*n):0}(a,e.embedding),r=e.anchor?`${e.route}#${e.anchor}`:e.route,o=`Relevant ${e.kind} section${e.anchor?` (${e.anchor})`:""}`,n=`${e.title} ${r}`.toLowerCase(),s=i.filter(e=>n.includes(e)).length,l=.25*("tool"===e.kind);return{title:e.title,href:r,why:o,pageTitle:e.title,pageRoute:e.route,anchor:e.anchor,score:t+(s?.12+.08*s:0)+l,matchCount:s}});s.sort((e,t)=>t.score-e.score);let l=s.slice(0,r),u=l.some(e=>i.some(t=>e.href.toLowerCase().includes(t))),c=s.filter(e=>e.href.includes("/studios/")||"tool"===e.kind).sort((e,t)=>t.matchCount-e.matchCount||t.score-e.score)[0];if(!u){let e=s.find(e=>e.matchCount>0);e&&(l=[e,...l.filter(t=>t.href!==e.href)].slice(0,r))}c&&!l.find(e=>e.href===c.href)&&(l=[c,...l].slice(0,r));let d=0===l.length||l[0].score<.12;return{matches:l,weak:d}}async function L(e,t,r=8){let o=[];try{for(let n of(await I(e,t,r)).matches){let e=n.why||"";o.push({title:n.title||n.pageTitle||"Content",href:n.href,excerpt:e,text:e,why:n.why,kind:n.href.includes("/tools/")?"tool":n.href.includes("#")?"section":"page",score:n.score||0})}}catch(e){console.error("[MENTOR] Vector retrieval failed:",e)}for(let n of function(e,t,r=6){let o=String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean).filter(e=>e.length>=2&&!$.has(e)).slice(0,15);if(!(o=function(e){let t=new Set(e);for(let r of e)("digitalisation"===r||"digitalization"===r)&&(t.add("digitalisation"),t.add("digitalization"),t.add("digital"),t.add("digitize"),t.add("digitise")),"digital"===r&&(t.add("digitalisation"),t.add("digitalization"));return Array.from(t)}(o)).length)return{matches:[],weak:!0};let n=function(){let e=k.default.join(process.cwd(),"public","content-index.json");if(!T.default.existsSync(e))throw Error("Missing public/content-index.json. Run npm run build:content-index.");return JSON.parse(T.default.readFileSync(e,"utf8"))}(),a=[];for(let e of n.pages){let r=t&&e.route===t?6:t&&e.route.startsWith(t.split("/")[1]||"")?1:0,n=e.title.toLowerCase(),i=0;for(let e of o)n.includes(e)&&(i+=3);for(let t of e.sections){if(!t.anchor)continue;let n=function(e,t,r){let o=t.title.toLowerCase(),n=(t.excerpt||"").toLowerCase(),a=`${o} ${n}`,i=0;for(let t of e){if(!t)continue;o===t||o.includes(` ${t} `)||o.startsWith(`${t} `)||o.endsWith(` ${t}`)?i+=8:o.includes(t)&&(i+=5);let e=RegExp(`\\b${t}\\b`,"gi"),r=a.match(e);if(r&&(i+=1.5*r.length),t.length>=4){let e=RegExp(t,"gi"),o=a.match(e);o&&o.length>(r?.length||0)&&(i+=(o.length-(r?.length||0))*.5)}}return Math.round(i+r)}(o,t,r+i);n<=0||a.push({title:t.title,href:`${e.route}#${t.anchor}`,why:t.excerpt?t.excerpt.slice(0,200):"Relevant section in the notes.",pageTitle:e.title,pageRoute:e.route,anchor:t.anchor,score:n})}i>=3&&!a.some(t=>t.pageRoute===e.route)&&a.push({title:e.title,href:e.route,why:`Page about ${e.title}`,pageTitle:e.title,pageRoute:e.route,anchor:"",score:i})}a.sort((e,t)=>t.score-e.score);let i=a.slice(0,r),s=0===i.length||i[0].score<2;return{matches:i,weak:s}}(e,t,r).matches)if(!o.some(e=>e.href===n.href)){let e=n.why||"";o.push({title:n.title,href:n.href,excerpt:e,text:e,why:n.why,kind:n.href.includes("#")?"section":"course",score:n.score||.5})}if(["tool","how to use","how do i","tutorial","guide","playground","lab","workshop"].some(t=>e.toLowerCase().includes(t))||e.toLowerCase().includes("use"))for(let t of function(e,t=3){let r=function(){let e=k.default.join(process.cwd(),"public","tools-index.json");if(!T.default.existsSync(e))return null;try{let t=T.default.readFileSync(e,"utf8");return JSON.parse(t)}catch{return null}}();if(!r||!Array.isArray(r.tools))return[];let o=e.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(e=>e.length>=2).slice(0,12);return o.some(e=>e.includes("digital"))&&o.push("digitalisation","digitalization","digital"),r.tools.map(e=>{let t=String(e.title||"").toLowerCase(),r=String(e.description||"").toLowerCase(),n=String(e.explain||"").toLowerCase(),a=`${t} ${r} ${n}`,i=0;for(let e of o){t.includes(e)&&(i+=5),r.includes(e)&&(i+=2),n.includes(e)&&(i+=3);let o=a.match(RegExp(`\\b${e}\\b`,"g"));o&&(i+=o.length)}if(i<=0)return null;let s=e.explain||e.description||`Tool: ${e.title}`,l=e.route||`/tools/${e.id}`;return{title:e.title||"Tool",href:l,excerpt:s.slice(0,300),text:`${e.description||""}

${e.explain||""}`.trim().slice(0,1e3),kind:"tool",score:i}}).filter(e=>null!==e).sort((e,t)=>t.score-e.score).slice(0,t)}(e,3))o.some(e=>e.href===t.href)||o.push(t);return o.sort((e,t)=>t.score-e.score).slice(0,r)}async function _(e,t){let r=process.env.OPENAI_API_KEY,o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:t.model,messages:[{role:"system",content:"You are a helpful learning mentor for Ransford's Notes, a website about cybersecurity, AI, software architecture, data, and digitalisation. You answer questions based ONLY on the provided context from the website. You provide clear, practical explanations with links to relevant pages. You never make up information that isn't in the context. If the context doesn't contain enough information to answer the question, you say so and suggest where the user might find more information on the website."},{role:"user",content:e}],max_tokens:t.maxTokens,temperature:t.temperature})});if(!o.ok){let e=await o.text();throw Error(`OpenAI API error: ${o.status} ${e}`)}let n=await o.json();return{answer:n.choices?.[0]?.message?.content||"",tokensUsed:n.usage?.total_tokens,provider:"openai"}}async function q(e,t){let r=process.env.TOGETHER_API_KEY,o=await fetch("https://api.together.xyz/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:t.model,messages:[{role:"system",content:"You are a helpful learning mentor for Ransford's Notes, a website about cybersecurity, AI, software architecture, data, and digitalisation. You answer questions based ONLY on the provided context from the website. You provide clear, practical explanations with links to relevant pages. You never make up information that isn't in the context. If the context doesn't contain enough information to answer the question, you say so and suggest where the user might find more information on the website."},{role:"user",content:e}],max_tokens:t.maxTokens,temperature:t.temperature})});if(!o.ok){let e=await o.text();throw Error(`Together.ai API error: ${o.status} ${e}`)}let n=await o.json();return{answer:n.choices?.[0]?.message?.content||"",tokensUsed:n.usage?.total_tokens,provider:"together"}}async function M(e,t){let r=process.env.OLLAMA_BASE_URL||"http://localhost:11434",o=await fetch(`${r}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.model,messages:[{role:"system",content:"You are a helpful learning mentor for Ransford's Notes, a website about cybersecurity, AI, software architecture, data, and digitalisation. You answer questions based ONLY on the provided context from the website. You provide clear, practical explanations with links to relevant pages. You never make up information that isn't in the context. If the context doesn't contain enough information to answer the question, you say so and suggest where the user might find more information on the website."},{role:"user",content:e}],options:{num_predict:t.maxTokens,temperature:t.temperature},stream:!1})});if(!o.ok){let e=await o.text();throw Error(`Ollama API error: ${o.status} ${e}`)}let n=await o.json();return{answer:n.message?.content||"",provider:"ollama"}}async function j(e,t,r,o=15e3){let n,a,i=process.env.OPENAI_API_KEY?{provider:"openai",model:process.env.OPENAI_MODEL||"gpt-4o-mini",maxTokens:800,temperature:.3}:process.env.TOGETHER_API_KEY?{provider:"together",model:process.env.TOGETHER_MODEL||"meta-llama/Llama-3.1-8B-Instruct-Turbo",maxTokens:800,temperature:.3}:process.env.OLLAMA_BASE_URL?{provider:"ollama",model:process.env.OLLAMA_MODEL||"llama3.2",maxTokens:800,temperature:.3}:{provider:"none"};if("none"===i.provider)return null;let s=(n=[],r?.title&&n.push(`Current page: ${r.title} (${r.pathname||""})`),n.push("\nRelevant content from the website:\n"),t.forEach((e,t)=>{let r=e.excerpt||e.text||e.why||"";n.push(`
[Source ${t+1}: ${e.title}]`),n.push(`URL: ${e.href}`),n.push(`Content: ${r}`)}),a=n.join("\n"),`Answer the following question based ONLY on the context provided below. If the context doesn't contain enough information, say so clearly and suggest relevant pages from the website where the user can learn more.

Question: ${e}

${a}

Instructions:
- Answer the question using only information from the context above
- Include the exact URLs from the context in your answer using markdown links like [Page Title](URL)
- If explaining how to use a tool, provide step-by-step instructions based on the context
- If the context is about a concept (like "digitalisation"), provide a clear explanation with links
- Never make up information that isn't in the context
- If multiple sources are relevant, reference them all

Answer:`),l=new AbortController,u=setTimeout(()=>l.abort(),o);try{let e;switch(i.provider){case"openai":e=await _(s,i);break;case"together":e=await q(s,i);break;case"ollama":e=await M(s,i);break;default:return null}return clearTimeout(u),e}catch(e){if(clearTimeout(u),e instanceof Error&&"AbortError"===e.name)throw Error("LLM request timed out");throw e}}var H=e.i(757660),U=e.i(568212),B=e.i(363984),D=e.i(416810),Y=e.i(699384);let F="false"===process.env.MENTOR_ENABLED;function z(e){let t=(e.citationsV2??[]).map(e=>({title:e.title??"",urlOrPath:e.urlOrPath??"",anchorOrHeading:e.anchorOrHeading}));return t.some(e=>"/tools"===e.urlOrPath)||t.push({title:"Tools hub",urlOrPath:"/tools"}),{answer:e.answer??"No answer available.",answerMode:e.answerMode??"fallback",citationsV2:t,suggestedActions:e.suggestedActions??[],debug:e.debug}}function J(e,t){return("string"==typeof e?e:"").replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F]/g," ").replace(/\s+/g," ").trim().slice(0,t)}function K(e){return String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}function V(e,t){let r=K(e).split(" ").filter(Boolean).slice(0,5),o=[{id:"python-playground",title:"Python Playground",route:"/tools/ai/python-playground"},{id:"js-sandbox",title:"JavaScript Sandbox",route:"/tools/software-architecture/js-sandbox"},{id:"sql-sqlite",title:"SQL Sandbox",route:"/tools/data/sql-sandbox"},{id:"regex-tester",title:"Regex Tester",route:"/tools/software-architecture/regex-tester"},{id:"password-entropy",title:"Password Entropy Meter",route:"/tools/cyber/password-entropy"}].filter(e=>r.some(t=>e.title.toLowerCase().includes(t)||e.id.toLowerCase().includes(t))).slice(0,3);return{answer:o.length>0?`I found ${o.length} relevant tool${o.length>1?"s":""} that might help:

${o.map((e,t)=>`${t+1}. [${e.title}](${e.route})`).join("\n")}

Visit these tools to learn more. For deeper answers, the full search system needs to be available.`:`I don't have indexed content for "${e}" yet. Here's what you can do:

1. Check the [Tools hub](/tools) for interactive tools
2. Browse [Notes](/notes) for written content
3. Try rephrasing your question with specific tool names or keywords`,answerMode:"fallback",citationsV2:o.length>0?o.map(e=>({title:e.title,urlOrPath:e.route,anchorOrHeading:e.title})):[{title:"Tools hub",urlOrPath:"/tools"}],suggestedActions:[{label:"Visit Tools Hub",href:"/tools"},{label:"Browse Notes",href:"/notes"}],debug:{retrievalCount:0,fallbackReason:"No indexed content found or RAG system unavailable"}}}async function W(e){let t=crypto.randomUUID(),r=Date.now();return(0,R.withRequestLogging)(e,{route:"POST /api/mentor/query"},async()=>{let o={};try{if(F)return o=V("",null),x.NextResponse.json(z(o));let n=(0,v.requireSameOrigin)(e);if(n)return n;let a=(0,b.rateLimit)(e,{keyPrefix:"mentor-query",limit:10,windowMs:6e4});if(a)return a;let i=await e.json().catch(()=>null),s="string"==typeof i?.question?i.question:"",l="string"==typeof i?.pageUrl?i.pageUrl:"",u=i?.pageContext??null,c="string"==typeof i?.projectId?i.projectId.trim():"";"string"==typeof i?.note&&i.note.slice(0,8e3);let d=function(e){if(!e)return{ok:!1,cleaned:"",reason:"empty"};let t=e.replace(/<[^>]+>/g," ").trim();if(t.length>320)return{ok:!1,cleaned:"",reason:"too_long"};let r=t.toLowerCase();return E.some(e=>r.includes(e))?{ok:!1,cleaned:"",reason:"out_of_scope"}:{ok:!0,cleaned:t}}(s);if(!d.ok)return o={answer:"too_long"===d.reason?"Please ask a shorter question so I can match it to the site content.":"Please enter a valid question.",answerMode:"fallback",citationsV2:[{title:"Tools hub",urlOrPath:"/tools"}],debug:{retrievalCount:0,fallbackReason:"too_long"===d.reason?"Question too long":"Invalid question"}},x.NextResponse.json(z(o),{status:"too_long"===d.reason?413:400});let h=await (0,H.getServerSession)(U.authOptions).catch(()=>null),p=h?.user?.id||null,f=await (0,D.getWorkspaceIdentity)(e),g=null;if(c){let e=await (0,Y.getProject)({projectId:c}),t=p?e?.ownerId===p:e?.ownerId==null&&e?.workspaceSessionId===f.workspaceSessionId;if(e&&t){let e=await (0,Y.createRun)({projectId:c,toolId:"mentor-query",status:"running",inputJson:{question:s,pageUrl:l}});g=String(e.id)}}let m=new AbortController,w=setTimeout(()=>m.abort(),2500),y=!1,R=!1,T=!1,k=0;try{let n=await Promise.race([(0,B.runWithMetering)({req:e,userId:p,toolId:"mentor-query",inputBytes:Buffer.from(s).byteLength,requestedComplexityPreset:"standard",execute:async()=>{var e;let t,r=u&&"object"==typeof u?{pathname:J(u?.pathname,200)||l||"",title:J(u?.title,180),text:J(u?.text,9e3),headings:Array.isArray(u?.headings)?u.headings.map(e=>({id:J(e?.id,80),text:J(e?.text,140),depth:Number(e?.depth)||void 0})).filter(e=>e.id&&e.text):void 0,toc:Array.isArray(u?.toc)?u.toc.map(e=>({id:J(e?.id,80),text:J(e?.text,140)})).filter(e=>e.id&&e.text):void 0}:null,n=function(e,t){let r=J(t?.text,8e3);if(r.length<200)return null;let o=K(e).split(" ").filter(Boolean).slice(0,10);if(!o.length)return null;let n=r.toLowerCase(),a=o.find(e=>n.includes(e));if(!a)return null;let i=n.indexOf(a),s=Math.max(0,i-180),l=Math.min(r.length,i+260),u=r.slice(s,l).trim(),c=(Array.isArray(t?.headings)?t.headings:[]).find(e=>e?.id&&o.some(t=>String(e.text||"").toLowerCase().includes(t)))||null,d=c?.id?`${t?.pathname||""}#${c.id}`:t?.pathname||"";return{title:c?.text?String(c.text).slice(0,120):t?.title||"This page",href:d,excerpt:u}}(d.cleaned,r),a=await L(d.cleaned,l||r?.pathname||null,8);if(k=a.length,y=a.length>0||null!==n,n&&!a.some(e=>e.href===n.href)&&a.unshift({title:n.title,href:n.href,excerpt:n.excerpt,text:n.excerpt,kind:"section",score:10}),!a.length)return o=V(d.cleaned,l||r?.pathname||null),T=!0,{output:z(o),outputBytes:Buffer.byteLength(JSON.stringify(z(o)))};(0,O.incrementUsage)();let i=a[0]||null,s=!i||i.score<4&&i.score<.15,c=(e=d.cleaned,t=String(e||"").toLowerCase(),A.find(e=>e.title.toLowerCase().includes(t)||t.includes(e.id.toLowerCase()))),h="",p=[],f="fallback";try{let e=await j(d.cleaned,a.map(e=>({title:e.title,href:e.href,excerpt:e.excerpt,text:e.text,why:e.why})),r?{title:r.title,pathname:r.pathname}:void 0,12e3);e&&e.answer&&(h=e.answer,f="rag",R=!0)}catch(e){console.error("[MENTOR] LLM generation failed:",e)}if(h)for(let e of(f="rag",a.slice(0,6)))p.push({title:e.title,urlOrPath:e.href,anchorOrHeading:e.excerpt||void 0});else{f="fallback";let e=a.slice(0,5).filter(e=>e.excerpt||e.text);if(e.length>0){let t=e[0];h=`Based on the site content, here's what I found about "${d.cleaned}":

`;let r=t.excerpt||t.text||t.why||"";if(r?(h+=r.slice(0,400),r.length>400&&(h+="...")):h+=`Relevant information is available in "${t.title}".`,e.length>1)for(let t of(h+="\n\n**Additional relevant sections:**",e.slice(1,4))){let e=t.excerpt||t.text||t.why||"";e?h+=`

• **[${t.title}](${t.href})**: ${e.slice(0,200)}${e.length>200?"...":""}`:h+=`

• **[${t.title}](${t.href})**`}for(let t of(h+="\n\nVisit the linked pages below for complete information and detailed explanations.",e))p.push({title:t.title,urlOrPath:t.href,anchorOrHeading:t.excerpt?t.excerpt.slice(0,100):void 0})}else n?(h=`Based on the current page: ${n.excerpt}

For more details, visit the page sections linked below.`,p.push({title:n.title,urlOrPath:n.href,anchorOrHeading:n.title})):i&&(i.excerpt||i.text)&&(h=`From the site content: ${i.excerpt||i.text||"Relevant content found."}

Visit the linked pages below for more information.`,p.push({title:i.title,urlOrPath:i.href,anchorOrHeading:i.excerpt||i.title}))}return h&&0!==p.length?o={answer:h.length>100?h:h+"\n\nFor more details, visit the linked pages above.",answerMode:f,citationsV2:p,suggestedActions:c?[{label:`Try ${c.title}`,href:c.route}]:[{label:"Visit Tools Hub",href:"/tools"}],debug:{retrievalCount:k,fallbackReason:s?"Low confidence match":void 0}}:(o=V(d.cleaned,l||r?.pathname||null),T=!0),{output:z(o),outputBytes:Buffer.byteLength(JSON.stringify(z(o)))}}}),new Promise((e,t)=>{m.signal.addEventListener("abort",()=>{t(Error("TIMEOUT"))})})]);clearTimeout(w);let a=Date.now()-r;if(console.log(`[MENTOR] requestId=${t} duration=${a}ms retrieval=${y} model=${R} fallback=${T}`),!n.ok)return o=V(d.cleaned,l||null),g&&await (0,Y.updateRun)({runId:g,status:"failed",outputJson:z(o)}).catch(()=>{}),x.NextResponse.json(z(o));return g&&await (0,Y.updateRun)({runId:g,status:"completed",outputJson:n.output}),x.NextResponse.json(n.output)}catch(a){clearTimeout(w);let e=a instanceof Error&&"TIMEOUT"===a.message,n=Date.now()-r;return console.error(`[MENTOR] requestId=${t} duration=${n}ms error=${e?"TIMEOUT":"ERROR"}`,a),o=V(d.cleaned,l||null),T=!0,g&&await (0,Y.updateRun)({runId:g,status:"failed",outputJson:z(o)}).catch(()=>{}),x.NextResponse.json(z(o))}}catch(n){let e=Date.now()-r;return console.error(`[MENTOR] requestId=${t} duration=${e}ms fatal_error`,n),o=V("",null),x.NextResponse.json(z(o))}})}z({}),e.s(["POST",()=>W],95414);var G=e.i(95414);let Q=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/mentor/query/route",pathname:"/api/mentor/query",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/mentor/query/route.ts",nextConfigOutput:"",userland:G}),{workAsyncStorage:X,workUnitAsyncStorage:Z,serverHooks:ee}=Q;function et(){return(0,o.patchFetch)({workAsyncStorage:X,workUnitAsyncStorage:Z})}async function er(e,t,o){Q.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/mentor/query/route";x=x.replace(/\/index$/,"")||"/";let b=await Q.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:E,parsedUrl:O,isDraftMode:A,prerenderManifest:T,routerServerContext:k,isOnDemandRevalidate:$,revalidateOnlyGenerated:C,resolvedPathname:S,clientReferenceManifest:P,serverActionsManifest:N}=b,I=(0,l.normalizeAppPath)(x),L=!!(T.dynamicRoutes[I]||T.routes[S]),_=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,O,!1):t.end("This page could not be found"),null);if(L&&!A){let e=!!T.routes[S],t=T.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await _();throw new w.NoFallbackError}}let q=null;!L||Q.isDev||A||(q="/index"===(q=S)?"/":q);let M=!0===Q.isDev||!L,j=L&&!M;N&&P&&(0,i.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:P,serverActionsManifest:N,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:N})});let H=e.method||"GET",U=(0,a.getTracer)(),B=U.getActiveScopeSpan(),D={params:R,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>Q.onRequestError(e,t,o,k)},sharedContext:{buildId:v}},Y=new u.NodeNextRequest(e),F=new u.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest(Y,(0,c.signalFromNodeResponse)(t));try{let i=async e=>Q.handle(z,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${H} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${x}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&$&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(n);e.fetchMetrics=D.renderOpts.fetchMetrics;let l=D.renderOpts.pendingWaitUntil;l&&o.waitUntil&&(o.waitUntil(l),l=void 0);let u=D.renderOpts.collectedTags;if(!L)return await (0,p.sendResponse)(Y,F,a,D.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,o=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await Q.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:$})},k),t}},c=await Q.handleResponse({req:e,nextConfig:E,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:o.waitUntil,isMinimalMode:s});if(!L)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",$?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&L||d.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(Y,F,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};B?await l(B):await U.withPropagatedContext(e.headers,()=>U.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${x}`,kind:a.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await Q.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:$})}),L)throw t;return await (0,p.sendResponse)(Y,F,new Response(null,{status:500})),null}}e.s(["handler",()=>er,"patchFetch",()=>et,"routeModule",()=>Q,"serverHooks",()=>ee,"workAsyncStorage",()=>X,"workUnitAsyncStorage",()=>Z],555227)}];

//# debugId=46c5b48b-2b4f-3c3e-4c3b-8a75c43fbcd5
//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_c483a12d.js.map