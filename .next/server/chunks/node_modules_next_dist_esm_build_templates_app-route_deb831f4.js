;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="e941827d-db9a-5ada-5895-ff53cf999b9a")}catch(e){}}();
module.exports=[421823,e=>{"use strict";var t=e.i(747909),i=e.i(174017),a=e.i(996250),r=e.i(759756),n=e.i(561916),s=e.i(114444),o=e.i(837092),l=e.i(869741),u=e.i(316795),d=e.i(487718),p=e.i(995169),c=e.i(47587),m=e.i(666012),h=e.i(570101),f=e.i(626937),g=e.i(10372),y=e.i(193695);e.i(52474);var v=e.i(600220),R=e.i(89171),b=e.i(469719),w=e.i(363984),x=e.i(936426),S=e.i(657194),A=e.i(895968),C=e.i(751232),N=e.i(707986);let E=b.z.enum(["dev","cyber","data","ai","architecture","lab"]),q=b.z.enum(["light","standard","heavy"]);async function O(e){return(0,A.withRequestLogging)(e,{route:"POST /api/studios/help/query"},async()=>{let t=(0,x.requireSameOrigin)(e);if(t)return t;let i=(0,S.rateLimit)(e,{keyPrefix:"studios-help",limit:60,windowMs:6e4});if(i)return i;let a=b.z.object({studio:E,mode:b.z.enum(["chat","generate"]),question:b.z.string().optional(),example:b.z.object({type:b.z.string().min(1).max(80),projectName:b.z.string().min(1).max(120),requirements:b.z.string().max(6e3).optional()}).nullable().optional(),requestedComplexityPreset:q.optional()}).safeParse(await e.json().catch(()=>null));if(!a.success)return R.NextResponse.json({ok:!1,error:"Invalid request."},{status:400});let r=a.data.studio,n=a.data.mode,s=function(e){switch(e){case"dev":return["/dev-studio","/dev-studios"];case"cyber":return["/cyber-studio","/cyber-studios","/tools/cyber"];case"data":return["/data-studio","/data-studios","/tools/data"];case"ai":return["/ai-studio","/ai-studios","/tools/ai"];case"architecture":return["/studios/architecture-diagram-studio","/tools/software-architecture"];default:return["/studios","/tools"]}}(r),o=a.data.requestedComplexityPreset||"standard",l="dev"===r?"Dev Studio":"cyber"===r?"Cyber Studio":"data"===r?"Data Studio":"ai"===r?"AI Studio":"architecture"===r?"Architecture Diagram Studio":"Studios",u=await (0,w.runWithMetering)({req:e,userId:null,toolId:"studio-help-assistant",inputBytes:Buffer.byteLength("chat"===n?String(a.data.question||""):JSON.stringify(a.data.example||{})),requestedComplexityPreset:o,execute:async()=>{var e;if("generate"===n){let t,i,n=a.data.example,s=n?(t=((e={studio:r,type:n.type,projectName:n.projectName,requirements:n.requirements||""}).projectName||"My project").trim().slice(0,80),i=(e.requirements||"").trim().slice(0,3e3),"architecture"===e.studio&&"mermaid"===e.type?[{filename:"diagram.mmd",mime:"text/plain",description:"Mermaid flow diagram (edit names and connections).",content:`%% ${t}
%% Requirements:
`+i.split("\n").slice(0,10).map(e=>`%% - ${e}`).join("\n")+`

flowchart LR
  user((User)) --> web[Web App]
  web --> api[API]
  api --> db[(Database)]
`},{filename:"brief.md",mime:"text/markdown",description:"A short diagram brief you can attach to reviews.",content:`# Diagram brief: ${t}

## Goal
${i||"- (fill in)"}

## Boundaries
- What is inside the system
- What is outside the system

## Key risks
- (fill in)
`}]:"cyber"===e.studio&&"risk-register"===e.type?[{filename:"risk-register.csv",mime:"text/csv",description:"CSV risk register starter (edit and upload).",content:`risk_id,title,asset,threat,impact,likelihood,mitigation,owner,status
R-001,Unauthorised access,${t},Credential stuffing,High,Medium,Rate limits + MFA + monitoring,Security,Open
R-002,Data leak,${t},Misconfigured storage,High,Low,Least privilege + audits,Security,Open
`}]:"cyber"===e.studio&&"threat-model"===e.type?[{filename:"threat-model.json",mime:"application/json",description:"Threat model JSON starter.",content:JSON.stringify({project:t,version:1,requirements:i,assets:[{name:"Customer data",sensitivity:"high"}],entryPoints:["Web app","API"],threats:[{id:"T1",title:"Credential stuffing",impact:"high",mitigations:["Rate limiting","MFA","Lockout policy"]},{id:"T2",title:"SQL injection",impact:"high",mitigations:["Parameterized queries","WAF","Input validation"]}]},null,2)}]:"data"===e.studio&&"dataset-csv"===e.type?[{filename:"dataset.csv",mime:"text/csv",description:"Small synthetic dataset starter.",content:"customer_id,signup_date,plan,monthly_spend,active\nc_001,2025-10-01,basic,12.99,true\nc_002,2025-10-08,pro,29.99,true\nc_003,2025-11-02,basic,12.99,false\n"},{filename:"schema.json",mime:"application/json",description:"Schema starter for validation/governance.",content:JSON.stringify({dataset:t,columns:[{name:"customer_id",type:"string",nullable:!1},{name:"signup_date",type:"date",nullable:!1},{name:"plan",type:"string",nullable:!1},{name:"monthly_spend",type:"number",nullable:!1},{name:"active",type:"boolean",nullable:!1}],requirements:i},null,2)}]:"dev"===e.studio&&"openapi"===e.type?[{filename:"openapi.yaml",mime:"text/yaml",description:"OpenAPI starter spec.",content:`openapi: 3.0.3
info:
  title: ${t} API
  version: 1.0.0
servers:
  - url: https://api.example.com
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

# Requirements:
# ${i.replace(/\n/g,"\n# ")}
`}]:"ai"===e.studio&&"ai-studio-project"===e.type?[{filename:"ai-studio-project.json",mime:"application/json",description:"AI Studio project-style JSON starter.",content:JSON.stringify({title:t,exampleId:"story-generator",audience:"all",difficulty:"beginner",category:"ai",config:{promptTemplate:"Write a safe, kind story about: {{topic}}"},requirements:i},null,2)}]:[{filename:"project-brief.md",mime:"text/markdown",description:"Generic brief starter.",content:`# Project brief: ${t}

## Requirements
${i||"- (fill in)"}

## Next steps
- Choose the right studio section
- Upload the example file (if applicable)
- Run once, inspect output, iterate in small steps
`}]):[],o=`Generated ${s.length} file(s) for **${l}**.

Next: download a file, then upload it in the relevant studio tool and run once.`;return{output:{answer:o,files:s},outputBytes:Buffer.byteLength(JSON.stringify({answer:o,files:s}))}}let t=String(a.data.question||"").trim().slice(0,500);if(!t){let e="Ask a question, or use the example generator.";return{output:{answer:e,files:[]},outputBytes:Buffer.byteLength(JSON.stringify({answer:e,files:[]}))}}let i=((0,C.retrieveContent)(t,null,10).matches||[]).filter(e=>{var t;let i,a;return t=e.pageRoute||e.href,a=(i=String(t||"")).startsWith("http")?i:i.split("#")[0],s.some(e=>a.startsWith(e))});if(!i.length){let e=`I can help only with **${l}** right now.

Try asking about:
- what to do first (step-by-step)
- how to upload a file and what format to use
- generating an example file you can copy/paste and tailor

Scope routes: ${s.join(", ")}`;return{output:{answer:e,files:[]},outputBytes:Buffer.byteLength(JSON.stringify({answer:e,files:[]}))}}let o=i.slice(0,6).map(e=>({title:e.title,href:e.href,excerpt:e.why})),u=await (0,N.generateAnswer)(t,o,{title:`${l} Help`,pathname:`/help?studio=${r}`}).catch(()=>null),d=u?.answer?u.answer:[`I found these relevant ${l} sections and can help you apply them:`,...o.map((e,t)=>`${t+1}. ${e.title} (${e.href})`),"",`Tell me what you’re building and what you want to upload, and I’ll generate an example file tailored to your requirements.`].join("\n");return{output:{answer:d,files:[]},outputBytes:Buffer.byteLength(JSON.stringify({answer:d,files:[]}))}}});if(!u.ok)return R.NextResponse.json({ok:!1,error:u.message,estimate:u.estimate},{status:u.status});let d=u.output;return R.NextResponse.json({ok:!0,answer:d.answer||"",files:d.files||[],receipt:u.receipt})})}e.s(["POST",()=>O],264110);var P=e.i(264110);let j=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/studios/help/query/route",pathname:"/api/studios/help/query",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/studios/help/query/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:T,workUnitAsyncStorage:k,serverHooks:_}=j;function I(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:k})}async function $(e,t,a){j.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/studios/help/query/route";R=R.replace(/\/index$/,"")||"/";let b=await j.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:x,nextConfig:S,parsedUrl:A,isDraftMode:C,prerenderManifest:N,routerServerContext:E,isOnDemandRevalidate:q,revalidateOnlyGenerated:O,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:k}=b,_=(0,l.normalizeAppPath)(R),I=!!(N.dynamicRoutes[_]||N.routes[P]),$=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,A,!1):t.end("This page could not be found"),null);if(I&&!C){let e=!!N.routes[P],t=N.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await $();throw new y.NoFallbackError}}let M=null;!I||j.isDev||C||(M="/index"===(M=P)?"/":M);let H=!0===j.isDev||!I,D=I&&!H;k&&T&&(0,s.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:T,serverActionsManifest:k,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:k})});let U=e.method||"GET",L=(0,n.getTracer)(),B=L.getActiveScopeSpan(),F={params:x,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,a)=>j.onRequestError(e,t,a,E)},sharedContext:{buildId:w}},W=new u.NodeNextRequest(e),z=new u.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest(W,(0,d.signalFromNodeResponse)(t));try{let s=async e=>j.handle(J,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=L.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=i.get("next.route");if(a){let t=`${U} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${R}`)}),o=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var n,l;let u=async({previousCacheEntry:i})=>{try{if(!o&&q&&O&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(r);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=F.renderOpts.collectedTags;if(!I)return await (0,m.sendResponse)(W,z,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,a=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:a}}}}catch(t){throw(null==i?void 0:i.isStale)&&await j.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:q})},E),t}},d=await j.handleResponse({req:e,nextConfig:S,cacheKey:M,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:q,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!I)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",q?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&I||p.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(W,z,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};B?await l(B):await L.withPropagatedContext(e.headers,()=>L.trace(p.BaseServerSpan.handleRequest,{spanName:`${U} ${R}`,kind:n.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await j.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:q})}),I)throw t;return await (0,m.sendResponse)(W,z,new Response(null,{status:500})),null}}e.s(["handler",()=>$,"patchFetch",()=>I,"routeModule",()=>j,"serverHooks",()=>_,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>k],421823)}];

//# debugId=e941827d-db9a-5ada-5895-ff53cf999b9a
//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_deb831f4.js.map