;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d44d2238-b3f8-ee4e-c2a8-0d086315f474")}catch(e){}}();
module.exports=[828414,(e,t,n)=>{t.exports=e.x("next-auth",()=>require("next-auth"))},241496,(e,t,n)=>{t.exports=e.x("next-auth/providers/google",()=>require("next-auth/providers/google"))},92660,(e,t,n)=>{t.exports=e.x("next-auth/providers/email",()=>require("next-auth/providers/email"))},489521,192489,974298,420306,e=>{"use strict";let t,n,i,r,s,l;e.s(["authOptions",()=>F],489521);var o=e.i(241496),a=e.i(92660),d=e.i(254799),c=e.i(522734),u=e.i(814747);function p(e,t){try{let n=u.default.isAbsolute(e)?e:u.default.join(process.cwd(),e);if(!c.default.existsSync(n))return t;let i=c.default.readFileSync(n,"utf8");return JSON.parse(i)}catch{return t}}function m(e,t){let n,i=u.default.isAbsolute(e)?e:u.default.join(process.cwd(),e);n=u.default.dirname(i),c.default.existsSync(n)||c.default.mkdirSync(n,{recursive:!0});let r=`${i}.tmp`;c.default.writeFileSync(r,JSON.stringify(t,null,2),"utf8"),c.default.renameSync(r,i)}let f=process.env.AUTH_STORE_PATH||"data/auth.json",A={users:[],accounts:[],sessions:[],verificationTokens:[],cpdState:{}};function g(){return p(f,A)}function v(e){m(f,e)}function I(){return(0,d.randomUUID)()}function y(e){return g().users.find(t=>t.id===e)||null}function S(e){return g().users.find(t=>t.email.toLowerCase()===e.toLowerCase())||null}function k(e){let t=g(),n=t.users.findIndex(t=>t.id===e.id),i=n>=0?t.users[n]:null,r={...e,entitlements:Array.isArray(e.entitlements)&&e.entitlements.length?e.entitlements:["free"],entitlementSource:e.entitlementSource||"default",createdAt:e.createdAt||new Date().toISOString(),lastLoginAt:void 0!==e.lastLoginAt?e.lastLoginAt:i?.lastLoginAt??null,tier:e.tier||i?.tier||"registered",consent:{termsAcceptedAt:e.consent?.termsAcceptedAt!==void 0?e.consent?.termsAcceptedAt:i?.consent?.termsAcceptedAt??null,privacyAcceptedAt:e.consent?.privacyAcceptedAt!==void 0?e.consent?.privacyAcceptedAt:i?.consent?.privacyAcceptedAt??null,cpdDataUseAcceptedAt:e.consent?.cpdDataUseAcceptedAt!==void 0?e.consent?.cpdDataUseAcceptedAt:i?.consent?.cpdDataUseAcceptedAt??null}};return n>=0?t.users[n]=r:t.users.push(r),v(t),r}function T(e){let t=g(),n=t.users.findIndex(t=>t.id===e.userId);if(n<0)return null;let i=new Date().toISOString(),r=t.users[n],s=r.consent||{};return t.users[n]={...r,consent:{termsAcceptedAt:e.termsAccepted?s.termsAcceptedAt||i:null,privacyAcceptedAt:e.privacyAccepted?s.privacyAcceptedAt||i:null,cpdDataUseAcceptedAt:e.cpdDataUseAccepted?s.cpdDataUseAcceptedAt||i:null}},v(t),t.users[n]}function w(e){let t=g();t.users=t.users.filter(t=>t.id!==e),t.accounts=t.accounts.filter(t=>t.userId!==e),t.sessions=t.sessions.filter(t=>t.userId!==e),delete t.cpdState[e],v(t)}function x(e){let t=g(),n={id:I(),...e};return t.accounts=t.accounts.filter(e=>e.provider!==n.provider||e.providerAccountId!==n.providerAccountId),t.accounts.push(n),v(t),n}function D(e,t){let n=g();n.accounts=n.accounts.filter(n=>n.provider!==e||n.providerAccountId!==t),v(n)}function U(e,t){let n=g(),i=n.accounts.find(n=>n.provider===e&&n.providerAccountId===t);return i&&n.users.find(e=>e.id===i.userId)||null}function _(e){let t=g(),n={id:I(),...e};return t.sessions.push(n),v(t),n}function V(e){let t=g(),n=t.sessions.find(t=>t.sessionToken===e);if(!n)return null;let i=t.users.find(e=>e.id===n.userId);return i?{session:n,user:i}:null}function h(e,t){let n=g(),i=n.sessions.findIndex(t=>t.sessionToken===e);return i<0?null:(n.sessions[i]={...n.sessions[i],...t},v(n),n.sessions[i])}function E(e){let t=g();t.sessions=t.sessions.filter(t=>t.sessionToken!==e),v(t)}function L(e){let t=g();return t.verificationTokens.push(e),v(t),e}function O(e,t){let n=g(),i=n.verificationTokens.findIndex(n=>n.identifier===e&&n.token===t);if(i<0)return null;let r=n.verificationTokens[i];return n.verificationTokens.splice(i,1),v(n),r}function R(e){return g().cpdState[e]||null}e.s(["createId",()=>I,"createSession",()=>_,"createVerificationToken",()=>L,"deleteSession",()=>E,"deleteUser",()=>w,"getCpdState",()=>R,"getSessionAndUser",()=>V,"getUserByAccount",()=>U,"getUserByEmail",()=>S,"getUserById",()=>y,"linkAccount",()=>x,"unlinkAccount",()=>D,"updateSession",()=>h,"updateUserConsent",()=>T,"upsertUser",()=>k,"useVerificationToken",()=>O],192489),e.s(["getUserPlan",()=>G],420306),e.i(828414);let N=process.env.BILLING_STORE_PATH||"data/billing-store.json",P={userPlans:[],toolRuns:[],templateDownloads:[],donations:[]};function C(e){return p(N,P).userPlans.find(t=>t.userId===e)||null}function B(e){let t=p(N,P);t.userPlans=t.userPlans.filter(t=>t.userId!==e),t.toolRuns=t.toolRuns.filter(t=>t.userId!==e),t.templateDownloads=t.templateDownloads.filter(t=>t.userId!==e),t.donations=t.donations.filter(t=>t.userId!==e),m(N,t)}e.s(["deleteUserBillingData",()=>B,"getUserPlanRecord",()=>C],974298);let b="true"===process.env.NEXT_PUBLIC_TESTING_MODE;async function G(e){if(("true"===process.env.NEXT_PUBLIC_TESTING_MODE?{allowed:!0,reason:"testing-mode"}:{allowed:!1,reason:"disabled"}).allowed||b)return"pro";let t=C(e);if(t?.plan)return t.plan;let n=y(e),i=Array.isArray(n?.entitlements)?n.entitlements:["free"];return i.includes("commercial")?"pro":i.includes("supporter")?"supporter":"free"}var j=e.i(29173);process.env.DATABASE_URL||(process.env.DATABASE_URL="file:./data/dev.db");let M=global.__prisma||new j.PrismaClient({log:["error"]});async function q(e){let t=e.email.trim().toLowerCase();return t?M.userIdentity.upsert({where:{id:e.userId},create:{id:e.userId,email:t,provider:e.provider,providerAccountId:e.providerAccountId,lastLoginAt:new Date},update:{provider:e.provider,providerAccountId:e.providerAccountId,lastLoginAt:new Date}}):null}let H=["OWNER","ADMIN","SUPPORT","READ_ONLY"];e.i(464592);let F={adapter:(t=()=>new Date().toISOString(),{async createUser(e){let n=e.id||I();return k({id:n,email:e.email,emailVerified:e.emailVerified?new Date(e.emailVerified).toISOString():null,name:e.name||null,image:e.image||null,provider:e.provider||null,entitlements:["free"],entitlementSource:"default",createdAt:t(),lastLoginAt:t(),tier:"registered",consent:{termsAcceptedAt:null,privacyAcceptedAt:null,cpdDataUseAcceptedAt:null}}),{...e,id:n}},async getUser(e){let t=y(e);return t?{id:t.id,email:t.email,emailVerified:t.emailVerified?new Date(t.emailVerified):null,name:t.name,image:t.image}:null},async getUserByEmail(e){let t=S(e);return t?{id:t.id,email:t.email,emailVerified:t.emailVerified?new Date(t.emailVerified):null,name:t.name,image:t.image}:null},async getUserByAccount({provider:e,providerAccountId:t}){let n=U(e,t);return n?{id:n.id,email:n.email,emailVerified:n.emailVerified?new Date(n.emailVerified):null,name:n.name,image:n.image}:null},async updateUser(e){let t=y(e.id);if(!t)return e;let n=k({id:e.id,email:e.email??t.email,emailVerified:void 0!==e.emailVerified?e.emailVerified?new Date(e.emailVerified).toISOString():null:t.emailVerified,name:void 0!==e.name?e.name:t.name,image:void 0!==e.image?e.image:t.image,provider:t.provider,entitlements:Array.isArray(t.entitlements)&&t.entitlements.length?t.entitlements:["free"],entitlementSource:t.entitlementSource||"default",createdAt:t.createdAt,lastLoginAt:t.lastLoginAt??null,tier:t.tier||"registered",consent:t.consent||{termsAcceptedAt:null,privacyAcceptedAt:null,cpdDataUseAcceptedAt:null}});return{id:n.id,email:n.email,emailVerified:n.emailVerified?new Date(n.emailVerified):null,name:n.name,image:n.image}},async deleteUser(e){w(e)},async linkAccount(e){let t=x({userId:e.userId,type:e.type,provider:e.provider,providerAccountId:e.providerAccountId,refresh_token:e.refresh_token||null,access_token:e.access_token||null,expires_at:e.expires_at||null,token_type:e.token_type||null,scope:e.scope||null,id_token:e.id_token||null,session_state:e.session_state||null});return{...e,id:t.id}},async unlinkAccount({provider:e,providerAccountId:t}){D(e,t)},async createSession(e){let t=_({sessionToken:e.sessionToken,userId:e.userId,expires:e.expires.toISOString()});return{sessionToken:t.sessionToken,userId:t.userId,expires:new Date(t.expires)}},async getSessionAndUser(e){let t=V(e);if(!t)return null;let{session:n,user:i}=t;return{session:{sessionToken:n.sessionToken,userId:n.userId,expires:new Date(n.expires)},user:{id:i.id,email:i.email,emailVerified:i.emailVerified?new Date(i.emailVerified):null,name:i.name,image:i.image}}},async updateSession(e){let t=h(e.sessionToken,{expires:e.expires?e.expires.toISOString():void 0});return t?{sessionToken:t.sessionToken,userId:t.userId,expires:new Date(t.expires)}:null},async deleteSession(e){E(e)},createVerificationToken:async e=>L({identifier:e.identifier,token:e.token,expires:e.expires.toISOString()}),async useVerificationToken({identifier:e,token:t}){let n=O(e,t);return n?{identifier:n.identifier,token:n.token,expires:new Date(n.expires)}:null}}),session:{strategy:"jwt",maxAge:1209600},secret:process.env.NEXTAUTH_SECRET,providers:(n=[],i=process.env.GOOGLE_CLIENT_ID||"",r=process.env.GOOGLE_CLIENT_SECRET||"",i&&r&&n.push((0,o.default)({clientId:i,clientSecret:r})),s=process.env.EMAIL_SERVER||"",l=process.env.EMAIL_FROM||"",s&&l&&n.push((0,a.default)({server:s,from:l,maxAge:900})),n),pages:{signIn:"/signin",verifyRequest:"/signin?check=1",error:"/signin?error=auth"},events:{async signIn({user:e,account:t}){try{let n=e?.id?y(e.id):null,i=e?.id?await G(e.id):"free";n&&e?.id&&k({...n,tier:"pro"===i?"professional":"supporter"===i?"supporter":"registered",lastLoginAt:new Date().toISOString()}),e?.id&&e?.email&&t?.provider&&t?.providerAccountId&&await q({userId:e.id,email:e.email,provider:t.provider,providerAccountId:String(t.providerAccountId)})}catch{}}},callbacks:{async jwt({token:e,user:t}){try{let n=t?.id||e?.sub;if(n){let t=await M.userIdentity.findUnique({where:{id:String(n)},select:{adminRole:!0}}),i=t?.adminRole;e.adminRole="string"==typeof i&&H.includes(i)?i:null}}catch{e.adminRole=null}return e},session:async({session:e,token:t,user:n})=>(e.user&&(e.user.id=n?.id||String(t?.sub||""),e.user.adminRole=t?.adminRole||null),e)},logger:{error(e){console.error("auth:error",e)},warn(e){console.warn("auth:warn",e)},debug(){}}}}];

//# debugId=d44d2238-b3f8-ee4e-c2a8-0d086315f474
//# sourceMappingURL=%5Broot-of-the-server%5D__ff165977._.js.map