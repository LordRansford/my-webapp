{
  "version": 3,
  "sources": [],
  "debugId": "4c67351e-ef60-7624-2c18-441930e3ed43",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../src/lib/studios/auth-gating.ts","../../../src/lib/billing/creditStore.ts","../../../src/lib/tools/registry.ts","../../../src/lib/audit/creditAudit.ts"],"sourcesContent":["/**\n * Account Gating Middleware\n * \n * Enforces authentication requirements for server-side tools and credit purchases.\n * Provides structured error responses with actionable guidance.\n */\n\nimport { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth/options\";\nimport { getToolDefinition, toolRequiresAuth, isClientSideOnly } from \"@/lib/tools/registry\";\n\nexport interface AuthGateResult {\n  allowed: boolean;\n  userId?: string;\n  reason?: string;\n  action?: string;\n  statusCode?: number;\n}\n\n/**\n * Require authentication for server-side tools\n * \n * Returns error response if:\n * - Tool requires auth and user is not authenticated\n * - Tool is server_required and user is anonymous\n */\nexport async function requireAuthForServerTools(\n  toolId: string\n): Promise<AuthGateResult | NextResponse> {\n  const tool = getToolDefinition(toolId);\n  \n  if (!tool) {\n    return NextResponse.json(\n      {\n        error: \"Tool not found\",\n        code: \"TOOL_NOT_FOUND\",\n        action: \"Check tool ID and try again\",\n      },\n      { status: 404 }\n    );\n  }\n\n  // Client-side only tools don't require auth\n  if (isClientSideOnly(toolId)) {\n    return { allowed: true };\n  }\n\n  // Check if tool requires auth\n  if (toolRequiresAuth(toolId)) {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user?.id) {\n      return NextResponse.json(\n        {\n          error: \"Authentication required\",\n          code: \"AUTH_REQUIRED\",\n          reason: \"This tool requires server-side execution, which needs an account\",\n          action: \"Sign in to continue\",\n          signInUrl: \"/api/auth/signin\",\n        },\n        { status: 401 }\n      );\n    }\n\n    return {\n      allowed: true,\n      userId: session.user.id,\n    };\n  }\n\n  // Hybrid tools: auth optional but recommended for save/share\n  return { allowed: true };\n}\n\n/**\n * Deny anonymous users from server-side operations\n * \n * Use this for any server-side API endpoint that should not be accessible\n * to anonymous users, even if the tool itself is hybrid.\n */\nexport async function denyIfAnonymous(\n  operation: string\n): Promise<AuthGateResult | NextResponse> {\n  const session = await getServerSession(authOptions);\n  \n  if (!session?.user?.id) {\n    return NextResponse.json(\n      {\n        error: \"Authentication required\",\n        code: \"AUTH_REQUIRED\",\n        reason: `${operation} requires an account`,\n        action: \"Sign in to continue\",\n        signInUrl: \"/api/auth/signin\",\n      },\n      { status: 401 }\n    );\n  }\n\n  return {\n    allowed: true,\n    userId: session.user.id,\n  };\n}\n\n/**\n * Deny if insufficient credits\n * \n * Checks if user has enough credits for estimated maximum charge.\n * Returns structured error with upgrade/purchase options.\n */\nexport async function denyIfInsufficientCredits(\n  userId: string,\n  estimatedMaxCharge: number,\n  currentBalance: number\n): Promise<AuthGateResult | NextResponse> {\n  if (currentBalance < estimatedMaxCharge) {\n    const shortfall = estimatedMaxCharge - currentBalance;\n    \n    return NextResponse.json(\n      {\n        error: \"Insufficient credits\",\n        code: \"INSUFFICIENT_CREDITS\",\n        reason: `This operation requires ${estimatedMaxCharge} credits, but you have ${currentBalance}`,\n        shortfall,\n        estimatedMaxCharge,\n        currentBalance,\n        action: \"Purchase credits or upgrade your plan\",\n        purchaseUrl: \"/account/credits\",\n        upgradeUrl: \"/account/upgrade\",\n      },\n      { status: 402 } // 402 Payment Required\n    );\n  }\n\n  return { allowed: true, userId };\n}\n\n/**\n * Get user ID from session (helper)\n */\nexport async function getUserIdFromSession(): Promise<string | null> {\n  const session = await getServerSession(authOptions);\n  return session?.user?.id || null;\n}\n\n/**\n * Require authentication (generic)\n * \n * Use this for any endpoint that requires authentication.\n */\nexport async function requireAuth(\n  reason?: string\n): Promise<AuthGateResult | NextResponse> {\n  const session = await getServerSession(authOptions);\n  \n  if (!session?.user?.id) {\n    return NextResponse.json(\n      {\n        error: \"Authentication required\",\n        code: \"AUTH_REQUIRED\",\n        reason: reason || \"This operation requires an account\",\n        action: \"Sign in to continue\",\n        signInUrl: \"/api/auth/signin\",\n      },\n      { status: 401 }\n    );\n  }\n\n  return {\n    allowed: true,\n    userId: session.user.id,\n  };\n}\n","/**\n * Credit Balance Store\n * \n * Manages user credit balances, purchases, and consumption.\n * Uses Prisma if available, falls back to file-based storage.\n */\n\nimport fs from \"fs\";\nimport path from \"path\";\nimport crypto from \"crypto\";\nimport { logCreditEvent } from \"@/lib/audit/creditAudit\";\n\nconst CREDITS_FILE = path.join(process.cwd(), \"data\", \"credits.json\");\n\n// Note: This module integrates with the existing Prisma credit store\n// (src/lib/credits/store.ts) when available, falling back to file-based storage\n\ninterface CreditTransaction {\n  id: string;\n  userId: string;\n  type: \"purchase\" | \"consumption\" | \"refund\" | \"monthly_allocation\";\n  amount: number; // Positive for purchase/allocation, negative for consumption\n  toolId?: string;\n  runId?: string;\n  timestamp: string;\n  metadata?: Record<string, unknown>;\n}\n\ninterface UserCredits {\n  userId: string;\n  balance: number;\n  monthlyAllocation: number;\n  dailyCap: number;\n  transactions: CreditTransaction[];\n  lastUpdated: string;\n}\n\ninterface CreditsStore {\n  users: Record<string, UserCredits>;\n}\n\nfunction loadStore(): CreditsStore {\n  try {\n    if (fs.existsSync(CREDITS_FILE)) {\n      const content = fs.readFileSync(CREDITS_FILE, \"utf-8\");\n      return JSON.parse(content);\n    }\n  } catch (error) {\n    console.error(\"Failed to load credits store:\", error);\n  }\n  return { users: {} };\n}\n\nfunction saveStore(store: CreditsStore): void {\n  try {\n    // Ensure directory exists\n    const dir = path.dirname(CREDITS_FILE);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n    fs.writeFileSync(CREDITS_FILE, JSON.stringify(store, null, 2));\n  } catch (error) {\n    console.error(\"Failed to save credits store:\", error);\n    throw error;\n  }\n}\n\n/**\n * Get user's credit balance\n */\nexport async function getCreditBalance(userId: string): Promise<number> {\n  // Try existing Prisma store first\n  try {\n    const { getOrCreateCredits } = await import(\"@/lib/credits/store\");\n    const credits = await getOrCreateCredits(userId);\n    return credits.balance ?? 0;\n  } catch (error) {\n    // Prisma not available, fallback to file-based\n    const store = loadStore();\n    const user = store.users[userId];\n    return user?.balance ?? 0;\n  }\n}\n\n/**\n * Get user's credit account (full details)\n */\nexport function getUserCredits(userId: string): UserCredits | null {\n  const store = loadStore();\n  return store.users[userId] || null;\n}\n\n/**\n * Initialize user credits (first time)\n */\nfunction initializeUserCredits(userId: string, monthlyAllocation: number, dailyCap: number): UserCredits {\n  return {\n    userId,\n    balance: monthlyAllocation, // Start with monthly allocation\n    monthlyAllocation,\n    dailyCap,\n    transactions: [\n      {\n        id: crypto.randomUUID(),\n        userId,\n        type: \"monthly_allocation\",\n        amount: monthlyAllocation,\n        timestamp: new Date().toISOString(),\n      },\n    ],\n    lastUpdated: new Date().toISOString(),\n  };\n}\n\n/**\n * Add credits (purchase or monthly allocation)\n */\nexport function addCredits(\n  userId: string,\n  amount: number,\n  type: \"purchase\" | \"monthly_allocation\" = \"purchase\",\n  metadata?: Record<string, unknown>\n): { success: boolean; newBalance: number; transactionId: string } {\n  const store = loadStore();\n  let user = store.users[userId];\n\n  if (!user) {\n    // Initialize with default values (will be updated by plan)\n    user = initializeUserCredits(userId, 0, 0);\n    store.users[userId] = user;\n  }\n\n  const transaction: CreditTransaction = {\n    id: crypto.randomUUID(),\n    userId,\n    type,\n    amount,\n    timestamp: new Date().toISOString(),\n    metadata,\n  };\n\n  user.balance += amount;\n  user.transactions.push(transaction);\n  user.lastUpdated = new Date().toISOString();\n\n  // Keep only last 1000 transactions per user\n  if (user.transactions.length > 1000) {\n    user.transactions = user.transactions.slice(-1000);\n  }\n\n  saveStore(store);\n\n  // Audit log\n  logCreditEvent({\n    type: type === \"purchase\" ? \"credit_granted\" : \"credit_granted\",\n    userId,\n    credits: amount,\n    balance: user.balance,\n    metadata: { type, ...metadata },\n  });\n\n  return {\n    success: true,\n    newBalance: user.balance,\n    transactionId: transaction.id,\n  };\n}\n\n/**\n * Consume credits (tool execution)\n */\nexport async function consumeCredits(\n  userId: string,\n  amount: number,\n  toolId: string,\n  runId?: string,\n  metadata?: Record<string, unknown>\n): Promise<{ success: boolean; newBalance: number; transactionId: string }> {\n  // Try existing Prisma store first\n  try {\n    const { getOrCreateCredits, createCreditUsageEvent } = await import(\"@/lib/credits/store\");\n    const { prisma } = await import(\"@/lib/db/prisma\");\n    \n    const credits = await getOrCreateCredits(userId);\n    \n    if (credits.balance < amount) {\n      throw new Error(\"Insufficient credits\");\n    }\n\n    const newBalance = credits.balance - amount;\n    await prisma.credits.update({\n      where: { userId },\n      data: { balance: newBalance },\n    });\n\n    await createCreditUsageEvent({\n      userId,\n      toolId,\n      consumed: amount,\n      units: 1,\n      freeUnits: 0,\n      paidUnits: amount,\n      runId: runId || null,\n      actualCredits: amount,\n      estimatedCredits: metadata && typeof metadata === \"object\" && \"estimated\" in metadata ? (metadata.estimated as number) : undefined,\n      durationMs: metadata && typeof metadata === \"object\" && \"usage\" in metadata && metadata.usage && typeof metadata.usage === \"object\" && \"durationMs\" in metadata.usage ? (metadata.usage.durationMs as number) : undefined,\n    });\n\n    return {\n      success: true,\n      newBalance,\n      transactionId: runId || crypto.randomUUID(),\n    };\n  } catch (error) {\n    // Prisma not available or error, fallback to file-based\n    console.warn(\"Prisma credit consumption failed, using file-based:\", error);\n  }\n\n  // Fallback to file-based\n  const store = loadStore();\n  let user = store.users[userId];\n\n  if (!user) {\n    throw new Error(\"User credits not initialized\");\n  }\n\n  if (user.balance < amount) {\n    throw new Error(\"Insufficient credits\");\n  }\n\n  const transaction: CreditTransaction = {\n    id: crypto.randomUUID(),\n    userId,\n    type: \"consumption\",\n    amount: -amount,\n    toolId,\n    runId,\n    timestamp: new Date().toISOString(),\n    metadata,\n  };\n\n      user.balance -= amount;\n      user.transactions.push(transaction);\n      user.lastUpdated = new Date().toISOString();\n\n      saveStore(store);\n\n      // Audit log\n      logCreditEvent({\n        type: \"credit_charged\",\n        userId,\n        toolId,\n        runId,\n        credits: amount,\n        balance: user.balance,\n        metadata,\n      });\n\n      return {\n        success: true,\n        newBalance: user.balance,\n        transactionId: transaction.id,\n      };\n}\n\n/**\n * Refund credits (platform error)\n */\nexport function refundCredits(\n  userId: string,\n  amount: number,\n  originalTransactionId: string,\n  reason: string,\n  metadata?: Record<string, unknown>\n): { success: boolean; newBalance: number; transactionId: string } {\n  const store = loadStore();\n  const user = store.users[userId];\n\n  if (!user) {\n    throw new Error(\"User credits not initialized\");\n  }\n\n  const transaction: CreditTransaction = {\n    id: crypto.randomUUID(),\n    userId,\n    type: \"refund\",\n    amount,\n    timestamp: new Date().toISOString(),\n    metadata: {\n      ...metadata,\n      originalTransactionId,\n      reason,\n    },\n  };\n\n  user.balance += amount;\n  user.transactions.push(transaction);\n  user.lastUpdated = new Date().toISOString();\n\n  saveStore(store);\n\n  return {\n    success: true,\n    newBalance: user.balance,\n    transactionId: transaction.id,\n  };\n}\n\n/**\n * Get daily credits consumed today\n */\nexport async function getDailyCreditsConsumed(userId: string): Promise<number> {\n  // Try existing Prisma store first\n  try {\n    const { prisma } = await import(\"@/lib/db/prisma\");\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    const events = await prisma.creditUsageEvent.findMany({\n      where: {\n        userId,\n        occurredAt: { gte: today },\n      },\n      select: { consumed: true },\n    });\n\n    return events.reduce((sum, e) => sum + (e.consumed || 0), 0);\n  } catch (error) {\n    // Prisma not available, fallback to file-based\n    console.warn(\"Prisma daily credits query failed, using file-based:\", error);\n  }\n\n  // Fallback to file-based\n  const store = loadStore();\n  const user = store.users[userId];\n  if (!user) return 0;\n\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const todayISO = today.toISOString();\n\n  return user.transactions\n    .filter((t) => {\n      const txDate = new Date(t.timestamp);\n      return txDate >= today && t.type === \"consumption\" && t.amount < 0;\n    })\n    .reduce((sum, t) => sum + Math.abs(t.amount), 0);\n}\n\n/**\n * Get monthly credits consumed this month\n */\nexport async function getMonthlyCreditsConsumed(userId: string): Promise<number> {\n  // Try existing Prisma store first\n  try {\n    const { prisma } = await import(\"@/lib/db/prisma\");\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n\n    const events = await prisma.creditUsageEvent.findMany({\n      where: {\n        userId,\n        occurredAt: { gte: monthStart },\n      },\n      select: { consumed: true },\n    });\n\n    return events.reduce((sum, e) => sum + (e.consumed || 0), 0);\n  } catch (error) {\n    // Prisma not available, fallback to file-based\n    console.warn(\"Prisma monthly credits query failed, using file-based:\", error);\n  }\n\n  // Fallback to file-based\n  const store = loadStore();\n  const user = store.users[userId];\n  if (!user) return 0;\n\n  const now = new Date();\n  const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n\n  return user.transactions\n    .filter((t) => {\n      const txDate = new Date(t.timestamp);\n      return txDate >= monthStart && t.type === \"consumption\" && t.amount < 0;\n    })\n    .reduce((sum, t) => sum + Math.abs(t.amount), 0);\n}\n\n/**\n * Update user's plan limits (monthly allocation, daily cap)\n */\nexport function updateUserPlanLimits(\n  userId: string,\n  monthlyAllocation: number,\n  dailyCap: number\n): void {\n  const store = loadStore();\n  let user = store.users[userId];\n\n  if (!user) {\n    user = initializeUserCredits(userId, monthlyAllocation, dailyCap);\n    store.users[userId] = user;\n  } else {\n    // If monthly allocation increased, add the difference to balance\n    const allocationDiff = monthlyAllocation - user.monthlyAllocation;\n    if (allocationDiff > 0) {\n      addCredits(userId, allocationDiff, \"monthly_allocation\", {\n        reason: \"Plan upgrade\",\n      });\n    }\n\n    user.monthlyAllocation = monthlyAllocation;\n    user.dailyCap = dailyCap;\n    user.lastUpdated = new Date().toISOString();\n  }\n\n  saveStore(store);\n}\n\n/**\n * Get credit transaction history\n */\nexport function getTransactionHistory(\n  userId: string,\n  limit: number = 100\n): CreditTransaction[] {\n  const store = loadStore();\n  const user = store.users[userId];\n  if (!user) return [];\n\n  return user.transactions\n    .slice(-limit)\n    .reverse(); // Most recent first\n}\n","/**\n * Tool Registry - Single Source of Truth\n * \n * Defines all tools with their execution mode, pricing, limits, and requirements.\n * This is the authoritative source for tool metadata used by the credit engine,\n * access control, and UI.\n */\n\nexport type ExecutionMode = \"client_only\" | \"hybrid\" | \"server_required\";\nexport type RiskTier = \"low\" | \"medium\" | \"high\";\nexport type AvailabilityFlag = \"enabled\" | \"beta\" | \"deprecated\" | \"coming_soon\";\n\nexport interface ToolLimits {\n  cpuMsMax: number; // Maximum CPU time in milliseconds\n  memMbMax: number; // Maximum memory in MB\n  outputKbMax: number; // Maximum output size in KB\n  timeoutMs: number; // Request timeout in milliseconds\n  concurrencyMax: number; // Maximum concurrent executions per user\n}\n\nexport interface ToolPricing {\n  baseCreditsPerRun: number; // Base fee per server run (default: 2)\n  cpuMsPerCredit: number; // CPU time per credit (default: 2000ms = 1 credit per 2s)\n  memMbMsPerCredit: number; // Memory time per credit (default: 4000ms per GB = 1 credit per 4s per GB)\n  minCreditsPerRun: number; // Minimum charge (default: 3)\n  maxCreditsPerRun: number; // Tool-specific maximum cap\n}\n\nexport interface ToolDefinition {\n  toolId: string;\n  title: string;\n  category: string; // \"dev-studio\" | \"cyber-studio\" | \"data-studio\" | etc.\n  executionMode: ExecutionMode;\n  requiresAuth: boolean; // true for server_required and any \"buy credits\"\n  riskTier: RiskTier;\n  limits: ToolLimits;\n  pricing: ToolPricing;\n  availability: {\n    enabled: boolean;\n    flag: AvailabilityFlag;\n    mobileSupported: boolean;\n  };\n  description?: string;\n}\n\n// Default pricing configuration\nconst DEFAULT_PRICING: Omit<ToolPricing, \"maxCreditsPerRun\"> = {\n  baseCreditsPerRun: 2,\n  cpuMsPerCredit: 2000, // 1 credit per 2 seconds\n  memMbMsPerCredit: 4000, // 1 credit per 4 seconds per GB\n  minCreditsPerRun: 3,\n};\n\n// Default limits\nconst DEFAULT_LIMITS: ToolLimits = {\n  cpuMsMax: 5000, // 5 seconds\n  memMbMax: 512, // 512 MB\n  outputKbMax: 1024, // 1 MB\n  timeoutMs: 10000, // 10 seconds\n  concurrencyMax: 1,\n};\n\n/**\n * Tool Registry\n * \n * Add all studio tools here with their complete definitions.\n */\nexport const TOOL_REGISTRY: Record<string, ToolDefinition> = {\n  // Dev Studio Tools\n  \"dev-studio-projects\": {\n    toolId: \"dev-studio-projects\",\n    title: \"Project Builder\",\n    category: \"dev-studio\",\n    executionMode: \"client_only\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 0, // Client-side only\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Visual project scaffolding with stack selection\",\n  },\n  \"dev-studio-api-designer\": {\n    toolId: \"dev-studio-api-designer\",\n    title: \"API Designer\",\n    category: \"dev-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false, // Client-side works without auth\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5, // Save/share operations\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Design, test, and document APIs with OpenAPI export\",\n  },\n  \"dev-studio-schema-designer\": {\n    toolId: \"dev-studio-schema-designer\",\n    title: \"Database Schema Designer\",\n    category: \"dev-studio\",\n    executionMode: \"client_only\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 0,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Visual schema builder with migration generation\",\n  },\n  \"dev-studio-cicd\": {\n    toolId: \"dev-studio-cicd\",\n    title: \"CI/CD Pipeline Builder\",\n    category: \"dev-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Visual pipeline designer with GitHub Actions export\",\n  },\n  \"dev-studio-deployment\": {\n    toolId: \"dev-studio-deployment\",\n    title: \"Deployment Wizard\",\n    category: \"dev-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"high\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 30000, // 30 seconds\n      timeoutMs: 60000, // 60 seconds\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 100, // External API calls\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Multi-cloud deployment (Vercel, AWS, GCP, Azure)\",\n  },\n  \"dev-studio-security\": {\n    toolId: \"dev-studio-security\",\n    title: \"Security Scanner\",\n    category: \"dev-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"high\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 20000, // 20 seconds\n      timeoutMs: 30000, // 30 seconds\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 50, // External API calls + compute\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Automated security checklist and vulnerability scanning\",\n  },\n  \"dev-studio-performance\": {\n    toolId: \"dev-studio-performance\",\n    title: \"Performance Profiler\",\n    category: \"dev-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"medium\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 15000, // 15 seconds\n      timeoutMs: 20000, // 20 seconds\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 25, // Heavy compute\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Load testing and performance analysis\",\n  },\n  \"dev-studio-cost\": {\n    toolId: \"dev-studio-cost\",\n    title: \"Cost Calculator\",\n    category: \"dev-studio\",\n    executionMode: \"client_only\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 0,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Real-time infrastructure cost estimation\",\n  },\n  // Cyber Studio Tools\n  \"cyber-studio-threat-modeling\": {\n    toolId: \"cyber-studio-threat-modeling\",\n    title: \"Threat Model Generator\",\n    category: \"cyber-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Automated threat modeling from system descriptions\",\n  },\n  \"cyber-studio-risk-register\": {\n    toolId: \"cyber-studio-risk-register\",\n    title: \"Risk Register Builder\",\n    category: \"cyber-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Comprehensive risk tracking with mitigation plans\",\n  },\n  \"cyber-studio-compliance\": {\n    toolId: \"cyber-studio-compliance\",\n    title: \"Compliance Auditor\",\n    category: \"cyber-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"medium\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 10000, // 10 seconds\n      timeoutMs: 15000, // 15 seconds\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 25,\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Automated compliance gap analysis\",\n  },\n  \"cyber-studio-ir-playbook\": {\n    toolId: \"cyber-studio-ir-playbook\",\n    title: \"Incident Response Playbook Builder\",\n    category: \"cyber-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Create and test IR procedures\",\n  },\n  \"cyber-studio-security-architecture\": {\n    toolId: \"cyber-studio-security-architecture\",\n    title: \"Security Architecture Designer\",\n    category: \"cyber-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Visual security architecture with attack surface mapping\",\n  },\n  \"cyber-studio-vulnerability-scanner\": {\n    toolId: \"cyber-studio-vulnerability-scanner\",\n    title: \"Vulnerability Scanner\",\n    category: \"cyber-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"high\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 20000,\n      timeoutMs: 30000,\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 50, // External API calls\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Integration with OWASP, CVE databases\",\n  },\n  \"cyber-studio-metrics\": {\n    toolId: \"cyber-studio-metrics\",\n    title: \"Security Metrics Dashboard\",\n    category: \"cyber-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"KPIs, KRIs, compliance scores\",\n  },\n  \"cyber-studio-policy-generator\": {\n    toolId: \"cyber-studio-policy-generator\",\n    title: \"Security Policy Generator\",\n    category: \"cyber-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Generate policies from templates\",\n  },\n  // Data Studio Tools\n  \"data-studio-pipelines\": {\n    toolId: \"data-studio-pipelines\",\n    title: \"Data Pipeline Designer\",\n    category: \"data-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Visual ETL/ELT pipeline builder\",\n  },\n  \"data-studio-quality\": {\n    toolId: \"data-studio-quality\",\n    title: \"Data Quality Monitor\",\n    category: \"data-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"medium\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 10000,\n      timeoutMs: 15000,\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 25,\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Automated data quality checks and alerts\",\n  },\n  \"data-studio-catalog\": {\n    toolId: \"data-studio-catalog\",\n    title: \"Data Catalog Builder\",\n    category: \"data-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Automated metadata cataloging\",\n  },\n  \"data-studio-dashboards\": {\n    toolId: \"data-studio-dashboards\",\n    title: \"Analytics Dashboard Builder\",\n    category: \"data-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Drag-and-drop dashboard creation\",\n  },\n  \"data-studio-privacy\": {\n    toolId: \"data-studio-privacy\",\n    title: \"Data Privacy Impact Assessor\",\n    category: \"data-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"medium\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 10000,\n      timeoutMs: 15000,\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 25,\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"GDPR, CCPA compliance checker\",\n  },\n  \"data-studio-lineage\": {\n    toolId: \"data-studio-lineage\",\n    title: \"Data Lineage Tracker\",\n    category: \"data-studio\",\n    executionMode: \"server_required\",\n    requiresAuth: true,\n    riskTier: \"medium\",\n    limits: {\n      ...DEFAULT_LIMITS,\n      cpuMsMax: 15000,\n      timeoutMs: 20000,\n    },\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 25,\n    },\n    availability: {\n      enabled: true,\n      flag: \"beta\",\n      mobileSupported: false,\n    },\n    description: \"Automated lineage discovery and visualization\",\n  },\n  \"data-studio-schema\": {\n    toolId: \"data-studio-schema\",\n    title: \"Schema Designer\",\n    category: \"data-studio\",\n    executionMode: \"client_only\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 0,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Visual database schema design with validation\",\n  },\n  \"data-studio-governance\": {\n    toolId: \"data-studio-governance\",\n    title: \"Data Governance Framework\",\n    category: \"data-studio\",\n    executionMode: \"hybrid\",\n    requiresAuth: false,\n    riskTier: \"low\",\n    limits: DEFAULT_LIMITS,\n    pricing: {\n      ...DEFAULT_PRICING,\n      maxCreditsPerRun: 5,\n    },\n    availability: {\n      enabled: true,\n      flag: \"enabled\",\n      mobileSupported: true,\n    },\n    description: \"Policy management and enforcement\",\n  },\n};\n\n/**\n * Get tool definition by ID\n */\nexport function getToolDefinition(toolId: string): ToolDefinition | null {\n  return TOOL_REGISTRY[toolId] || null;\n}\n\n/**\n * Get all tools for a category\n */\nexport function getToolsByCategory(category: string): ToolDefinition[] {\n  return Object.values(TOOL_REGISTRY).filter((tool) => tool.category === category);\n}\n\n/**\n * Check if tool requires authentication\n */\nexport function toolRequiresAuth(toolId: string): boolean {\n  const tool = getToolDefinition(toolId);\n  return tool?.requiresAuth ?? false;\n}\n\n/**\n * Check if tool is client-side only\n */\nexport function isClientSideOnly(toolId: string): boolean {\n  const tool = getToolDefinition(toolId);\n  return tool?.executionMode === \"client_only\";\n}\n\n/**\n * Check if tool is enabled\n */\nexport function isToolEnabled(toolId: string): boolean {\n  const tool = getToolDefinition(toolId);\n  return tool?.availability.enabled ?? false;\n}\n","/**\n * Credit System Audit Logging\n * \n * Logs all credit-related events for compliance and monitoring.\n */\n\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst AUDIT_LOG_DIR = path.join(process.cwd(), \"data\", \"audit\");\nconst CREDIT_AUDIT_LOG = path.join(AUDIT_LOG_DIR, \"credits.jsonl\");\n\n// Ensure audit log directory exists\nfunction ensureAuditLogDir() {\n  if (!fs.existsSync(AUDIT_LOG_DIR)) {\n    fs.mkdirSync(AUDIT_LOG_DIR, { recursive: true });\n  }\n}\n\nexport type CreditAuditEventType =\n  | \"credit_estimate_requested\"\n  | \"credit_charged\"\n  | \"credit_refunded\"\n  | \"credit_granted\"\n  | \"credit_purchase_initiated\"\n  | \"credit_purchase_completed\"\n  | \"credit_purchase_failed\"\n  | \"spend_limit_exceeded\"\n  | \"insufficient_credits\"\n  | \"tool_execution_blocked\"\n  | \"tool_execution_allowed\"\n  | \"tool_execution_completed\"\n  | \"tool_execution_failed\";\n\nexport interface CreditAuditEvent {\n  id: string;\n  timestamp: string;\n  type: CreditAuditEventType;\n  userId: string | null;\n  toolId?: string;\n  runId?: string;\n  credits?: number;\n  balance?: number;\n  metadata?: Record<string, unknown>;\n  ip?: string | null;\n  userAgent?: string | null;\n}\n\n/**\n * Log a credit audit event\n */\nexport function logCreditEvent(event: Omit<CreditAuditEvent, \"id\" | \"timestamp\">): void {\n  try {\n    ensureAuditLogDir();\n\n    const auditEvent: CreditAuditEvent = {\n      ...event,\n      id: `${Date.now()}-${Math.random().toString(36).substring(7)}`,\n      timestamp: new Date().toISOString(),\n    };\n\n    // Append to JSONL file\n    const line = JSON.stringify(auditEvent) + \"\\n\";\n    fs.appendFileSync(CREDIT_AUDIT_LOG, line, \"utf-8\");\n  } catch (error) {\n    // Don't throw - audit logging should never break the application\n    console.error(\"Failed to log credit audit event:\", error);\n  }\n}\n\n/**\n * Read audit log entries (for admin viewing)\n */\nexport function readCreditAuditLog(\n  filters?: {\n    userId?: string;\n    type?: CreditAuditEventType;\n    startDate?: Date;\n    endDate?: Date;\n    limit?: number;\n  }\n): CreditAuditEvent[] {\n  try {\n    if (!fs.existsSync(CREDIT_AUDIT_LOG)) {\n      return [];\n    }\n\n    const content = fs.readFileSync(CREDIT_AUDIT_LOG, \"utf-8\");\n    const lines = content.trim().split(\"\\n\").filter(Boolean);\n    const events: CreditAuditEvent[] = lines.map((line) => JSON.parse(line));\n\n    // Apply filters\n    let filtered = events;\n\n    if (filters?.userId) {\n      filtered = filtered.filter((e) => e.userId === filters.userId);\n    }\n\n    if (filters?.type) {\n      filtered = filtered.filter((e) => e.type === filters.type);\n    }\n\n    if (filters?.startDate) {\n      filtered = filtered.filter((e) => new Date(e.timestamp) >= filters.startDate!);\n    }\n\n    if (filters?.endDate) {\n      filtered = filtered.filter((e) => new Date(e.timestamp) <= filters.endDate!);\n    }\n\n    // Sort by timestamp (newest first)\n    filtered.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n\n    // Apply limit\n    if (filters?.limit) {\n      filtered = filtered.slice(0, filters.limit);\n    }\n\n    return filtered;\n  } catch (error) {\n    console.error(\"Failed to read credit audit log:\", error);\n    return [];\n  }\n}\n\n/**\n * Get audit statistics\n */\nexport function getCreditAuditStats(userId?: string): {\n  totalEvents: number;\n  totalCreditsCharged: number;\n  totalCreditsGranted: number;\n  totalCreditsRefunded: number;\n  toolExecutions: number;\n  blockedExecutions: number;\n} {\n  try {\n    const events = readCreditAuditLog({ userId });\n\n    let totalCreditsCharged = 0;\n    let totalCreditsGranted = 0;\n    let totalCreditsRefunded = 0;\n    let toolExecutions = 0;\n    let blockedExecutions = 0;\n\n    events.forEach((event) => {\n      if (event.credits) {\n        if (event.type === \"credit_charged\") {\n          totalCreditsCharged += event.credits;\n        } else if (event.type === \"credit_granted\" || event.type === \"credit_purchase_completed\") {\n          totalCreditsGranted += event.credits;\n        } else if (event.type === \"credit_refunded\") {\n          totalCreditsRefunded += event.credits;\n        }\n      }\n\n      if (event.type === \"tool_execution_completed\" || event.type === \"tool_execution_allowed\") {\n        toolExecutions++;\n      }\n\n      if (event.type === \"tool_execution_blocked\" || event.type === \"spend_limit_exceeded\" || event.type === \"insufficient_credits\") {\n        blockedExecutions++;\n      }\n    });\n\n    return {\n      totalEvents: events.length,\n      totalCreditsCharged,\n      totalCreditsGranted,\n      totalCreditsRefunded,\n      toolExecutions,\n      blockedExecutions,\n    };\n  } catch (error) {\n    console.error(\"Failed to get credit audit stats:\", error);\n    return {\n      totalEvents: 0,\n      totalCreditsCharged: 0,\n      totalCreditsGranted: 0,\n      totalCreditsRefunded: 0,\n      toolExecutions: 0,\n      blockedExecutions: 0,\n    };\n  }\n}\n"],"names":[],"mappings":"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"}}]
}