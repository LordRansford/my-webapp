{
  "version": 3,
  "sources": [],
  "debugId": "29092f94-c2f9-0bd7-de2d-a43196f718de",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../src/lib/cpd/calculations.core.js","../../../src/lib/cpd/calculations.ts"],"sourcesContent":["import crypto from \"crypto\";\n\nexport const CPD_RULES_VERSION = \"v1\";\n\nexport function minutesToHours(minutes) {\n  const m = Number(minutes) || 0;\n  return Math.round((m / 60) * 10) / 10;\n}\n\nexport function hoursToMinutes(hours) {\n  const h = Number(hours) || 0;\n  return Math.max(0, Math.round(h * 60));\n}\n\nexport function validateCpdState(state) {\n  if (!state || typeof state !== \"object\") return { ok: false, error: \"State must be an object\" };\n  if (!Array.isArray(state.sections) || !Array.isArray(state.activity)) {\n    return { ok: false, error: \"State must contain sections and activity arrays\" };\n  }\n  for (const s of state.sections) {\n    if (!s.trackId || !s.levelId || !s.sectionId) return { ok: false, error: \"Section missing identifiers\" };\n    if (Number(s.minutes) < 0) return { ok: false, error: \"Section minutes must be non-negative\" };\n  }\n  for (const a of state.activity) {\n    if (!a.id || !a.trackId || !a.levelId || !a.sectionId || !a.timestamp) return { ok: false, error: \"Activity missing fields\" };\n    if (!Number.isFinite(Number(a.minutesDelta))) return { ok: false, error: \"Activity minutesDelta must be numeric\" };\n  }\n  return { ok: true };\n}\n\nexport function buildEvidenceRecord(input) {\n  const payload = {\n    ...input,\n    rulesVersion: CPD_RULES_VERSION,\n  };\n  const canonical = JSON.stringify(payload);\n  const hash = crypto.createHash(\"sha256\").update(canonical).digest(\"hex\");\n  return { ...payload, hash };\n}\n\nexport function explainCredits(state, trackId) {\n  const activity = (state?.activity || []).filter((a) => a.trackId === trackId);\n  const totalMinutesFromActivity = activity.reduce((sum, a) => sum + (Number(a.minutesDelta) || 0), 0);\n  return {\n    trackId,\n    totalMinutesFromActivity,\n    totalHoursFromActivity: minutesToHours(totalMinutesFromActivity),\n    recent: activity.slice(0, 50).map((a) => ({\n      id: a.id,\n      timestamp: a.timestamp,\n      minutesDelta: a.minutesDelta,\n      note: a.note || \"\",\n      levelId: a.levelId,\n      sectionId: a.sectionId,\n    })),\n  };\n}\n\n\n","import type { CPDState, CPDTrackId } from \"@/lib/cpd\";\nimport {\n  CPD_RULES_VERSION,\n  minutesToHours,\n  hoursToMinutes,\n  validateCpdState,\n  explainCredits,\n} from \"@/lib/cpd/calculations.core\";\n\nexport { CPD_RULES_VERSION, minutesToHours, hoursToMinutes };\n\nexport type CpdValidationResult = { ok: true } | { ok: false; error: string };\n\nexport function validateCpdStateOrThrow(state: CPDState): void {\n  const result = validateCpdState(state) as CpdValidationResult;\n  if (!result.ok) throw new Error(result.error);\n}\n\nexport type CpdCreditExplanation = ReturnType<typeof explainCredits>;\n\nexport function explainTrackCredits(state: CPDState, trackId: CPDTrackId): CpdCreditExplanation {\n  return explainCredits(state as any, trackId);\n}\n\n\n"],"names":[],"mappings":"gnCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QAIO,SAAS,EAAe,CAAO,EAEpC,OAAO,KAAK,KAAK,CAAE,CADT,OAAO,IAAY,GACN,GAAM,IAAM,EACrC,CAEO,SAAS,EAAe,CAAK,EAElC,OAAO,KAAK,GAAG,CAAC,EAAG,KAAK,KAAK,CAAC,AAAI,IADxB,OAAO,KAAU,GAE7B,CAEO,SAAS,EAAiB,CAAK,EACpC,GAAI,CAAC,GAA0B,UAAjB,OAAO,EAAoB,MAAO,CAAE,IAAI,EAAO,MAAO,yBAA0B,EAC9F,GAAI,CAAC,MAAM,OAAO,CAAC,EAAM,QAAQ,GAAK,CAAC,MAAM,OAAO,CAAC,EAAM,QAAQ,EACjE,CADoE,KAC7D,CAAE,IAAI,EAAO,MAAO,iDAAkD,EAE/E,IAAK,IAAM,KAAK,EAAM,QAAQ,CAAE,CAC9B,GAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,SAAS,CAAE,MAAO,CAAE,IAAI,EAAO,MAAO,6BAA8B,EACvG,GAAwB,EAApB,OAAO,EAAE,OAAO,EAAO,MAAO,CAAE,IAAI,EAAO,MAAO,sCAAuC,CAC/F,CACA,IAAK,IAAM,KAAK,EAAM,QAAQ,CAAE,CAC9B,GAAI,CAAC,EAAE,EAAE,EAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,SAAS,EAAI,CAAC,EAAE,SAAS,CAAE,MAAO,CAAE,IAAI,EAAO,MAAO,yBAA0B,EAC5H,GAAI,CAAC,OAAO,QAAQ,CAAC,OAAO,EAAE,YAAY,GAAI,MAAO,CAAE,IAAI,EAAO,MAAO,uCAAwC,CACnH,CACA,MAAO,CAAE,IAAI,CAAK,CACpB,CAEO,SAAS,EAAoB,CAAK,EACvC,IAAM,EAAU,CACd,GAAG,CAAK,CACR,cAAc,GAChB,EACM,EAAY,KAAK,SAAS,CAAC,GAC3B,EAAO,EAAA,OAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,GAAW,MAAM,CAAC,OAClE,MAAO,CAAE,GAAG,CAAO,CAAE,MAAK,CAC5B,CAEO,SAAS,EAAe,CAAK,CAAE,CAAO,EAC3C,IAAM,EAAW,CAAC,GAAO,UAAY,EAAA,AAAE,EAAE,MAAM,CAAC,AAAC,GAAM,EAAE,OAAO,GAAK,GAC/D,EAA2B,EAAS,MAAM,CAAC,CAAC,EAAK,IAAM,GAAO,GAAD,IAAQ,EAAE,YAAY,IAAK,CAAC,CAAG,GAClG,MAAO,SACL,2BACA,EACA,uBAAwB,EAAe,GACvC,OAAQ,EAAS,KAAK,CAAC,EAAG,IAAI,GAAG,CAAC,AAAC,IAAM,AAAC,CACxC,GAAI,EAAE,EAAE,CACR,UAAW,EAAE,SAAS,CACtB,aAAc,EAAE,YAAY,CAC5B,KAAM,EAAE,IAAI,EAAI,GAChB,QAAS,EAAE,OAAO,CAClB,UAAW,EAAE,SAAS,AACxB,CAAC,EACH,CACF,4BAtDiC,0JCDjC,IAAA,EAAA,EAAA,CAAA,CAAA,QAYO,SAAS,EAAwB,CAAe,EACrD,IAAM,EAAS,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,GAChC,GAAI,CAAC,EAAO,EAAE,CAAE,MAAM,AAAI,MAAM,EAAO,KAAK,CAC9C"}}]
}