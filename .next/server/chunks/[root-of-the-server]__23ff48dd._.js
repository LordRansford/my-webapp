;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="687c501c-65a1-3c48-1a0f-a2407ee91b04")}catch(e){}}();
module.exports=[29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},464592,e=>{"use strict";let t=new Set(["authorization","cookie","set-cookie","stripe-signature","secret","token","password","apiKey","apikey","client_secret"]);function r(e,r,s){let n={level:e,event:String(r||"").slice(0,80),ts:new Date().toISOString(),...function e(r,s=0){if(s>4)return"[TRUNCATED]";if(null==r)return r;if(Array.isArray(r))return r.slice(0,20).map(t=>e(t,s+1));if("object"!=typeof r)return r;let n={};for(let[i,a]of Object.entries(r)){let r=String(i),o=r.toLowerCase();if(t.has(o)||o.includes("secret")||o.includes("token")||o.includes("password")){n[r]=null==a?a:("string"==typeof a&&a.length,"[REDACTED]");continue}n[r]=e(a,s+1)}return n}(s&&"object"==typeof s?s:{})};"error"===e?console.error(n):"warn"===e?console.warn(n):console.log(n)}function s(e,t){r("info",e,t)}function n(e,t){r("warn",e,t)}e.s(["logInfo",()=>s,"logWarn",()=>n])},278821,e=>{"use strict";var t=e.i(902157),r=e.i(750227),s=e.i(666680);let n=process.env.CERTIFICATES_STORE_PATH||"data/certificates.json",i={certificates:[]};function a(e,s){try{let n=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);if(!t.default.existsSync(n))return s;return JSON.parse(t.default.readFileSync(n,"utf8"))}catch{return s}}function o(e,s){let n,i=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);n=r.default.dirname(i),t.default.existsSync(n)||t.default.mkdirSync(n,{recursive:!0});let a=`${i}.tmp`;t.default.writeFileSync(a,JSON.stringify(s,null,2),"utf8"),t.default.renameSync(a,i)}function u(e){let{userId:t,courseId:r,levelId:u,courseTitle:c,hoursEarned:l,completionDate:d,learnerName:f}=e,p=a(n,i),m=`${t}:${r}:${u}`,g=(p.certificates||[]).find(e=>`${e.userId}:${e.courseId}:${e.levelId}`===m);if(g)return g;let S={certificateId:s.default.randomUUID(),userId:t,courseId:r,levelId:u,courseTitle:c,hoursEarned:l,completionDate:d,issuedAt:new Date().toISOString(),version:1,learnerName:f||"",revokedAt:null};return p.certificates.push(S),o(n,p),S}function c(e){return(a(n,i).certificates||[]).find(t=>t.certificateId===e)||null}function l(e,t=""){let r=a(n,i),s=(r.certificates||[]).findIndex(t=>t.certificateId===e);return s<0?null:(r.certificates[s].revokedAt||(r.certificates[s]={...r.certificates[s],revokedAt:new Date().toISOString(),revokedReason:t||void 0},o(n,r)),r.certificates[s])}e.s(["getCertificateById",()=>c,"issueCertificate",()=>u,"revokeCertificate",()=>l])},898957,e=>{"use strict";let t=e.r(278821);t.issueCertificate;let r=t.getCertificateById;t.revokeCertificate,e.s(["getCertificateById",0,r])},439667,e=>{"use strict";var t=e.i(902157),r=e.i(750227);let s=process.env.LEARNING_RECORDS_STORE_PATH||"data/learning-records.json",n={records:[]};function i(e,s){try{let n=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);if(!t.default.existsSync(n))return s;return JSON.parse(t.default.readFileSync(n,"utf8"))}catch{return s}}function a(e){let{estimatedMinutes:t,sectionsCompleted:r,quizzesCompleted:s,toolsUsed:n}=e;return Math.min(10*Math.max(0,Number(r)||0)+5*Math.max(0,Number(s)||0)+5*Math.max(0,Number(n)||0),Math.max(0,Number(t)||0))}function o(e){let{userId:t,courseId:r,levelId:s,totalSections:n,completedSectionKeys:i,quizIdsCompleted:o,toolIdsUsed:u,estimatedMinutes:c}=e,l=i.size,d=o.size,f=u.size,p=a({estimatedMinutes:c,sectionsCompleted:l,quizzesCompleted:d,toolsUsed:f}),m=n>0&&l>=n&&d>=1?"completed":l>0||d>0||f>0?"in_progress":"not_started",g="completed"===m?new Date().toISOString():null;return{userId:t,courseId:r,levelId:s,sectionsCompleted:l,quizzesCompleted:d,toolsUsed:f,timeSpentMinutes:p,completionStatus:m,completionDate:g,updatedAt:new Date().toISOString()}}function u(e){let a,o,u,c=i(s,n),l=`${e.userId}:${e.courseId}:${e.levelId}`,d=c.records.findIndex(e=>`${e.userId}:${e.courseId}:${e.levelId}`===l),f=e;if(d>=0){let t=c.records[d],r="completed"===t.completionStatus&&t.completionDate?t.completionDate:e.completionDate;f={...e,completionDate:r},c.records[d]=f}else c.records.push(e);return a=r.default.isAbsolute(s)?s:r.default.join(process.cwd(),s),o=r.default.dirname(a),t.default.existsSync(o)||t.default.mkdirSync(o,{recursive:!0}),u=`${a}.tmp`,t.default.writeFileSync(u,JSON.stringify(c,null,2),"utf8"),t.default.renameSync(u,a),f}function c(e){return(i(s,n).records||[]).filter(t=>t.userId===e)}e.s(["calculateEarnedMinutes",()=>a,"deriveLearningRecord",()=>o,"listLearningRecordsForUser",()=>c,"upsertLearningRecord",()=>u])},439086,e=>{"use strict";var t=e.i(926747),r=e.i(190406),s=e.i(244898),n=e.i(262950),i=e.i(828414),a=e.i(489521),o=e.i(254799);class u extends Error{code;status;exposeMessage;cause;constructor(e){super(e.message),this.name="AppError",this.code=e.code,this.status=e.status,this.exposeMessage=e.exposeMessage??"Request failed.",this.cause=e.cause}}function c(e,t,r,s){let n={level:e,event:t,requestId:r.requestId,route:r.route,...s,ts:new Date().toISOString()};"error"===e?console.error(t,n):"warn"===e?console.warn(t,n):console.info(t,n)}function l(e,t,r=200,s){return s&&e.setHeader("x-request-id",s),e.status(r).json(s?{...t,requestId:s}:t)}async function d(e,t,r,s){let n,i="string"==typeof(n=e.headers["x-request-id"])?n:Array.isArray(n)&&n.length?n[0]:o.default.randomUUID(),a=Date.now();try{let e,n,o;await s({requestId:i});let u=Date.now()-a;e="api_request",n={requestId:i,route:r.route},o={status:t.statusCode,durationMs:u},c("info",e,n,o)}catch(n){let e=Date.now()-a,s=n instanceof u?n:new u({code:"INTERNAL_ERROR",status:500,message:n instanceof Error?n.message:String(n),exposeMessage:"Something went wrong.",cause:n});c("error","api_request",{requestId:i,route:r.route},{status:s.status,durationMs:e,code:s.code}),l(t,{error:{code:s.code,message:s.exposeMessage}},s.status,i)}}let f=e.r(439667);f.calculateEarnedMinutes,f.deriveLearningRecord,f.upsertLearningRecord;let p=f.listLearningRecordsForUser;e.i(898957);var m=e.i(902157),g=e.i(750227);let S=process.env.CERTIFICATES_STORE_PATH||"data/certificates.json";async function h(e,t){return d(e,t,{route:"GET /api/account/learning-summary"},async({requestId:r})=>{var s;let n,o,c;if("GET"!==e.method)throw new u({code:"VALIDATION_ERROR",status:405,message:"Method not allowed",exposeMessage:"Method not allowed"});let d=await (0,i.getServerSession)(e,t,a.authOptions);if(!d?.user?.id)throw new u({code:"UNAUTHORIZED",status:401,message:"Unauthorized",exposeMessage:"Unauthorized"});let f=(n=p(s=d.user.id),o=function(e){let t=g.default.isAbsolute(S)?S:g.default.join(process.cwd(),S);if(!m.default.existsSync(t))return[];try{return(JSON.parse(m.default.readFileSync(t,"utf8")).certificates||[]).filter(t=>t.userId===e)}catch{return[]}}(s),c=new Set(n.map(e=>e.courseId)).size,{coursesStarted:c,coursesCompleted:n.filter(e=>"completed"===e.completionStatus).length,totalCpdHours:Math.round(n.reduce((e,t)=>e+(Number(t.timeSpentMinutes)||0),0)/60*10)/10,certificatesEarned:o.length});return l(t,{email:d.user.email||null,displayName:d.user.name||null,...f},200,r)})}e.s(["default",()=>h],319332);var y=e.i(319332),w=e.i(7031),x=e.i(181927),v=e.i(846432);let I=(0,n.hoist)(y,"default"),R=(0,n.hoist)(y,"config"),A=new s.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/account/learning-summary",pathname:"/api/account/learning-summary",bundlePath:"",filename:""},userland:y,distDir:".next",relativeProjectDir:""});async function E(e,r,s){A.isDev&&(0,v.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/account/learning-summary";n=n.replace(/\/index$/,"")||"/";let i=await A.prepare(e,r,{srcPage:n});if(!i){r.statusCode=400,r.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve());return}let{query:a,params:o,prerenderManifest:u,routerServerContext:c}=i;try{let t=e.method||"GET",s=(0,w.getTracer)(),i=s.getActiveScopeSpan(),l=A.instrumentationOnRequestError.bind(A),d=async i=>A.render(e,r,{query:{...a,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:A.isDev,page:"/api/account/learning-summary",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==x.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=e.get("next.route");if(a){let e=`${t} ${a}`;i.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),i.updateName(e)}else i.updateName(`${t} ${n}`)});i?await d(i):await s.withPropagatedContext(e.headers,()=>s.trace(x.BaseServerSpan.handleRequest,{spanName:`${t} ${n}`,kind:w.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},d))}catch(e){if(A.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==s.waitUntil||s.waitUntil.call(s,Promise.resolve())}}e.s(["config",0,R,"default",0,I,"handler",()=>E],439086)}];

//# debugId=687c501c-65a1-3c48-1a0f-a2407ee91b04
//# sourceMappingURL=%5Broot-of-the-server%5D__23ff48dd._.js.map