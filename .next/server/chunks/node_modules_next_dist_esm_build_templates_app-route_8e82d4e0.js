;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6d254529-6854-4602-a673-9e5020eab460")}catch(e){}}();
module.exports=[75138,e=>{"use strict";var t=e.i(747909),r=e.i(174017),i=e.i(996250),s=e.i(759756),n=e.i(561916),a=e.i(114444),o=e.i(837092),c=e.i(869741),l=e.i(316795),d=e.i(487718),u=e.i(995169),p=e.i(47587),y=e.i(666012),h=e.i(570101),f=e.i(626937),m=e.i(10372),g=e.i(193695);e.i(52474);var b=e.i(600220),w=e.i(89171),v=e.i(757660),R=e.i(568212),I=e.i(124594),A=e.i(895968),S=e.i(936426),x=e.i(657194),C=e.i(199355),E=e.i(356846),T=e.i(685750),N=e.i(51662),k=e.i(338303),q=e.i(986225);function O(e,t,r){return`${e}:${t}:${r}`}let P={[O("cybersecurity","foundations","basics")]:{title:"What security is",href:"/cybersecurity/beginner#foundations-f0-what-security-is"},[O("cybersecurity","foundations","risk")]:{title:"Risk and outcomes",href:"/cybersecurity/beginner#foundations-f1-risk-and-outcomes"},[O("cybersecurity","foundations","crypto")]:{title:"Data and integrity",href:"/cybersecurity/beginner#foundations-f2-data-and-integrity"},[O("cybersecurity","foundations","network")]:{title:"Networks and transport",href:"/cybersecurity/beginner#foundations-f3-networks-and-transport"},[O("cybersecurity","foundations","identity")]:{title:"Identity and access",href:"/cybersecurity/beginner#foundations-f5-identity-and-access"},[O("cybersecurity","foundations","response")]:{title:"Capstone",href:"/cybersecurity/beginner#foundations-f8-foundations-capstone"},[O("cybersecurity","applied","web")]:{title:"Web app security",href:"/cybersecurity/intermediate#applied-a3-web-app-security"},[O("cybersecurity","applied","api")]:{title:"API and service security",href:"/cybersecurity/intermediate#applied-a4-api-and-service-security"},[O("cybersecurity","applied","auth")]:{title:"Identity and access control",href:"/cybersecurity/intermediate#applied-a2-identity-and-access-control"},[O("cybersecurity","applied","secrets")]:{title:"Verification and release gates",href:"/cybersecurity/intermediate#applied-a5-verification-and-release-gates"},[O("cybersecurity","applied","logging")]:{title:"Logging and detection basics",href:"/cybersecurity/intermediate#applied-a6-logging-and-detection-basics"},[O("cybersecurity","applied","cloud")]:{title:"Applied capstone",href:"/cybersecurity/intermediate#applied-a7-applied-capstone"},[O("cybersecurity","practice","sdlc")]:{title:"Secure SDLC",href:"/cybersecurity/advanced#practice-p1-secure-sdlc"},[O("cybersecurity","practice","zero-trust")]:{title:"Exposure reduction and zero trust",href:"/cybersecurity/advanced#practice-p2-exposure-reduction-zero-trust"},[O("cybersecurity","practice","runtime")]:{title:"Runtime and cloud security",href:"/cybersecurity/advanced#practice-p3-runtime-and-cloud-security"},[O("cybersecurity","practice","vulnerability")]:{title:"Vulnerability management",href:"/cybersecurity/advanced#practice-p5-vulnerability-management"},[O("cybersecurity","practice","detection")]:{title:"Detection and incident response",href:"/cybersecurity/advanced#practice-p6-detection-and-incident-response"},[O("cybersecurity","practice","governance")]:{title:"Capstone professional practice",href:"/cybersecurity/advanced#practice-p9-capstone-professional-practice"}};function M(e){let t=String(e.courseId||""),r=String(e.levelId||""),i=String(e.domain||"").trim();return t&&r&&i&&P[O(t,r,i)]||null}function D(e){try{return JSON.stringify(e??null)}catch{return"{}"}}function U(e){if(null==e)return null;if("number"==typeof e||"string"==typeof e||Array.isArray(e))return e;if("object"==typeof e){let t=e.choice;if("number"==typeof t||"string"==typeof t||Array.isArray(t))return t}return null}async function _(e){return(0,A.withRequestLogging)(e,{route:"POST /api/assessments/submit"},async()=>{let t=(0,S.requireSameOrigin)(e);if(t)return t;let r=(0,x.rateLimit)(e,{keyPrefix:"assessments-submit",limit:20,windowMs:6e4});if(r)return r;let i=await (0,v.getServerSession)(R.authOptions).catch(()=>null),s=i?.user?.id||"";if(!s)return w.NextResponse.json({message:"Unauthorized"},{status:401});let n=await e.json().catch(()=>null),a="string"==typeof n?.sessionId?n.sessionId.trim():"",o=n?.answers&&"object"==typeof n.answers?n.answers:null;if(!a||!o)return w.NextResponse.json({message:"Invalid request"},{status:400});let c=await I.prisma.assessmentSession.findUnique({where:{id:a},select:{id:!0,userId:!0,assessmentId:!0,questionIds:!0,startedAt:!0,expiresAt:!0}});if(!c||c.userId!==s)return w.NextResponse.json({message:"Session not found"},{status:404});let l=new Date;if(c.expiresAt.getTime()<=l.getTime())return await I.prisma.assessmentSession.delete({where:{id:c.id}}).catch(()=>null),w.NextResponse.json({message:"Session expired"},{status:409});let d=await I.prisma.assessment.findUnique({where:{id:c.assessmentId},select:{id:!0,courseId:!0,levelId:!0,passThreshold:!0,timeLimit:!0}});if(!d)return await I.prisma.assessmentSession.delete({where:{id:c.id}}).catch(()=>null),w.NextResponse.json({message:"Assessment not found"},{status:404});let u=(0,N.getAssessmentAttemptCredits)({courseId:d.courseId,levelId:d.levelId}),p=await (0,C.enforceCreditGate)(u,1);if(!p.ok)return(0,C.creditGateErrorResponse)(p);let y=JSON.parse(c.questionIds||"[]"),h=new Map((await I.prisma.question.findMany({where:{id:{in:y}},select:{id:!0,question:!0,options:!0,correctAnswer:!0,explanation:!0,optionRationales:!0,tags:!0,type:!0}})).map(e=>[e.id,e])),f=y.map(e=>h.get(e)).filter(Boolean),m=function(e){let t=0,r=[];for(let i of e.questions){let s=e.answers[i.id],n=U(s),a=JSON.parse(i.correctAnswer),o=!1;"number"==typeof a&&"number"==typeof n&&n===a&&(o=!0),"string"==typeof a&&"string"==typeof n&&n===a&&(o=!0),Array.isArray(a)&&Array.isArray(n)&&a.slice().sort().join("|")===n.slice().sort().join("|")&&(o=!0),o&&(t+=1),r.push({questionId:i.id,correct:o,answer:s})}let i=e.questions.length||1,s=Math.round(t/i*100);return{correct:t,total:i,percent:s,perQuestion:r}}({questions:f,answers:o}),g=m.percent>=d.passThreshold,b=Math.max(0,Math.round((l.getTime()-c.startedAt.getTime())/1e3)),A=(0,q.getActiveCourseVersion)(d.courseId);if(!(await (0,E.deductCreditsFromLots)({userId:s,credits:u})).ok)return w.NextResponse.json({message:"Insufficient credits"},{status:402});let O=await I.prisma.assessmentAttempt.create({data:{userId:s,assessmentId:d.id,courseVersion:A,questionIds:c.questionIds||"[]",score:m.percent,passed:g,answers:D(o),timeSpent:b},select:{id:!0,score:!0,passed:!0,completedAt:!0}});Array.isArray(m.perQuestion)&&m.perQuestion.length&&await I.prisma.assessmentAttemptItem.createMany({data:m.perQuestion.map(e=>({attemptId:O.id,questionId:e.questionId,correct:!!e.correct,answer:void 0===e.answer?null:D(e.answer)})),skipDuplicates:!0}).catch(()=>null),await I.prisma.assessmentSession.delete({where:{id:c.id}}).catch(()=>null),await (0,T.createCreditUsageEvent)({userId:s,toolId:"assessment-attempt",consumed:u,units:u,freeUnits:0,paidUnits:u,runId:O.id,baseFree:!1,estimatedCredits:u,actualCredits:u,meteringUnit:"fixed",durationMs:1e3*b,inputBytes:0,outputBytes:0,freeTierAppliedMs:0,paidMs:0}).catch(()=>null);let P=e.headers.get("x-forwarded-for")||"",_=P.split(",")[0]?.trim()||e.headers.get("x-real-ip")||null,j=e.headers.get("user-agent")||null;await (0,k.recordEvidence)({userId:s,courseId:d.courseId,evidenceType:"quiz",payload:{kind:"assessment",levelId:d.levelId,assessmentId:d.id,attemptId:O.id,score:O.score,passed:O.passed,timeSpentSeconds:b},requestMeta:{ip:_,userAgent:j}}).catch(()=>null);let H=!1;if(g){let e=`${d.courseId}:${d.levelId}`;await I.prisma.courseCompletion.upsert({where:{userId_courseId_courseVersion:{userId:s,courseId:e,courseVersion:A}},create:{userId:s,courseId:e,courseVersion:A,completedAt:l,score:m.percent,passed:!0},update:{completedAt:l,score:m.percent,passed:!0}}).catch(()=>null),H=!0}let $=new Map,L=f.map(e=>{let t=o[e.id],r=U(t),i=JSON.parse(e.correctAnswer),s="number"==typeof i&&"number"==typeof r&&r===i||"string"==typeof i&&"string"==typeof r&&r===i||Array.isArray(i)&&Array.isArray(r)&&i.slice().sort().join("|")===r.slice().sort().join("|"),n=function(e){for(let t of String(e||"").split(",").map(e=>e.trim()).filter(Boolean))if(t.startsWith("domain:"))return t.slice(7);return""}(e.tags)||"other",a=$.get(n)||{correct:0,total:0};return a.total+=1,s&&(a.correct+=1),$.set(n,a),{id:e.id,question:e.question,options:e.options?JSON.parse(e.options):null,userAnswer:t,correctAnswer:i,correct:s,explanation:e.explanation,optionRationales:e.optionRationales?JSON.parse(e.optionRationales):null,tags:e.tags,type:e.type}}),B=Array.from($.entries()).map(([e,t])=>{let r=t.total?Math.round(t.correct/t.total*100):0,i=M({courseId:d.courseId,levelId:d.levelId,domain:e});return{domain:e,correct:t.correct,total:t.total,percent:r,link:i}}).sort((e,t)=>e.percent-t.percent),F=B.filter(e=>e.total>=3&&e.percent<d.passThreshold).map(e=>e.domain),K=function(e){let t=String(e.levelId||""),r=[];for(let i of(r.push({title:"CPD prep pack",href:"/cybersecurity/cpd-prep",why:"Structured revision workflows that do not mirror the live bank"}),r.push({title:"Pricing",href:"/pricing",why:"CPD, certificates, donations, and compute credits"}),r.push({title:"Return to course notes",href:"foundations"===t?"/cybersecurity/beginner":"applied"===t?"/cybersecurity/intermediate":"/cybersecurity/advanced",why:"Target revision using the course path"}),e.weakDomains.slice(0,3))){let e=M({courseId:"cybersecurity",levelId:t,domain:String(i||"")});e&&r.push({title:e.title,href:e.href,why:`Revision for domain ${String(i||"")}`})}let i={risk:{title:"Risk register builder",href:"/tools/cyber/risk-register-builder",why:"Train prioritisation and mitigation clarity"},detection:{title:"Incident post mortem builder",href:"/tools/cyber/incident-post-mortem-builder",why:"Practice timeline, containment, and follow up actions"},logging:{title:"Incident post mortem builder",href:"/tools/cyber/incident-post-mortem-builder",why:"Translate logs into an investigation narrative"},web:{title:"Threat modelling lite",href:"/tools/cyber/threat-modelling-lite",why:"Rehearse common web abuse cases and mitigations"},api:{title:"Threat modelling lite",href:"/tools/cyber/threat-modelling-lite",why:"Rehearse unsafe endpoint patterns and controls"},auth:{title:"Threat modelling lite",href:"/tools/cyber/threat-modelling-lite",why:"Rehearse auth vs authorisation failure patterns"},identity:{title:"Threat modelling lite",href:"/tools/cyber/threat-modelling-lite",why:"Rehearse sessions, cookies, and access boundaries"},governance:{title:"Decision log generator",href:"/tools/software-architecture/decision-log-generator",why:"Write defensible decisions and evidence"},sdlc:{title:"Decision log generator",href:"/tools/software-architecture/decision-log-generator",why:"Capture verification steps and trade offs"},basics:{title:"Entropy and hashing",href:"/tools/cyber/entropy-hashing",why:"Reinforce core primitives with safe practice"},crypto:{title:"RSA lab",href:"/tools/cyber/rsa-lab",why:"Reinforce asymmetric crypto concepts safely"},network:{title:"Certificate viewer",href:"/tools/cyber/certificate-viewer",why:"Build confidence with browser trust cues"}};for(let t of e.weakDomains.slice(0,3)){let e=i[String(t||"").trim()];e&&r.push(e)}let s=new Set;return r.filter(e=>!(!e.href||s.has(e.href))&&(s.add(e.href),!0))}({levelId:d.levelId,weakDomains:F});return w.NextResponse.json({ok:!0,attempt:{id:O.id,score:O.score,passed:O.passed,completedAt:O.completedAt.toISOString(),timeSpentSeconds:b},assessment:{courseId:d.courseId,levelId:d.levelId,passThreshold:d.passThreshold,timeLimitMinutes:d.timeLimit??75},completionWritten:H,certificateCourseId:g?`${d.courseId}:${d.levelId}`:null,domainReport:B,nextSteps:K,review:L},{status:200})})}e.s(["POST",()=>_],58890);var j=e.i(58890);let H=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/assessments/submit/route",pathname:"/api/assessments/submit",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/assessments/submit/route.ts",nextConfigOutput:"",userland:j}),{workAsyncStorage:$,workUnitAsyncStorage:L,serverHooks:B}=H;function F(){return(0,i.patchFetch)({workAsyncStorage:$,workUnitAsyncStorage:L})}async function K(e,t,i){H.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/assessments/submit/route";w=w.replace(/\/index$/,"")||"/";let v=await H.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:R,params:I,nextConfig:A,parsedUrl:S,isDraftMode:x,prerenderManifest:C,routerServerContext:E,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,resolvedPathname:k,clientReferenceManifest:q,serverActionsManifest:O}=v,P=(0,c.normalizeAppPath)(w),M=!!(C.dynamicRoutes[P]||C.routes[k]),D=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,S,!1):t.end("This page could not be found"),null);if(M&&!x){let e=!!C.routes[k],t=C.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await D();throw new g.NoFallbackError}}let U=null;!M||H.isDev||x||(U="/index"===(U=k)?"/":U);let _=!0===H.isDev||!M,j=M&&!_;O&&q&&(0,a.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:q,serverActionsManifest:O,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:O})});let $=e.method||"GET",L=(0,n.getTracer)(),B=L.getActiveScopeSpan(),F={params:I,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>H.onRequestError(e,t,i,E)},sharedContext:{buildId:R}},K=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let a=async e=>H.handle(z,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${$} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${w}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),c=async s=>{var n,c;let l=async({previousCacheEntry:r})=>{try{if(!o&&T&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let c=F.renderOpts.pendingWaitUntil;c&&i.waitUntil&&(i.waitUntil(c),c=void 0);let l=F.renderOpts.collectedTags;if(!M)return await (0,y.sendResponse)(K,V,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,i=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await H.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:T})},E),t}},d=await H.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:o});if(!M)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&M||u.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,y.sendResponse)(K,V,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};B?await c(B):await L.withPropagatedContext(e.headers,()=>L.trace(u.BaseServerSpan.handleRequest,{spanName:`${$} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},c))}catch(t){if(t instanceof g.NoFallbackError||await H.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:T})}),M)throw t;return await (0,y.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>K,"patchFetch",()=>F,"routeModule",()=>H,"serverHooks",()=>B,"workAsyncStorage",()=>$,"workUnitAsyncStorage",()=>L],75138)}];

//# debugId=6d254529-6854-4602-a673-9e5020eab460
//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_8e82d4e0.js.map