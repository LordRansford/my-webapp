;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="b8cff5d2-4909-e39d-0231-beee835049d3")}catch(e){}}();
module.exports=[66576,a=>{"use strict";var b=a.i(508171),c=a.i(127669),d=a.i(766150),e=a.i(613483),f=a.i(524911),g=a.i(612485),h=a.i(379035),i=a.i(698887),j=a.i(190896),k=a.i(742093),l=a.i(739362),m=a.i(778529),n=a.i(324920),o=a.i(742480);function p(){let[a,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(.5),[A,B]=(0,c.useState)("Upload model outputs with true labels, scores and a group column to begin."),C=(0,c.useCallback)(a=>{let{safeFiles:b,errors:c}=(0,n.validateUpload)(a.target.files,{maxBytes:8388608,allowedExtensions:[".csv"]});c.length&&alert(c.join("\n"));let d=b[0];d&&(B("Parsing CSVâ€¦"),p(null),f.default.parse(d,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:a=>{let b=a.data;if(!b||0===b.length)return void B("The CSV file appears to be empty or malformed.");let c=Object.keys(b[0]);c.length?(p({columns:c,rows:b}),B("File loaded. Now choose the label, score and group columns, then pick a positive label and threshold."),q||r(c[0]),!s&&c.length>1&&t(c[1]),!u&&c.length>2&&v(c[2])):B("Could not detect any columns in the CSV file.")},error:a=>{B(`Failed to parse CSV: ${a.message}`)}}))},[q,s,u]),D=(0,c.useMemo)(()=>{if(!a||!q)return[];let b=new Set;for(let c of a.rows){let a=c[q];if(null==a)continue;let d=String(a).trim();d.length>0&&b.add(d)}return Array.from(b.values())},[a,q]);(0,c.useMemo)(()=>{if(!a||!u)return[];let b=new Set;for(let c of a.rows){let a=c[u];if(null==a)continue;let d=String(a).trim();d.length>0&&b.add(d)}return Array.from(b.values())},[a,u]);let E=(0,c.useMemo)(()=>{if(!a||!q||!s||!u||!w)return[];let b=new Map;for(let c of a.rows){let a=c[q],d=c[s],e=c[u];if(null==a||null==d||null==e)continue;let f=String(a).trim(),g=String(e).trim(),h="number"==typeof d?d:Number(String(d).replace(",","."));if(!Number.isFinite(h))continue;let i=b.get(g);i||(i={group:g,count:0,positivesTrue:0,predictedPositive:0,truePositive:0,falsePositive:0,falseNegative:0,negativeTrue:0,positiveRate:0,tpr:0,fpr:0},b.set(g,i)),i.count+=1;let j=f===w,k=h>=y;j?i.positivesTrue+=1:i.negativeTrue+=1,k&&(i.predictedPositive+=1),j&&k?i.truePositive+=1:!j&&k?i.falsePositive+=1:j&&!k&&(i.falseNegative+=1)}let c=[];for(let a of b.values())a.positiveRate=a.count>0?a.predictedPositive/a.count:0,a.tpr=a.positivesTrue>0?a.truePositive/a.positivesTrue:0,a.fpr=a.negativeTrue>0?a.falsePositive/a.negativeTrue:0,c.push(a);return c.sort((a,b)=>a.group.localeCompare(b.group)),c},[a,q,s,u,w,y]),F=(0,c.useMemo)(()=>{if(!E.length)return null;let a=E.map(a=>a.positiveRate),b=E.map(a=>a.tpr),c=Math.min(...a),d=Math.max(...a),e=Math.min(...b),f=Math.max(...b);return{positiveRateMin:c,positiveRateMax:d,positiveRateRatio:d>0?c/d:null,tprMin:e,tprMax:f,tprRatio:f>0?e/f:null}},[E]),G=(0,c.useMemo)(()=>E.map(a=>({group:a.group,value:Number(a.positiveRate.toFixed(3))})),[E]),H=(0,c.useMemo)(()=>E.map(a=>({group:a.group,value:Number(a.tpr.toFixed(3))})),[E]),I=(0,c.useMemo)(()=>!!a&&!!q&&!!s&&!!u&&!!w&&E.length>0,[a,q,s,u,w,E]),J=a?.columns??[];return(0,b.jsxs)(m.AiToolCard,{id:"fairness-probe-lab-title",title:"Bias and fairness probe",icon:(0,b.jsx)(d.Scale,{className:"h-4 w-4","aria-hidden":"true"}),description:"Upload model outputs, choose a group column and see how positive rates and true positive rates vary between groups.",children:[(0,b.jsx)(o.SecurityBanner,{}),(0,b.jsxs)("div",{className:"grid gap-6 xl:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-100 bg-slate-50/60 p-4 xl:col-span-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Step 1 - Upload model outputs"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Use a CSV with one row per prediction. Include the true label, a model score between 0 and 1 and at least one group column such as gender, region or customer segment."}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"fairness-upload",className:"block text-sm font-medium text-slate-700",children:"CSV file"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("label",{htmlFor:"fairness-upload",className:"inline-flex cursor-pointer items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm hover:border-sky-300 hover:text-sky-700",children:[(0,b.jsx)(e.UploadCloud,{className:"h-4 w-4","aria-hidden":"true"}),(0,b.jsx)("span",{children:"Choose file"})]}),(0,b.jsx)("input",{id:"fairness-upload",type:"file",accept:".csv,text/csv",className:"hidden",onChange:C}),(0,b.jsx)("span",{className:"text-sm text-slate-500",children:"CSV only, max 8MB. Processed locally in your browser."})]})]}),(0,b.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"label-column",className:"block text-sm font-medium text-slate-700",children:"True label column"}),(0,b.jsxs)("select",{id:"label-column",value:q,onChange:a=>r(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select label column"}),J.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"score-column",className:"block text-sm font-medium text-slate-700",children:"Score or probability column"}),(0,b.jsxs)("select",{id:"score-column",value:s,onChange:a=>t(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select score column"}),J.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Scores should be between 0 and 1. They are treated as the model's confidence in the positive class."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"group-column",className:"block text-sm font-medium text-slate-700",children:"Group column"}),(0,b.jsxs)("select",{id:"group-column",value:u,onChange:a=>v(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select group column"}),J.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Use a column like gender, country, customer segment, tariff type or any other group that you wish to analyse."})]})]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:A})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-100 bg-slate-50/60 p-4 xl:col-span-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Step 2 - Choose positive class and threshold"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"The positive label is the outcome you are most concerned about. For example, in a fraud model it might be fraud, in a safety model it might be unsafe."}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"positive-label",className:"block text-sm font-medium text-slate-700",children:"Positive label"}),(0,b.jsxs)("select",{id:"positive-label",value:w,onChange:a=>x(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select positive label"}),D.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"threshold",className:"block text-sm font-medium text-slate-700",children:"Decision threshold"}),(0,b.jsx)("input",{id:"threshold",type:"number",min:0,max:1,step:.01,value:y,onChange:a=>z(Math.min(1,Math.max(0,Number(a.target.value)))),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Scores greater than or equal to this value are treated as positive predictions."})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-slate-700",children:"Positive prediction rate by group"}),(0,b.jsx)("div",{className:"h-44 rounded-2xl border border-slate-200 bg-white px-3 py-2",children:I?(0,b.jsx)(i.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(h.BarChart,{data:G,children:[(0,b.jsx)(k.XAxis,{dataKey:"group",tick:{fontSize:9},interval:0}),(0,b.jsx)(l.YAxis,{tick:{fontSize:9},domain:[0,1],label:{value:"Positive rate",angle:-90,position:"insideLeft",fontSize:10}}),(0,b.jsx)(j.Tooltip,{contentStyle:{fontSize:10,borderRadius:12,padding:8}}),(0,b.jsx)(g.Bar,{dataKey:"value",fill:"#0f766e",radius:[8,8,0,0]})]})}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Once you have selected a positive label and threshold the chart will show how often each group is predicted as positive."})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-slate-700",children:"True positive rate by group"}),(0,b.jsx)("div",{className:"h-44 rounded-2xl border border-slate-200 bg-white px-3 py-2",children:I?(0,b.jsx)(i.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(h.BarChart,{data:H,children:[(0,b.jsx)(k.XAxis,{dataKey:"group",tick:{fontSize:9},interval:0}),(0,b.jsx)(l.YAxis,{tick:{fontSize:9},domain:[0,1],label:{value:"True positive rate",angle:-90,position:"insideLeft",fontSize:10}}),(0,b.jsx)(j.Tooltip,{contentStyle:{fontSize:10,borderRadius:12,padding:8}}),(0,b.jsx)(g.Bar,{dataKey:"value",fill:"#6366f1",radius:[8,8,0,0]})]})}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Once a positive label is chosen the chart will show how frequently the model correctly identifies positive cases for each group."})})]})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-100 bg-slate-50/60 p-4 xl:col-span-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Step 3 - Inspect group metrics and ratios"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Use this view to reason about whether the model treats groups consistently. You can adjust the threshold to see how trade offs change."}),(0,b.jsx)("div",{className:"max-h-56 overflow-auto rounded-2xl border border-slate-200 bg-white",children:(0,b.jsxs)("table",{className:"min-w-full table-fixed border-collapse text-sm text-slate-700",children:[(0,b.jsx)("thead",{className:"bg-slate-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-2 py-1 text-left font-semibold",children:"Group"}),(0,b.jsx)("th",{className:"px-2 py-1 text-right font-semibold",children:"Count"}),(0,b.jsx)("th",{className:"px-2 py-1 text-right font-semibold",children:"Pos rate"}),(0,b.jsx)("th",{className:"px-2 py-1 text-right font-semibold",children:"TPR"}),(0,b.jsx)("th",{className:"px-2 py-1 text-right font-semibold",children:"FPR"})]})}),(0,b.jsx)("tbody",{children:0===E.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"px-2 py-2 text-center text-sm text-slate-500",children:"Metrics will appear here after you upload data and choose columns."})}):E.map(a=>(0,b.jsxs)("tr",{className:"border-t border-slate-100",children:[(0,b.jsx)("td",{className:"px-2 py-1 text-left",children:a.group}),(0,b.jsx)("td",{className:"px-2 py-1 text-right",children:a.count}),(0,b.jsx)("td",{className:"px-2 py-1 text-right",children:a.positiveRate.toFixed(3)}),(0,b.jsx)("td",{className:"px-2 py-1 text-right",children:a.tpr.toFixed(3)}),(0,b.jsx)("td",{className:"px-2 py-1 text-right",children:a.fpr.toFixed(3)})]},a.group))})]})}),(0,b.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-3 text-sm text-slate-700 space-y-1",children:F&&I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"font-semibold text-slate-900",children:"Quick fairness summary"}),(0,b.jsxs)("p",{children:["The lowest positive prediction rate across groups is"," ",(0,b.jsx)("span",{className:"font-medium",children:F.positiveRateMin.toFixed(3)})," and the highest is"," ",(0,b.jsx)("span",{className:"font-medium",children:F.positiveRateMax.toFixed(3)}),"."]}),null!==F.positiveRateRatio&&(0,b.jsxs)("p",{children:["The ratio of lowest to highest positive rate is"," ",(0,b.jsx)("span",{className:"font-medium",children:F.positiveRateRatio.toFixed(3)}),". Values closer to 1 suggest more similar treatment between groups on this measure."]}),(0,b.jsxs)("p",{children:["The lowest true positive rate across groups is"," ",(0,b.jsx)("span",{className:"font-medium",children:F.tprMin.toFixed(3)})," and the highest is"," ",(0,b.jsx)("span",{className:"font-medium",children:F.tprMax.toFixed(3)}),"."]}),null!==F.tprRatio&&(0,b.jsxs)("p",{children:["The ratio of lowest to highest true positive rate is"," ",(0,b.jsx)("span",{className:"font-medium",children:F.tprRatio.toFixed(3)}),". This helps you see if some groups receive significantly fewer correct positive predictions."]}),(0,b.jsx)("p",{className:"text-slate-500",children:"This lab is not a full fairness audit. It is a practical way to see how different groups experience your model and to start conversations about whether those differences are acceptable, explainable or need action."})]}):(0,b.jsx)("p",{className:"text-slate-500",children:"Once you have uploaded data and chosen a positive label and threshold this box will highlight key differences between groups."})})]})]})]})}a.s(["FairnessProbeLab",()=>p])},569811,a=>{a.n(a.i(66576))}];

//# debugId=b8cff5d2-4909-e39d-0231-beee835049d3
//# sourceMappingURL=src_components_tools_ai_FairnessProbeLab_tsx_48d40937._.js.map