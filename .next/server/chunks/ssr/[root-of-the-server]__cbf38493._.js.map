{
  "version": 3,
  "sources": [],
  "debugId": "9cab3568-0172-a3c0-b9cb-c6f37a4a43c9",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/lib/entitlements/entitlements.js","../../../../src/hooks/useTemplateState.js","../../../../src/app/templates/cybersecurity/threat-model/page.jsx"],"sourcesContent":["const DONATION_KEY = \"template-donation-token\";\nconst PERMISSION_KEY = \"template-permission-token\";\n\nconst safeWindow = () => (typeof window !== \"undefined\" ? window : null);\n\nexport function setDonationToken(token) {\n  const win = safeWindow();\n  if (!win || !token) return;\n  win.localStorage.setItem(DONATION_KEY, token);\n}\n\nexport function getDonationToken() {\n  const win = safeWindow();\n  if (!win) return null;\n  return win.localStorage.getItem(DONATION_KEY);\n}\n\nexport function setPermissionToken(token) {\n  const win = safeWindow();\n  if (!win || !token) return;\n  win.localStorage.setItem(PERMISSION_KEY, token.trim());\n}\n\nexport function getPermissionToken() {\n  const win = safeWindow();\n  if (!win) return null;\n  const token = win.localStorage.getItem(PERMISSION_KEY);\n  return token ? token.trim() : null;\n}\n\nexport function hasDonationSupport() {\n  return Boolean(getDonationToken());\n}\n\nexport function hasPermissionToken() {\n  return Boolean(getPermissionToken());\n}\n\nexport function unlockCommercialNoAttribution() {\n  return hasDonationSupport() || hasPermissionToken();\n}\n","\"use client\";\n\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\n\nconst cloneValue = (value) => JSON.parse(JSON.stringify(typeof value === \"function\" ? value() : value));\n\nexport function useTemplateState(storageKey, initialState) {\n  const [state, setState] = useState(() => cloneValue(initialState));\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [hydrated, setHydrated] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const raw = window.localStorage.getItem(storageKey);\n    if (raw) {\n      try {\n        const parsed = JSON.parse(raw);\n        if (parsed.data !== undefined) {\n          setState(parsed.data);\n        }\n        if (parsed.lastUpdated) {\n          setLastUpdated(parsed.lastUpdated);\n        }\n      } catch (error) {\n        console.warn(\"Could not parse stored template state\", error);\n      }\n    }\n    setHydrated(true);\n  }, [storageKey]);\n\n  const persist = useCallback(\n    (nextState, timestamp) => {\n      if (typeof window === \"undefined\") return;\n      const payload = {\n        data: nextState,\n        lastUpdated: timestamp,\n      };\n      window.localStorage.setItem(storageKey, JSON.stringify(payload));\n    },\n    [storageKey]\n  );\n\n  const updateState = useCallback(\n    (updater) => {\n      setState((prev) => {\n        const next = typeof updater === \"function\" ? updater(prev) : updater;\n        const timestamp = new Date().toISOString();\n        setLastUpdated(timestamp);\n        persist(next, timestamp);\n        return next;\n      });\n    },\n    [persist]\n  );\n\n  const resetState = useCallback(() => {\n    const resetValue = cloneValue(initialState);\n    const timestamp = new Date().toISOString();\n    setState(resetValue);\n    setLastUpdated(timestamp);\n    persist(resetValue, timestamp);\n  }, [initialState, persist]);\n\n  const status = useMemo(\n    () => ({\n      hydrated,\n      lastUpdated,\n    }),\n    [hydrated, lastUpdated]\n  );\n\n  return {\n    state,\n    updateState,\n    resetState,\n    ...status,\n  };\n}\n","\"use client\";\n\nimport { useMemo } from \"react\";\nimport TemplateLayout from \"@/components/templates/TemplateLayout\";\nimport TemplateExportPanel from \"@/components/templates/TemplateExportPanel\";\nimport { useTemplateState } from \"@/hooks/useTemplateState\";\n\nconst storageKey = \"template-cyber-threat-model-v1\";\nconst templateVersion = \"1.0.0\";\nconst templateCategory = \"Cybersecurity\";\nconst attributionText =\n  \"Created by Ransford for Ransfords Notes. Internal use allowed. Commercial use requires visible attribution. Downloads will be gated in the next stage.\";\n\nconst defaultState = {\n  assets: \"Customer data lake\\nAuthentication service\\nAdmin console\\nCI/CD pipeline\",\n  threatActors: \"External attacker\\nDisgruntled insider\\nThird-party integrator\\nScript kiddie\",\n  entryPoints: \"Public web app login\\nAPI gateway\\nAdmin VPN\\nCI/CD webhook\",\n  trustBoundaries: \"Internet to edge/WAF\\nEdge to app services\\nApp services to data stores\\nCI/CD to runtime\",\n  mitigations: \"MFA on admin paths\\nWAF with managed rules\\nLeast privilege for service accounts\\nSigned releases\",\n};\n\nconst formatTimestamp = (iso) => {\n  if (!iso) return \"Not saved yet\";\n  try {\n    return new Date(iso).toLocaleString();\n  } catch (error) {\n    return iso;\n  }\n};\n\nconst toList = (value) =>\n  (value || \"\")\n    .split(\"\\n\")\n    .map((item) => item.trim())\n    .filter(Boolean);\n\nfunction CanvasCard({ id, label, hint, value, onChange }) {\n  return (\n    <div className=\"flex flex-col gap-2 rounded-2xl border border-slate-200 bg-white/90 p-5 shadow-sm\">\n      <label htmlFor={id} className=\"text-sm font-semibold text-slate-900\">\n        {label}\n      </label>\n      <textarea\n        id={id}\n        name={id}\n        value={value}\n        onChange={onChange}\n        rows={4}\n        className=\"w-full rounded-lg border border-slate-200 bg-white p-3 text-sm text-slate-800 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200\"\n      />\n      <p className=\"text-xs text-slate-600\">{hint}</p>\n    </div>\n  );\n}\n\nexport default function ThreatModelPage() {\n  const { state, updateState, resetState, lastUpdated } = useTemplateState(storageKey, defaultState);\n\n  const updateField = (field) => (event) => {\n    updateState((prev) => ({ ...prev, [field]: event.target.value }));\n  };\n\n  const lists = useMemo(\n    () => ({\n      assets: toList(state.assets),\n      threatActors: toList(state.threatActors),\n      entryPoints: toList(state.entryPoints),\n      trustBoundaries: toList(state.trustBoundaries),\n      mitigations: toList(state.mitigations),\n    }),\n    [state.assets, state.entryPoints, state.mitigations, state.threatActors, state.trustBoundaries]\n  );\n\n  const summaryPoints = useMemo(() => {\n    const keyAsset = lists.assets[0] || \"key asset\";\n    const topThreat = lists.threatActors[0] || \"threat actor\";\n    const entry = lists.entryPoints[0] || \"entry point\";\n    const boundary = lists.trustBoundaries[0] || \"trust boundary\";\n    const mitigation = lists.mitigations[0] || \"mitigation\";\n\n    return [\n      `Protect ${keyAsset} against ${topThreat}.`,\n      `Watch the entry point: ${entry}.`,\n      `Validate controls at the ${boundary} boundary.`,\n      `Primary mitigation in place: ${mitigation}.`,\n    ];\n  }, [lists.assets, lists.entryPoints, lists.mitigations, lists.threatActors, lists.trustBoundaries]);\n\n  const buildSections = () => [\n    { heading: \"Assets and value\", body: state.assets },\n    { heading: \"Threat actors\", body: state.threatActors },\n    { heading: \"Entry points\", body: state.entryPoints },\n    { heading: \"Trust boundaries\", body: state.trustBoundaries },\n    { heading: \"Mitigations and owners\", body: state.mitigations },\n    { heading: \"Auto-summary\", body: summaryPoints.join(\" \") },\n  ];\n\n  return (\n    <TemplateLayout\n      title=\"Threat Modelling Canvas\"\n      description=\"Map assets, actors, entry points, and trust boundaries with a concise summary to brief stakeholders.\"\n      audience=\"Security architects, product/security partners, platform engineers.\"\n      useCases={[\n        \"Run lightweight threat modelling on new features.\",\n        \"Document boundaries and assumptions before a pen test.\",\n        \"Align teams on mitigations and ownership.\",\n      ]}\n      instructions={[\n        \"List assets and their value.\",\n        \"Capture threat actors and likely entry points.\",\n        \"Describe key trust boundaries and the controls in place.\",\n        \"Record mitigations and owners; review the auto-summary.\",\n      ]}\n      outputTitle=\"Canvas summary\"\n      outputSummary={summaryPoints.join(\" \")}\n      outputInterpretation=\"Use this summary to brief teams and log assumptions. Expand to a full STRIDE or attack tree if risk is high.\"\n      outputNextSteps={[\n        \"Validate mitigations against the riskiest entry point.\",\n        \"Assign owners and due dates for control gaps.\",\n        \"Schedule a review after major architectural changes.\",\n      ]}\n      attributionText={attributionText}\n      version={templateVersion}\n    >\n      <TemplateExportPanel\n        templateId=\"cyber-threat-model\"\n        title=\"Threat Modelling Canvas\"\n        category={templateCategory}\n        version={templateVersion}\n        attributionText={attributionText}\n        prepareSections={buildSections}\n      />\n\n      <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n        <p className=\"text-sm font-medium text-slate-700\">Autosaves locally. Last updated: {formatTimestamp(lastUpdated)}</p>\n        <button\n          type=\"button\"\n          onClick={resetState}\n          className=\"inline-flex items-center justify-center rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-800 shadow-sm transition hover:-translate-y-0.5 hover:border-slate-300 hover:shadow focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-900\"\n        >\n          Reset template\n        </button>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        <CanvasCard\n          id=\"assets\"\n          label=\"Assets and value\"\n          hint=\"List the assets and why they matter (data sensitivity, availability needs). One per line.\"\n          value={state.assets}\n          onChange={updateField(\"assets\")}\n        />\n        <CanvasCard\n          id=\"threatActors\"\n          label=\"Threat actors\"\n          hint=\"Name specific adversaries or profiles (insider, partner, commodity attacker).\"\n          value={state.threatActors}\n          onChange={updateField(\"threatActors\")}\n        />\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        <CanvasCard\n          id=\"entryPoints\"\n          label=\"Entry points\"\n          hint=\"Where can the actor start? Web, API, physical, CI/CD, credentials, supply chain. One per line.\"\n          value={state.entryPoints}\n          onChange={updateField(\"entryPoints\")}\n        />\n        <CanvasCard\n          id=\"trustBoundaries\"\n          label=\"Trust boundaries\"\n          hint=\"Boundary crossings and expected controls (authn/z, rate limiting, validation, isolation).\"\n          value={state.trustBoundaries}\n          onChange={updateField(\"trustBoundaries\")}\n        />\n      </div>\n\n      <CanvasCard\n        id=\"mitigations\"\n        label=\"Mitigations and owners\"\n        hint=\"Current or planned mitigations with owners. Note coverage and any gaps that need review.\"\n        value={state.mitigations}\n        onChange={updateField(\"mitigations\")}\n      />\n\n      <div className=\"rounded-2xl border border-slate-200 bg-slate-50/90 p-5 shadow-sm\" aria-live=\"polite\" role=\"status\">\n        <h3 className=\"text-sm font-semibold uppercase tracking-wide text-slate-700\">Auto-generated summary</h3>\n        <ul className=\"mt-3 list-disc space-y-2 pl-5 text-sm text-slate-800\">\n          {summaryPoints.map((point, index) => (\n            <li key={index}>{point}</li>\n          ))}\n        </ul>\n      </div>\n    </TemplateLayout>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}