{
  "version": 3,
  "sources": [],
  "debugId": "675b8d3d-6c02-3500-dc4c-8b0ce486c9e9",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/app/admin/billing/credits/page.tsx"],"sourcesContent":["import Link from \"next/link\";\nimport { prisma } from \"@/lib/db/prisma\";\n\nexport const dynamic = \"force-dynamic\";\n\nexport const metadata = {\n  title: \"Admin: Credits ledger\",\n  robots: { index: false, follow: false },\n};\n\nfunction toHuman(d: any) {\n  try {\n    return new Date(d).toLocaleString();\n  } catch {\n    return String(d);\n  }\n}\n\nfunction formatPence(pence: number) {\n  const pounds = (pence / 100).toFixed(2);\n  return `Â£${pounds}`;\n}\n\nexport default async function AdminCreditsLedgerPage({\n  searchParams,\n}: {\n  searchParams: Promise<{ user?: string; type?: string; from?: string; to?: string; cursor?: string }>;\n}) {\n  const sp = await searchParams;\n  const user = (sp.user || \"\").trim();\n  const type = (sp.type || \"\").trim();\n  const from = (sp.from || \"\").trim();\n  const to = (sp.to || \"\").trim();\n  const cursor = sp.cursor || null;\n\n  const where: any = {};\n  if (user) where.userId = user;\n  if (type) where.type = type;\n  if (from || to) {\n    where.createdAt = {};\n    if (from) where.createdAt.gte = new Date(from);\n    if (to) where.createdAt.lte = new Date(to);\n  }\n\n  const take = 30;\n  let rows: any[] = [];\n  try {\n    rows = await (prisma as any).creditLedgerEvent.findMany({\n      where,\n      take: take + 1,\n      ...(cursor ? { cursor: { id: cursor }, skip: 1 } : {}),\n      orderBy: { createdAt: \"desc\" },\n      select: { id: true, userId: true, type: true, amountPence: true, reason: true, toolId: true, runId: true, createdAt: true },\n    });\n  } catch {\n    rows = [];\n  }\n\n  const next = rows.length > take ? rows[take] : null;\n  const items = rows.slice(0, take);\n\n  return (\n    <main className=\"mx-auto max-w-6xl px-4 py-10 md:px-6 lg:px-8 space-y-6\">\n      <header className=\"space-y-2\">\n        <p className=\"text-xs font-semibold text-slate-600\">Billing</p>\n        <h1 className=\"text-2xl font-semibold text-slate-900\">Credits ledger</h1>\n        <p className=\"text-slate-700\">Read-only ledger of credit events. No edits or deletions.</p>\n      </header>\n\n      <form className=\"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm flex flex-wrap gap-3 items-end\" action=\"/admin/billing/credits\">\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">User</span>\n          <input name=\"user\" defaultValue={user} placeholder=\"User ID\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">Type</span>\n          <input name=\"type\" defaultValue={type} placeholder=\"credit_spent\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">From</span>\n          <input name=\"from\" defaultValue={from} placeholder=\"YYYY-MM-DD\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">To</span>\n          <input name=\"to\" defaultValue={to} placeholder=\"YYYY-MM-DD\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <button type=\"submit\" className=\"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800\">\n          Apply\n        </button>\n      </form>\n\n      <div className=\"overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm\">\n        <table className=\"min-w-full text-sm\">\n          <thead className=\"bg-slate-50 text-slate-700\">\n            <tr>\n              {[\"Created\", \"User\", \"Type\", \"Amount\", \"Reason\", \"Tool\", \"Run\"].map((h) => (\n                <th key={h} className=\"px-4 py-3 text-left text-xs font-semibold\">\n                  {h}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((e: any) => (\n              <tr key={e.id} className=\"border-t border-slate-100\">\n                <td className=\"px-4 py-3 text-slate-700\">{toHuman(e.createdAt)}</td>\n                <td className=\"px-4 py-3 font-mono text-xs text-slate-700\">{e.userId}</td>\n                <td className=\"px-4 py-3 text-slate-900\">{e.type}</td>\n                <td className=\"px-4 py-3 text-slate-900\">{formatPence(Number(e.amountPence || 0))}</td>\n                <td className=\"px-4 py-3 text-slate-700\">\n                  <Link href={`/admin/billing/credits/${encodeURIComponent(e.id)}`} className=\"font-semibold text-emerald-700 hover:underline\">\n                    {e.reason}\n                  </Link>\n                </td>\n                <td className=\"px-4 py-3 text-slate-700\">{e.toolId || \"\"}</td>\n                <td className=\"px-4 py-3 text-slate-700\">{e.runId || \"\"}</td>\n              </tr>\n            ))}\n            {items.length === 0 ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-8 text-center text-slate-600\">\n                  No ledger entries.\n                </td>\n              </tr>\n            ) : null}\n          </tbody>\n        </table>\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Link href=\"/admin/billing\" className=\"text-sm font-semibold text-emerald-700 hover:underline\">\n          Back to billing overview\n        </Link>\n        {next ? (\n          <Link\n            href={`/admin/billing/credits?user=${encodeURIComponent(user)}&type=${encodeURIComponent(type)}&from=${encodeURIComponent(from)}&to=${encodeURIComponent(\n              to\n            )}&cursor=${encodeURIComponent(next.id)}`}\n            className=\"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400\"\n          >\n            Next page\n          </Link>\n        ) : (\n          <span className=\"text-xs text-slate-500\">End</span>\n        )}\n      </div>\n    </main>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}}]
}