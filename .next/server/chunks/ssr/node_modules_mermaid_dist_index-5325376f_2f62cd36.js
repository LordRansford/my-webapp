;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="40118f0f-0b92-db6b-3119-610b8bb143b4")}catch(e){}}();
module.exports=[336515,230038,a=>{"use strict";a.i(858762);var b=a.i(783287),c=a.i(226670),d=a.i(133337),d=d,e=a.i(990118);a.i(977739);var f=a.i(661256);function g(a){var b,f,g={options:{directed:a.isDirected(),multigraph:a.isMultigraph(),compound:a.isCompound()},nodes:(b=a,e.map(b.nodes(),function(a){var d=b.node(a),e=b.parent(a),f={v:a};return c.isUndefined(d)||(f.value=d),c.isUndefined(e)||(f.parent=e),f})),edges:(f=a,e.map(f.edges(),function(a){var b=f.edge(a),d={v:a.v,w:a.w};return c.isUndefined(a.name)||(d.name=a.name),c.isUndefined(b)||(d.value=b),d}))};return c.isUndefined(a.graph())||(g.value=d.default(a.graph())),g}a.s(["write",()=>g],230038);var h=a.i(890969),i=a.i(407860);a.i(797774);var j=a.i(670963);a.i(975930);var k=a.i(671731);let l={},m={},n={},o=(a,b)=>(i.l.trace("In isDescendant",b," ",a," = ",m[b].includes(a)),!!m[b].includes(a)),p=(a,b,c,d)=>{i.l.warn("Copying children of ",a,"root",d,"data",b.node(a),d);let e=b.children(a)||[];a!==d&&e.push(a),i.l.warn("Copying (nodes) clusterId",a,"nodes",e),e.forEach(e=>{if(b.children(e).length>0)p(e,b,c,d);else{let f=b.node(e);i.l.info("cp ",e," to ",d," with parent ",a),c.setNode(e,f),d!==b.parent(e)&&(i.l.warn("Setting parent",e,b.parent(e)),c.setParent(e,b.parent(e))),a!==d&&e!==a?(i.l.debug("Setting parent",e,a),c.setParent(e,a)):(i.l.info("In copy ",a,"root",d,"data",b.node(a),d),i.l.debug("Not Setting parent for node=",e,"cluster!==rootId",a!==d,"node!==clusterId",e!==a));let g=b.edges(e);i.l.debug("Copying Edges",g),g.forEach(e=>{i.l.info("Edge",e);let f=b.edge(e.v,e.w,e.name);i.l.info("Edge data",f,d);try{(i.l.info("Descendants of ",d," is ",m[d]),i.l.info("Edge is ",e),e.v!==d&&e.w!==d&&(m[d]?m[d].includes(e.v)||o(e.v,d)||o(e.w,d)||m[d].includes(e.w):(i.l.debug("Tilt, ",d,",not in descendants"),!1)))?(i.l.info("Copying as ",e.v,e.w,f,e.name),c.setEdge(e.v,e.w,f,e.name),i.l.info("newGraph edges ",c.edges(),c.edge(c.edges()[0]))):i.l.info("Skipping copy of edge ",e.v,"-->",e.w," rootId: ",d," clusterId:",a)}catch(a){i.l.error(a)}})}i.l.debug("Removing node",e),b.removeNode(e)})},q=(a,b)=>{let c=b.children(a),d=[...c];for(let e of c)n[e]=a,d=[...d,...q(e,b)];return d},r=(a,b)=>{i.l.trace("Searching",a);let c=b.children(a);if(i.l.trace("Searching children of id ",a,c),c.length<1)return i.l.trace("This is a valid node",a),a;for(let d of c){let c=r(d,b);if(c)return i.l.trace("Found replacement for",a," => ",c),c}},s=a=>l[a]&&l[a].externalConnections&&l[a]?l[a].id:a,t=(a,b)=>{if(i.l.warn("extractor - ",b,g(a),a.children("D")),b>10)return void i.l.error("Bailing out");let c=a.nodes(),d=!1;for(let b of c){let c=a.children(b);d=d||c.length>0}if(!d)return void i.l.debug("Done, no node has children",a.nodes());for(let d of(i.l.debug("Nodes = ",c,b),c))if(i.l.debug("Extracting node",d,l,l[d]&&!l[d].externalConnections,!a.parent(d),a.node(d),a.children("D")," Depth ",b),l[d])if(!l[d].externalConnections&&a.children(d)&&a.children(d).length>0){i.l.warn("Cluster without external connections, without a parent and with children",d,b);let c="TB"===a.graph().rankdir?"LR":"TB";l[d]&&l[d].clusterData&&l[d].clusterData.dir&&(c=l[d].clusterData.dir,i.l.warn("Fixing dir",l[d].clusterData.dir,c));let e=new f.Graph({multigraph:!0,compound:!0}).setGraph({rankdir:c,nodesep:50,ranksep:50,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});i.l.warn("Old graph before copy",g(a)),p(d,a,e,d),a.setNode(d,{clusterNode:!0,id:d,clusterData:l[d].clusterData,labelText:l[d].labelText,graph:e}),i.l.warn("New graph after copy node: (",d,")",g(e)),i.l.debug("Old graph after copy",g(a))}else i.l.warn("Cluster ** ",d," **not meeting the criteria !externalConnections:",!l[d].externalConnections," no parent: ",!a.parent(d)," children ",a.children(d)&&a.children(d).length>0,a.children("D"),b),i.l.debug(l);else i.l.debug("Not a cluster",d,b);for(let d of(c=a.nodes(),i.l.warn("New list of nodes",c),c)){let c=a.node(d);i.l.warn(" Now next level",d,c),c.clusterNode&&t(c.graph,b+1)}},u=(a,b)=>{if(0===b.length)return[];let c=Object.assign(b);return b.forEach(b=>{let d=a.children(b),e=u(a,d);c=[...c,...e]}),c},v={rect:(a,b)=>{i.l.info("Creating subgraph rect for ",b.id,b);let c=(0,i.c)(),d=a.insert("g").attr("class","cluster"+(b.class?" "+b.class:"")).attr("id",b.id),e=d.insert("rect",":first-child"),f=(0,i.m)(c.flowchart.htmlLabels),g=d.insert("g").attr("class","cluster-label"),l="markdown"===b.labelType?(0,j.a)(g,b.labelText,{style:b.labelStyle,useHtmlLabels:f}):g.node().appendChild((0,h.c)(b.labelText,b.labelStyle,void 0,!0)),m=l.getBBox();if((0,i.m)(c.flowchart.htmlLabels)){let a=l.children[0],b=(0,k.select)(l);m=a.getBoundingClientRect(),b.attr("width",m.width),b.attr("height",m.height)}let n=0*b.padding,o=b.width<=m.width+n?m.width+n:b.width;b.width<=m.width+n?b.diff=(m.width-b.width)/2-b.padding/2:b.diff=-b.padding/2,i.l.trace("Data ",b,JSON.stringify(b)),e.attr("style",b.style).attr("rx",b.rx).attr("ry",b.ry).attr("x",b.x-o/2).attr("y",b.y-b.height/2-n/2).attr("width",o).attr("height",b.height+n);let{subGraphTitleTopMargin:p}=(0,h.g)(c);f?g.attr("transform",`translate(${b.x-m.width/2}, ${b.y-b.height/2+p})`):g.attr("transform",`translate(${b.x}, ${b.y-b.height/2+p})`);let q=e.node().getBBox();return b.width=q.width,b.height=q.height,b.intersect=function(a){return(0,h.i)(b,a)},d},roundedWithTitle:(a,b)=>{let c=(0,i.c)(),d=a.insert("g").attr("class",b.classes).attr("id",b.id),e=d.insert("rect",":first-child"),f=d.insert("g").attr("class","cluster-label"),g=d.append("rect"),j=f.node().appendChild((0,h.c)(b.labelText,b.labelStyle,void 0,!0)),l=j.getBBox();if((0,i.m)(c.flowchart.htmlLabels)){let a=j.children[0],b=(0,k.select)(j);l=a.getBoundingClientRect(),b.attr("width",l.width),b.attr("height",l.height)}l=j.getBBox();let m=0*b.padding,n=m/2,o=b.width<=l.width+b.padding?l.width+b.padding:b.width;b.width<=l.width+b.padding?b.diff=(l.width+0*b.padding-b.width)/2:b.diff=-b.padding/2,e.attr("class","outer").attr("x",b.x-o/2-n).attr("y",b.y-b.height/2-n).attr("width",o+m).attr("height",b.height+m),g.attr("class","inner").attr("x",b.x-o/2-n).attr("y",b.y-b.height/2-n+l.height-1).attr("width",o+m).attr("height",b.height+m-l.height-3);let{subGraphTitleTopMargin:p}=(0,h.g)(c);return f.attr("transform",`translate(${b.x-l.width/2}, ${b.y-b.height/2-b.padding/3+((0,i.m)(c.flowchart.htmlLabels)?5:3)+p})`),b.height=e.node().getBBox().height,b.intersect=function(a){return(0,h.i)(b,a)},d},noteGroup:(a,b)=>{let c=a.insert("g").attr("class","note-cluster").attr("id",b.id),d=c.insert("rect",":first-child"),e=0*b.padding,f=e/2;d.attr("rx",b.rx).attr("ry",b.ry).attr("x",b.x-b.width/2-f).attr("y",b.y-b.height/2-f).attr("width",b.width+e).attr("height",b.height+e).attr("fill","none");let g=d.node().getBBox();return b.width=g.width,b.height=g.height,b.intersect=function(a){return(0,h.i)(b,a)},c},divider:(a,b)=>{let c=a.insert("g").attr("class",b.classes).attr("id",b.id),d=c.insert("rect",":first-child"),e=0*b.padding;d.attr("class","divider").attr("x",b.x-b.width/2-e/2).attr("y",b.y-b.height/2).attr("width",b.width+e).attr("height",b.height+e);let f=d.node().getBBox();return b.width=f.width,b.height=f.height,b.diff=-b.padding/2,b.intersect=function(a){return(0,h.i)(b,a)},c}},w={},x=async(a,c,d,e,f,j)=>{i.l.info("Graph in recursive render: XXX",g(c),f);let k=c.graph().rankdir;i.l.trace("Dir in recursive render - dir:",k);let m=a.insert("g").attr("class","root");c.nodes()?i.l.info("Recursive render XXX",c.nodes()):i.l.info("No nodes found for",c),c.edges().length>0&&i.l.trace("Recursive edges",c.edge(c.edges()[0]));let n=m.insert("g").attr("class","clusters"),o=m.insert("g").attr("class","edgePaths"),p=m.insert("g").attr("class","edgeLabels"),q=m.insert("g").attr("class","nodes");await Promise.all(c.nodes().map(async function(a){let b=c.node(a);if(void 0!==f){let b=JSON.parse(JSON.stringify(f.clusterData));i.l.info("Setting data for cluster XXX (",a,") ",b,f),c.setNode(f.id,b),c.parent(a)||(i.l.trace("Setting parent",a,f.id),c.setParent(a,f.id,b))}if(i.l.info("(Insert) Node XXX"+a+": "+JSON.stringify(c.node(a))),b&&b.clusterNode){i.l.info("Cluster identified",a,b.width,c.node(a));let f=await x(q,b.graph,d,e,c.node(a),j),g=f.elem;(0,h.u)(b,g),b.diff=f.diff||0,i.l.info("Node bounds (abc123)",a,b,b.width,b.x,b.y),(0,h.s)(g,b),i.l.warn("Recursive render complete ",g,b)}else c.children(a).length>0?(i.l.info("Cluster - the non recursive path XXX",a,b.id,b,c),i.l.info(r(b.id,c)),l[b.id]={id:r(b.id,c),node:b}):(i.l.info("Node - the non recursive path",a,b.id,b),await (0,h.e)(q,c.node(a),k))})),c.edges().forEach(function(a){let b=c.edge(a.v,a.w,a.name);i.l.info("Edge "+a.v+" -> "+a.w+": "+JSON.stringify(a)),i.l.info("Edge "+a.v+" -> "+a.w+": ",a," ",JSON.stringify(c.edge(a))),i.l.info("Fix",l,"ids:",a.v,a.w,"Translating: ",l[a.v],l[a.w]),(0,h.f)(p,b)}),c.edges().forEach(function(a){i.l.info("Edge "+a.v+" -> "+a.w+": "+JSON.stringify(a))}),i.l.info("#############################################"),i.l.info("###                Layout                 ###"),i.l.info("#############################################"),i.l.info(c),(0,b.layout)(c),i.l.info("Graph after layout:",g(c));let s=0,{subGraphTitleTotalMargin:t}=(0,h.g)(j);return u(c,c.children()).forEach(function(a){let b=c.node(a);if(i.l.info("Position "+a+": "+JSON.stringify(c.node(a))),i.l.info("Position "+a+": ("+b.x,","+b.y,") width: ",b.width," height: ",b.height),b&&b.clusterNode)b.y+=t,(0,h.p)(b);else if(c.children(a).length>0){let a;b.height+=t,i.l.trace("Inserting cluster"),a=b.shape||"rect",w[b.id]=v[a](n,b),l[b.id].node=b}else b.y+=t/2,(0,h.p)(b)}),c.edges().forEach(function(a){let b=c.edge(a);i.l.info("Edge "+a.v+" -> "+a.w+": "+JSON.stringify(b),b),b.points.forEach(a=>a.y+=t/2);let f=(0,h.h)(o,a,b,l,d,c,e);(0,h.j)(b,f)}),c.nodes().forEach(function(a){let b=c.node(a);i.l.info(a,b.type,b.diff),"group"===b.type&&(s=b.diff)}),{elem:m,diff:s}},y=async(a,b,c,d,e)=>{(0,h.a)(a,c,d,e),(0,h.b)(),(0,h.d)(),w={},m={},n={},l={},i.l.warn("Graph at first:",JSON.stringify(g(b))),((a,b)=>{if(!a)return i.l.debug("Opting out, no graph ");for(let b of(i.l.debug("Opting in, graph "),a.nodes().forEach(function(b){a.children(b).length>0&&(i.l.warn("Cluster identified",b," Replacement id in edges: ",r(b,a)),m[b]=q(b,a),l[b]={id:r(b,a),clusterData:a.node(b)})}),a.nodes().forEach(function(b){let c=a.children(b),d=a.edges();c.length>0?(i.l.debug("Cluster identified",b,m),d.forEach(a=>{a.v!==b&&a.w!==b&&o(a.v,b)^o(a.w,b)&&(i.l.warn("Edge: ",a," leaves cluster ",b),i.l.warn("Descendants of XXX ",b,": ",m[b]),l[b].externalConnections=!0)})):i.l.debug("Not a cluster ",b,m)}),Object.keys(l))){let c=l[b].id,d=a.parent(c);d!==b&&l[d]&&!l[d].externalConnections&&(l[b].id=d)}a.edges().forEach(function(b){let c=a.edge(b);i.l.warn("Edge "+b.v+" -> "+b.w+": "+JSON.stringify(b)),i.l.warn("Edge "+b.v+" -> "+b.w+": "+JSON.stringify(a.edge(b)));let d=b.v,e=b.w;if(i.l.warn("Fix XXX",l,"ids:",b.v,b.w,"Translating: ",l[b.v]," --- ",l[b.w]),l[b.v]&&l[b.w]&&l[b.v]===l[b.w]){i.l.warn("Fixing and trixing link to self - removing XXX",b.v,b.w,b.name),i.l.warn("Fixing and trixing - removing XXX",b.v,b.w,b.name),d=s(b.v),e=s(b.w),a.removeEdge(b.v,b.w,b.name);let f=b.w+"---"+b.v;a.setNode(f,{domId:f,id:f,labelStyle:"",labelText:c.label,padding:0,shape:"labelRect",style:""});let g=structuredClone(c),h=structuredClone(c);g.label="",g.arrowTypeEnd="none",h.label="",g.fromCluster=b.v,h.toCluster=b.v,a.setEdge(d,f,g,b.name+"-cyclic-special"),a.setEdge(f,e,h,b.name+"-cyclic-special")}else(l[b.v]||l[b.w])&&(i.l.warn("Fixing and trixing - removing XXX",b.v,b.w,b.name),d=s(b.v),e=s(b.w),a.removeEdge(b.v,b.w,b.name),d!==b.v&&(l[a.parent(d)].externalConnections=!0,c.fromCluster=b.v),e!==b.w&&(l[a.parent(e)].externalConnections=!0,c.toCluster=b.w),i.l.warn("Fix Replacing with XXX",d,e,b.name),a.setEdge(d,e,c,b.name))}),i.l.warn("Adjusted Graph",g(a)),t(a,0),i.l.trace(l)})(b),i.l.warn("Graph after:",JSON.stringify(g(b)));let f=(0,i.c)();await x(a,b,d,e,void 0,f)};a.s(["r",()=>y],336515)}];

//# debugId=40118f0f-0b92-db6b-3119-610b8bb143b4
//# sourceMappingURL=node_modules_mermaid_dist_index-5325376f_2f62cd36.js.map