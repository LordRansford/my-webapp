;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f21b2d6b-b46d-869a-a23c-ebbe57172807")}catch(e){}}();
module.exports=[468197,a=>{"use strict";var b=a.i(508171),c=a.i(127669),d=a.i(575639),e=a.i(613483),f=a.i(524911),g=a.i(887358),h=a.i(530548),i=a.i(698887),j=a.i(190896),k=a.i(742093),l=a.i(739362),m=a.i(855423),n=a.i(379035),o=a.i(612485),p=a.i(778529),q=a.i(324920),r=a.i(742480);function s(){let[a,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(10),[B,C]=(0,c.useState)("Upload a CSV with true labels and model probabilities to explore calibration."),D=(0,c.useCallback)(a=>{let{safeFiles:b,errors:c}=(0,q.validateUpload)(a.target.files,{maxBytes:8388608,allowedExtensions:[".csv"]});c.length&&alert(c.join("\n"));let d=b[0];d&&(C("Parsing CSVâ€¦"),s(null),f.default.parse(d,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:a=>{let b=a.data;if(!b||0===b.length)return void C("The CSV file appears to be empty or malformed.");let c=Object.keys(b[0]);c.length?(s({columns:c,rows:b}),C("File loaded. Now choose the label column, the probability column and the positive label."),t||u(c[0]),!v&&c.length>1&&w(c[1])):C("Could not detect any columns in the CSV file.")},error:a=>{C(`Failed to parse CSV: ${a.message}`)}}))},[t,v]),E=a?.columns??[],F=(0,c.useMemo)(()=>a&&t?a.rows.map(a=>a[t]).filter(a=>null!=a):[],[a,t]),G=(0,c.useMemo)(()=>{if(!a||!v)return[];let b=[];for(let c of a.rows){let a=function(a){if(null==a)return null;if("number"==typeof a&&Number.isFinite(a))return a;let b=Number(String(a).replace(",","."));return Number.isFinite(b)?b:null}(c[v]);null!==a&&b.push(a)}return b},[a,v]),H=(0,c.useMemo)(()=>{if(!F.length)return[];let a=new Set;for(let b of F){let c=String(b).trim();c.length>0&&a.add(c)}return Array.from(a.values())},[F]),I=a&&t&&v&&x&&F.length===G.length&&F.length>0,{bins:J,histogram:K}=(0,c.useMemo)(()=>I?function(a,b,c,d){let e=[],f=[],g=1/d;for(let a=0;a<d;a+=1){let b=(a+.5)*g;e.push({sumPred:0,sumPos:0,count:0,binCenter:b}),f.push({count:0,binCenter:b})}for(let h=0;h<b.length;h+=1){let i=b[h],j=String(a[h]).trim();if(!Number.isFinite(i))continue;let k=Math.min(d-1,Math.max(0,Math.floor(i/g))),l=e[k];l.sumPred+=i,l.sumPos+=+(j===c),l.count+=1,f[k].count+=1}return{bins:e.map(a=>({binCenter:Number(a.binCenter.toFixed(2)),avgPred:0===a.count?0:a.sumPred/a.count,fracPos:0===a.count?0:a.sumPos/a.count,count:a.count})),histogram:f.map(a=>({binCenter:Number(a.binCenter.toFixed(2)),count:a.count}))}}(F,G,x,z):{bins:[],histogram:[]},[I,F,G,x,z]),L=(0,c.useMemo)(()=>I?function(a,b,c){if(!a.length||a.length!==b.length)return 0;let d=0;for(let e=0;e<a.length;e+=1){let f=+(String(a[e]).trim()===c),g=b[e];if(!Number.isFinite(g))continue;let h=g-f;d+=h*h}return d/a.length}(F,G,x):null,[I,F,G,x]),M=J.map(a=>({...a,avgPredDisplay:Number(a.avgPred.toFixed(3)),fracPosDisplay:Number(a.fracPos.toFixed(3))}));return(0,b.jsxs)(p.AiToolCard,{id:"calibration-lab-title",title:"Calibration and reliability lab",icon:(0,b.jsx)(d.Target,{className:"h-4 w-4","aria-hidden":"true"}),description:"Upload model probabilities and true labels to see whether the numbers your model outputs match reality.",children:[(0,b.jsx)(r.SecurityBanner,{}),(0,b.jsxs)("div",{className:"grid gap-6 xl:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-100 bg-slate-50/60 p-4 xl:col-span-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Step 1 - Upload model probabilities"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Use a CSV where each row is a prediction. Include a true label column and a probability column between 0 and 1. Only your browser sees this data."}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"calibration-upload",className:"block text-sm font-medium text-slate-700",children:"CSV file"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("label",{htmlFor:"calibration-upload",className:"inline-flex cursor-pointer items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm hover:border-sky-300 hover:text-sky-700",children:[(0,b.jsx)(e.UploadCloud,{className:"h-4 w-4","aria-hidden":"true"}),(0,b.jsx)("span",{children:"Choose file"})]}),(0,b.jsx)("input",{id:"calibration-upload",type:"file",accept:".csv,text/csv",className:"hidden",onChange:D}),(0,b.jsx)("span",{className:"text-sm text-slate-500",children:"CSV only, max 8MB. Processed locally."})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"calib-label-column",className:"block text-sm font-medium text-slate-700",children:"Label column"}),(0,b.jsxs)("select",{id:"calib-label-column",value:t,onChange:a=>u(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select label column"}),E.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"calib-score-column",className:"block text-sm font-medium text-slate-700",children:"Probability column"}),(0,b.jsxs)("select",{id:"calib-score-column",value:v,onChange:a=>w(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select probability column"}),E.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"These are the model's predicted probabilities that a case is positive. Values should be between 0 and 1."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"calib-positive-label",className:"block text-sm font-medium text-slate-700",children:"Positive label"}),(0,b.jsxs)("select",{id:"calib-positive-label",value:x,onChange:a=>y(a.target.value),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:"",children:"Select positive label"}),H.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"This is the outcome you are treating as positive. For example, fraud, unsafe, complaint or churn."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"calib-bin-count",className:"block text-sm font-medium text-slate-700",children:"Number of bins"}),(0,b.jsxs)("select",{id:"calib-bin-count",value:z,onChange:a=>A(Number(a.target.value)),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[(0,b.jsx)("option",{value:5,children:"5 bins"}),(0,b.jsx)("option",{value:10,children:"10 bins"}),(0,b.jsx)("option",{value:20,children:"20 bins"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"More bins show more detail but need more data. Fewer bins are smoother."})]})]}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:B})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-100 bg-slate-50/60 p-4 xl:col-span-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Step 2 - Reliability diagram"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"The reliability diagram compares what the model says to what actually happens. If the model is perfectly calibrated, the points will sit close to the diagonal line."}),(0,b.jsx)("div",{className:"h-48 rounded-2xl border border-slate-200 bg-white px-3 py-2",children:I&&M.length>0?(0,b.jsx)(i.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(h.LineChart,{data:M,children:[(0,b.jsx)(m.CartesianGrid,{stroke:"#e5e7eb",strokeDasharray:"3 3"}),(0,b.jsx)(k.XAxis,{dataKey:"avgPredDisplay",tick:{fontSize:9},label:{value:"Average predicted probability",position:"insideBottom",offset:-4,fontSize:10},type:"number",domain:[0,1]}),(0,b.jsx)(l.YAxis,{dataKey:"fracPosDisplay",tick:{fontSize:9},label:{value:"Observed fraction positive",angle:-90,position:"insideLeft",fontSize:10},type:"number",domain:[0,1]}),(0,b.jsx)(j.Tooltip,{contentStyle:{fontSize:10,borderRadius:12,padding:8},formatter:(a,b)=>"avgPredDisplay"===b?[a,"Average predicted"]:"fracPosDisplay"===b?[a,"Observed fraction positive"]:"count"===b?[a,"Count"]:[a,b]}),(0,b.jsx)(g.Line,{type:"linear",dataKey:"avgPredDisplay",stroke:"#cbd5f5",strokeWidth:1,dot:!1,isAnimationActive:!1}),(0,b.jsx)(g.Line,{type:"linear",dataKey:"fracPosDisplay",stroke:"#0f766e",strokeWidth:2,dot:{r:3},name:"Calibration"})]})}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Once you upload data and choose the positive label the reliability diagram will appear here."})}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-3 text-sm text-slate-700",children:[(0,b.jsx)("p",{className:"mb-1 text-sm font-semibold text-slate-900",children:"Bin summary"}),I&&J.length>0?(0,b.jsx)("div",{className:"max-h-32 overflow-auto pr-1",children:(0,b.jsxs)("table",{className:"w-full border-collapse text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"text-slate-500",children:[(0,b.jsx)("th",{className:"pb-1 pr-2 text-left font-medium",children:"Bin center"}),(0,b.jsx)("th",{className:"pb-1 pr-2 text-left font-medium",children:"Avg predicted"}),(0,b.jsx)("th",{className:"pb-1 pr-2 text-left font-medium",children:"Observed positive"}),(0,b.jsx)("th",{className:"pb-1 text-left font-medium",children:"Count"})]})}),(0,b.jsx)("tbody",{children:M.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"py-0.5 pr-2 text-slate-700",children:a.binCenter.toFixed(2)}),(0,b.jsx)("td",{className:"py-0.5 pr-2 text-slate-700",children:a.avgPredDisplay.toFixed(3)}),(0,b.jsx)("td",{className:"py-0.5 pr-2 text-slate-700",children:a.fracPosDisplay.toFixed(3)}),(0,b.jsx)("td",{className:"py-0.5 text-slate-700",children:a.count})]},a.binCenter))})]})}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Each row will show a bin such as all cases with predicted probability between 0.4 and 0.5, the average prediction in that bin and the fraction of positives that actually occurred."})]})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-100 bg-slate-50/60 p-4 xl:col-span-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Step 3 - Score distribution and interpretation"}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"The histogram shows how many examples fall into each probability region. This helps you see whether the model uses the full range from 0 to 1 or clusters around certain values."}),(0,b.jsx)("div",{className:"h-40 rounded-2xl border border-slate-200 bg-white px-3 py-2",children:I&&K.length>0?(0,b.jsx)(i.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(n.BarChart,{data:K,children:[(0,b.jsx)(k.XAxis,{dataKey:"binCenter",tick:{fontSize:9},label:{value:"Score bins",position:"insideBottom",offset:-4,fontSize:10}}),(0,b.jsx)(l.YAxis,{tick:{fontSize:9}}),(0,b.jsx)(j.Tooltip,{contentStyle:{fontSize:10,borderRadius:12,padding:8}}),(0,b.jsx)(o.Bar,{dataKey:"count",fill:"#6366f1",radius:[8,8,0,0],name:"Count"})]})}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Once data is loaded this chart will show how many predictions land in each probability bin."})}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-3 text-sm text-slate-700 space-y-1",children:[(0,b.jsx)("p",{className:"font-semibold text-slate-900",children:"How well calibrated is the model"}),(0,b.jsx)("p",{children:function(){if(!I||!J.length||null===L)return"Once you upload data and choose the positive label this area will explain whether the model tends to be over confident or under confident.";let a=J.filter(a=>a.count>0&&a.avgPred>a.fracPos+.05),b=J.filter(a=>a.count>0&&a.avgPred<a.fracPos-.05);return a.length&&!b.length?`Across many bins the average predicted probability is higher than the observed fraction of positives. This means the model tends to be over confident. The Brier score of ${L.toFixed(3)} summarises this mismatch across all rows.`:b.length&&!a.length?`Across many bins the average predicted probability is lower than the observed fraction of positives. This means the model tends to be under confident. The Brier score of ${L.toFixed(3)} summarises how gently or sharply the predictions deviate from reality.`:`Some regions look over confident and some under confident, which is common in real systems. The Brier score of ${L.toFixed(3)} gives a single measure of how well the probabilities line up with the outcomes. Use this together with the reliability diagram to decide where recalibration or threshold adjustments might help.`}()}),null!==L&&I&&(0,b.jsxs)("p",{className:"mt-1",children:["Brier score: ",(0,b.jsx)("span",{className:"font-semibold text-slate-900",children:L.toFixed(3)}),". Lower is better. A score close to zero means the probabilities usually match reality. Higher scores mean the model regularly assigns very confident probabilities to outcomes that do not happen."]}),(0,b.jsx)("p",{className:"text-slate-500",children:"Calibration is separate from discrimination. A model can rank cases well but still be badly calibrated. This lab focuses only on whether the probabilities you see are trustworthy."})]})]})]})]})}a.s(["CalibrationLab",()=>s])},573337,a=>{a.n(a.i(468197))}];

//# debugId=f21b2d6b-b46d-869a-a23c-ebbe57172807
//# sourceMappingURL=src_components_tools_ai_CalibrationLab_tsx_15578da7._.js.map