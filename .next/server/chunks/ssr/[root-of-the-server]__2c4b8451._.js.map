{
  "version": 3,
  "sources": [],
  "debugId": "c430ed00-3001-8aa8-ccea-2f2fd6c696c0",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/node_modules/openid-client/package.json","turbopack:///[project]/node_modules/nodemailer/package.json","turbopack:///[project]/node_modules/nodemailer/lib/well-known/services.json","../../../../src/lib/db/prisma.ts","../../../../src/services/progressService.ts","../../../../src/app/account/certificates/ui.client.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/account/certificates/page.tsx"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","{\"name\":\"nodemailer\",\"version\":\"7.0.12\",\"description\":\"Easy as cake e-mail sending from your Node.js applications\",\"main\":\"lib/nodemailer.js\",\"scripts\":{\"test\":\"node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js\",\"test:coverage\":\"c8 node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js\",\"format\":\"prettier --write \\\"**/*.{js,json,md}\\\"\",\"format:check\":\"prettier --check \\\"**/*.{js,json,md}\\\"\",\"lint\":\"eslint .\",\"lint:fix\":\"eslint . --fix\",\"update\":\"rm -rf node_modules/ package-lock.json && ncu -u && npm install\"},\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/nodemailer/nodemailer.git\"},\"keywords\":[\"Nodemailer\"],\"author\":\"Andris Reinman\",\"license\":\"MIT-0\",\"bugs\":{\"url\":\"https://github.com/nodemailer/nodemailer/issues\"},\"homepage\":\"https://nodemailer.com/\",\"devDependencies\":{\"@aws-sdk/client-sesv2\":\"3.940.0\",\"bunyan\":\"1.8.15\",\"c8\":\"10.1.3\",\"eslint\":\"9.39.1\",\"eslint-config-prettier\":\"10.1.8\",\"globals\":\"16.5.0\",\"libbase64\":\"1.3.0\",\"libmime\":\"5.3.7\",\"libqp\":\"2.1.1\",\"nodemailer-ntlm-auth\":\"1.0.4\",\"prettier\":\"3.6.2\",\"proxy\":\"1.0.2\",\"proxy-test-server\":\"1.0.0\",\"smtp-server\":\"3.16.1\"},\"engines\":{\"node\":\">=6.0.0\"}}","{\"1und1\":{\"description\":\"1&1 Mail (German hosting provider)\",\"host\":\"smtp.1und1.de\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"126\":{\"description\":\"126 Mail (NetEase)\",\"host\":\"smtp.126.com\",\"port\":465,\"secure\":true},\"163\":{\"description\":\"163 Mail (NetEase)\",\"host\":\"smtp.163.com\",\"port\":465,\"secure\":true},\"Aliyun\":{\"description\":\"Alibaba Cloud Mail\",\"domains\":[\"aliyun.com\"],\"host\":\"smtp.aliyun.com\",\"port\":465,\"secure\":true},\"AliyunQiye\":{\"description\":\"Alibaba Cloud Enterprise Mail\",\"host\":\"smtp.qiye.aliyun.com\",\"port\":465,\"secure\":true},\"AOL\":{\"description\":\"AOL Mail\",\"domains\":[\"aol.com\"],\"host\":\"smtp.aol.com\",\"port\":587},\"Aruba\":{\"description\":\"Aruba PEC (Italian email provider)\",\"domains\":[\"aruba.it\",\"pec.aruba.it\"],\"aliases\":[\"Aruba PEC\"],\"host\":\"smtps.aruba.it\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"Bluewin\":{\"description\":\"Bluewin (Swiss email provider)\",\"host\":\"smtpauths.bluewin.ch\",\"domains\":[\"bluewin.ch\"],\"port\":465},\"BOL\":{\"description\":\"BOL Mail (Brazilian provider)\",\"domains\":[\"bol.com.br\"],\"host\":\"smtp.bol.com.br\",\"port\":587,\"requireTLS\":true},\"DebugMail\":{\"description\":\"DebugMail (email testing service)\",\"host\":\"debugmail.io\",\"port\":25},\"Disroot\":{\"description\":\"Disroot (privacy-focused provider)\",\"domains\":[\"disroot.org\"],\"host\":\"disroot.org\",\"port\":587,\"secure\":false,\"authMethod\":\"LOGIN\"},\"DynectEmail\":{\"description\":\"Dyn Email Delivery\",\"aliases\":[\"Dynect\"],\"host\":\"smtp.dynect.net\",\"port\":25},\"ElasticEmail\":{\"description\":\"Elastic Email\",\"aliases\":[\"Elastic Email\"],\"host\":\"smtp.elasticemail.com\",\"port\":465,\"secure\":true},\"Ethereal\":{\"description\":\"Ethereal Email (email testing service)\",\"aliases\":[\"ethereal.email\"],\"host\":\"smtp.ethereal.email\",\"port\":587},\"FastMail\":{\"description\":\"FastMail\",\"domains\":[\"fastmail.fm\"],\"host\":\"smtp.fastmail.com\",\"port\":465,\"secure\":true},\"Feishu Mail\":{\"description\":\"Feishu Mail (Lark)\",\"aliases\":[\"Feishu\",\"FeishuMail\"],\"domains\":[\"www.feishu.cn\"],\"host\":\"smtp.feishu.cn\",\"port\":465,\"secure\":true},\"Forward Email\":{\"description\":\"Forward Email (email forwarding service)\",\"aliases\":[\"FE\",\"ForwardEmail\"],\"domains\":[\"forwardemail.net\"],\"host\":\"smtp.forwardemail.net\",\"port\":465,\"secure\":true},\"GandiMail\":{\"description\":\"Gandi Mail\",\"aliases\":[\"Gandi\",\"Gandi Mail\"],\"host\":\"mail.gandi.net\",\"port\":587},\"Gmail\":{\"description\":\"Gmail\",\"aliases\":[\"Google Mail\"],\"domains\":[\"gmail.com\",\"googlemail.com\"],\"host\":\"smtp.gmail.com\",\"port\":465,\"secure\":true},\"GMX\":{\"description\":\"GMX Mail\",\"domains\":[\"gmx.com\",\"gmx.net\",\"gmx.de\"],\"host\":\"mail.gmx.com\",\"port\":587},\"Godaddy\":{\"description\":\"GoDaddy Email (US)\",\"host\":\"smtpout.secureserver.net\",\"port\":25},\"GodaddyAsia\":{\"description\":\"GoDaddy Email (Asia)\",\"host\":\"smtp.asia.secureserver.net\",\"port\":25},\"GodaddyEurope\":{\"description\":\"GoDaddy Email (Europe)\",\"host\":\"smtp.europe.secureserver.net\",\"port\":25},\"hot.ee\":{\"description\":\"Hot.ee (Estonian email provider)\",\"host\":\"mail.hot.ee\"},\"Hotmail\":{\"description\":\"Outlook.com / Hotmail\",\"aliases\":[\"Outlook\",\"Outlook.com\",\"Hotmail.com\"],\"domains\":[\"hotmail.com\",\"outlook.com\"],\"host\":\"smtp-mail.outlook.com\",\"port\":587},\"iCloud\":{\"description\":\"iCloud Mail\",\"aliases\":[\"Me\",\"Mac\"],\"domains\":[\"me.com\",\"mac.com\"],\"host\":\"smtp.mail.me.com\",\"port\":587},\"Infomaniak\":{\"description\":\"Infomaniak Mail (Swiss hosting provider)\",\"host\":\"mail.infomaniak.com\",\"domains\":[\"ik.me\",\"ikmail.com\",\"etik.com\"],\"port\":587},\"KolabNow\":{\"description\":\"KolabNow (secure email service)\",\"domains\":[\"kolabnow.com\"],\"aliases\":[\"Kolab\"],\"host\":\"smtp.kolabnow.com\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"Loopia\":{\"description\":\"Loopia (Swedish hosting provider)\",\"host\":\"mailcluster.loopia.se\",\"port\":465},\"Loops\":{\"description\":\"Loops\",\"host\":\"smtp.loops.so\",\"port\":587},\"mail.ee\":{\"description\":\"Mail.ee (Estonian email provider)\",\"host\":\"smtp.mail.ee\"},\"Mail.ru\":{\"description\":\"Mail.ru\",\"host\":\"smtp.mail.ru\",\"port\":465,\"secure\":true},\"Mailcatch.app\":{\"description\":\"Mailcatch (email testing service)\",\"host\":\"sandbox-smtp.mailcatch.app\",\"port\":2525},\"Maildev\":{\"description\":\"MailDev (local email testing)\",\"port\":1025,\"ignoreTLS\":true},\"MailerSend\":{\"description\":\"MailerSend\",\"host\":\"smtp.mailersend.net\",\"port\":587},\"Mailgun\":{\"description\":\"Mailgun\",\"host\":\"smtp.mailgun.org\",\"port\":465,\"secure\":true},\"Mailjet\":{\"description\":\"Mailjet\",\"host\":\"in.mailjet.com\",\"port\":587},\"Mailosaur\":{\"description\":\"Mailosaur (email testing service)\",\"host\":\"mailosaur.io\",\"port\":25},\"Mailtrap\":{\"description\":\"Mailtrap\",\"host\":\"live.smtp.mailtrap.io\",\"port\":587},\"Mandrill\":{\"description\":\"Mandrill (by Mailchimp)\",\"host\":\"smtp.mandrillapp.com\",\"port\":587},\"Naver\":{\"description\":\"Naver Mail (Korean email provider)\",\"host\":\"smtp.naver.com\",\"port\":587},\"OhMySMTP\":{\"description\":\"OhMySMTP (email delivery service)\",\"host\":\"smtp.ohmysmtp.com\",\"port\":587,\"secure\":false},\"One\":{\"description\":\"One.com Email\",\"host\":\"send.one.com\",\"port\":465,\"secure\":true},\"OpenMailBox\":{\"description\":\"OpenMailBox\",\"aliases\":[\"OMB\",\"openmailbox.org\"],\"host\":\"smtp.openmailbox.org\",\"port\":465,\"secure\":true},\"Outlook365\":{\"description\":\"Microsoft 365 / Office 365\",\"host\":\"smtp.office365.com\",\"port\":587,\"secure\":false},\"Postmark\":{\"description\":\"Postmark\",\"aliases\":[\"PostmarkApp\"],\"host\":\"smtp.postmarkapp.com\",\"port\":2525},\"Proton\":{\"description\":\"Proton Mail\",\"aliases\":[\"ProtonMail\",\"Proton.me\",\"Protonmail.com\",\"Protonmail.ch\"],\"domains\":[\"proton.me\",\"protonmail.com\",\"pm.me\",\"protonmail.ch\"],\"host\":\"smtp.protonmail.ch\",\"port\":587,\"requireTLS\":true},\"qiye.aliyun\":{\"description\":\"Alibaba Mail Enterprise Edition\",\"host\":\"smtp.mxhichina.com\",\"port\":\"465\",\"secure\":true},\"QQ\":{\"description\":\"QQ Mail\",\"domains\":[\"qq.com\"],\"host\":\"smtp.qq.com\",\"port\":465,\"secure\":true},\"QQex\":{\"description\":\"QQ Enterprise Mail\",\"aliases\":[\"QQ Enterprise\"],\"domains\":[\"exmail.qq.com\"],\"host\":\"smtp.exmail.qq.com\",\"port\":465,\"secure\":true},\"Resend\":{\"description\":\"Resend\",\"host\":\"smtp.resend.com\",\"port\":465,\"secure\":true},\"Runbox\":{\"description\":\"Runbox (Norwegian email provider)\",\"domains\":[\"runbox.com\"],\"host\":\"smtp.runbox.com\",\"port\":465,\"secure\":true},\"SendCloud\":{\"description\":\"SendCloud (Chinese email delivery)\",\"host\":\"smtp.sendcloud.net\",\"port\":2525},\"SendGrid\":{\"description\":\"SendGrid\",\"host\":\"smtp.sendgrid.net\",\"port\":587},\"SendinBlue\":{\"description\":\"Brevo (formerly Sendinblue)\",\"aliases\":[\"Brevo\"],\"host\":\"smtp-relay.brevo.com\",\"port\":587},\"SendPulse\":{\"description\":\"SendPulse\",\"host\":\"smtp-pulse.com\",\"port\":465,\"secure\":true},\"SES\":{\"description\":\"AWS SES US East (N. Virginia)\",\"host\":\"email-smtp.us-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-1\":{\"description\":\"AWS SES Asia Pacific (Tokyo)\",\"host\":\"email-smtp.ap-northeast-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-2\":{\"description\":\"AWS SES Asia Pacific (Seoul)\",\"host\":\"email-smtp.ap-northeast-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-3\":{\"description\":\"AWS SES Asia Pacific (Osaka)\",\"host\":\"email-smtp.ap-northeast-3.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTH-1\":{\"description\":\"AWS SES Asia Pacific (Mumbai)\",\"host\":\"email-smtp.ap-south-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTHEAST-1\":{\"description\":\"AWS SES Asia Pacific (Singapore)\",\"host\":\"email-smtp.ap-southeast-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTHEAST-2\":{\"description\":\"AWS SES Asia Pacific (Sydney)\",\"host\":\"email-smtp.ap-southeast-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-CA-CENTRAL-1\":{\"description\":\"AWS SES Canada (Central)\",\"host\":\"email-smtp.ca-central-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-CENTRAL-1\":{\"description\":\"AWS SES Europe (Frankfurt)\",\"host\":\"email-smtp.eu-central-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-NORTH-1\":{\"description\":\"AWS SES Europe (Stockholm)\",\"host\":\"email-smtp.eu-north-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-1\":{\"description\":\"AWS SES Europe (Ireland)\",\"host\":\"email-smtp.eu-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-2\":{\"description\":\"AWS SES Europe (London)\",\"host\":\"email-smtp.eu-west-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-3\":{\"description\":\"AWS SES Europe (Paris)\",\"host\":\"email-smtp.eu-west-3.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-SA-EAST-1\":{\"description\":\"AWS SES South America (SÃ£o Paulo)\",\"host\":\"email-smtp.sa-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-EAST-1\":{\"description\":\"AWS SES US East (N. Virginia)\",\"host\":\"email-smtp.us-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-EAST-2\":{\"description\":\"AWS SES US East (Ohio)\",\"host\":\"email-smtp.us-east-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-GOV-EAST-1\":{\"description\":\"AWS SES GovCloud (US-East)\",\"host\":\"email-smtp.us-gov-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-GOV-WEST-1\":{\"description\":\"AWS SES GovCloud (US-West)\",\"host\":\"email-smtp.us-gov-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-WEST-1\":{\"description\":\"AWS SES US West (N. California)\",\"host\":\"email-smtp.us-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-WEST-2\":{\"description\":\"AWS SES US West (Oregon)\",\"host\":\"email-smtp.us-west-2.amazonaws.com\",\"port\":465,\"secure\":true},\"Seznam\":{\"description\":\"Seznam Email (Czech email provider)\",\"aliases\":[\"Seznam Email\"],\"domains\":[\"seznam.cz\",\"email.cz\",\"post.cz\",\"spoluzaci.cz\"],\"host\":\"smtp.seznam.cz\",\"port\":465,\"secure\":true},\"SMTP2GO\":{\"description\":\"SMTP2GO\",\"host\":\"mail.smtp2go.com\",\"port\":2525},\"Sparkpost\":{\"description\":\"SparkPost\",\"aliases\":[\"SparkPost\",\"SparkPost Mail\"],\"domains\":[\"sparkpost.com\"],\"host\":\"smtp.sparkpostmail.com\",\"port\":587,\"secure\":false},\"Tipimail\":{\"description\":\"Tipimail (email delivery service)\",\"host\":\"smtp.tipimail.com\",\"port\":587},\"Tutanota\":{\"description\":\"Tutanota (Tuta Mail)\",\"domains\":[\"tutanota.com\",\"tuta.com\",\"tutanota.de\",\"tuta.io\"],\"host\":\"smtp.tutanota.com\",\"port\":465,\"secure\":true},\"Yahoo\":{\"description\":\"Yahoo Mail\",\"domains\":[\"yahoo.com\"],\"host\":\"smtp.mail.yahoo.com\",\"port\":465,\"secure\":true},\"Yandex\":{\"description\":\"Yandex Mail\",\"domains\":[\"yandex.ru\"],\"host\":\"smtp.yandex.ru\",\"port\":465,\"secure\":true},\"Zimbra\":{\"description\":\"Zimbra Mail Server\",\"aliases\":[\"Zimbra Collaboration\"],\"host\":\"smtp.zimbra.com\",\"port\":587,\"requireTLS\":true},\"Zoho\":{\"description\":\"Zoho Mail\",\"host\":\"smtp.zoho.com\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"}}","import { PrismaClient } from \"@prisma/client\";\n\n// Default DB for local dev when env is missing.\n// This keeps local dev lightweight and avoids \"silent\" runtime failures.\nif (!process.env.DATABASE_URL) {\n  process.env.DATABASE_URL = \"file:./data/dev.db\";\n}\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\nexport const prisma: PrismaClient =\n  global.__prisma ||\n  new PrismaClient({\n    log: [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  global.__prisma = prisma;\n}\n\n\n","import { prisma } from \"@/lib/db/prisma\";\n\n// Progress persistence rules:\n// - Anonymous users: local-only (handled in client hook; server endpoints require auth)\n// - Signed-in users: server is source of truth for cross-device persistence\n\nexport async function upsertUserIdentity(params: {\n  userId: string;\n  email: string;\n  provider: string;\n  providerAccountId: string;\n}) {\n  const email = params.email.trim().toLowerCase();\n  if (!email) return null;\n  return prisma.userIdentity.upsert({\n    where: { id: params.userId },\n    create: {\n      id: params.userId,\n      email,\n      provider: params.provider,\n      providerAccountId: params.providerAccountId,\n      lastLoginAt: new Date(),\n    },\n    update: {\n      provider: params.provider,\n      providerAccountId: params.providerAccountId,\n      lastLoginAt: new Date(),\n    },\n  });\n}\n\nexport async function getCpdStateForUser(userId: string) {\n  const row = await prisma.cpdState.findUnique({ where: { userId } });\n  return row ? { stateJson: row.stateJson, updatedAt: row.updatedAt.toISOString() } : null;\n}\n\nexport async function setCpdStateForUser(params: { userId: string; stateJson: string }) {\n  const saved = await prisma.cpdState.upsert({\n    where: { userId: params.userId },\n    create: { userId: params.userId, stateJson: params.stateJson },\n    update: { stateJson: params.stateJson },\n  });\n\n  // Maintain per-section progress rows as a foundation for future CPD evidence/export.\n  // This is derived data: the canonical state is the CPD JSON.\n  try {\n    const state = JSON.parse(params.stateJson);\n    const sections = Array.isArray(state?.sections) ? state.sections : [];\n\n    const writes = sections\n      .filter((s: any) => s && typeof s === \"object\")\n      .filter((s: any) => s.sectionId && s.sectionId !== \"overall\")\n      .map((s: any) => ({\n        courseId: String(s.trackId || \"\").trim(),\n        levelId: String(s.levelId || \"\").trim(),\n        sectionId: String(s.sectionId || \"\").trim(),\n        completed: Boolean(s.completed),\n        minutes: Math.max(0, Number(s.minutes) || 0),\n      }))\n      .filter((s: any) => s.courseId && s.levelId && s.sectionId);\n\n    // Upsert each progress row (idempotent per unique key).\n    await Promise.all(\n      writes.map((w: any) =>\n        prisma.progress.upsert({\n          where: {\n            userId_courseId_levelId_sectionId: {\n              userId: params.userId,\n              courseId: w.courseId,\n              levelId: w.levelId,\n              sectionId: w.sectionId,\n            },\n          },\n          create: { userId: params.userId, ...w },\n          update: { completed: w.completed, minutes: w.minutes },\n        }),\n      ),\n    );\n  } catch {\n    // Do not fail persistence if derived progress rows cannot be updated.\n  }\n\n  return { updatedAt: saved.updatedAt.toISOString() };\n}\n\nexport async function getAdminProgressStats() {\n  const totalUsers = await prisma.userIdentity.count();\n  const totalProgressRecords = await prisma.progress.count();\n  const since = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n  const activeUsers = await prisma.userIdentity.count({ where: { lastLoginAt: { gte: since } } });\n  return { totalUsers, activeUsersLast7Days: activeUsers, totalProgressRecords };\n}\n\n\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/account/certificates/ui.client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/account/certificates/ui.client.tsx\",\n    \"default\",\n);\n","import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth/options\";\nimport { prisma } from \"@/lib/db/prisma\";\nimport CertificatesClient from \"./ui.client\";\n\nexport const dynamic = \"force-dynamic\";\n\nconst COURSES = [\n  { courseId: \"cybersecurity\", title: \"Cybersecurity\" },\n  { courseId: \"ai\", title: \"AI\" },\n  { courseId: \"software-architecture\", title: \"Software architecture\" },\n  { courseId: \"data\", title: \"Data\" },\n  { courseId: \"digitalisation\", title: \"Digitalisation\" },\n] as const;\n\nexport default async function CertificatesPage() {\n  const session = await getServerSession(authOptions).catch(() => null);\n  const userId = session?.user?.id || \"\";\n  if (!userId) {\n    return (\n      <div className=\"mx-auto max-w-3xl p-6\">\n        <h1 className=\"text-2xl font-semibold\">Certificates</h1>\n        <p className=\"mt-2 text-sm text-slate-600\">Sign in to view your certificates.</p>\n      </div>\n    );\n  }\n\n  const issuanceModel = (prisma as any).certificateIssuance as {\n    findMany: (args: any) => Promise<any[]>;\n  };\n  const entitlementModel = (prisma as any).certificateEntitlement as {\n    findMany: (args: any) => Promise<any[]>;\n  };\n\n  const [issuances, entitlements] = await Promise.all([\n    issuanceModel.findMany({ where: { userId }, orderBy: { issuedAt: \"desc\" } }),\n    entitlementModel.findMany({ where: { userId } }),\n  ]);\n\n  const entitlementByCourse = new Map<string, any>();\n  for (const e of entitlements) entitlementByCourse.set(e.courseId, e);\n\n  return (\n    <div className=\"mx-auto max-w-3xl p-6\">\n      <h1 className=\"text-2xl font-semibold\">Certificates</h1>\n      <p className=\"mt-2 text-sm text-slate-600\">\n        Learning stays free. Certificates are optional paid recognition.\n      </p>\n\n      <div className=\"mt-6 rounded-xl border border-slate-200 bg-white\">\n        <div className=\"border-b border-slate-200 p-4\">\n          <h2 className=\"text-sm font-semibold text-slate-900\">Issued certificates</h2>\n        </div>\n        <div className=\"p-4\">\n          {issuances.length === 0 ? (\n            <p className=\"text-sm text-slate-600\">No certificates issued yet.</p>\n          ) : (\n            <ul className=\"space-y-3\">\n              {issuances.map((c) => (\n                <li key={c.certificateId} className=\"flex flex-wrap items-center justify-between gap-3\">\n                  <div>\n                    <div className=\"text-sm font-semibold text-slate-900\">{c.courseId}</div>\n                    <div className=\"text-xs text-slate-600\">{c.certificateId}</div>\n                  </div>\n                  <CertificatesClient kind=\"download\" certificateId={c.certificateId} />\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n\n      <div className=\"mt-6 rounded-xl border border-slate-200 bg-white\">\n        <div className=\"border-b border-slate-200 p-4\">\n          <h2 className=\"text-sm font-semibold text-slate-900\">Issue a certificate</h2>\n        </div>\n        <div className=\"p-4\">\n          <ul className=\"space-y-3\">\n            {COURSES.map((c) => {\n              const ent = entitlementByCourse.get(c.courseId);\n              const status = ent?.status || \"not_requested\";\n              return (\n                <li key={c.courseId} className=\"flex flex-wrap items-center justify-between gap-3\">\n                  <div>\n                    <div className=\"text-sm font-semibold text-slate-900\">{c.title}</div>\n                    <div className=\"text-xs text-slate-600\">Status: {status}</div>\n                  </div>\n                  {status === \"issued\" ? (\n                    <span className=\"text-xs text-slate-600\">Already issued</span>\n                  ) : status === \"eligible\" ? (\n                    <CertificatesClient kind=\"issue\" courseId={c.courseId} />\n                  ) : status === \"pending_payment\" ? (\n                    <span className=\"text-xs text-slate-600\">Payment pending</span>\n                  ) : (\n                    <span className=\"text-xs text-slate-600\">Not requested</span>\n                  )}\n                </li>\n              );\n            })}\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\n"],"names":[],"mappings":"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","ignoreList":[5]}}]
}