{
  "version": 3,
  "sources": [],
  "debugId": "3925904e-16fd-9424-0ffd-f5b086edfe9f",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/node_modules/openid-client/package.json","turbopack:///[project]/node_modules/nodemailer/package.json","turbopack:///[project]/node_modules/nodemailer/lib/well-known/services.json","../../../../src/lib/db/prisma.ts","../../../../src/services/progressService.ts","../../../../src/app/admin/access-denied/page.tsx","../../../../src/app/admin/layout.tsx"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","{\"name\":\"nodemailer\",\"version\":\"7.0.12\",\"description\":\"Easy as cake e-mail sending from your Node.js applications\",\"main\":\"lib/nodemailer.js\",\"scripts\":{\"test\":\"node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js\",\"test:coverage\":\"c8 node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js\",\"format\":\"prettier --write \\\"**/*.{js,json,md}\\\"\",\"format:check\":\"prettier --check \\\"**/*.{js,json,md}\\\"\",\"lint\":\"eslint .\",\"lint:fix\":\"eslint . --fix\",\"update\":\"rm -rf node_modules/ package-lock.json && ncu -u && npm install\"},\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/nodemailer/nodemailer.git\"},\"keywords\":[\"Nodemailer\"],\"author\":\"Andris Reinman\",\"license\":\"MIT-0\",\"bugs\":{\"url\":\"https://github.com/nodemailer/nodemailer/issues\"},\"homepage\":\"https://nodemailer.com/\",\"devDependencies\":{\"@aws-sdk/client-sesv2\":\"3.940.0\",\"bunyan\":\"1.8.15\",\"c8\":\"10.1.3\",\"eslint\":\"9.39.1\",\"eslint-config-prettier\":\"10.1.8\",\"globals\":\"16.5.0\",\"libbase64\":\"1.3.0\",\"libmime\":\"5.3.7\",\"libqp\":\"2.1.1\",\"nodemailer-ntlm-auth\":\"1.0.4\",\"prettier\":\"3.6.2\",\"proxy\":\"1.0.2\",\"proxy-test-server\":\"1.0.0\",\"smtp-server\":\"3.16.1\"},\"engines\":{\"node\":\">=6.0.0\"}}","{\"1und1\":{\"description\":\"1&1 Mail (German hosting provider)\",\"host\":\"smtp.1und1.de\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"126\":{\"description\":\"126 Mail (NetEase)\",\"host\":\"smtp.126.com\",\"port\":465,\"secure\":true},\"163\":{\"description\":\"163 Mail (NetEase)\",\"host\":\"smtp.163.com\",\"port\":465,\"secure\":true},\"Aliyun\":{\"description\":\"Alibaba Cloud Mail\",\"domains\":[\"aliyun.com\"],\"host\":\"smtp.aliyun.com\",\"port\":465,\"secure\":true},\"AliyunQiye\":{\"description\":\"Alibaba Cloud Enterprise Mail\",\"host\":\"smtp.qiye.aliyun.com\",\"port\":465,\"secure\":true},\"AOL\":{\"description\":\"AOL Mail\",\"domains\":[\"aol.com\"],\"host\":\"smtp.aol.com\",\"port\":587},\"Aruba\":{\"description\":\"Aruba PEC (Italian email provider)\",\"domains\":[\"aruba.it\",\"pec.aruba.it\"],\"aliases\":[\"Aruba PEC\"],\"host\":\"smtps.aruba.it\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"Bluewin\":{\"description\":\"Bluewin (Swiss email provider)\",\"host\":\"smtpauths.bluewin.ch\",\"domains\":[\"bluewin.ch\"],\"port\":465},\"BOL\":{\"description\":\"BOL Mail (Brazilian provider)\",\"domains\":[\"bol.com.br\"],\"host\":\"smtp.bol.com.br\",\"port\":587,\"requireTLS\":true},\"DebugMail\":{\"description\":\"DebugMail (email testing service)\",\"host\":\"debugmail.io\",\"port\":25},\"Disroot\":{\"description\":\"Disroot (privacy-focused provider)\",\"domains\":[\"disroot.org\"],\"host\":\"disroot.org\",\"port\":587,\"secure\":false,\"authMethod\":\"LOGIN\"},\"DynectEmail\":{\"description\":\"Dyn Email Delivery\",\"aliases\":[\"Dynect\"],\"host\":\"smtp.dynect.net\",\"port\":25},\"ElasticEmail\":{\"description\":\"Elastic Email\",\"aliases\":[\"Elastic Email\"],\"host\":\"smtp.elasticemail.com\",\"port\":465,\"secure\":true},\"Ethereal\":{\"description\":\"Ethereal Email (email testing service)\",\"aliases\":[\"ethereal.email\"],\"host\":\"smtp.ethereal.email\",\"port\":587},\"FastMail\":{\"description\":\"FastMail\",\"domains\":[\"fastmail.fm\"],\"host\":\"smtp.fastmail.com\",\"port\":465,\"secure\":true},\"Feishu Mail\":{\"description\":\"Feishu Mail (Lark)\",\"aliases\":[\"Feishu\",\"FeishuMail\"],\"domains\":[\"www.feishu.cn\"],\"host\":\"smtp.feishu.cn\",\"port\":465,\"secure\":true},\"Forward Email\":{\"description\":\"Forward Email (email forwarding service)\",\"aliases\":[\"FE\",\"ForwardEmail\"],\"domains\":[\"forwardemail.net\"],\"host\":\"smtp.forwardemail.net\",\"port\":465,\"secure\":true},\"GandiMail\":{\"description\":\"Gandi Mail\",\"aliases\":[\"Gandi\",\"Gandi Mail\"],\"host\":\"mail.gandi.net\",\"port\":587},\"Gmail\":{\"description\":\"Gmail\",\"aliases\":[\"Google Mail\"],\"domains\":[\"gmail.com\",\"googlemail.com\"],\"host\":\"smtp.gmail.com\",\"port\":465,\"secure\":true},\"GMX\":{\"description\":\"GMX Mail\",\"domains\":[\"gmx.com\",\"gmx.net\",\"gmx.de\"],\"host\":\"mail.gmx.com\",\"port\":587},\"Godaddy\":{\"description\":\"GoDaddy Email (US)\",\"host\":\"smtpout.secureserver.net\",\"port\":25},\"GodaddyAsia\":{\"description\":\"GoDaddy Email (Asia)\",\"host\":\"smtp.asia.secureserver.net\",\"port\":25},\"GodaddyEurope\":{\"description\":\"GoDaddy Email (Europe)\",\"host\":\"smtp.europe.secureserver.net\",\"port\":25},\"hot.ee\":{\"description\":\"Hot.ee (Estonian email provider)\",\"host\":\"mail.hot.ee\"},\"Hotmail\":{\"description\":\"Outlook.com / Hotmail\",\"aliases\":[\"Outlook\",\"Outlook.com\",\"Hotmail.com\"],\"domains\":[\"hotmail.com\",\"outlook.com\"],\"host\":\"smtp-mail.outlook.com\",\"port\":587},\"iCloud\":{\"description\":\"iCloud Mail\",\"aliases\":[\"Me\",\"Mac\"],\"domains\":[\"me.com\",\"mac.com\"],\"host\":\"smtp.mail.me.com\",\"port\":587},\"Infomaniak\":{\"description\":\"Infomaniak Mail (Swiss hosting provider)\",\"host\":\"mail.infomaniak.com\",\"domains\":[\"ik.me\",\"ikmail.com\",\"etik.com\"],\"port\":587},\"KolabNow\":{\"description\":\"KolabNow (secure email service)\",\"domains\":[\"kolabnow.com\"],\"aliases\":[\"Kolab\"],\"host\":\"smtp.kolabnow.com\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"Loopia\":{\"description\":\"Loopia (Swedish hosting provider)\",\"host\":\"mailcluster.loopia.se\",\"port\":465},\"Loops\":{\"description\":\"Loops\",\"host\":\"smtp.loops.so\",\"port\":587},\"mail.ee\":{\"description\":\"Mail.ee (Estonian email provider)\",\"host\":\"smtp.mail.ee\"},\"Mail.ru\":{\"description\":\"Mail.ru\",\"host\":\"smtp.mail.ru\",\"port\":465,\"secure\":true},\"Mailcatch.app\":{\"description\":\"Mailcatch (email testing service)\",\"host\":\"sandbox-smtp.mailcatch.app\",\"port\":2525},\"Maildev\":{\"description\":\"MailDev (local email testing)\",\"port\":1025,\"ignoreTLS\":true},\"MailerSend\":{\"description\":\"MailerSend\",\"host\":\"smtp.mailersend.net\",\"port\":587},\"Mailgun\":{\"description\":\"Mailgun\",\"host\":\"smtp.mailgun.org\",\"port\":465,\"secure\":true},\"Mailjet\":{\"description\":\"Mailjet\",\"host\":\"in.mailjet.com\",\"port\":587},\"Mailosaur\":{\"description\":\"Mailosaur (email testing service)\",\"host\":\"mailosaur.io\",\"port\":25},\"Mailtrap\":{\"description\":\"Mailtrap\",\"host\":\"live.smtp.mailtrap.io\",\"port\":587},\"Mandrill\":{\"description\":\"Mandrill (by Mailchimp)\",\"host\":\"smtp.mandrillapp.com\",\"port\":587},\"Naver\":{\"description\":\"Naver Mail (Korean email provider)\",\"host\":\"smtp.naver.com\",\"port\":587},\"OhMySMTP\":{\"description\":\"OhMySMTP (email delivery service)\",\"host\":\"smtp.ohmysmtp.com\",\"port\":587,\"secure\":false},\"One\":{\"description\":\"One.com Email\",\"host\":\"send.one.com\",\"port\":465,\"secure\":true},\"OpenMailBox\":{\"description\":\"OpenMailBox\",\"aliases\":[\"OMB\",\"openmailbox.org\"],\"host\":\"smtp.openmailbox.org\",\"port\":465,\"secure\":true},\"Outlook365\":{\"description\":\"Microsoft 365 / Office 365\",\"host\":\"smtp.office365.com\",\"port\":587,\"secure\":false},\"Postmark\":{\"description\":\"Postmark\",\"aliases\":[\"PostmarkApp\"],\"host\":\"smtp.postmarkapp.com\",\"port\":2525},\"Proton\":{\"description\":\"Proton Mail\",\"aliases\":[\"ProtonMail\",\"Proton.me\",\"Protonmail.com\",\"Protonmail.ch\"],\"domains\":[\"proton.me\",\"protonmail.com\",\"pm.me\",\"protonmail.ch\"],\"host\":\"smtp.protonmail.ch\",\"port\":587,\"requireTLS\":true},\"qiye.aliyun\":{\"description\":\"Alibaba Mail Enterprise Edition\",\"host\":\"smtp.mxhichina.com\",\"port\":\"465\",\"secure\":true},\"QQ\":{\"description\":\"QQ Mail\",\"domains\":[\"qq.com\"],\"host\":\"smtp.qq.com\",\"port\":465,\"secure\":true},\"QQex\":{\"description\":\"QQ Enterprise Mail\",\"aliases\":[\"QQ Enterprise\"],\"domains\":[\"exmail.qq.com\"],\"host\":\"smtp.exmail.qq.com\",\"port\":465,\"secure\":true},\"Resend\":{\"description\":\"Resend\",\"host\":\"smtp.resend.com\",\"port\":465,\"secure\":true},\"Runbox\":{\"description\":\"Runbox (Norwegian email provider)\",\"domains\":[\"runbox.com\"],\"host\":\"smtp.runbox.com\",\"port\":465,\"secure\":true},\"SendCloud\":{\"description\":\"SendCloud (Chinese email delivery)\",\"host\":\"smtp.sendcloud.net\",\"port\":2525},\"SendGrid\":{\"description\":\"SendGrid\",\"host\":\"smtp.sendgrid.net\",\"port\":587},\"SendinBlue\":{\"description\":\"Brevo (formerly Sendinblue)\",\"aliases\":[\"Brevo\"],\"host\":\"smtp-relay.brevo.com\",\"port\":587},\"SendPulse\":{\"description\":\"SendPulse\",\"host\":\"smtp-pulse.com\",\"port\":465,\"secure\":true},\"SES\":{\"description\":\"AWS SES US East (N. Virginia)\",\"host\":\"email-smtp.us-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-1\":{\"description\":\"AWS SES Asia Pacific (Tokyo)\",\"host\":\"email-smtp.ap-northeast-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-2\":{\"description\":\"AWS SES Asia Pacific (Seoul)\",\"host\":\"email-smtp.ap-northeast-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-3\":{\"description\":\"AWS SES Asia Pacific (Osaka)\",\"host\":\"email-smtp.ap-northeast-3.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTH-1\":{\"description\":\"AWS SES Asia Pacific (Mumbai)\",\"host\":\"email-smtp.ap-south-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTHEAST-1\":{\"description\":\"AWS SES Asia Pacific (Singapore)\",\"host\":\"email-smtp.ap-southeast-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTHEAST-2\":{\"description\":\"AWS SES Asia Pacific (Sydney)\",\"host\":\"email-smtp.ap-southeast-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-CA-CENTRAL-1\":{\"description\":\"AWS SES Canada (Central)\",\"host\":\"email-smtp.ca-central-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-CENTRAL-1\":{\"description\":\"AWS SES Europe (Frankfurt)\",\"host\":\"email-smtp.eu-central-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-NORTH-1\":{\"description\":\"AWS SES Europe (Stockholm)\",\"host\":\"email-smtp.eu-north-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-1\":{\"description\":\"AWS SES Europe (Ireland)\",\"host\":\"email-smtp.eu-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-2\":{\"description\":\"AWS SES Europe (London)\",\"host\":\"email-smtp.eu-west-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-3\":{\"description\":\"AWS SES Europe (Paris)\",\"host\":\"email-smtp.eu-west-3.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-SA-EAST-1\":{\"description\":\"AWS SES South America (SÃ£o Paulo)\",\"host\":\"email-smtp.sa-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-EAST-1\":{\"description\":\"AWS SES US East (N. Virginia)\",\"host\":\"email-smtp.us-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-EAST-2\":{\"description\":\"AWS SES US East (Ohio)\",\"host\":\"email-smtp.us-east-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-GOV-EAST-1\":{\"description\":\"AWS SES GovCloud (US-East)\",\"host\":\"email-smtp.us-gov-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-GOV-WEST-1\":{\"description\":\"AWS SES GovCloud (US-West)\",\"host\":\"email-smtp.us-gov-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-WEST-1\":{\"description\":\"AWS SES US West (N. California)\",\"host\":\"email-smtp.us-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-WEST-2\":{\"description\":\"AWS SES US West (Oregon)\",\"host\":\"email-smtp.us-west-2.amazonaws.com\",\"port\":465,\"secure\":true},\"Seznam\":{\"description\":\"Seznam Email (Czech email provider)\",\"aliases\":[\"Seznam Email\"],\"domains\":[\"seznam.cz\",\"email.cz\",\"post.cz\",\"spoluzaci.cz\"],\"host\":\"smtp.seznam.cz\",\"port\":465,\"secure\":true},\"SMTP2GO\":{\"description\":\"SMTP2GO\",\"host\":\"mail.smtp2go.com\",\"port\":2525},\"Sparkpost\":{\"description\":\"SparkPost\",\"aliases\":[\"SparkPost\",\"SparkPost Mail\"],\"domains\":[\"sparkpost.com\"],\"host\":\"smtp.sparkpostmail.com\",\"port\":587,\"secure\":false},\"Tipimail\":{\"description\":\"Tipimail (email delivery service)\",\"host\":\"smtp.tipimail.com\",\"port\":587},\"Tutanota\":{\"description\":\"Tutanota (Tuta Mail)\",\"domains\":[\"tutanota.com\",\"tuta.com\",\"tutanota.de\",\"tuta.io\"],\"host\":\"smtp.tutanota.com\",\"port\":465,\"secure\":true},\"Yahoo\":{\"description\":\"Yahoo Mail\",\"domains\":[\"yahoo.com\"],\"host\":\"smtp.mail.yahoo.com\",\"port\":465,\"secure\":true},\"Yandex\":{\"description\":\"Yandex Mail\",\"domains\":[\"yandex.ru\"],\"host\":\"smtp.yandex.ru\",\"port\":465,\"secure\":true},\"Zimbra\":{\"description\":\"Zimbra Mail Server\",\"aliases\":[\"Zimbra Collaboration\"],\"host\":\"smtp.zimbra.com\",\"port\":587,\"requireTLS\":true},\"Zoho\":{\"description\":\"Zoho Mail\",\"host\":\"smtp.zoho.com\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"}}","import { PrismaClient } from \"@prisma/client\";\n\n// Default DB for local dev when env is missing.\n// This keeps local dev lightweight and avoids \"silent\" runtime failures.\nif (!process.env.DATABASE_URL) {\n  process.env.DATABASE_URL = \"file:./data/dev.db\";\n}\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\nexport const prisma: PrismaClient =\n  global.__prisma ||\n  new PrismaClient({\n    log: [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  global.__prisma = prisma;\n}\n\n\n","import { prisma } from \"@/lib/db/prisma\";\n\n// Progress persistence rules:\n// - Anonymous users: local-only (handled in client hook; server endpoints require auth)\n// - Signed-in users: server is source of truth for cross-device persistence\n\nexport async function upsertUserIdentity(params: {\n  userId: string;\n  email: string;\n  provider: string;\n  providerAccountId: string;\n}) {\n  const email = params.email.trim().toLowerCase();\n  if (!email) return null;\n  return prisma.userIdentity.upsert({\n    where: { id: params.userId },\n    create: {\n      id: params.userId,\n      email,\n      provider: params.provider,\n      providerAccountId: params.providerAccountId,\n      lastLoginAt: new Date(),\n    },\n    update: {\n      provider: params.provider,\n      providerAccountId: params.providerAccountId,\n      lastLoginAt: new Date(),\n    },\n  });\n}\n\nexport async function getCpdStateForUser(userId: string) {\n  const row = await prisma.cpdState.findUnique({ where: { userId } });\n  return row ? { stateJson: row.stateJson, updatedAt: row.updatedAt.toISOString() } : null;\n}\n\nexport async function setCpdStateForUser(params: { userId: string; stateJson: string }) {\n  const saved = await prisma.cpdState.upsert({\n    where: { userId: params.userId },\n    create: { userId: params.userId, stateJson: params.stateJson },\n    update: { stateJson: params.stateJson },\n  });\n\n  // Maintain per-section progress rows as a foundation for future CPD evidence/export.\n  // This is derived data: the canonical state is the CPD JSON.\n  try {\n    const state = JSON.parse(params.stateJson);\n    const sections = Array.isArray(state?.sections) ? state.sections : [];\n\n    const writes = sections\n      .filter((s: any) => s && typeof s === \"object\")\n      .filter((s: any) => s.sectionId && s.sectionId !== \"overall\")\n      .map((s: any) => ({\n        courseId: String(s.trackId || \"\").trim(),\n        levelId: String(s.levelId || \"\").trim(),\n        sectionId: String(s.sectionId || \"\").trim(),\n        completed: Boolean(s.completed),\n        minutes: Math.max(0, Number(s.minutes) || 0),\n      }))\n      .filter((s: any) => s.courseId && s.levelId && s.sectionId);\n\n    // Upsert each progress row (idempotent per unique key).\n    await Promise.all(\n      writes.map((w: any) =>\n        prisma.progress.upsert({\n          where: {\n            userId_courseId_levelId_sectionId: {\n              userId: params.userId,\n              courseId: w.courseId,\n              levelId: w.levelId,\n              sectionId: w.sectionId,\n            },\n          },\n          create: { userId: params.userId, ...w },\n          update: { completed: w.completed, minutes: w.minutes },\n        }),\n      ),\n    );\n  } catch {\n    // Do not fail persistence if derived progress rows cannot be updated.\n  }\n\n  return { updatedAt: saved.updatedAt.toISOString() };\n}\n\nexport async function getAdminProgressStats() {\n  const totalUsers = await prisma.userIdentity.count();\n  const totalProgressRecords = await prisma.progress.count();\n  const since = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n  const activeUsers = await prisma.userIdentity.count({ where: { lastLoginAt: { gte: since } } });\n  return { totalUsers, activeUsersLast7Days: activeUsers, totalProgressRecords };\n}\n\n\n","import Link from \"next/link\";\n\nexport const dynamic = \"force-dynamic\";\n\nexport default function AdminAccessDeniedPage() {\n  return (\n    <div className=\"mx-auto max-w-2xl px-6 py-12 space-y-4\">\n      <p className=\"text-xs font-semibold text-slate-600\">Admin</p>\n      <h1 className=\"text-3xl font-semibold text-slate-900\">Access denied</h1>\n      <p className=\"text-slate-700\">\n        You do not have permission to access the admin area. If you believe this is a mistake, contact the site owner.\n      </p>\n      <div className=\"flex flex-wrap gap-2\">\n        <Link href=\"/\" className=\"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400\">\n          Return home\n        </Link>\n        <Link href=\"/signin\" className=\"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800\">\n          Sign in\n        </Link>\n      </div>\n    </div>\n  );\n}\n\n\n","import type { Metadata } from \"next\";\nimport Link from \"next/link\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth/options\";\nimport AdminAccessDeniedPage from \"@/app/admin/access-denied/page\";\nimport { getAdminRole, hasPermission } from \"@/lib/admin/rbac\";\n\n// Preview: /admin routes are not for indexing during early release.\nexport const metadata: Metadata = {\n  robots: {\n    index: false,\n    follow: false,\n  },\n};\n\nexport default async function AdminLayout({ children }: { children: React.ReactNode }) {\n  const session = await getServerSession(authOptions).catch(() => null);\n  const role = getAdminRole(session?.user || null);\n  if (!session?.user || !role) return <AdminAccessDeniedPage />;\n\n  const canViewBilling = hasPermission(role, \"VIEW_BILLING\");\n\n  const nav = [\n    { href: \"/admin\", label: \"Overview\", enabled: true },\n    { href: \"/admin/users\", label: \"Users\", enabled: true },\n    { href: \"/admin/support\", label: \"Support\", enabled: true },\n    { href: \"/admin/assessments\", label: \"Assessments\", enabled: hasPermission(role, \"VIEW_ASSESSMENTS\") },\n    { href: \"/admin/billing\", label: \"Billing overview\", enabled: canViewBilling },\n    { href: \"/admin/billing/credits\", label: \"Credits ledger\", enabled: canViewBilling },\n    { href: \"/admin/billing/usage\", label: \"Usage and costs\", enabled: canViewBilling },\n    { href: \"/admin/billing/stripe\", label: \"Stripe readiness\", enabled: canViewBilling },\n    { href: \"/admin/system\", label: \"System\", enabled: true },\n  ];\n\n  return (\n    <div className=\"min-h-[calc(100vh-60px)] bg-slate-50\">\n      <div className=\"mx-auto max-w-7xl px-4 py-8 md:px-6 lg:px-8\">\n        <div className=\"flex flex-col gap-6 lg:flex-row\">\n          <aside className=\"lg:w-64\">\n            <div className=\"rounded-3xl border border-slate-200 bg-white p-5 shadow-sm space-y-4\">\n              <div>\n                <p className=\"text-xs font-semibold text-slate-600\">Admin Control Centre</p>\n                <p className=\"mt-1 text-sm font-semibold text-slate-900\">Signed in role: {role}</p>\n              </div>\n              <nav aria-label=\"Admin navigation\" className=\"space-y-1\">\n                {nav.map((item) => (\n                  item.enabled ? (\n                    <Link\n                      key={item.href}\n                      href={item.href}\n                      className=\"block rounded-xl px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2\"\n                    >\n                      {item.label}\n                    </Link>\n                  ) : (\n                    <div key={item.href} className=\"block rounded-xl px-3 py-2 text-sm font-semibold text-slate-400\">\n                      {item.label}\n                    </div>\n                  )\n                ))}\n              </nav>\n              <div className=\"rounded-2xl border border-slate-200 bg-slate-50/70 p-4\">\n                <p className=\"text-xs font-semibold text-slate-700\">Auditability</p>\n                <p className=\"mt-1 text-xs text-slate-600\">\n                  Admin actions are audited server-side. Provide a reason for sensitive changes.\n                </p>\n              </div>\n            </div>\n          </aside>\n\n          <div className=\"flex-1\">{children}</div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}}]
}