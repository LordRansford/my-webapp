;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d339f2ff-314f-9f6b-c6e9-4f926f9933cd")}catch(e){}}();
module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},569264,a=>{a.n(a.i(354832))},881967,a=>{a.n(a.i(429735))},900827,a=>{a.n(a.i(995845))},918554,a=>{a.n(a.i(316801))},517537,a=>{a.n(a.i(903363))},13718,a=>{a.n(a.i(685523))},118198,a=>{a.n(a.i(545518))},444067,a=>{a.n(a.i(436102))},989644,a=>{a.n(a.i(736900))},851595,a=>{"use strict";var b=a.i(907997),c=a.i(395936),d=a.i(929073);let e={freeTierComputeUnitsPerRun:120,freeTierMaxInputBytes:2e5,paidTierComputeUnitPricePence:1,minPurchasePence:1e3,maxInputBytesPaid:2e6,maxComputeUnitsPaid:5e3};function f(a){let b=(a/100).toFixed(2);return`\xa3${b}`}async function g(){let a=0,g=0,h=0,i=0,j=0,k=[];try{a=await d.prisma.userIdentity.count()}catch{a=0}try{let a=await d.prisma.creditLedgerEvent.groupBy({by:["userId"],_sum:{amountPence:!0}});g=(a||[]).filter(a=>Number(a?._sum?.amountPence||0)>0).length,h=(a||[]).reduce((a,b)=>a+Number(b?._sum?.amountPence||0),0)}catch{g=0,h=0}let l=Date.now();try{let a=await d.prisma.creditLedgerEvent.aggregate({where:{type:"credit_spent",createdAt:{gte:new Date(l-6048e5)}},_sum:{amountPence:!0}});i=Math.max(0,-1*Number(a?._sum?.amountPence||0))}catch{i=0}try{let a=await d.prisma.creditLedgerEvent.aggregate({where:{type:"credit_spent",createdAt:{gte:new Date(l-2592e6)}},_sum:{amountPence:!0}});j=Math.max(0,-1*Number(a?._sum?.amountPence||0))}catch{j=0}try{k=(await d.prisma.toolRun.groupBy({by:["toolId"],where:{createdAt:{gte:new Date(l-2592e6)}},_sum:{paidTierChargedPence:!0},orderBy:{_sum:{paidTierChargedPence:"desc"}},take:5})||[]).map(a=>({toolId:String(a.toolId),paid:Number(a?._sum?.paidTierChargedPence||0)}))}catch{k=[]}return(0,b.jsxs)("main",{className:"mx-auto max-w-6xl px-4 py-10 md:px-6 lg:px-8 space-y-6",children:[(0,b.jsxs)("header",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"Billing"}),(0,b.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"Billing overview"}),(0,b.jsx)("p",{className:"text-slate-700",children:"Read-only visibility for credits, usage, and Stripe readiness. Payments remain disabled."}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(c.default,{href:"/admin/billing/credits",className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400",children:"Credits ledger"}),(0,b.jsx)(c.default,{href:"/admin/billing/usage",className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400",children:"Usage and costs"}),(0,b.jsx)(c.default,{href:"/admin/billing/stripe",className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400",children:"Stripe readiness"})]})]}),(0,b.jsx)("section",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[{label:"Total users",value:String(a)},{label:"Users with balance > 0",value:String(g)},{label:"Total credit outstanding",value:f(h)},{label:"Total credit spent (30d)",value:f(j)}].map(a=>(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:a.label}),(0,b.jsx)("p",{className:"mt-2 text-3xl font-semibold text-slate-900",children:a.value})]},a.label))}),(0,b.jsxs)("section",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Spend windows"}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Spent (7d)"}),(0,b.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:f(i)})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Spent (30d)"}),(0,b.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:f(j)})]})]})]}),(0,b.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Top tools by paid cost (30d)"}),k.length?(0,b.jsx)("ul",{className:"space-y-2 text-sm text-slate-800",children:k.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between rounded-2xl border border-slate-200 bg-slate-50/70 px-4 py-3",children:[(0,b.jsx)("span",{className:"font-semibold",children:a.toolId}),(0,b.jsx)("span",{className:"text-slate-700",children:f(Number(a.paid||0))})]},a.toolId))}):(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"No paid usage recorded yet."})]})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Pricing configuration (read only)"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"These values are the server-side source of truth for later billing work."}),(0,b.jsx)("pre",{className:"overflow-auto rounded-2xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-800",children:JSON.stringify(e,null,2)})]})]})}a.s(["default",()=>g,"dynamic",0,"force-dynamic","metadata",0,{title:"Admin: Billing overview",robots:{index:!1,follow:!1}}],851595)}];

//# debugId=d339f2ff-314f-9f6b-c6e9-4f926f9933cd
//# sourceMappingURL=%5Broot-of-the-server%5D__6bfdd854._.js.map