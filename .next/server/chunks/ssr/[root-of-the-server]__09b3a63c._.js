;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="48dc40cd-8e35-dc9d-ea78-80b90ba1628c")}catch(e){}}();
module.exports=[556704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},7821,a=>{"use strict";let b={cyber:{foundations:{"foundations-f0-what-security-is":["foundations-why-cyber-matters"],"foundations-f2-data-and-integrity":["foundations-data-and-bits"],"foundations-f3-networks-and-transport":["foundations-networks-and-packets"],"foundations-f4-cia-and-simple-attacks":["foundations-cia-and-simple-attacks"],"foundations-f8-foundations-capstone":["foundations-checkpoint-capstone"]}}};function c(a,c,d){let e=String(d||"").trim();if(!e)return[];let f=b?.[a]?.[c]?.[e]??[];return Array.from(new Set([e,...f].map(a=>String(a).trim()).filter(Boolean)))}function d(){return{version:1,sections:[],activity:[]}}function e(a){}function f(a,b){let c={...a,sections:[...a.sections]},d=c.sections.findIndex(a=>a.trackId===b.trackId&&a.levelId===b.levelId&&a.sectionId===b.sectionId),e=new Date().toISOString(),f=d>=0?c.sections[d]:null,g=Math.max(0,(f?.minutes||0)+(b.minutesDelta||0)),h={trackId:b.trackId,levelId:b.levelId,sectionId:b.sectionId,completed:b.completed??f?.completed??!1,minutes:g,lastUpdated:e};return d>=0?c.sections[d]=h:c.sections.push(h),c}function g(a,b){let c=a.sections.filter(a=>a.trackId===b),d=c.reduce((a,b)=>a+b.minutes,0);return{totalMinutes:d,completedSections:c.filter(a=>a.completed).length,totalSections:c.length}}function h(a){return"cybersecurity"===a||"cyber"===a?"cyber":"software-architecture"===a||"architecture"===a?"software-architecture":"digitalisation"===a?"digitalisation":"data"===a?"data":"ai"}function i(a,b,d,e=[]){let f=e.filter(e=>{let f;return 0!==(f=c(b,d,e)).length&&f.some(c=>a.sections.some(a=>a.trackId===b&&a.levelId===d&&a.sectionId===c&&a.completed))}).length,g=e.length,h=0===g?0:Math.round(f/g*100);return{completedCount:f,totalCount:g,percent:h}}function j(a,b,c,d){let e=(d&&d.length>0?d:Object.keys(c||{})).reduce((d,e)=>{let f=c?.[e]||[],g=i(a,b,e,f);return d.completed+=g.completedCount,d.total+=g.totalCount,d},{completed:0,total:0}),f=0===e.total?0:Math.round(e.completed/e.total*100);return{completedCount:e.completed,totalCount:e.total,percent:f}}function k(a,b){let c={...b,id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,timestamp:new Date().toISOString()};return{...a,activity:[c,...a.activity].slice(0,200)}}a.s(["addActivityEntry",()=>k,"getCompletionForCourse",()=>j,"getCompletionForLevel",()=>i,"getInitialCPDState",()=>d,"getSectionAliases",()=>c,"getTotalsForTrack",()=>g,"resolveTrackId",()=>h,"saveCPDState",()=>e,"upsertSection",()=>f])},40510,a=>{"use strict";var b=a.i(127669),c=a.i(483074),d=a.i(7821);function e(){let[a,e]=(0,b.useState)(()=>({version:1,sections:[],activity:[]})),{data:f,status:g}=(0,c.useSession)(),h=!!f?.user?.id;(0,b.useEffect)(()=>{},[]),(0,b.useEffect)(()=>{if(!h)return;let b=!1;return(async()=>{try{let c=await fetch("/api/progress/cpd",{method:"GET"});if(!c.ok)return;let f=await c.json();if(b)return;f?.state?(e(f.state),(0,d.saveCPDState)(f.state)):await fetch("/api/progress/cpd",{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({state:a})})}catch{}})(),()=>{b=!0}},[h,g]);let i=(0,b.useCallback)(a=>{f?.user?.id&&e(b=>{let c=(0,d.upsertSection)(b,a);return a.minutesDelta&&0!==a.minutesDelta&&(c=(0,d.addActivityEntry)(c,{trackId:a.trackId,levelId:a.levelId,sectionId:a.sectionId,minutesDelta:a.minutesDelta,note:a.note??""})),(0,d.saveCPDState)(c),fetch("/api/progress/cpd",{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({state:c})}).catch(()=>{}),!0===a.completed&&fetch("/api/cpd/evidence",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({courseId:"cyber"===a.trackId?"cybersecurity":String(a.trackId||""),evidenceType:"progress",payload:{trackId:a.trackId,levelId:a.levelId,sectionId:a.sectionId,completed:!0}})}).catch(()=>{}),c})},[f?.user?.id]),j=(0,b.useCallback)(b=>(0,d.getTotalsForTrack)(a,b),[a]);return{state:a,updateSection:i,getTrackTotals:j,isAuthed:h}}a.s(["useCPD",()=>e])},644575,a=>{"use strict";var b=a.i(508171),c=a.i(127669),d=a.i(901257),e=a.i(483074),f=a.i(645667),g=a.i(40510);function h(){let{data:a,status:h}=(0,e.useSession)(),i=a?.user,j=!!i?.id,{state:k}=(0,g.useCPD)(),[l,m]=(0,c.useState)("free"),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)({termsAccepted:!1,privacyAccepted:!1,cpdDataUseAccepted:!1}),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),H=(0,c.useMemo)(()=>j?"pro"===l?"Professional":"supporter"===l?"Supporter":"Registered learner":"Visitor",[j,l]);(0,c.useEffect)(()=>{j&&fetch("/api/account/profile").then(a=>a.json()).then(a=>{m(a?.plan||"free");let b=a?.user?.consent||{};A({termsAccepted:!!b.termsAcceptedAt,privacyAccepted:!!b.privacyAcceptedAt,cpdDataUseAccepted:!!b.cpdDataUseAcceptedAt})}).catch(()=>m("free"))},[j]),(0,c.useEffect)(()=>{j&&(fetch("/api/analytics/me").then(a=>a.json()).then(a=>o(a)).catch(()=>o(null)),fetch("/api/account/learning-summary").then(a=>a.json()).then(a=>q(a)).catch(()=>q(null)),fetch("/api/credits/status").then(a=>a.ok?a.json():null).then(a=>{s("number"==typeof a?.balance?a.balance:0),u("string"==typeof a?.expiresAt?a.expiresAt:a?.expiresAt?String(a.expiresAt):null),w(Array.isArray(a?.usage)?a.usage:[])}).catch(()=>s(0)))},[j,z.cpdDataUseAccepted]);let I=async a=>{y(!0),G(null);try{let b=await fetch("/api/account/consent",{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify(a)});if(b.ok)G("Consent settings saved.");else{let a=await b.json().catch(()=>({}));G(a?.message||"Could not save consent settings.")}}catch{G("Could not save consent settings.")}finally{y(!1)}},J=async()=>{if(i?.email){E(!0),G(null);try{let a=await fetch("/api/account/delete",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({confirmEmail:B})}),b=await a.json().catch(()=>({}));if(!a.ok)return void G(b?.message||"Account deletion failed.");G("Account deleted. Signing out."),await (0,e.signOut)({callbackUrl:"/"})}catch{G("Account deletion failed.")}finally{E(!1)}}};return"loading"===h?(0,b.jsx)(f.default,{title:"Account",description:"Your account and consent settings.",children:(0,b.jsx)("main",{className:"page",children:(0,b.jsxs)("header",{className:"page-header",children:[(0,b.jsx)("p",{className:"eyebrow",children:"Account"}),(0,b.jsx)("h1",{children:"Account"}),(0,b.jsx)("p",{className:"lead",children:"Loading."})]})})}):j?(0,b.jsx)(f.default,{title:"Account",description:"Your account and consent settings.",children:(0,b.jsxs)("main",{className:"page",children:[(0,b.jsxs)("header",{className:"page-header",children:[(0,b.jsx)("p",{className:"eyebrow",children:"Account"}),(0,b.jsx)("h1",{children:"Account"}),(0,b.jsx)("p",{className:"lead",children:"Minimal identity. No passwords. No profile data required."})]}),(0,b.jsxs)("section",{className:"section",children:[(0,b.jsx)("h2",{children:"Details"}),(0,b.jsxs)("ul",{className:"list",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Email"}),": ",i?.email]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Tier"}),": ",H]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Credits"}),": ",r??0]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Credits expiry"}),": ",t?new Date(t).toLocaleDateString():"Not set yet"]}),p?.displayName?(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Name"}),": ",p.displayName]}):null]}),(0,b.jsx)("p",{className:"muted",children:"Payments are not enabled yet. Learning stays free. Credits only apply to compute above the free tier. When payments launch, the minimum top-up will be £10 and credits will expire after a set period."}),v?.length?(0,b.jsxs)("div",{className:"mt-3 rounded-2xl border border-slate-200 bg-white p-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"Recent credit usage"}),(0,b.jsx)("ul",{className:"mt-2 space-y-1 text-sm text-slate-700",children:v.slice(0,8).map(a=>(0,b.jsxs)("li",{children:[new Date(a.occurredAt||a.submittedAt||Date.now()).toLocaleDateString()," - ",a.toolId," - ",a.consumed," credits"]},a.id))})]}):null,(0,b.jsxs)("div",{className:"mt-4 flex flex-wrap gap-3",children:[(0,b.jsx)(d.default,{href:"/account/history",className:"button",children:"View history"}),(0,b.jsx)(d.default,{href:"/my-cpd",className:"button",children:"My CPD"}),(0,b.jsx)("button",{type:"button",className:"button",onClick:()=>(0,e.signOut)({callbackUrl:"/"}),children:"Sign out"})]})]}),(0,b.jsxs)("section",{className:"section",children:[(0,b.jsx)("h2",{children:"Learning insights"}),(0,b.jsx)("p",{className:"muted",children:"These are learning signals from your progress, quizzes, and tool use. They are not ad tracking."}),n?.consented===!1?(0,b.jsx)("p",{className:"muted",children:"Turn on CPD tracking consent below to enable insights."}):null,(0,b.jsxs)("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Progress signals"}),(0,b.jsxs)("p",{className:"muted",children:["Sections: ",k.sections.filter(a=>a.completed).length," completed"]}),(0,b.jsxs)("p",{className:"muted",children:["Courses started: ",p?.coursesStarted??0," · Courses completed: ",p?.coursesCompleted??0]}),(0,b.jsxs)("p",{className:"muted",children:["Certificates earned: ",p?.certificatesEarned??0]}),(0,b.jsxs)("p",{className:"muted",children:["Total CPD hours: ",p?.totalCpdHours??0]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Exploration"}),(0,b.jsxs)("p",{className:"muted",children:["Tools explored: ",n?.summary?.toolsExplored??0]}),(0,b.jsxs)("p",{className:"muted",children:["Quizzes attempted: ",n?.summary?.quizzesAttempted??0]})]})]})]}),(0,b.jsxs)("section",{className:"section",children:[(0,b.jsx)("h2",{children:"Consent"}),(0,b.jsx)("p",{className:"muted",children:"These flags exist so your CPD record is defensible and your preferences are explicit. You can change them at any time."}),(0,b.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-start gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:z.termsAccepted,onChange:a=>{let b={...z,termsAccepted:a.target.checked};A(b),I(b)},disabled:x}),(0,b.jsxs)("span",{children:["I accept the ",(0,b.jsx)(d.default,{href:"/terms",className:"link",children:"terms"}),"."]})]}),(0,b.jsxs)("label",{className:"flex items-start gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:z.privacyAccepted,onChange:a=>{let b={...z,privacyAccepted:a.target.checked};A(b),I(b)},disabled:x}),(0,b.jsxs)("span",{children:["I accept the ",(0,b.jsx)(d.default,{href:"/privacy",className:"link",children:"privacy policy"}),"."]})]}),(0,b.jsxs)("label",{className:"flex items-start gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:z.cpdDataUseAccepted,onChange:a=>{let b={...z,cpdDataUseAccepted:a.target.checked};A(b),I(b)},disabled:x}),(0,b.jsx)("span",{children:"I consent to CPD tracking being stored to my account."})]})]}),F?(0,b.jsx)("p",{className:"mt-3 text-sm",children:F}):null]}),(0,b.jsxs)("section",{className:"section",children:[(0,b.jsx)("h2",{children:"Delete account"}),(0,b.jsx)("p",{className:"muted",children:"This deletes your account and server-side records for progress and history. It does not affect Stripe records held by Stripe."}),(0,b.jsx)("p",{className:"muted",children:"To confirm, type your email address and then delete."}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-3",children:[(0,b.jsx)("input",{className:"input",value:B,onChange:a=>C(a.target.value),placeholder:"Email confirmation","aria-label":"Confirm email for deletion"}),(0,b.jsx)("button",{type:"button",className:"button",disabled:D||B.trim().toLowerCase()!==String(i?.email||"").toLowerCase(),onClick:J,children:D?"Deleting":"Delete account"})]})]})]})}):(0,b.jsx)(f.default,{title:"Account",description:"Sign in to manage your account.",children:(0,b.jsxs)("main",{className:"page",children:[(0,b.jsxs)("header",{className:"page-header",children:[(0,b.jsx)("p",{className:"eyebrow",children:"Account"}),(0,b.jsx)("h1",{children:"Account"}),(0,b.jsx)("p",{className:"lead",children:"Sign in to track progress, CPD hours, and tool usage."})]}),(0,b.jsx)("section",{className:"section",children:(0,b.jsx)(d.default,{href:"/signin",className:"button primary",children:"Sign in"})})]})})}a.s(["default",()=>h])},363714,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(167684),h=a.i(276695),i=a.i(644575),j=a.i(509193),k=b([h]);[h]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/account/index",pathname:"/account",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/account/index",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1),705779,a=>{a.v(b=>Promise.all(["server/chunks/ssr/src_components_donations_DonationModal_tsx_266cc690._.js"].map(b=>a.l(b))).then(()=>b(438398)))}];

//# debugId=48dc40cd-8e35-dc9d-ea78-80b90ba1628c
//# sourceMappingURL=%5Broot-of-the-server%5D__09b3a63c._.js.map