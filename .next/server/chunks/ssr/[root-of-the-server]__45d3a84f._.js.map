{
  "version": 3,
  "sources": [],
  "debugId": "eed3b128-0da4-ff63-c667-c65f8c2fdc33",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/app/admin/billing/usage/page.tsx"],"sourcesContent":["import Link from \"next/link\";\nimport { prisma } from \"@/lib/db/prisma\";\n\nexport const dynamic = \"force-dynamic\";\n\nexport const metadata = {\n  title: \"Admin: Usage and costs\",\n  robots: { index: false, follow: false },\n};\n\nfunction toHuman(d: any) {\n  try {\n    return new Date(d).toLocaleString();\n  } catch {\n    return String(d);\n  }\n}\n\nfunction formatPence(pence: number) {\n  const pounds = (pence / 100).toFixed(2);\n  return `Â£${pounds}`;\n}\n\nexport default async function AdminUsagePage({\n  searchParams,\n}: {\n  searchParams: Promise<{ user?: string; toolId?: string; status?: string; from?: string; to?: string; cursor?: string }>;\n}) {\n  const sp = await searchParams;\n  const user = (sp.user || \"\").trim();\n  const toolId = (sp.toolId || \"\").trim();\n  const status = (sp.status || \"\").trim();\n  const from = (sp.from || \"\").trim();\n  const to = (sp.to || \"\").trim();\n  const cursor = sp.cursor || null;\n\n  const where: any = {};\n  if (user) where.userId = user;\n  if (toolId) where.toolId = toolId;\n  if (status) where.status = status;\n  if (from || to) {\n    where.createdAt = {};\n    if (from) where.createdAt.gte = new Date(from);\n    if (to) where.createdAt.lte = new Date(to);\n  }\n\n  const take = 30;\n  let rows: any[] = [];\n  try {\n    rows = await (prisma as any).toolRun.findMany({\n      where,\n      take: take + 1,\n      ...(cursor ? { cursor: { id: cursor }, skip: 1 } : {}),\n      orderBy: { createdAt: \"desc\" },\n      select: {\n        id: true,\n        createdAt: true,\n        userId: true,\n        toolId: true,\n        computeMs: true,\n        computeUnits: true,\n        costPence: true,\n        freeTierCoveredPence: true,\n        paidTierChargedPence: true,\n        status: true,\n      },\n    });\n  } catch {\n    rows = [];\n  }\n\n  const next = rows.length > take ? rows[take] : null;\n  const items = rows.slice(0, take);\n\n  return (\n    <main className=\"mx-auto max-w-6xl px-4 py-10 md:px-6 lg:px-8 space-y-6\">\n      <header className=\"space-y-2\">\n        <p className=\"text-xs font-semibold text-slate-600\">Billing</p>\n        <h1 className=\"text-2xl font-semibold text-slate-900\">Usage and costs</h1>\n        <p className=\"text-slate-700\">Read-only tool run ledger.</p>\n      </header>\n\n      <form className=\"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm flex flex-wrap gap-3 items-end\" action=\"/admin/billing/usage\">\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">User</span>\n          <input name=\"user\" defaultValue={user} placeholder=\"User ID\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">Tool</span>\n          <input name=\"toolId\" defaultValue={toolId} placeholder=\"tool id\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">Status</span>\n          <input name=\"status\" defaultValue={status} placeholder=\"success\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">From</span>\n          <input name=\"from\" defaultValue={from} placeholder=\"YYYY-MM-DD\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <label className=\"space-y-1\">\n          <span className=\"text-xs font-semibold text-slate-700\">To</span>\n          <input name=\"to\" defaultValue={to} placeholder=\"YYYY-MM-DD\" className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900\" />\n        </label>\n        <button type=\"submit\" className=\"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800\">\n          Apply\n        </button>\n      </form>\n\n      <div className=\"overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm\">\n        <table className=\"min-w-full text-sm\">\n          <thead className=\"bg-slate-50 text-slate-700\">\n            <tr>\n              {[\"Created\", \"User\", \"Tool\", \"Compute (ms)\", \"Units\", \"Cost\", \"Free\", \"Paid\", \"Status\"].map((h) => (\n                <th key={h} className=\"px-4 py-3 text-left text-xs font-semibold\">\n                  {h}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((r: any) => (\n              <tr key={r.id} className=\"border-t border-slate-100\">\n                <td className=\"px-4 py-3 text-slate-700\">{toHuman(r.createdAt)}</td>\n                <td className=\"px-4 py-3 font-mono text-xs text-slate-700\">{r.userId || \"anonymous\"}</td>\n                <td className=\"px-4 py-3 text-slate-900\">\n                  <Link href={`/admin/billing/usage/${encodeURIComponent(r.id)}`} className=\"font-semibold text-emerald-700 hover:underline\">\n                    {r.toolId}\n                  </Link>\n                </td>\n                <td className=\"px-4 py-3 text-slate-700\">{r.computeMs}</td>\n                <td className=\"px-4 py-3 text-slate-700\">{r.computeUnits}</td>\n                <td className=\"px-4 py-3 text-slate-900\">{formatPence(Number(r.costPence || 0))}</td>\n                <td className=\"px-4 py-3 text-slate-700\">{formatPence(Number(r.freeTierCoveredPence || 0))}</td>\n                <td className=\"px-4 py-3 text-slate-700\">{formatPence(Number(r.paidTierChargedPence || 0))}</td>\n                <td className=\"px-4 py-3 text-slate-900\">{r.status}</td>\n              </tr>\n            ))}\n            {items.length === 0 ? (\n              <tr>\n                <td colSpan={9} className=\"px-4 py-8 text-center text-slate-600\">\n                  No tool runs recorded yet.\n                </td>\n              </tr>\n            ) : null}\n          </tbody>\n        </table>\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Link href=\"/admin/billing\" className=\"text-sm font-semibold text-emerald-700 hover:underline\">\n          Back to billing overview\n        </Link>\n        {next ? (\n          <Link\n            href={`/admin/billing/usage?user=${encodeURIComponent(user)}&toolId=${encodeURIComponent(toolId)}&status=${encodeURIComponent(status)}&from=${encodeURIComponent(\n              from\n            )}&to=${encodeURIComponent(to)}&cursor=${encodeURIComponent(next.id)}`}\n            className=\"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400\"\n          >\n            Next page\n          </Link>\n        ) : (\n          <span className=\"text-xs text-slate-500\">End</span>\n        )}\n      </div>\n    </main>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}}]
}