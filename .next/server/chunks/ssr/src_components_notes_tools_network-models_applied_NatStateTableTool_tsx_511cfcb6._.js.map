{
  "version": 3,
  "sources": [],
  "debugId": "fde0037c-70d9-feb0-ef22-ae14012923b5",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/components/notes/tools/network-models/applied/NatStateTableTool.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\n\ntype Mapping = {\n  id: string;\n  createdAt: number;\n  internalIp: string;\n  internalPort: number;\n  externalIp: string;\n  externalPort: number;\n  remoteIp: string;\n  remotePort: number;\n  protocol: \"TCP\" | \"UDP\";\n  ttlSeconds: number;\n};\n\nfunction randPort(min = 20000, max = 65000) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport default function NatStateTableTool() {\n  const [internalIp, setInternalIp] = useState(\"192.168.1.10\");\n  const [externalIp, setExternalIp] = useState(\"203.0.113.5\");\n  const [remoteIp, setRemoteIp] = useState(\"93.184.216.34\");\n  const [remotePortRaw, setRemotePortRaw] = useState(\"443\");\n  const [protocol, setProtocol] = useState<\"TCP\" | \"UDP\">(\"TCP\");\n  const [mappings, setMappings] = useState<Mapping[]>([]);\n\n  const remotePort = useMemo(() => {\n    const p = Math.floor(Number(remotePortRaw) || 443);\n    return Math.max(1, Math.min(65535, p));\n  }, [remotePortRaw]);\n\n  const rows = useMemo(() => {\n    const t = nowSeconds();\n    return mappings\n      .map((m) => {\n        const age = t - m.createdAt;\n        const remaining = Math.max(0, m.ttlSeconds - age);\n        return { ...m, remaining };\n      })\n      .filter((m) => m.remaining > 0)\n      .sort((a, b) => b.createdAt - a.createdAt);\n  }, [mappings]);\n\n  function addFlow() {\n    const entry: Mapping = {\n      id: `m-${Math.random().toString(16).slice(2)}`,\n      createdAt: nowSeconds(),\n      internalIp: internalIp.trim() || \"192.168.1.10\",\n      internalPort: randPort(40000, 65000),\n      externalIp: externalIp.trim() || \"203.0.113.5\",\n      externalPort: randPort(20000, 65000),\n      remoteIp: remoteIp.trim() || \"93.184.216.34\",\n      remotePort,\n      protocol,\n      ttlSeconds: protocol === \"UDP\" ? 30 : 120,\n    };\n    setMappings((prev) => [entry, ...prev].slice(0, 24));\n  }\n\n  function sweepExpired() {\n    const t = nowSeconds();\n    setMappings((prev) => prev.filter((m) => t - m.createdAt < m.ttlSeconds));\n  }\n\n  function reset() {\n    setMappings([]);\n  }\n\n  return (\n    <div className=\"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900/60\">\n      <div className=\"grid gap-3 sm:grid-cols-3\">\n        <div>\n          <label className=\"text-sm font-semibold text-slate-900 dark:text-slate-100\">Internal host</label>\n          <input\n            value={internalIp}\n            onChange={(e) => setInternalIp(e.target.value)}\n            className=\"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none focus:border-sky-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100\"\n            placeholder=\"192.168.1.10\"\n          />\n        </div>\n        <div>\n          <label className=\"text-sm font-semibold text-slate-900 dark:text-slate-100\">External public IP</label>\n          <input\n            value={externalIp}\n            onChange={(e) => setExternalIp(e.target.value)}\n            className=\"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none focus:border-sky-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100\"\n            placeholder=\"203.0.113.5\"\n          />\n        </div>\n        <div>\n          <label className=\"text-sm font-semibold text-slate-900 dark:text-slate-100\">Remote destination</label>\n          <div className=\"mt-1 grid grid-cols-3 gap-2\">\n            <input\n              value={remoteIp}\n              onChange={(e) => setRemoteIp(e.target.value)}\n              className=\"col-span-2 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none focus:border-sky-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100\"\n              placeholder=\"93.184.216.34\"\n            />\n            <input\n              value={remotePortRaw}\n              onChange={(e) => setRemotePortRaw(e.target.value)}\n              inputMode=\"numeric\"\n              className=\"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none focus:border-sky-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100\"\n              placeholder=\"443\"\n              aria-label=\"Remote port\"\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"mt-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <label className=\"text-sm font-semibold text-slate-900 dark:text-slate-100\">Protocol</label>\n          <select\n            value={protocol}\n            onChange={(e) => setProtocol(e.target.value as any)}\n            className=\"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none focus:border-sky-400 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100\"\n          >\n            <option value=\"TCP\">TCP</option>\n            <option value=\"UDP\">UDP</option>\n          </select>\n        </div>\n        <div className=\"flex flex-wrap gap-2\">\n          <button\n            type=\"button\"\n            onClick={addFlow}\n            className=\"rounded-full bg-slate-900 px-3 py-1.5 text-sm font-semibold text-white hover:bg-slate-800\"\n          >\n            Add outbound flow\n          </button>\n          <button\n            type=\"button\"\n            onClick={sweepExpired}\n            className=\"rounded-full border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-900 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:hover:bg-slate-900/40\"\n          >\n            Sweep expired\n          </button>\n          <button\n            type=\"button\"\n            onClick={reset}\n            className=\"rounded-full border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-900 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:hover:bg-slate-900/40\"\n          >\n            Reset\n          </button>\n        </div>\n      </div>\n\n      <div className=\"mt-4 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden\">\n        <table className=\"w-full text-left text-sm\">\n          <thead className=\"bg-slate-50 text-xs uppercase tracking-wide text-slate-600 dark:bg-slate-950/40 dark:text-slate-300\">\n            <tr>\n              <th className=\"px-3 py-2\">Internal</th>\n              <th className=\"px-3 py-2\">NAT public</th>\n              <th className=\"px-3 py-2\">Remote</th>\n              <th className=\"px-3 py-2\">Proto</th>\n              <th className=\"px-3 py-2\">TTL left</th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-slate-200 dark:divide-slate-800\">\n            {rows.map((m) => (\n              <tr key={m.id} className=\"bg-white dark:bg-transparent\">\n                <td className=\"px-3 py-2 font-mono text-slate-900 dark:text-slate-100\">\n                  {m.internalIp}:{m.internalPort}\n                </td>\n                <td className=\"px-3 py-2 font-mono text-slate-900 dark:text-slate-100\">\n                  {m.externalIp}:{m.externalPort}\n                </td>\n                <td className=\"px-3 py-2 font-mono text-slate-700 dark:text-slate-200\">\n                  {m.remoteIp}:{m.remotePort}\n                </td>\n                <td className=\"px-3 py-2 font-semibold text-slate-900 dark:text-slate-100\">{m.protocol}</td>\n                <td className=\"px-3 py-2 text-slate-700 dark:text-slate-200\">{m.remaining}s</td>\n              </tr>\n            ))}\n            {rows.length === 0 ? (\n              <tr>\n                <td className=\"px-3 py-4 text-slate-600 dark:text-slate-300\" colSpan={5}>\n                  No active mappings. Add an outbound flow to see how a mapping is created.\n                </td>\n              </tr>\n            ) : null}\n          </tbody>\n        </table>\n      </div>\n\n      <div className=\"mt-4 text-sm text-slate-700 dark:text-slate-200\">\n        <p className=\"m-0\">\n          NAT often feels like magic until you treat it as a state table. If the state expires or the mapping changes,\n          long lived sessions can break.\n        </p>\n        <p className=\"mt-2 m-0 text-slate-600 dark:text-slate-300\">\n          NAT is not a firewall. Many devices bundle NAT with stateful filtering, which is why people confuse them.\n        </p>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}