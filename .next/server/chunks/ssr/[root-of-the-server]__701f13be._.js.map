{
  "version": 3,
  "sources": [],
  "debugId": "d54521b8-dcf9-624c-b852-6f2642506399",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/lib/admin/supportStore.ts","../../../../src/app/admin/support/%5Bid%5D/ui.client.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/admin/support/%5Bid%5D/page.tsx"],"sourcesContent":["import { prisma } from \"@/lib/db/prisma\";\n\nexport type SupportStatus = \"open\" | \"in_progress\" | \"resolved\";\n\nexport type SupportTicketListItem = {\n  id: string;\n  userId: string | null;\n  name: string | null;\n  email: string | null;\n  category: string;\n  status: SupportStatus;\n  createdAt: string;\n  updatedAt: string;\n};\n\nfunction toIso(d: any) {\n  try {\n    return new Date(d).toISOString();\n  } catch {\n    return new Date(0).toISOString();\n  }\n}\n\nexport async function listSupportTicketsAdminSafe(opts: {\n  status?: SupportStatus | null;\n  category?: string | null;\n  take: number;\n  cursor?: string | null;\n  sort: \"newest\" | \"oldest\";\n}) {\n  const take = Math.max(1, Math.min(50, opts.take));\n  const where: any = {};\n  if (opts.status) where.status = opts.status;\n  if (opts.category) where.category = String(opts.category);\n\n  const orderBy = opts.sort === \"oldest\" ? { createdAt: \"asc\" as const } : { createdAt: \"desc\" as const };\n\n  const rows = await (prisma as any).supportTicket.findMany({\n    where,\n    take: take + 1,\n    ...(opts.cursor ? { cursor: { id: opts.cursor }, skip: 1 } : {}),\n    orderBy,\n    select: {\n      id: true,\n      userId: true,\n      name: true,\n      email: true,\n      category: true,\n      status: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  const next = rows.length > take ? rows[take] : null;\n  const slice = rows.slice(0, take);\n  return {\n    items: slice.map((r: any) => ({\n      id: String(r.id),\n      userId: r.userId ? String(r.userId) : null,\n      name: r.name ? String(r.name) : null,\n      email: r.email ? String(r.email) : null,\n      category: String(r.category || \"\"),\n      status: r.status as SupportStatus,\n      createdAt: toIso(r.createdAt),\n      updatedAt: toIso(r.updatedAt),\n    })) satisfies SupportTicketListItem[],\n    nextCursor: next ? String(next.id) : null,\n  };\n}\n\nexport async function getSupportTicketAdminSafe(id: string) {\n  const row = await (prisma as any).supportTicket.findUnique({\n    where: { id },\n    select: {\n      id: true,\n      userId: true,\n      name: true,\n      email: true,\n      category: true,\n      message: true,\n      status: true,\n      createdAt: true,\n      updatedAt: true,\n      attachments: { select: { id: true, fileName: true, mimeType: true, sizeBytes: true, storageKey: true, createdAt: true } },\n      notes: { select: { id: true, adminUserId: true, note: true, createdAt: true }, orderBy: { createdAt: \"desc\" as const } },\n    },\n  });\n  if (!row) return null;\n  return {\n    id: String(row.id),\n    userId: row.userId ? String(row.userId) : null,\n    name: row.name ? String(row.name) : null,\n    email: row.email ? String(row.email) : null,\n    category: String(row.category || \"\"),\n    message: String(row.message || \"\"),\n    status: row.status as SupportStatus,\n    createdAt: toIso(row.createdAt),\n    updatedAt: toIso(row.updatedAt),\n    attachments: (row.attachments || []).map((a: any) => ({\n      id: String(a.id),\n      fileName: String(a.fileName),\n      mimeType: String(a.mimeType),\n      sizeBytes: Number(a.sizeBytes),\n      storageKey: a.storageKey ? String(a.storageKey) : null,\n      createdAt: toIso(a.createdAt),\n    })),\n    notes: (row.notes || []).map((n: any) => ({ id: String(n.id), adminUserId: String(n.adminUserId), note: String(n.note), createdAt: toIso(n.createdAt) })),\n  };\n}\n\nexport async function setSupportTicketStatus(id: string, status: SupportStatus) {\n  await (prisma as any).supportTicket.update({ where: { id }, data: { status } });\n}\n\nexport async function addSupportTicketNote(id: string, adminUserId: string, note: string) {\n  await (prisma as any).supportTicketNote.create({ data: { ticketId: id, adminUserId, note } });\n}\n\n\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/support/[id]/ui.client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/support/[id]/ui.client.tsx\",\n    \"default\",\n);\n","import AdminSupportTicketClient from \"./ui.client\";\nimport { getSupportTicketAdminSafe } from \"@/lib/admin/supportStore\";\n\nexport const metadata = {\n  title: \"Admin: Support ticket\",\n  robots: { index: false, follow: false },\n};\n\nexport default async function AdminSupportTicketPage({ params }: { params: Promise<{ id: string }> }) {\n  const { id } = await params;\n  const ticket = await getSupportTicketAdminSafe(id);\n  if (!ticket) {\n    return (\n      <main className=\"mx-auto max-w-4xl px-4 py-10 md:px-6 lg:px-8 space-y-3\">\n        <h1 className=\"text-2xl font-semibold text-slate-900\">Ticket not found</h1>\n        <p className=\"text-slate-700\">This ticket does not exist or is not accessible.</p>\n      </main>\n    );\n  }\n  return <AdminSupportTicketClient ticket={ticket} />;\n}\n\n\n"],"names":[],"mappings":"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","ignoreList":[1]}}]
}