;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="19b3c028-7718-b8e7-1f12-f63ea08d5493")}catch(e){}}();
module.exports=[589448,a=>{"use strict";var b=a.i(218282),c=a.i(572131),d=a.i(238246);function e(a){try{return new Date(a).toLocaleString()}catch{return a}}async function f(a,b){let c=await fetch(a,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(b)}),d=await c.json().catch(()=>({}));if(!c.ok)throw Error(d?.error||d?.message||"Request failed");return d}function g({ticket:a}){let[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(a.status),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),u=(0,c.useMemo)(()=>["open","in_progress","resolved"],[]),v=async()=>{r(null),t(null);let b=k.trim();if(!b)return r("Reason is required.");if(confirm("Confirm status change")){h("status");try{await f(`/api/admin/support/${encodeURIComponent(a.id)}/status`,{status:i,reason:b}),t("Status updated. Refresh the page to see updated timestamps."),l("")}catch(a){r(a.message||"Failed to update status.")}finally{h(null)}}},w=async()=>{r(null),t(null);let b=o.trim(),c=m.trim();if(!c)return r("Note is required.");if(!b)return r("Reason is required.");if(confirm("Confirm add note")){h("note");try{await f(`/api/admin/support/${encodeURIComponent(a.id)}/note`,{note:c,reason:b}),t("Note added. Refresh the page to see it."),n(""),p("")}catch(a){r(a.message||"Failed to add note.")}finally{h(null)}}};return(0,b.jsxs)("main",{className:"mx-auto max-w-4xl px-4 py-10 md:px-6 lg:px-8 space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"Support"}),(0,b.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:a.category}),(0,b.jsxs)("p",{className:"text-xs text-slate-600 font-mono",children:["Ticket ID: ",a.id]})]}),(0,b.jsx)(d.default,{href:"/admin/support",className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400",children:"Back to support"})]}),q?(0,b.jsx)("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-900",children:q}):null,s?(0,b.jsx)("div",{className:"rounded-2xl border border-emerald-200 bg-emerald-50 p-4 text-sm text-emerald-900",children:s}):null,(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Ticket"}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"From"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-900",children:a.email||"Unknown"}),(0,b.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:a.name||"No name provided"}),(0,b.jsxs)("p",{className:"mt-1 text-xs text-slate-600",children:["User ID: ",a.userId||"Anonymous"]})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Timeline"}),(0,b.jsxs)("p",{className:"mt-1 text-xs text-slate-600",children:["Created: ",e(a.createdAt)]}),(0,b.jsxs)("p",{className:"mt-1 text-xs text-slate-600",children:["Updated: ",e(a.updatedAt)]}),(0,b.jsxs)("p",{className:"mt-2 text-sm font-semibold text-slate-900",children:["Status: ",a.status]})]})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Message"}),(0,b.jsx)("p",{className:"mt-2 whitespace-pre-wrap text-sm text-slate-800",children:a.message})]})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Attachments"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Attachments are treated as untrusted content. This UI does not render them inline. Use download only."}),(0,b.jsx)("div",{className:"space-y-2",children:a.attachments.length?a.attachments.map(c=>(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4 flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:c.fileName}),(0,b.jsxs)("p",{className:"text-xs text-slate-600",children:[c.mimeType," · ",Math.round(c.sizeBytes/1024)," KB · ",e(c.createdAt)]})]}),(0,b.jsx)("a",{href:`/api/admin/support/${encodeURIComponent(a.id)}/attachments/${encodeURIComponent(c.id)}`,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400",children:"Download"})]},c.id)):(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"No attachments."})})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Status"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("label",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"New status"}),(0,b.jsx)("select",{value:i,onChange:a=>j(a.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",children:u.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsxs)("label",{className:"space-y-1 md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Reason"}),(0,b.jsx)("input",{value:k,onChange:a=>l(a.target.value),placeholder:"Required",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900"})]})]}),(0,b.jsx)("button",{type:"button",className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:bg-slate-300",disabled:null!==g,onClick:v,children:"status"===g?"Updating...":"Change status"})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Admin notes"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Notes are internal only. Adding a note requires a reason and is audited."}),(0,b.jsx)("div",{className:"space-y-2",children:a.notes.length?a.notes.map(a=>(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsxs)("p",{className:"text-xs font-semibold text-slate-700",children:["Admin user: ",a.adminUserId]}),(0,b.jsx)("p",{className:"mt-2 text-sm text-slate-800 whitespace-pre-wrap",children:a.note}),(0,b.jsx)("p",{className:"mt-2 text-xs text-slate-600",children:e(a.createdAt)})]},a.id)):(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"No notes."})}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsxs)("label",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Note"}),(0,b.jsx)("textarea",{value:m,onChange:a=>n(a.target.value),rows:4,className:"w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm text-slate-900"})]}),(0,b.jsxs)("label",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Reason"}),(0,b.jsx)("input",{value:o,onChange:a=>p(a.target.value),placeholder:"Required",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900"})]})]}),(0,b.jsx)("button",{type:"button",className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:bg-slate-300",disabled:null!==g,onClick:w,children:"note"===g?"Saving...":"Add note"})]})]})}a.s(["default",()=>g])}];

//# debugId=19b3c028-7718-b8e7-1f12-f63ea08d5493
//# sourceMappingURL=src_app_admin_support_%5Bid%5D_ui_client_tsx_0456d04a._.js.map