;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="af0d2c9a-0311-9569-ba5c-d5cc8a29a98d")}catch(e){}}();
module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},250852,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},540175,(a,b,c)=>{"use strict";b.exports=a.r(501951).vendored.contexts.HeadManagerContext},442939,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},475974,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return f}});let d=a.r(127669),e=()=>{};function f(a){let{headManager:b,reduceComponentsToState:c}=a;function f(){if(b&&b.mountedInstances){let a=d.Children.toArray(Array.from(b.mountedInstances).filter(Boolean));b.updateHead(c(a))}}return b?.mountedInstances?.add(a.children),f(),e(()=>(b?.mountedInstances?.add(a.children),()=>{b?.mountedInstances?.delete(a.children)})),e(()=>(b&&(b._pendingUpdate=f),()=>{b&&(b._pendingUpdate=f)})),null}},111276,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return p},defaultHead:function(){return l}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(404550),g=a.r(250852),h=a.r(508171),i=g._(a.r(127669)),j=f._(a.r(475974)),k=a.r(540175);function l(){return[(0,h.jsx)("meta",{charSet:"utf-8"},"charset"),(0,h.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")]}function m(a,b){return"string"==typeof b||"number"==typeof b?a:b.type===i.default.Fragment?a.concat(i.default.Children.toArray(b.props.children).reduce((a,b)=>"string"==typeof b||"number"==typeof b?a:a.concat(b),[])):a.concat(b)}a.r(442939);let n=["name","httpEquiv","charSet","itemProp"];function o(a){let b,c,d,e;return a.reduce(m,[]).reverse().concat(l().reverse()).filter((b=new Set,c=new Set,d=new Set,e={},a=>{let f=!0,g=!1;if(a.key&&"number"!=typeof a.key&&a.key.indexOf("$")>0){g=!0;let c=a.key.slice(a.key.indexOf("$")+1);b.has(c)?f=!1:b.add(c)}switch(a.type){case"title":case"base":c.has(a.type)?f=!1:c.add(a.type);break;case"meta":for(let b=0,c=n.length;b<c;b++){let c=n[b];if(a.props.hasOwnProperty(c))if("charSet"===c)d.has(c)?f=!1:d.add(c);else{let b=a.props[c],d=e[c]||new Set;("name"!==c||!g)&&d.has(b)?f=!1:(d.add(b),e[c]=d)}}}return f})).reverse().map((a,b)=>{let c=a.key||b;return i.default.cloneElement(a,{key:c})})}let p=function({children:a}){let b=(0,i.useContext)(k.HeadManagerContext);return(0,h.jsx)(j.default,{reduceComponentsToState:o,headManager:b,children:a})};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},119059,(a,b,c)=>{b.exports=a.r(111276)},666680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},902157,(a,b,c)=>{b.exports=a.x("node:fs",()=>require("node:fs"))},750227,(a,b,c)=>{b.exports=a.x("node:path",()=>require("node:path"))},353440,a=>{"use strict";var b=a.i(902157),c=a.i(750227),d=a.i(666680);let e=process.env.CERTIFICATES_STORE_PATH||"data/certificates.json",f={certificates:[]};function g(a,d){try{let e=c.default.isAbsolute(a)?a:c.default.join(process.cwd(),a);if(!b.default.existsSync(e))return d;return JSON.parse(b.default.readFileSync(e,"utf8"))}catch{return d}}function h(a,d){let e,f=c.default.isAbsolute(a)?a:c.default.join(process.cwd(),a);e=c.default.dirname(f),b.default.existsSync(e)||b.default.mkdirSync(e,{recursive:!0});let g=`${f}.tmp`;b.default.writeFileSync(g,JSON.stringify(d,null,2),"utf8"),b.default.renameSync(g,f)}function i(a){let{userId:b,courseId:c,levelId:i,courseTitle:j,hoursEarned:k,completionDate:l,learnerName:m}=a,n=g(e,f),o=`${b}:${c}:${i}`,p=(n.certificates||[]).find(a=>`${a.userId}:${a.courseId}:${a.levelId}`===o);if(p)return p;let q={certificateId:d.default.randomUUID(),userId:b,courseId:c,levelId:i,courseTitle:j,hoursEarned:k,completionDate:l,issuedAt:new Date().toISOString(),version:1,learnerName:m||"",revokedAt:null};return n.certificates.push(q),h(e,n),q}function j(a){return(g(e,f).certificates||[]).find(b=>b.certificateId===a)||null}function k(a,b=""){let c=g(e,f),d=(c.certificates||[]).findIndex(b=>b.certificateId===a);return d<0?null:(c.certificates[d].revokedAt||(c.certificates[d]={...c.certificates[d],revokedAt:new Date().toISOString(),revokedReason:b||void 0},h(e,c)),c.certificates[d])}a.s(["getCertificateById",()=>j,"issueCertificate",()=>i,"revokeCertificate",()=>k])},730464,a=>{"use strict";let b=a.r(353440);b.issueCertificate;let c=b.getCertificateById;b.revokeCertificate,a.s(["getCertificateById",0,c])},987346,160055,a=>{"use strict";function b(a){return"number"==typeof a&&Number.isFinite(a)?a:null}function c(a){let c=b(a);return null==c?null:Math.max(0,Math.round(c))}function d(a){let b=c(a);if(null==b)return null;let d=Math.max(0,Math.round(b/1e3));if(d<60)return`${d}s`;let e=Math.floor(d/60);return`${e}m ${d%60}s`}function e(a){let c=b(a);return null==c?null:String(Math.max(0,Math.round(c)))}a.s(["formatCreditsSafe",()=>e,"formatMsSafe",()=>d,"msOrNull",()=>c,"numberOrNull",()=>b],160055),a.s([],987346)},843539,a=>{"use strict";var b=a.i(508171),c=a.i(127669);a.i(987346);var d=a.i(160055);function e({estimatedCredits:a,currentBalance:e,onAccept:f,onDecline:g,disabled:h=!1,safetyBuffer:i=1.25}){let[j,k]=(0,c.useState)(!1),l=Math.ceil(a*i),m=null!==e&&e>=l;return((0,c.useEffect)(()=>{k(!1)},[a]),a<=0)?null:null===e?(0,b.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4",children:(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Loading credit balance..."})}):(0,b.jsx)("div",{className:"rounded-xl border border-amber-200 bg-amber-50/50 p-4",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"Credit Cost Estimate"}),(0,b.jsx)("span",{className:"text-xs font-semibold text-amber-700 bg-amber-100 px-2 py-0.5 rounded",children:"ESTIMATE"})]}),(0,b.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[(0,b.jsxs)("div",{className:"flex items-baseline justify-between",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-slate-700",children:"Estimated credits:"}),(0,b.jsx)("span",{className:"text-lg font-bold text-slate-900",children:(0,d.formatCreditsSafe)(a)})]}),(0,b.jsxs)("div",{className:"mt-1 flex items-baseline justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-slate-600",children:"Required (with safety buffer):"}),(0,b.jsx)("span",{className:"font-semibold text-slate-700",children:(0,d.formatCreditsSafe)(l)})]}),(0,b.jsxs)("div",{className:"mt-1 flex items-baseline justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-slate-600",children:"Current balance:"}),(0,b.jsx)("span",{className:`font-semibold ${m?"text-slate-900":"text-rose-600"}`,children:(0,d.formatCreditsSafe)(e)})]})]}),(0,b.jsx)("div",{className:"rounded-lg border border-amber-300 bg-amber-100/50 p-3",children:(0,b.jsxs)("p",{className:"text-xs font-medium text-amber-900",children:["⚠️ ",(0,b.jsx)("strong",{children:"This is an ESTIMATE."})," Actual cost may be higher or lower depending on actual execution time, complexity, and system load."]})}),!m&&(0,b.jsxs)("div",{className:"rounded-lg border border-rose-300 bg-rose-50 p-3",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-rose-900",children:"Insufficient Credits"}),(0,b.jsxs)("p",{className:"mt-1 text-xs text-rose-800",children:["You need at least ",(0,d.formatCreditsSafe)(l)," credits to proceed. Current balance: ",(0,d.formatCreditsSafe)(e),"."]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"credit-consent",checked:j,onChange:a=>{a.target.checked&&m?(k(!0),f?.()):k(!1)},disabled:!m||h,className:"mt-0.5 h-4 w-4 rounded border-slate-300 text-amber-600 focus:ring-amber-500 disabled:opacity-50 disabled:cursor-not-allowed"}),(0,b.jsxs)("label",{htmlFor:"credit-consent",className:"text-xs text-slate-700",children:[(0,b.jsx)("span",{className:"font-medium",children:"I accept that this operation will consume credits."}),(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-slate-600",children:"I understand this is an estimate and actual cost may vary. I have sufficient credits to proceed."})]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:j&&m?(0,b.jsx)("button",{type:"button",onClick:()=>{k(!1),g?.()},className:"text-xs text-slate-600 underline hover:text-slate-900",children:"Revoke acceptance"}):(0,b.jsx)("button",{type:"button",onClick:()=>{m&&(k(!0),f?.())},disabled:!m||h,className:"rounded-lg bg-amber-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Accept and Continue"})})]})})}function f(a,b,d=1.25){let[e,g]=(0,c.useState)(!1),h=Math.ceil(a*d),i=null!==b&&b>=h,j=!(a>0)||e&&i;return(0,c.useEffect)(()=>{a<=0&&g(!0)},[a]),{accepted:e,setAccepted:g,canProceed:j,hasEnoughCredits:i,requiredCredits:h,needsConsent:a>0}}a.s(["default",()=>e,"useCreditConsent",()=>f])},402093,(a,b,c)=>{b.exports=a.x("styled-jsx/style.js",()=>require("styled-jsx/style.js"))},151389,a=>{"use strict";var b=a.i(508171),c=a.i(402093),d=a.i(119059),e=a.i(730464),f=a.i(127669),g=a.i(483074),h=a.i(843539);function i({certificateId:a}){let{data:c}=(0,g.useSession)(),[d,e]=(0,f.useState)(null),[i,j]=(0,f.useState)(!1),[k,l]=(0,f.useState)(null),{accepted:m,canProceed:n}=(0,h.useCreditConsent)(5,d);(0,f.useEffect)(()=>{c?.user?.id&&fetch("/api/credits/status").then(a=>a.ok?a.json():null).then(a=>{e("number"==typeof a?.balance?a.balance:0)}).catch(()=>e(0))},[c?.user?.id]);let o=async()=>{if(!n)return void l("Please accept the credit estimate and ensure sufficient credits.");j(!0),l(null);try{let b=await fetch(`/api/certificates/${encodeURIComponent(a)}/pdf`);if(!b.ok){let a=await b.json().catch(()=>({}));l(a?.message||"Failed to download certificate PDF");return}let c=await b.blob(),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`${a}.pdf`,document.body.appendChild(e),e.click(),e.remove(),window.URL.revokeObjectURL(d)}catch(a){l(a instanceof Error?a.message:"Failed to download certificate")}finally{j(!1)}};return c?.user?.id?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(h.default,{estimatedCredits:5,currentBalance:d,onAccept:()=>{}}),(0,b.jsx)("button",{type:"button",onClick:o,disabled:!n||i,className:"button",children:i?"Downloading...":"Download PDF"}),k&&(0,b.jsx)("p",{className:"text-sm text-rose-600",children:k})]}):(0,b.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4",children:(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Sign in to download your certificate PDF."})})}function j({found:a,certificate:e}){return a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.default,{children:(0,b.jsxs)("title",{children:["Certificate | ",e?.courseTitle]})}),(0,b.jsxs)("main",{className:"jsx-213b8ccfeb18bc40 certificate-shell",children:[(0,b.jsxs)("section",{className:"jsx-213b8ccfeb18bc40 certificate",children:[(0,b.jsxs)("header",{className:"jsx-213b8ccfeb18bc40 certificate__header",children:[(0,b.jsxs)("div",{className:"jsx-213b8ccfeb18bc40",children:[(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 eyebrow",children:"Ransford's Notes"}),(0,b.jsx)("h1",{className:"jsx-213b8ccfeb18bc40",children:"Certificate of Completion"}),(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 muted",children:"Professional learning record"})]}),(0,b.jsxs)("div",{className:"jsx-213b8ccfeb18bc40 certificate__meta",children:[(0,b.jsxs)("p",{className:"jsx-213b8ccfeb18bc40",children:[(0,b.jsx)("strong",{className:"jsx-213b8ccfeb18bc40",children:"Certificate ID:"})," ",e?.certificateId]}),(0,b.jsxs)("p",{className:"jsx-213b8ccfeb18bc40",children:[(0,b.jsx)("strong",{className:"jsx-213b8ccfeb18bc40",children:"Status:"})," ",e?.status==="revoked"?"Revoked":"Valid"]})]})]}),(0,b.jsxs)("div",{className:"jsx-213b8ccfeb18bc40 certificate__body",children:[(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 muted",children:"This is to certify that"}),(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 certificate__name",children:e?.learnerName||"Learner"}),(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 muted",children:"has completed"}),(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 certificate__course",children:e?.courseTitle}),(0,b.jsxs)("div",{className:"jsx-213b8ccfeb18bc40 certificate__stats",children:[(0,b.jsxs)("p",{className:"jsx-213b8ccfeb18bc40",children:[(0,b.jsx)("strong",{className:"jsx-213b8ccfeb18bc40",children:"CPD hours:"})," ",e?.hoursEarned]}),(0,b.jsxs)("p",{className:"jsx-213b8ccfeb18bc40",children:[(0,b.jsx)("strong",{className:"jsx-213b8ccfeb18bc40",children:"Completion date:"})," ",new Date(e?.completionDate||"").toLocaleDateString()]}),(0,b.jsxs)("p",{className:"jsx-213b8ccfeb18bc40",children:[(0,b.jsx)("strong",{className:"jsx-213b8ccfeb18bc40",children:"Issued:"})," ",new Date(e?.issuedAt||"").toLocaleDateString()]})]})]}),(0,b.jsxs)("footer",{className:"jsx-213b8ccfeb18bc40 certificate__footer",children:[(0,b.jsxs)("p",{className:"jsx-213b8ccfeb18bc40 muted",children:["Issued by ",e?.provider,". CPD hours are based on server verified completion signals and course estimated time. For verification, visit the public verification page and enter the certificate ID."]}),e?.status==="revoked"?(0,b.jsx)("p",{className:"jsx-213b8ccfeb18bc40 muted",children:"Status: revoked. This certificate is no longer valid."}):null,(0,b.jsxs)("div",{className:"jsx-213b8ccfeb18bc40 space-y-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>window.print(),className:"jsx-213b8ccfeb18bc40 button",children:"Print / Save as PDF"}),(0,b.jsx)(i,{certificateId:e?.certificateId||""})]})]})]}),(0,b.jsx)(c.default,{id:"213b8ccfeb18bc40",children:".certificate-shell.jsx-213b8ccfeb18bc40{background:#f8fafc;min-height:100vh;padding:24px}.certificate.jsx-213b8ccfeb18bc40{color:#0f172a;background:#fff;border:1px solid #e2e8f0;border-radius:16px;max-width:900px;margin:0 auto;padding:32px}.certificate__header.jsx-213b8ccfeb18bc40{justify-content:space-between;gap:16px;display:flex}.certificate__meta.jsx-213b8ccfeb18bc40{text-align:right;color:#475569;font-size:14px}.certificate__body.jsx-213b8ccfeb18bc40{text-align:center;margin-top:24px}.certificate__name.jsx-213b8ccfeb18bc40{margin:8px 0;font-size:28px;font-weight:700}.certificate__course.jsx-213b8ccfeb18bc40{margin:8px 0 16px;font-size:22px;font-weight:600}.certificate__stats.jsx-213b8ccfeb18bc40{color:#334155;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:16px;font-size:14px;display:grid}.certificate__footer.jsx-213b8ccfeb18bc40{color:#475569;flex-direction:column;gap:8px;margin-top:24px;font-size:13px;display:flex}@media print{.button.jsx-213b8ccfeb18bc40{display:none}.certificate-shell.jsx-213b8ccfeb18bc40{background:#fff;padding:0}.certificate.jsx-213b8ccfeb18bc40{box-shadow:none;border:none}}"})]})]}):(0,b.jsx)("main",{className:"page",children:(0,b.jsxs)("header",{className:"page-header",children:[(0,b.jsx)("p",{className:"eyebrow",children:"Certificate"}),(0,b.jsx)("h1",{children:"Certificate not found"}),(0,b.jsx)("p",{className:"lead",children:"The requested certificate could not be located."})]})})}let k=async a=>{let b=String(a.params?.certificateId||"").trim();if(!b)return{props:{found:!1}};let c=(0,e.getCertificateById)(b);return c?{props:{found:!0,certificate:{certificateId:c.certificateId,learnerName:c.learnerName||"Learner",courseTitle:c.courseTitle,hoursEarned:c.hoursEarned,completionDate:c.completionDate,issuedAt:c.issuedAt,status:c.revokedAt?"revoked":"valid",provider:"Ransford's Notes"}}}:{props:{found:!1}}};a.s(["default",()=>j,"getServerSideProps",0,k],151389)},760768,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(167684),h=a.i(276695),i=a.i(151389),j=a.i(509193),k=b([h]);[h]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/certificates/[certificateId]",pathname:"/certificates/[certificateId]",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/certificates/[certificateId]",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# debugId=af0d2c9a-0311-9569-ba5c-d5cc8a29a98d
//# sourceMappingURL=%5Broot-of-the-server%5D__a337e384._.js.map