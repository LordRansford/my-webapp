{
  "version": 3,
  "sources": [],
  "debugId": "09cf4241-b886-88f4-b1e0-17740f1f3170",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/lib/games/framework/InputLayer.ts","../../../../src/lib/games/framework/useReducedMotion.ts"],"sourcesContent":["/**\n * Input Layer - Unified keyboard and touch input handling\n * \n * Provides:\n * - Keyboard mapping for desktop\n * - Touch gestures and on-screen controls for mobile\n * - Consistent pause/resume/quit behavior\n * - Event normalization\n */\n\nexport type InputEvent = {\n  type: \"keyboard\" | \"touch\" | \"mouse\";\n  action: string;\n  timestamp: number;\n  data?: unknown;\n};\n\nexport type InputHandler = (event: InputEvent) => void;\n\nexport class InputLayer {\n  private handlers: Map<string, InputHandler[]> = new Map();\n  private isEnabled: boolean = true;\n  private touchStartPos: { x: number; y: number } | null = null;\n  private readonly SWIPE_THRESHOLD = 50; // pixels\n  private keyboardHandler: ((e: KeyboardEvent) => void) | null = null;\n  private touchStartHandler: ((e: TouchEvent) => void) | null = null;\n  private touchEndHandler: ((e: TouchEvent) => void) | null = null;\n\n  constructor() {\n    // Don't set up listeners in constructor - let components do it via setup methods\n  }\n\n  /**\n   * Register handler for specific action\n   */\n  on(action: string, handler: InputHandler): () => void {\n    if (!this.handlers.has(action)) {\n      this.handlers.set(action, []);\n    }\n    this.handlers.get(action)!.push(handler);\n\n    // Return unsubscribe function\n    return () => {\n      const handlers = this.handlers.get(action);\n      if (handlers) {\n        const index = handlers.indexOf(handler);\n        if (index > -1) {\n          handlers.splice(index, 1);\n        }\n      }\n    };\n  }\n\n  /**\n   * Enable/disable input\n   */\n  setEnabled(enabled: boolean): void {\n    this.isEnabled = enabled;\n  }\n\n  /**\n   * Setup keyboard listeners (call from component useEffect)\n   */\n  setupKeyboardListeners(): () => void {\n    if (typeof window === \"undefined\") return () => {};\n\n    this.keyboardHandler = (e: KeyboardEvent) => {\n      if (!this.isEnabled) return;\n\n      const action = this.mapKeyToAction(e.key, e);\n      if (action) {\n        this.emit(action, {\n          type: \"keyboard\",\n          action,\n          timestamp: Date.now(),\n          data: { key: e.key, code: e.code, modifiers: this.getModifiers(e) },\n        });\n      }\n    };\n\n    window.addEventListener(\"keydown\", this.keyboardHandler);\n    return () => {\n      if (this.keyboardHandler) {\n        window.removeEventListener(\"keydown\", this.keyboardHandler);\n        this.keyboardHandler = null;\n      }\n    };\n  }\n\n  /**\n   * Setup touch listeners (call from component useEffect)\n   */\n  setupTouchListeners(): () => void {\n    if (typeof window === \"undefined\") return () => {};\n\n    this.touchStartHandler = (e: TouchEvent) => {\n      if (!this.isEnabled) return;\n      const touch = e.touches[0];\n      if (touch) {\n        this.touchStartPos = { x: touch.clientX, y: touch.clientY };\n      }\n    };\n\n    this.touchEndHandler = (e: TouchEvent) => {\n      if (!this.isEnabled || !this.touchStartPos) return;\n\n      const touch = e.changedTouches[0];\n      if (!touch) return;\n\n      const deltaX = touch.clientX - this.touchStartPos.x;\n      const deltaY = touch.clientY - this.touchStartPos.y;\n      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n\n      if (distance > this.SWIPE_THRESHOLD) {\n        const action = this.detectSwipe(deltaX, deltaY);\n        if (action) {\n          this.emit(action, {\n            type: \"touch\",\n            action,\n            timestamp: Date.now(),\n            data: { deltaX, deltaY, distance },\n          });\n        }\n      } else {\n        // Tap\n        this.emit(\"tap\", {\n          type: \"touch\",\n          action: \"tap\",\n          timestamp: Date.now(),\n          data: { x: touch.clientX, y: touch.clientY },\n        });\n      }\n\n      this.touchStartPos = null;\n    };\n\n    window.addEventListener(\"touchstart\", this.touchStartHandler, { passive: true });\n    window.addEventListener(\"touchend\", this.touchEndHandler, { passive: true });\n\n    return () => {\n      if (this.touchStartHandler) {\n        window.removeEventListener(\"touchstart\", this.touchStartHandler);\n        this.touchStartHandler = null;\n      }\n      if (this.touchEndHandler) {\n        window.removeEventListener(\"touchend\", this.touchEndHandler);\n        this.touchEndHandler = null;\n      }\n    };\n  }\n\n  /**\n   * Map keyboard key to game action\n   */\n  private mapKeyToAction(key: string, event: KeyboardEvent): string | null {\n    // Standard game controls\n    const keyMap: Record<string, string> = {\n      ArrowUp: \"move-up\",\n      ArrowDown: \"move-down\",\n      ArrowLeft: \"move-left\",\n      ArrowRight: \"move-right\",\n      \" \": \"action\", // Spacebar\n      Enter: \"confirm\",\n      Escape: \"pause\",\n      \"p\": \"pause\",\n      \"P\": \"pause\",\n      \"q\": \"quit\",\n      \"Q\": \"quit\",\n    };\n\n    return keyMap[key] || null;\n  }\n\n  /**\n   * Detect swipe direction\n   */\n  private detectSwipe(deltaX: number, deltaY: number): string | null {\n    const absX = Math.abs(deltaX);\n    const absY = Math.abs(deltaY);\n\n    if (absX > absY) {\n      return deltaX > 0 ? \"swipe-right\" : \"swipe-left\";\n    } else {\n      return deltaY > 0 ? \"swipe-down\" : \"swipe-up\";\n    }\n  }\n\n  /**\n   * Get keyboard modifiers\n   */\n  private getModifiers(event: KeyboardEvent): {\n    shift: boolean;\n    ctrl: boolean;\n    alt: boolean;\n    meta: boolean;\n  } {\n    return {\n      shift: event.shiftKey,\n      ctrl: event.ctrlKey,\n      alt: event.altKey,\n      meta: event.metaKey,\n    };\n  }\n\n  /**\n   * Emit event to handlers\n   */\n  private emit(action: string, event: InputEvent): void {\n    const handlers = this.handlers.get(action);\n    if (handlers) {\n      handlers.forEach((handler) => handler(event));\n    }\n  }\n\n  /**\n   * Setup all listeners (convenience method)\n   */\n  setupAllListeners(): () => void {\n    const cleanupKeyboard = this.setupKeyboardListeners();\n    const cleanupTouch = this.setupTouchListeners();\n    return () => {\n      cleanupKeyboard();\n      cleanupTouch();\n    };\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    if (this.keyboardHandler) {\n      window.removeEventListener(\"keydown\", this.keyboardHandler);\n      this.keyboardHandler = null;\n    }\n    if (this.touchStartHandler) {\n      window.removeEventListener(\"touchstart\", this.touchStartHandler);\n      this.touchStartHandler = null;\n    }\n    if (this.touchEndHandler) {\n      window.removeEventListener(\"touchend\", this.touchEndHandler);\n      this.touchEndHandler = null;\n    }\n    this.handlers.clear();\n  }\n}\n","/**\n * Hook to detect and respect reduced motion preferences\n * \n * Returns true if user prefers reduced motion\n */\n\nimport { useState, useEffect } from \"react\";\n\nexport function useReducedMotion(): boolean {\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n    setPrefersReducedMotion(mediaQuery.matches);\n\n    const handleChange = (e: MediaQueryListEvent) => {\n      setPrefersReducedMotion(e.matches);\n    };\n\n    // Modern browsers\n    if (mediaQuery.addEventListener) {\n      mediaQuery.addEventListener(\"change\", handleChange);\n      return () => mediaQuery.removeEventListener(\"change\", handleChange);\n    } else {\n      // Fallback for older browsers\n      mediaQuery.addListener(handleChange);\n      return () => mediaQuery.removeListener(handleChange);\n    }\n  }, []);\n\n  return prefersReducedMotion;\n}\n"],"names":[],"mappings":"8CAmBO,OAAM,EACH,SAAwC,IAAI,GAAM,CAClD,WAAqB,CAAK,CAC1B,cAAiD,IAAK,CAC7C,gBAAkB,EAAG,CAC9B,gBAAuD,IAAK,CAC5D,kBAAsD,IAAK,CAC3D,gBAAoD,IAAK,AAEjE,cAAc,CAEd,CAKA,GAAG,CAAc,CAAE,CAAqB,CAAc,CAOpD,OANI,AAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IACrB,IAAI,CAD0B,AACzB,QAAQ,CAAC,GAAG,CAAC,EAAQ,EAAE,EAE9B,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAS,IAAI,CAAC,GAGzB,KACL,IAAM,EAAW,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GACnC,GAAI,EAAU,CACZ,IAAM,EAAQ,EAAS,OAAO,CAAC,GAC3B,EAAQ,CAAC,GACX,AADc,EACL,MAAM,CAAC,EAAO,EAE3B,CACF,CACF,CAKA,WAAW,CAAgB,CAAQ,CACjC,IAAI,CAAC,SAAS,CAAG,CACnB,CAKA,wBAAqC,CACA,MAAO,KAAO,CAuBnD,CAKA,qBAAkC,CACG,MAAO,KAAO,CAwDnD,CAKQ,eAAe,CAAW,CAAE,CAAoB,CAAiB,CAgBvE,MAAO,CAdgC,CACrC,QAAS,UACT,UAAW,YACX,UAAW,YACX,WAAY,aACZ,IAAK,SACL,MAAO,UACP,OAAQ,QACR,EAAK,QACL,EAAK,QACL,EAAK,OACL,EAAK,OACP,CAEa,CAAC,EAAI,EAAI,IACxB,CAKQ,YAAY,CAAc,CAAE,CAAc,CAAiB,QACpD,AAGb,AAAI,KAHc,EAGP,CAHU,CAAC,GACT,CAEI,IAFC,GAAG,CAAC,GAGb,EAAS,EAAI,cAAgB,aAE7B,EAAS,EAAI,aAAe,UAEvC,CAKQ,aAAa,CAAoB,CAKvC,CACA,MAAO,CACL,MAAO,EAAM,QAAQ,CACrB,KAAM,EAAM,OAAO,CACnB,IAAK,EAAM,MAAM,CACjB,KAAM,EAAM,OAAO,AACrB,CACF,CAKQ,KAAK,CAAc,CAAE,CAAiB,CAAQ,CACpD,IAAM,EAAW,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAC/B,GACF,EAAS,KADG,EACI,CAAC,AAAC,GAAY,EAAQ,GAE1C,CAKA,mBAAgC,CAC9B,IAAM,EAAkB,IAAI,CAAC,sBAAsB,GAC7C,EAAe,IAAI,CAAC,mBAAmB,GAC7C,MAAO,KACL,IACA,GACF,CACF,CAKA,SAAgB,CACV,IAAI,CAAC,eAAe,EAAE,CACxB,OAAO,mBAAmB,CAAC,UAAW,IAAI,CAAC,eAAe,EAC1D,IAAI,CAAC,eAAe,CAAG,MAErB,IAAI,CAAC,iBAAiB,EAAE,CAC1B,OAAO,mBAAmB,CAAC,aAAc,IAAI,CAAC,iBAAiB,EAC/D,IAAI,CAAC,iBAAiB,CAAG,MAEvB,IAAI,CAAC,eAAe,EAAE,CACxB,OAAO,mBAAmB,CAAC,WAAY,IAAI,CAAC,eAAe,EAC3D,IAAI,CAAC,eAAe,CAAG,MAEzB,IAAI,CAAC,QAAQ,CAAC,KAAK,EACrB,CACF,kCC9OA,IAAA,EAAA,EAAA,CAAA,CAAA,QAEO,SAAS,IACd,GAAM,CAAC,EAAsB,EAAwB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAuBjE,MArBA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAmBV,EAAG,EAAE,EAEE,CACT"}}]
}