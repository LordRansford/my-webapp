;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="50f85f95-197a-2d02-6a5a-e9b5dbe50267")}catch(e){}}();
module.exports=[899146,a=>{"use strict";var b=a.i(218282),c=a.i(572131);function d(a){return new Set(String(a||"").split(",").map(a=>a.trim()).filter(Boolean))}function e(a){for(let b of d(a))if(b.startsWith("domain:"))return b.slice(7);return""}function f(a){let[f,g]=(0,c.useState)("foundations"),[h,i]=(0,c.useState)("2025.01"),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(""),z=(0,c.useMemo)(()=>({courseId:"cybersecurity",levelId:f,version:h}),[f,h]),A=async()=>{k(!0),m("");try{let a=`/api/admin/assessments/questions?courseId=${encodeURIComponent(z.courseId)}&levelId=${encodeURIComponent(z.levelId)}&version=${encodeURIComponent(z.version)}`,b=await fetch(a),c=await b.json().catch(()=>null);if(!b.ok)return void m(c?.error||"Unable to load assessment.");q(c);let d=`/api/admin/assessments/analysis?courseId=${encodeURIComponent(z.courseId)}&levelId=${encodeURIComponent(z.levelId)}&version=${encodeURIComponent(z.version)}`,e=await fetch(d),f=await e.json().catch(()=>null);e.ok?s(f):s(null);let g=`/api/admin/assessments/quality?courseId=${encodeURIComponent(z.courseId)}&levelId=${encodeURIComponent(z.levelId)}&version=${encodeURIComponent(z.version)}`,h=await fetch(g),i=await h.json().catch(()=>null);h.ok?u(i):u(null)}catch{m("Unable to load assessment.")}finally{k(!1)}};(0,c.useEffect)(()=>{A()},[z.courseId,z.levelId,z.version]);let B=(0,c.useMemo)(()=>{let a=p?.questions||[],b=a.filter(a=>a.published).length;return{total:a.length,published:b,draft:a.length-b}},[p?.questions]),C=(0,c.useMemo)(()=>x?new Set(t?.issues?.[x]||t?.samples?.[x]||[]):null,[x,t?.issues,t?.samples]),D=(0,c.useMemo)(()=>{let a=p?.questions||[];return C?a.filter(a=>C.has(a.id)):a},[p?.questions,C]),E=(0,c.useMemo)(()=>"foundations"===f?["basics","identity","network","crypto","risk","response"]:"applied"===f?["web","api","auth","secrets","cloud","logging"]:["sdlc","zero-trust","runtime","vulnerability","detection","governance"],[f]),F=async b=>{if(!a.canManage)return;let c=n.trim();if(!c)return void m("Reason required.");k(!0),m("");try{var e,f;let a,g=await fetch(`/api/admin/assessments/questions/${encodeURIComponent(b.id)}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({reason:c,version:z.version,published:!b.published,patch:{tags:(e=b.tags,f=!b.published,a=d(e),f?a.add("published"):a.delete("published"),Array.from(a).join(", "))}})}),h=await g.json().catch(()=>null);if(!g.ok)return void m(h?.error||"Unable to update question.");o(""),await A()}catch{m("Unable to update question.")}finally{k(!1)}},G=async b=>{if(!a.canManage)return;let c=n.trim();if(!c)return void m("Reason required.");k(!0),m("");try{let a=await fetch(`/api/admin/assessments/questions/${encodeURIComponent(b.id)}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({reason:c,version:z.version,patch:{question:b.question,options:b.options,correctAnswer:b.correctAnswer,explanation:b.explanation,optionRationales:b.optionRationales,tags:b.tags,bloomLevel:b.bloomLevel}})}),d=await a.json().catch(()=>null);if(!a.ok)return void m(d?.error||"Unable to update question.");w(null),o(""),await A()}catch{m("Unable to update question.")}finally{k(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-5 shadow-sm space-y-4",children:[(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Course"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:"Cybersecurity"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs font-semibold text-slate-600",htmlFor:"level",children:"Level"}),(0,b.jsxs)("select",{id:"level",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",value:f,onChange:a=>g(a.target.value),children:[(0,b.jsx)("option",{value:"foundations",children:"Foundations"}),(0,b.jsx)("option",{value:"applied",children:"Applied"}),(0,b.jsx)("option",{value:"practice",children:"Practice"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs font-semibold text-slate-600",htmlFor:"version",children:"Course version"}),(0,b.jsx)("input",{id:"version",value:h,onChange:a=>i(a.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",placeholder:"Example 2025.01"})]})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Questions"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:B.total})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Published"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:B.published})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Draft"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:B.draft})]})]}),(0,b.jsxs)("div",{className:"grid gap-2 md:grid-cols-[1fr_auto]",children:[(0,b.jsx)("input",{value:n,onChange:a=>o(a.target.value),placeholder:"Reason for change",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900"}),(0,b.jsx)("button",{type:"button",disabled:j,onClick:A,className:"inline-flex items-center justify-center rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:j?"Loading":"Refresh"})]}),r?(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[(0,b.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Attempt analytics"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Attempts"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:r.attempts.total})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Pass rate"}),(0,b.jsxs)("div",{className:"text-sm font-semibold text-slate-900",children:[r.attempts.passRatePercent," percent"]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:"Average score"}),(0,b.jsxs)("div",{className:"text-sm font-semibold text-slate-900",children:[r.attempts.avgScore," percent"]})]})]})]}):null,l?(0,b.jsx)("div",{className:"text-sm font-semibold text-rose-700",children:l}):null]}),(0,b.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-5 shadow-sm space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Questions"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-600",children:[(0,b.jsx)("span",{children:"Tag `published` is required for exam selection"}),(0,b.jsx)("a",{className:"font-semibold text-emerald-700 hover:underline",href:`/api/admin/assessments/answer-key?courseId=${encodeURIComponent(z.courseId)}&levelId=${encodeURIComponent(z.levelId)}&version=${encodeURIComponent(z.version)}`,children:"Download answer key"})]})]}),t?(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 space-y-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Quality checks"}),(0,b.jsx)("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:Object.entries(t.totals||{}).map(([a,c])=>(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white px-3 py-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:a}),(0,b.jsx)("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:c})]},a))}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("button",{type:"button",className:["rounded-full border px-3 py-1 text-xs font-semibold shadow-sm",!x?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-900 hover:bg-slate-50"].join(" "),onClick:()=>y(""),children:"Show all"}),Object.entries(t.totals||{}).filter(([,a])=>Number(a)>0).slice(0,10).map(([a])=>(0,b.jsx)("button",{type:"button",className:["rounded-full border px-3 py-1 text-xs font-semibold shadow-sm",x===a?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-900 hover:bg-slate-50"].join(" "),onClick:()=>y(a),title:"Filter questions by this issue",children:a},a))]}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:"Prioritise missing rationales first so the exported answer key is worth paying for."})]}):null,(0,b.jsx)("div",{className:"space-y-3",children:D.map(c=>{let f=v===c.id,g=e(c.tags);return(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-600",children:c.id}),(0,b.jsxs)("div",{className:"text-sm font-semibold text-slate-900",children:[c.type," Bloom ",c.bloomLevel]}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:c.published?"Published":"Draft"}),g?(0,b.jsxs)("div",{className:"text-xs font-semibold text-slate-700",children:["Domain ",g]}):(0,b.jsx)("div",{className:"text-xs font-semibold text-rose-700",children:"Domain missing"})]}),(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:a.canManage?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{type:"button",disabled:j,onClick:()=>w(f?null:c.id),className:"rounded-full border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-900 hover:bg-slate-50 disabled:opacity-60",children:f?"Close":"Edit"}),(0,b.jsx)("button",{type:"button",disabled:j,onClick:()=>F(c),className:"rounded-full bg-slate-900 px-3 py-2 text-xs font-semibold text-white hover:bg-slate-800 disabled:opacity-60",children:c.published?"Unpublish":"Publish"})]}):(0,b.jsx)("div",{className:"text-xs text-slate-600",children:"Read only"})})]}),f?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Question"}),(0,b.jsx)("textarea",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",rows:3,value:c.question,onChange:a=>{let b=a.target.value;q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,question:b}:a)}:a)}})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Options"}),(0,b.jsx)("textarea",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",rows:4,value:(c.options||[]).join("\n"),onChange:a=>{let b=a.target.value.split("\n").map(a=>a.trim()).filter(Boolean);q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,options:b}:a)}:a)}})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Correct answer index"}),(0,b.jsx)("input",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",value:"number"==typeof c.correctAnswer?String(c.correctAnswer):"",onChange:a=>{let b=Number(a.target.value);q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,correctAnswer:Number.isFinite(b)?b:0}:a)}:a)}}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:"This editor supports MCQ index answers for now"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Explanation"}),(0,b.jsx)("textarea",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",rows:3,value:c.explanation,onChange:a=>{let b=a.target.value;q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,explanation:b}:a)}:a)}})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Option rationales"}),(0,b.jsx)("textarea",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",rows:4,value:(c.optionRationales||[]).join("\n"),onChange:a=>{let b=a.target.value.split("\n").map(a=>a.trimEnd());q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,optionRationales:b}:a)}:a)},placeholder:"One line per option. Include why each option is correct or wrong."}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:"Keep the number of lines aligned with options"})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Bloom level"}),(0,b.jsx)("input",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",value:String(c.bloomLevel),onChange:a=>{let b=Math.max(1,Math.min(6,Number(a.target.value)||1));q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,bloomLevel:b}:a)}:a)}})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Tags"}),(0,b.jsx)("input",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",value:c.tags,onChange:a=>{let b=a.target.value;q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,tags:b}:a)}:a)}}),(0,b.jsxs)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Domain tag"}),(0,b.jsxs)("select",{className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900",value:e(c.tags)||"",onChange:a=>{let b=a.target.value;q(a=>a?{...a,questions:a.questions.map(a=>a.id===c.id?{...a,tags:function(a,b){let c=d(a);for(let a of Array.from(c))a.startsWith("domain:")&&c.delete(a);let e=String(b||"").trim();return e&&c.add(`domain:${e}`),Array.from(c).join(", ")}(a.tags,b)}:a)}:a)},children:[(0,b.jsx)("option",{value:"",children:"Choose domain"}),E.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Tip"}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:"Use exactly one domain tag. Keep it consistent with the blueprint so the learning report links correctly."})]})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("button",{type:"button",disabled:j,onClick:()=>G(c),className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:opacity-60",children:"Save"}),(0,b.jsx)("button",{type:"button",disabled:j,onClick:()=>w(null),className:"rounded-full border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-50 disabled:opacity-60",children:"Cancel"})]})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:c.question}),(0,b.jsx)("ol",{className:"ml-5 list-decimal space-y-1 text-sm text-slate-700",children:(c.options||[]).map((a,c)=>(0,b.jsx)("li",{children:a},c))}),(0,b.jsxs)("div",{className:"text-xs text-slate-600",children:["Tags ",c.tags]})]})]},c.id)})})]})]})}a.s(["default",()=>f])}];

//# debugId=50f85f95-197a-2d02-6a5a-e9b5dbe50267
//# sourceMappingURL=src_app_admin_assessments_ui_client_tsx_89d4345b._.js.map