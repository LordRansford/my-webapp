{
  "version": 3,
  "sources": [],
  "debugId": "6c22e242-ef51-7d1a-4dfd-76d95f88518e",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../node_modules/lucide-react/src/icons/play.ts","../../../../src/lib/motion.js","../../../../node_modules/lucide-react/src/icons/arrow-right.ts","../../../../src/lib/analytics/internalClient.ts","../../../../src/components/auth/SaveProgressPrompt.jsx","../../../../src/components/notes/ToolCard.jsx","../../../../src/lib/cpd.ts","../../../../src/hooks/useCPD.ts","../../../../src/hooks/useAnalytics.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Play\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cG9seWdvbiBwb2ludHM9IjYgMyAyMCAxMiA2IDIxIDYgMyIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/play\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Play = createLucideIcon('Play', [\n  ['polygon', { points: '6 3 20 12 6 21 6 3', key: '1oa8hb' }],\n]);\n\nexport default Play;\n","export const motionTransition = {\n  duration: 0.22,\n  ease: \"easeInOut\",\n};\n\nexport const motionPresets = {\n  fadeIn: {\n    initial: { opacity: 0 },\n    animate: { opacity: 1 },\n    exit: { opacity: 0 },\n  },\n  slideUp: {\n    initial: { opacity: 0, y: 10 },\n    animate: { opacity: 1, y: 0 },\n    exit: { opacity: 0, y: 8 },\n  },\n  scaleIn: {\n    initial: { opacity: 0, scale: 0.98 },\n    animate: { opacity: 1, scale: 1 },\n    exit: { opacity: 0, scale: 0.98 },\n  },\n  softPulse: {\n    // single “breath” only (no loop)\n    initial: { opacity: 0.7 },\n    animate: { opacity: 1 },\n    exit: { opacity: 0 },\n  },\n};\n\nexport function reducedMotionProps(reduce, preset) {\n  if (reduce) {\n    return { initial: false, animate: false, exit: undefined, transition: { duration: 0 } };\n  }\n  return {\n    ...preset,\n    transition: motionTransition,\n  };\n}\n\n\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name ArrowRight\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KICA8cGF0aCBkPSJtMTIgNSA3IDctNyA3IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/arrow-right\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowRight = createLucideIcon('ArrowRight', [\n  ['path', { d: 'M5 12h14', key: '1ays0h' }],\n  ['path', { d: 'm12 5 7 7-7 7', key: 'xquz4c' }],\n]);\n\nexport default ArrowRight;\n","\"use client\";\n\nimport { type InternalToolEvent, type InternalToolEventPayload } from \"@/lib/analytics/internalEvents\";\n\nconst SESSION_KEY = \"rn_internal_anon_session_v1\";\n\nfunction isEnabled(): boolean {\n  // Disabled by default. Enable explicitly in production only.\n  if (process.env.NODE_ENV !== \"production\") return false;\n  if (process.env.CI) return false;\n  if (process.env.NEXT_PUBLIC_INTERNAL_ANALYTICS !== \"true\") return false;\n  if (typeof window === \"undefined\") return false;\n  const path = window.location?.pathname || \"\";\n  if (path.startsWith(\"/admin\")) return false;\n  return true;\n}\n\nexport function getAnonSessionId(): string {\n  if (typeof window === \"undefined\") return \"server\";\n  try {\n    const existing = window.sessionStorage.getItem(SESSION_KEY);\n    if (existing) return existing;\n    const id =\n      typeof crypto !== \"undefined\" && typeof crypto.randomUUID === \"function\"\n        ? crypto.randomUUID()\n        : `${Date.now()}-${Math.random().toString(16).slice(2)}`;\n    window.sessionStorage.setItem(SESSION_KEY, id);\n    return id;\n  } catch {\n    return \"unknown\";\n  }\n}\n\nexport function emitInternalToolEvent(event: Omit<InternalToolEvent, \"timestamp\" | \"sessionId\"> & { timestamp?: string }) {\n  if (!isEnabled()) return;\n\n  const payload: InternalToolEventPayload = {\n    v: 1,\n    event: {\n      ...event,\n      toolId: String(event.toolId || \"\").trim(),\n      timestamp: event.timestamp || new Date().toISOString(),\n      sessionId: getAnonSessionId(),\n    },\n  };\n\n  // Fire and forget. Never block tool execution.\n  try {\n    void fetch(\"/api/analytics\", {\n      method: \"POST\",\n      headers: { \"content-type\": \"application/json\" },\n      body: JSON.stringify(payload),\n      keepalive: true,\n    });\n  } catch {\n    // ignore\n  }\n}\n\n\n","\"use client\";\n\nimport Link from \"next/link\";\n\nexport default function SaveProgressPrompt({ className = \"\" }) {\n  return (\n    <div className={`mt-3 rounded-2xl border border-slate-200 bg-white/90 p-3 text-sm text-slate-700 shadow-sm ${className}`}>\n      <p className=\"m-0\">\n        <span className=\"font-semibold text-slate-900\">Sign in to track this.</span>{\" \"}\n        Visitors can read the courses, but tracking requires an account.\n      </p>\n      <div className=\"mt-2\">\n        <Link\n          href=\"/signin\"\n          className=\"inline-flex items-center justify-center rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-900\"\n        >\n          Sign in\n        </Link>\n      </div>\n      <p className=\"mt-2 text-xs text-slate-600\">Privacy note: we store your email and your progress only. No analytics. No IP storage.</p>\n    </div>\n  );\n}\n\n\n","\"use client\";\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport Link from \"next/link\";\nimport { LazyMotion, domAnimation, m, useReducedMotion } from \"framer-motion\";\nimport { ArrowRight } from \"lucide-react\";\nimport { useSession } from \"next-auth/react\";\nimport { useCPD } from \"@/hooks/useCPD\";\nimport { resolveTrackId } from \"@/lib/cpd\";\nimport { motionPresets, reducedMotionProps } from \"@/lib/motion\";\nimport SaveProgressPrompt from \"@/components/auth/SaveProgressPrompt\";\nimport { useAnalytics } from \"@/hooks/useAnalytics\";\nimport { emitInternalToolEvent } from \"@/lib/analytics/internalClient\";\n\nclass ToolErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError() {\n    return { hasError: true };\n  }\n\n  componentDidCatch() {\n    // No console logging of tool contents.\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"w-full rounded-xl border border-slate-100 bg-slate-50/80 p-4\">\n          <p className=\"m-0 text-sm text-slate-700\">This tool could not load. Please refresh the page.</p>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\nexport default function ToolCard({\n  id,\n  title,\n  description,\n  usageHint,\n  children,\n  href,\n  icon: Icon,\n  courseId,\n  levelId,\n  sectionId,\n  cpdMinutesOnUse,\n}) {\n  const slugify = (text = \"\") =>\n    String(text)\n      .toLowerCase()\n      .replace(/&[#\\w]+;?/g, \"\")\n      .replace(/[^\\w\\s-]/g, \"\")\n      .trim()\n      .replace(/\\s+/g, \"-\")\n      .slice(0, 60);\n\n  const resolvedId = id || slugify(title) || undefined;\n\n  const { updateSection, isAuthed } = useCPD();\n  const { track } = useAnalytics();\n  const [hasAwarded, setHasAwarded] = useState(false);\n  const [showSavePrompt, setShowSavePrompt] = useState(false);\n  const trackId = courseId ? resolveTrackId(courseId) : null;\n  const reduce = useReducedMotion();\n  useSession();\n\n  const handleUse = ({ allowPrompt = true } = {}) => {\n    if (!isAuthed) {\n      if (allowPrompt) setShowSavePrompt(true);\n      return;\n    }\n\n    if (resolvedId) track({ type: \"tool_used\", toolId: resolvedId, trackId: trackId || undefined, levelId, sectionId });\n    if (!trackId || !levelId || !sectionId) return;\n    if (hasAwarded) return;\n\n    updateSection({\n      trackId,\n      levelId,\n      sectionId,\n      minutesDelta: cpdMinutesOnUse ?? 5,\n      note: resolvedId ? `Used tool ${resolvedId}` : `Used tool ${title}`,\n    });\n\n    setHasAwarded(true);\n  };\n\n  const showCta = Boolean(href) && !children;\n  const ResolvedIcon = Icon || ArrowRight;\n  const showPlaceholder = !children && !href;\n  const viewedRef = useRef(false);\n\n  useEffect(() => {\n    if (viewedRef.current) return;\n    if (!resolvedId) return;\n    viewedRef.current = true;\n    emitInternalToolEvent({ type: \"tool_viewed\", toolId: resolvedId });\n  }, [resolvedId]);\n\n  const Inner = (\n    <>\n      <header className=\"mb-4 min-w-0\">\n        <div className=\"flex min-w-0 items-start justify-between gap-3\">\n          <div className=\"flex min-w-0 items-start gap-2\">\n            {showCta ? (\n              <span className=\"mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-xl border border-slate-200 bg-white shadow-sm\">\n                <ResolvedIcon className=\"h-4 w-4 text-slate-700\" aria-hidden=\"true\" />\n              </span>\n            ) : null}\n            <div className=\"min-w-0\">\n              <h3 className=\"mb-2 break-words text-lg font-semibold text-slate-900\">{title}</h3>\n              {description ? <p className=\"break-words text-sm leading-relaxed text-slate-600\">{description}</p> : null}\n              <p className=\"mt-1 text-xs font-semibold text-slate-700\">\n                {usageHint || \"How to use: open the tool, follow the inputs, and run with limits shown.\"}\n              </p>\n            </div>\n          </div>\n          {showCta ? (\n            <span className=\"inline-flex shrink-0 items-center gap-2 rounded-full bg-slate-900 px-3 py-1 text-xs font-semibold text-white shadow-sm\">\n              Open <span aria-hidden=\"true\">-&gt;</span>\n            </span>\n          ) : null}\n        </div>\n      </header>\n\n      {children ? (\n        <div className=\"w-full overflow-x-auto rounded-xl border border-slate-100 bg-slate-50/80 p-4 transition-colors duration-200\">\n          <ToolErrorBoundary>{children}</ToolErrorBoundary>\n        </div>\n      ) : showPlaceholder ? (\n        <div className=\"w-full rounded-xl border border-slate-100 bg-slate-50/80 p-4\">\n          <p className=\"m-0 text-sm text-slate-700\">\n            Tool coming online. This card is intentionally visible so the section is not a blank gap.\n          </p>\n        </div>\n      ) : null}\n    </>\n  );\n\n  return (\n    <LazyMotion features={domAnimation}>\n      <m.section\n        {...reducedMotionProps(reduce, motionPresets.slideUp)}\n        data-tool-id={resolvedId || \"\"}\n        data-tool-title={title || \"\"}\n        className=\"notes-tool-card my-6 w-full rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all duration-300 hover:border-slate-300 hover:shadow-md\"\n      >\n        {href ? (\n          <Link\n            href={href}\n            className=\"block w-full min-w-0 rounded-2xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-300 focus-visible:ring-offset-2 focus-visible:ring-offset-white\"\n            onClick={() => handleUse({ allowPrompt: false })}\n            aria-label={`Open ${title}`}\n          >\n            {Inner}\n          </Link>\n        ) : (\n          <button\n            type=\"button\"\n            className=\"w-full min-w-0 rounded-2xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-300 focus-visible:ring-offset-2 focus-visible:ring-offset-white\"\n            onClick={() => handleUse({ allowPrompt: true })}\n            aria-label={`Use ${title}`}\n          >\n            {Inner}\n          </button>\n        )}\n      </m.section>\n      {showSavePrompt && !isAuthed ? <SaveProgressPrompt /> : null}\n    </LazyMotion>\n  );\n}\n","export type CPDTrackId = \"cyber\" | \"ai\" | \"software-architecture\" | \"digitalisation\" | \"data\" | \"network-models\";\n\nexport interface CPDSectionKey {\n  trackId: CPDTrackId;\n  levelId: string;\n  sectionId: string;\n}\n\nexport interface CPDSectionState extends CPDSectionKey {\n  completed: boolean;\n  minutes: number;\n  lastUpdated: string;\n}\n\nexport interface CPDActivity {\n  id: string;\n  trackId: CPDTrackId;\n  levelId: string;\n  sectionId: string;\n  minutesDelta: number;\n  timestamp: string;\n  note?: string;\n}\n\nexport interface CPDState {\n  version: number;\n  sections: CPDSectionState[];\n  activity: CPDActivity[];\n}\n\nconst CPD_STORAGE_KEY = \"ransfords-notes-cpd-v1\";\nconst CPD_VERSION = 1;\n\nconst emptyState = (): CPDState => ({\n  version: CPD_VERSION,\n  sections: [],\n  activity: [],\n});\n\nconst isBrowser = typeof window !== \"undefined\";\n\n/**\n * Legacy section IDs exist in older content. We keep them as aliases so:\n * - existing learner progress still counts after an ID migration\n * - content can migrate to canonical IDs without breaking progress bars\n *\n * IMPORTANT:\n * - Canonical IDs should be stable and live in docs/courses/CYBERSECURITY_MASTER_SYLLABUS.md\n * - Aliases should only be added for real historical IDs used in production content.\n */\nconst LEGACY_SECTION_ALIASES: Partial<\n  Record<CPDTrackId, Partial<Record<string, Partial<Record<string, string[]>>>>>\n> = {\n  cyber: {\n    foundations: {\n      // Old \"Foundations overview\" toggle + quiz lived under this ID.\n      // Canonical syllabus splits this into a dedicated Module F0.\n      \"foundations-f0-what-security-is\": [\"foundations-why-cyber-matters\"],\n\n      // Old module IDs from the original Foundations page.\n      \"foundations-f2-data-and-integrity\": [\"foundations-data-and-bits\"],\n      \"foundations-f3-networks-and-transport\": [\"foundations-networks-and-packets\"],\n      \"foundations-f4-cia-and-simple-attacks\": [\"foundations-cia-and-simple-attacks\"],\n\n      // Old manifest had a placeholder capstone ID, keep it as an alias.\n      \"foundations-f8-foundations-capstone\": [\"foundations-checkpoint-capstone\"],\n    },\n    applied: {\n      \"applied-a1-threat-modelling-as-design\": [\"applied-threat-modelling\"],\n      \"applied-a2-identity-and-access-control\": [\"applied-auth-sessions-access\"],\n      \"applied-a6-logging-and-detection-basics\": [\"applied-logging-and-risk\"],\n    },\n    practice: {\n      \"practice-p2-exposure-reduction-zero-trust\": [\"practice-p1-secure-architecture-zero-trust\", \"advanced-secure-architecture\"],\n      \"practice-p3-runtime-and-cloud-security\": [\"practice-p0-crypto-in-practice\", \"advanced-crypto-practice\"],\n      \"practice-p4-supply-chain-security\": [\"practice-p3-supply-chain-risk\", \"advanced-supply-chain-risk\"],\n      \"practice-p6-detection-and-incident-response\": [\"practice-p2-detection-and-incident-response\", \"advanced-detection-response\"],\n      \"practice-p7-privacy-ethics-auditability\": [\"practice-p5-governance-and-professional-practice\", \"advanced-governance-career\"],\n      \"practice-p8-system-ilities\": [\"practice-p4-adversarial-tradeoffs\", \"advanced-adversarial-tradeoffs\"],\n      \"practice-p9-capstone-professional-practice\": [\"practice-p6-capstone\"],\n    },\n  },\n};\n\nexport function getSectionAliases(trackId: CPDTrackId, levelId: string, sectionId: string): string[] {\n  const canonical = String(sectionId || \"\").trim();\n  if (!canonical) return [];\n  const aliases = LEGACY_SECTION_ALIASES?.[trackId]?.[levelId]?.[canonical] ?? [];\n  const all = [canonical, ...aliases].map((s) => String(s).trim()).filter(Boolean);\n  return Array.from(new Set(all));\n}\n\nexport function isSectionCompleted(state: CPDState, trackId: CPDTrackId, levelId: string, sectionId: string): boolean {\n  const ids = getSectionAliases(trackId, levelId, sectionId);\n  if (ids.length === 0) return false;\n  return ids.some((id) =>\n    state.sections.some(\n      (section) =>\n        section.trackId === trackId &&\n        section.levelId === levelId &&\n        section.sectionId === id &&\n        section.completed\n    )\n  );\n}\n\nconst normaliseSection = (input: any): CPDSectionState | null => {\n  if (!input || typeof input !== \"object\") return null;\n  const { trackId, levelId, sectionId, completed, minutes, lastUpdated } = input;\n  if (!trackId || !levelId || !sectionId) return null;\n  return {\n    trackId,\n    levelId,\n    sectionId,\n    completed: Boolean(completed),\n    minutes: Math.max(0, Number(minutes) || 0),\n    lastUpdated: typeof lastUpdated === \"string\" && lastUpdated.length > 0 ? lastUpdated : new Date().toISOString(),\n  };\n};\n\nconst normaliseActivity = (input: any): CPDActivity | null => {\n  if (!input || typeof input !== \"object\") return null;\n  const { id, trackId, levelId, sectionId, minutesDelta, timestamp, note } = input;\n  if (!id || !trackId || !levelId || !sectionId || !timestamp) return null;\n  return {\n    id: String(id),\n    trackId,\n    levelId,\n    sectionId,\n    minutesDelta: Number(minutesDelta) || 0,\n    timestamp: String(timestamp),\n    note: typeof note === \"string\" ? note : undefined,\n  };\n};\n\nfunction isNetworkModelsSectionId(sectionId: string) {\n  const id = String(sectionId || \"\").trim().toLowerCase();\n  // Network Models content is consistently namespaced.\n  return id.startsWith(\"net-\") || id.startsWith(\"network-models-\");\n}\n\nfunction migrateLegacyNetworkModels(state: CPDState): CPDState {\n  // Historical bug: network-models pages previously resolved to trackId \"ai\".\n  // We can safely migrate because network models section IDs are namespaced.\n  const next: CPDState = { ...state, sections: [...state.sections], activity: [...state.activity] };\n\n  let changed = false;\n  for (const s of next.sections) {\n    if (s.trackId === \"ai\" && isNetworkModelsSectionId(s.sectionId)) {\n      (s as any).trackId = \"network-models\";\n      changed = true;\n    }\n  }\n  for (const a of next.activity) {\n    if (a.trackId === \"ai\" && isNetworkModelsSectionId(a.sectionId)) {\n      (a as any).trackId = \"network-models\";\n      changed = true;\n    }\n  }\n\n  return changed ? next : state;\n}\n\nexport function getInitialCPDState(): CPDState {\n  if (!isBrowser) return emptyState();\n  try {\n    const raw = window.localStorage.getItem(CPD_STORAGE_KEY);\n    if (!raw) return emptyState();\n    const parsed = JSON.parse(raw);\n    if (!parsed || typeof parsed !== \"object\") return emptyState();\n    const version = Number(parsed.version) || CPD_VERSION;\n    const sections = Array.isArray(parsed.sections)\n      ? parsed.sections.map(normaliseSection).filter(Boolean)\n      : [];\n    const activity = Array.isArray(parsed.activity)\n      ? parsed.activity.map(normaliseActivity).filter(Boolean)\n      : [];\n    return migrateLegacyNetworkModels({ version, sections, activity });\n  } catch {\n    return emptyState();\n  }\n}\n\nexport function saveCPDState(state: CPDState): void {\n  if (!isBrowser) return;\n  try {\n    window.localStorage.setItem(CPD_STORAGE_KEY, JSON.stringify(state));\n  } catch {\n    // ignore storage errors\n  }\n}\n\nexport function upsertSection(\n  state: CPDState,\n  input: CPDSectionKey & { completed?: boolean; minutesDelta?: number }\n): CPDState {\n  const next = { ...state, sections: [...state.sections] };\n  const index = next.sections.findIndex(\n    (section) =>\n      section.trackId === input.trackId &&\n      section.levelId === input.levelId &&\n      section.sectionId === input.sectionId\n  );\n\n  const now = new Date().toISOString();\n  const existing = index >= 0 ? next.sections[index] : null;\n  const minutes = Math.max(0, (existing?.minutes || 0) + (input.minutesDelta || 0));\n  const updated: CPDSectionState = {\n    trackId: input.trackId,\n    levelId: input.levelId,\n    sectionId: input.sectionId,\n    completed: input.completed ?? existing?.completed ?? false,\n    minutes,\n    lastUpdated: now,\n  };\n\n  if (index >= 0) {\n    next.sections[index] = updated;\n  } else {\n    next.sections.push(updated);\n  }\n\n  return next;\n}\n\nexport function getTotalsForTrack(state: CPDState, trackId: CPDTrackId) {\n  const sections = state.sections.filter((section) => section.trackId === trackId);\n  const totalMinutes = sections.reduce((sum, section) => sum + section.minutes, 0);\n  const completedSections = sections.filter((section) => section.completed).length;\n  const totalSections = sections.length;\n  return { totalMinutes, completedSections, totalSections };\n}\n\nexport function resolveTrackId(courseId: string): CPDTrackId {\n  if (courseId === \"cybersecurity\" || courseId === \"cyber\") return \"cyber\";\n  if (courseId === \"network-models\" || courseId === \"network\") return \"network-models\";\n  if (courseId === \"software-architecture\" || courseId === \"architecture\") return \"software-architecture\";\n  if (courseId === \"digitalisation\") return \"digitalisation\";\n  if (courseId === \"data\") return \"data\";\n  return \"ai\";\n}\n\nexport function getCompletionForLevel(\n  state: CPDState,\n  trackId: CPDTrackId,\n  levelId: string,\n  sectionIds: string[] = []\n) {\n  const completedCount = sectionIds.filter((sectionId) =>\n    isSectionCompleted(state, trackId, levelId, sectionId)\n  ).length;\n  const totalCount = sectionIds.length;\n  const percent = totalCount === 0 ? 0 : Math.round((completedCount / totalCount) * 100);\n  return { completedCount, totalCount, percent };\n}\n\nexport function getCompletionForCourse(\n  state: CPDState,\n  trackId: CPDTrackId,\n  manifest: Record<string, string[]>,\n  levelIds?: string[]\n) {\n  const levels = levelIds && levelIds.length > 0 ? levelIds : Object.keys(manifest || {});\n  const totals = levels.reduce(\n    (acc, levelId) => {\n      const sectionIds = manifest?.[levelId] || [];\n      const result = getCompletionForLevel(state, trackId, levelId, sectionIds);\n      acc.completed += result.completedCount;\n      acc.total += result.totalCount;\n      return acc;\n    },\n    { completed: 0, total: 0 }\n  );\n  const percent = totals.total === 0 ? 0 : Math.round((totals.completed / totals.total) * 100);\n  return { completedCount: totals.completed, totalCount: totals.total, percent };\n}\n\nexport function addActivityEntry(\n  state: CPDState,\n  entry: Omit<CPDActivity, \"id\" | \"timestamp\">\n): CPDState {\n  const full: CPDActivity = {\n    ...entry,\n    id: `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n    timestamp: new Date().toISOString(),\n  };\n  return {\n    ...state,\n    activity: [full, ...state.activity].slice(0, 200),\n  };\n}\n","import { useCallback, useEffect, useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport {\n  CPDSectionKey,\n  CPDState,\n  CPDTrackId,\n  addActivityEntry,\n  getInitialCPDState,\n  getTotalsForTrack,\n  saveCPDState,\n  upsertSection,\n} from \"@/lib/cpd\";\n\nexport function useCPD() {\n  // SSR/hydration safety: start with a deterministic empty state, then hydrate from storage on mount.\n  // This avoids server/client mismatches when localStorage has existing progress.\n  const [state, setState] = useState<CPDState>(() => ({ version: 1, sections: [], activity: [] }));\n  const { data: session, status } = useSession();\n  const isAuthed = Boolean(session?.user?.id);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const fresh = getInitialCPDState();\n    setState(fresh);\n  }, []);\n\n  // When signed in, load server-backed progress (falls back to local state if none).\n  useEffect(() => {\n    if (!isAuthed) return;\n    let cancelled = false;\n    (async () => {\n      try {\n        const res = await fetch(\"/api/progress/cpd\", { method: \"GET\" });\n        if (!res.ok) return;\n        const data = await res.json();\n        if (cancelled) return;\n        if (data?.state) {\n          setState(data.state);\n          saveCPDState(data.state);\n        } else {\n          // No server state yet: push local state up so progress persists across devices.\n          await fetch(\"/api/progress/cpd\", {\n            method: \"PUT\",\n            headers: { \"content-type\": \"application/json\" },\n            body: JSON.stringify({ state }),\n          });\n        }\n      } catch {\n        // Keep local-only if offline or server unavailable.\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isAuthed, status]);\n\n  const updateSection = useCallback(\n    (input: CPDSectionKey & { completed?: boolean; minutesDelta?: number; note?: string }) => {\n      // Stage 20 tier rule: visitors can view content but do not track progress or CPD.\n      // Tracking requires a signed-in learner account.\n      if (!session?.user?.id) return;\n      setState((prev) => {\n        let next = upsertSection(prev, input);\n        if (input.minutesDelta && input.minutesDelta !== 0) {\n          next = addActivityEntry(next, {\n            trackId: input.trackId,\n            levelId: input.levelId,\n            sectionId: input.sectionId,\n            minutesDelta: input.minutesDelta,\n            note: input.note ?? \"\",\n          });\n        }\n        saveCPDState(next);\n        // Server-side enforcement: the server derives userId from the validated session.\n        // Client never sends userId claims.\n        fetch(\"/api/progress/cpd\", {\n          method: \"PUT\",\n          headers: { \"content-type\": \"application/json\" },\n          body: JSON.stringify({ state: next }),\n        }).catch(() => {});\n\n        // Minimal evidence capture for CPD audit trail.\n        // This does not lock learning and does not store secrets.\n        if (input.completed === true) {\n          const courseId =\n            input.trackId === \"cyber\" ? \"cybersecurity\" : String(input.trackId || \"\");\n          fetch(\"/api/cpd/evidence\", {\n            method: \"POST\",\n            headers: { \"content-type\": \"application/json\" },\n            body: JSON.stringify({\n              courseId,\n              evidenceType: \"progress\",\n              payload: { trackId: input.trackId, levelId: input.levelId, sectionId: input.sectionId, completed: true },\n            }),\n          }).catch(() => {});\n        }\n        return next;\n      });\n    },\n    [session?.user?.id]\n  );\n\n  const getTrackTotals = useCallback(\n    (trackId: CPDTrackId) => getTotalsForTrack(state, trackId),\n    [state]\n  );\n\n  return { state, updateSection, getTrackTotals, isAuthed };\n}\n","import { useEffect, useRef, useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\n\ntype AnalyticsEvent = {\n  type: \"section_started\" | \"section_completed\" | \"quiz_attempted\" | \"quiz_completed\" | \"tool_used\";\n  timestamp?: string;\n  trackId?: string;\n  levelId?: string;\n  sectionId?: string;\n  quizId?: string;\n  success?: boolean;\n  toolId?: string;\n};\n\nexport function useAnalytics() {\n  const { data: session } = useSession();\n  const userId = session?.user?.id || null;\n\n  const [consented, setConsented] = useState(false);\n  const queueRef = useRef<AnalyticsEvent[]>([]);\n  const flushTimerRef = useRef<any>(null);\n\n  useEffect(() => {\n    if (!userId) {\n      setConsented(false);\n      queueRef.current = [];\n      return;\n    }\n    fetch(\"/api/account/profile\")\n      .then((r) => r.json())\n      .then((d) => {\n        const acceptedAt = d?.user?.consent?.cpdDataUseAcceptedAt;\n        setConsented(Boolean(acceptedAt));\n      })\n      .catch(() => setConsented(false));\n  }, [userId]);\n\n  const flush = async () => {\n    if (!userId || !consented) {\n      queueRef.current = [];\n      return;\n    }\n    const events = queueRef.current.splice(0, queueRef.current.length);\n    if (!events.length) return;\n    try {\n      await fetch(\"/api/analytics/events\", {\n        method: \"POST\",\n        headers: { \"content-type\": \"application/json\" },\n        body: JSON.stringify({ events }),\n      });\n    } catch {\n      // keep best effort; drop events rather than retry loops\n    }\n  };\n\n  const track = (event: AnalyticsEvent) => {\n    if (!userId || !consented) return;\n    queueRef.current.push({ ...event, timestamp: new Date().toISOString() });\n    if (queueRef.current.length >= 20) {\n      void flush();\n      return;\n    }\n    if (flushTimerRef.current) clearTimeout(flushTimerRef.current);\n    flushTimerRef.current = setTimeout(() => void flush(), 1200);\n  };\n\n  useEffect(() => {\n    return () => {\n      if (flushTimerRef.current) clearTimeout(flushTimerRef.current);\n    };\n  }, []);\n\n  // Returning plain functions is fine here; we keep writes debounced and best-effort.\n  return { consented, track, flush };\n}\n\n\n"],"names":[],"mappings":"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"}}]
}