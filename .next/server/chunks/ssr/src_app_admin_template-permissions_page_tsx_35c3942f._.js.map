{
  "version": 3,
  "sources": [],
  "debugId": "bcb1c608-3fd7-518a-37c3-6c69c74f68e3",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/app/admin/template-permissions/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ntype Token = {\n  tokenId: string;\n  userId?: string | null;\n  anonymousUserId?: string | null;\n  templateId?: string | null;\n  issuedAt: string;\n  expiresAt?: string | null;\n  notes?: string | null;\n};\n\nexport default function TemplatePermissionsAdminPage() {\n  const [tokens, setTokens] = useState<Token[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [form, setForm] = useState({ userId: \"\", templateId: \"\", expiresAt: \"\", notes: \"\" });\n  const [error, setError] = useState<string | null>(null);\n  const [configError, setConfigError] = useState<string | null>(null);\n\n  const loadTokens = async () => {\n    setLoading(true);\n    setError(null);\n    setConfigError(null);\n    try {\n      const res = await fetch(\"/api/admin/permission-tokens\");\n      const data = await res.json();\n      if (!res.ok) {\n        if (res.status === 401 || res.status === 403) {\n          setConfigError(data?.message || \"Admin access requires a valid admin_token cookie.\");\n          return;\n        }\n        if (res.status === 500 && data?.message) {\n          setConfigError(data.message);\n          return;\n        }\n        throw new Error(data?.message || \"Forbidden\");\n      }\n      setTokens(data.tokens || []);\n    } catch (err: any) {\n      setError(err.message || \"Could not load tokens\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadTokens();\n  }, []);\n\n  const createToken = async () => {\n    if (configError) {\n      setError(configError);\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(\"/api/admin/permission-tokens\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          userId: form.userId || null,\n          templateId: form.templateId || null,\n          expiresAt: form.expiresAt || null,\n          notes: form.notes || null,\n        }),\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data?.message || \"Could not create token\");\n      await loadTokens();\n      setForm({ userId: \"\", templateId: \"\", expiresAt: \"\", notes: \"\" });\n    } catch (err: any) {\n      setError(err.message || \"Could not create token\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const revokeToken = async (tokenId: string) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`/api/admin/permission-tokens?tokenId=${encodeURIComponent(tokenId)}`, { method: \"DELETE\" });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data?.message || \"Could not revoke token\");\n      await loadTokens();\n    } catch (err: any) {\n      setError(err.message || \"Could not revoke token\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (configError) {\n    return (\n      <main className=\"mx-auto max-w-4xl p-6\">\n        <h1 className=\"text-2xl font-semibold text-slate-900\">Admin access unavailable</h1>\n        <p className=\"text-sm text-slate-800\">{configError}</p>\n        <p className=\"text-sm text-slate-700\">\n          Set ADMIN_DASHBOARD_TOKEN server side and present the admin_token cookie. All validation stays on the server.\n        </p>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"mx-auto max-w-5xl p-6 space-y-4\">\n      <header className=\"space-y-1\">\n        <p className=\"text-sm font-semibold uppercase tracking-wide text-slate-600\">Admin</p>\n        <h1 className=\"text-2xl font-semibold text-slate-900\">Template permissions</h1>\n        <p className=\"text-sm text-slate-700\">Issue and revoke permission tokens.</p>\n      </header>\n\n      <section className=\"grid gap-3 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm\">\n        <div className=\"grid gap-3 sm:grid-cols-2\">\n          <label className=\"space-y-1 text-sm text-slate-800\">\n            User ID (optional)\n            <input\n              className=\"w-full rounded-lg border border-slate-200 p-2\"\n              value={form.userId}\n              onChange={(e) => setForm((f) => ({ ...f, userId: e.target.value }))}\n              placeholder=\"user-123 or leave blank\"\n            />\n          </label>\n          <label className=\"space-y-1 text-sm text-slate-800\">\n            Template ID (optional)\n            <input\n              className=\"w-full rounded-lg border border-slate-200 p-2\"\n              value={form.templateId}\n              onChange={(e) => setForm((f) => ({ ...f, templateId: e.target.value }))}\n              placeholder=\"template slug or leave blank\"\n            />\n          </label>\n          <label className=\"space-y-1 text-sm text-slate-800\">\n            Expires at (ISO, optional)\n            <input\n              className=\"w-full rounded-lg border border-slate-200 p-2\"\n              value={form.expiresAt}\n              onChange={(e) => setForm((f) => ({ ...f, expiresAt: e.target.value }))}\n              placeholder=\"2026-01-01T00:00:00Z\"\n            />\n          </label>\n          <label className=\"space-y-1 text-sm text-slate-800\">\n            Notes\n            <input\n              className=\"w-full rounded-lg border border-slate-200 p-2\"\n              value={form.notes}\n              onChange={(e) => setForm((f) => ({ ...f, notes: e.target.value }))}\n              placeholder=\"Who approved this\"\n            />\n          </label>\n        </div>\n        <div className=\"flex gap-2\">\n          <button\n            type=\"button\"\n            onClick={createToken}\n            className=\"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800\"\n            disabled={loading}\n          >\n            {loading ? \"Working...\" : \"Create token\"}\n          </button>\n          <button\n            type=\"button\"\n            onClick={loadTokens}\n            className=\"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50\"\n            disabled={loading}\n          >\n            Refresh\n          </button>\n        </div>\n        <p className=\"text-sm text-slate-600\">Scope is fixed to commercial_remove_signature. Issuer is Ransford.</p>\n      </section>\n\n      <section className=\"overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm\">\n        <table className=\"min-w-full text-left text-sm text-slate-800\">\n          <thead className=\"bg-slate-50 text-sm font-semibold uppercase tracking-wide text-slate-600\">\n            <tr>\n              <th className=\"px-4 py-2\">Token</th>\n              <th className=\"px-4 py-2\">User / anon</th>\n              <th className=\"px-4 py-2\">Template</th>\n              <th className=\"px-4 py-2\">Issued</th>\n              <th className=\"px-4 py-2\">Expires</th>\n              <th className=\"px-4 py-2\">Notes</th>\n              <th className=\"px-4 py-2\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {tokens.map((t) => (\n              <tr key={t.tokenId} className=\"border-t border-slate-100\">\n                <td className=\"px-4 py-2 font-mono text-sm text-slate-800 break-all\">{t.tokenId}</td>\n                <td className=\"px-4 py-2 text-sm text-slate-800\">\n                  {t.userId || \"-\"} / {t.anonymousUserId || \"-\"}\n                </td>\n                <td className=\"px-4 py-2\">{t.templateId || \"Any\"}</td>\n                <td className=\"px-4 py-2 text-sm text-slate-800\">{new Date(t.issuedAt).toLocaleString()}</td>\n                <td className=\"px-4 py-2 text-sm text-slate-800\">\n                  {t.expiresAt ? new Date(t.expiresAt).toLocaleString() : \"No expiry\"}\n                </td>\n                <td className=\"px-4 py-2 text-sm text-slate-800\">{t.notes || \"\"}</td>\n                <td className=\"px-4 py-2\">\n                  <button\n                    type=\"button\"\n                    onClick={() => revokeToken(t.tokenId)}\n                    className=\"text-sm font-semibold text-rose-700 hover:underline\"\n                    disabled={loading}\n                  >\n                    Revoke\n                  </button>\n                </td>\n              </tr>\n            ))}\n            {!tokens.length && (\n              <tr>\n                <td className=\"px-4 py-3 text-sm text-slate-600\" colSpan={7}>\n                  No tokens issued yet.\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </section>\n\n      {error ? <p className=\"text-sm font-semibold text-rose-700\">{error}</p> : null}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}