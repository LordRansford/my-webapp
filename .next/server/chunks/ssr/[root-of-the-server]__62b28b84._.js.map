{
  "version": 3,
  "sources": [],
  "debugId": "66edf318-e6c4-1e20-96da-1c65ce9ee846",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../src/lib/admin/usersStore.ts","../../../../src/app/admin/users/%5Bid%5D/ui.client.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/admin/users/%5Bid%5D/page.tsx"],"sourcesContent":["import { prisma } from \"@/lib/db/prisma\";\nimport type { AdminRole } from \"@/lib/admin/rbac\";\n\nexport type AdminUserListItem = {\n  userId: string;\n  email: string;\n  role: AdminRole | \"NONE\";\n  accountStatus: \"active\" | \"suspended\" | \"pending\";\n  createdAt: string;\n  lastActiveAt: string;\n};\n\nfunction toIso(d: any) {\n  try {\n    return new Date(d).toISOString();\n  } catch {\n    return new Date(0).toISOString();\n  }\n}\n\nexport type UserSortKey = \"created\" | \"lastActive\" | \"role\";\nexport type SortDir = \"asc\" | \"desc\";\n\nexport async function listUsersAdminSafe(opts: {\n  search?: string;\n  take: number;\n  cursor?: string | null;\n  sortKey: UserSortKey;\n  sortDir: SortDir;\n}): Promise<{ items: AdminUserListItem[]; nextCursor: string | null }> {\n  const take = Math.max(1, Math.min(50, opts.take));\n  const search = (opts.search || \"\").trim().toLowerCase();\n\n  const where = search\n    ? {\n        OR: [{ email: { contains: search } }],\n      }\n    : {};\n\n  const orderBy =\n    opts.sortKey === \"created\"\n      ? { createdAt: opts.sortDir }\n      : opts.sortKey === \"lastActive\"\n        ? { lastActiveAt: opts.sortDir }\n        : [{ adminRole: opts.sortDir }, { createdAt: \"desc\" as const }];\n\n  const rows = await (prisma as any).userIdentity.findMany({\n    where,\n    take: take + 1,\n    ...(opts.cursor ? { cursor: { id: opts.cursor }, skip: 1 } : {}),\n    orderBy,\n    select: {\n      id: true,\n      email: true,\n      adminRole: true,\n      accountStatus: true,\n      createdAt: true,\n      lastActiveAt: true,\n    },\n  });\n\n  const next = rows.length > take ? rows[take] : null;\n  const slice = rows.slice(0, take);\n  const items: AdminUserListItem[] = slice.map((r: any) => ({\n    userId: String(r.id),\n    email: String(r.email || \"\"),\n    role: (r.adminRole as AdminRole) || \"NONE\",\n    accountStatus: (r.accountStatus as any) || \"active\",\n    createdAt: toIso(r.createdAt),\n    lastActiveAt: toIso(r.lastActiveAt),\n  }));\n\n  return { items, nextCursor: next ? String(next.id) : null };\n}\n\nexport async function getUserAdminSafe(userId: string) {\n  const row = await (prisma as any).userIdentity.findUnique({\n    where: { id: userId },\n    select: {\n      id: true,\n      email: true,\n      adminRole: true,\n      accountStatus: true,\n      createdAt: true,\n      lastActiveAt: true,\n    },\n  });\n  if (!row) return null;\n  return {\n    userId: String(row.id),\n    email: String(row.email || \"\"),\n    role: (row.adminRole as AdminRole) || \"NONE\",\n    accountStatus: (row.accountStatus as any) || \"active\",\n    createdAt: toIso(row.createdAt),\n    lastActiveAt: toIso(row.lastActiveAt),\n  } satisfies AdminUserListItem;\n}\n\nexport async function setUserAdminRole(userId: string, role: AdminRole | null) {\n  await (prisma as any).userIdentity.update({\n    where: { id: userId },\n    data: { adminRole: role },\n  });\n}\n\nexport async function setUserAccountStatus(userId: string, status: \"active\" | \"suspended\" | \"pending\") {\n  await (prisma as any).userIdentity.update({\n    where: { id: userId },\n    data: { accountStatus: status },\n  });\n}\n\n\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/users/[id]/ui.client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/users/[id]/ui.client.tsx\",\n    \"default\",\n);\n","import AdminUserClient from \"./ui.client\";\nimport { getUserAdminSafe } from \"@/lib/admin/usersStore\";\n\nexport const metadata = {\n  title: \"Admin: User\",\n  robots: { index: false, follow: false },\n};\n\nexport default async function AdminUserDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const { id } = await params;\n  const user = await getUserAdminSafe(id);\n  if (!user) {\n    return (\n      <main className=\"mx-auto max-w-4xl px-4 py-10 md:px-6 lg:px-8 space-y-3\">\n        <h1 className=\"text-2xl font-semibold text-slate-900\">User not found</h1>\n        <p className=\"text-slate-700\">This user does not exist or is not accessible.</p>\n      </main>\n    );\n  }\n  return <AdminUserClient user={user} />;\n}\n\n\n"],"names":[],"mappings":"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","ignoreList":[1]}}]
}