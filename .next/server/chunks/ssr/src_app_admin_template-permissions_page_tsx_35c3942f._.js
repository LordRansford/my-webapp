;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="bcb1c608-3fd7-518a-37c3-6c69c74f68e3")}catch(e){}}();
module.exports=[552367,a=>{"use strict";var b=a.i(218282),c=a.i(572131);function d(){let[a,d]=(0,c.useState)([]),[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)({userId:"",templateId:"",expiresAt:"",notes:""}),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),m=async()=>{f(!0),j(null),l(null);try{let a=await fetch("/api/admin/permission-tokens"),b=await a.json();if(!a.ok){if(401===a.status||403===a.status)return void l(b?.message||"Admin access requires a valid admin_token cookie.");if(500===a.status&&b?.message)return void l(b.message);throw Error(b?.message||"Forbidden")}d(b.tokens||[])}catch(a){j(a.message||"Could not load tokens")}finally{f(!1)}};(0,c.useEffect)(()=>{m()},[]);let n=async()=>{if(k)return void j(k);f(!0),j(null);try{let a=await fetch("/api/admin/permission-tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g.userId||null,templateId:g.templateId||null,expiresAt:g.expiresAt||null,notes:g.notes||null})}),b=await a.json();if(!a.ok)throw Error(b?.message||"Could not create token");await m(),h({userId:"",templateId:"",expiresAt:"",notes:""})}catch(a){j(a.message||"Could not create token")}finally{f(!1)}},o=async a=>{f(!0),j(null);try{let b=await fetch(`/api/admin/permission-tokens?tokenId=${encodeURIComponent(a)}`,{method:"DELETE"}),c=await b.json();if(!b.ok)throw Error(c?.message||"Could not revoke token");await m()}catch(a){j(a.message||"Could not revoke token")}finally{f(!1)}};return k?(0,b.jsxs)("main",{className:"mx-auto max-w-4xl p-6",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"Admin access unavailable"}),(0,b.jsx)("p",{className:"text-sm text-slate-800",children:k}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Set ADMIN_DASHBOARD_TOKEN server side and present the admin_token cookie. All validation stays on the server."})]}):(0,b.jsxs)("main",{className:"mx-auto max-w-5xl p-6 space-y-4",children:[(0,b.jsxs)("header",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-sm font-semibold uppercase tracking-wide text-slate-600",children:"Admin"}),(0,b.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"Template permissions"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Issue and revoke permission tokens."})]}),(0,b.jsxs)("section",{className:"grid gap-3 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"space-y-1 text-sm text-slate-800",children:["User ID (optional)",(0,b.jsx)("input",{className:"w-full rounded-lg border border-slate-200 p-2",value:g.userId,onChange:a=>h(b=>({...b,userId:a.target.value})),placeholder:"user-123 or leave blank"})]}),(0,b.jsxs)("label",{className:"space-y-1 text-sm text-slate-800",children:["Template ID (optional)",(0,b.jsx)("input",{className:"w-full rounded-lg border border-slate-200 p-2",value:g.templateId,onChange:a=>h(b=>({...b,templateId:a.target.value})),placeholder:"template slug or leave blank"})]}),(0,b.jsxs)("label",{className:"space-y-1 text-sm text-slate-800",children:["Expires at (ISO, optional)",(0,b.jsx)("input",{className:"w-full rounded-lg border border-slate-200 p-2",value:g.expiresAt,onChange:a=>h(b=>({...b,expiresAt:a.target.value})),placeholder:"2026-01-01T00:00:00Z"})]}),(0,b.jsxs)("label",{className:"space-y-1 text-sm text-slate-800",children:["Notes",(0,b.jsx)("input",{className:"w-full rounded-lg border border-slate-200 p-2",value:g.notes,onChange:a=>h(b=>({...b,notes:a.target.value})),placeholder:"Who approved this"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:n,className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800",disabled:e,children:e?"Working...":"Create token"}),(0,b.jsx)("button",{type:"button",onClick:m,className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50",disabled:e,children:"Refresh"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Scope is fixed to commercial_remove_signature. Issuer is Ransford."})]}),(0,b.jsx)("section",{className:"overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm",children:(0,b.jsxs)("table",{className:"min-w-full text-left text-sm text-slate-800",children:[(0,b.jsx)("thead",{className:"bg-slate-50 text-sm font-semibold uppercase tracking-wide text-slate-600",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2",children:"Token"}),(0,b.jsx)("th",{className:"px-4 py-2",children:"User / anon"}),(0,b.jsx)("th",{className:"px-4 py-2",children:"Template"}),(0,b.jsx)("th",{className:"px-4 py-2",children:"Issued"}),(0,b.jsx)("th",{className:"px-4 py-2",children:"Expires"}),(0,b.jsx)("th",{className:"px-4 py-2",children:"Notes"}),(0,b.jsx)("th",{className:"px-4 py-2",children:"Actions"})]})}),(0,b.jsxs)("tbody",{children:[a.map(a=>(0,b.jsxs)("tr",{className:"border-t border-slate-100",children:[(0,b.jsx)("td",{className:"px-4 py-2 font-mono text-sm text-slate-800 break-all",children:a.tokenId}),(0,b.jsxs)("td",{className:"px-4 py-2 text-sm text-slate-800",children:[a.userId||"-"," / ",a.anonymousUserId||"-"]}),(0,b.jsx)("td",{className:"px-4 py-2",children:a.templateId||"Any"}),(0,b.jsx)("td",{className:"px-4 py-2 text-sm text-slate-800",children:new Date(a.issuedAt).toLocaleString()}),(0,b.jsx)("td",{className:"px-4 py-2 text-sm text-slate-800",children:a.expiresAt?new Date(a.expiresAt).toLocaleString():"No expiry"}),(0,b.jsx)("td",{className:"px-4 py-2 text-sm text-slate-800",children:a.notes||""}),(0,b.jsx)("td",{className:"px-4 py-2",children:(0,b.jsx)("button",{type:"button",onClick:()=>o(a.tokenId),className:"text-sm font-semibold text-rose-700 hover:underline",disabled:e,children:"Revoke"})})]},a.tokenId)),!a.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-slate-600",colSpan:7,children:"No tokens issued yet."})})]})]})}),i?(0,b.jsx)("p",{className:"text-sm font-semibold text-rose-700",children:i}):null]})}a.s(["default",()=>d])}];

//# debugId=bcb1c608-3fd7-518a-37c3-6c69c74f68e3
//# sourceMappingURL=src_app_admin_template-permissions_page_tsx_35c3942f._.js.map