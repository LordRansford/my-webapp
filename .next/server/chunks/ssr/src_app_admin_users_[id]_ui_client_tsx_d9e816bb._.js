;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6a101772-c258-a429-b712-0630405f50bc")}catch(e){}}();
module.exports=[520198,a=>{"use strict";var b=a.i(218282),c=a.i(572131),d=a.i(238246);function e(a){try{return new Date(a).toLocaleString()}catch{return a}}async function f(a,b){let c=await fetch(a,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(b)}),d=await c.json().catch(()=>({}));if(!c.ok)throw Error(d?.error||d?.message||"Request failed");return d}function g({user:a}){let[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(a.role),[o,p]=(0,c.useState)(a.accountStatus),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(0),[A,B]=(0,c.useState)(""),C=(0,c.useMemo)(()=>["NONE","READ_ONLY","SUPPORT","ADMIN","OWNER"],[]),D=(0,c.useMemo)(()=>["active","pending","suspended"],[]),E=async()=>{x("snapshot"),j(null);try{let b=await fetch(`/api/admin/users/${encodeURIComponent(a.userId)}/support-snapshot`),c=await b.json().catch(()=>({}));if(!b.ok)throw Error(c?.error||"Failed to load support snapshot");v({learnerProfile:c?.learnerProfile||null,credits:c?.credits?{balance:Number(c.credits.balance||0),expiresAt:c.credits.expiresAt||null}:null,creditLots:Array.isArray(c?.creditLots)?c.creditLots:[],purchases:Array.isArray(c?.purchases)?c.purchases:[],certificateEntitlements:Array.isArray(c?.certificateEntitlements)?c.certificateEntitlements:[],certificates:Array.isArray(c?.certificates)?c.certificates:[],assessmentAttempts:Array.isArray(c?.assessmentAttempts)?c.assessmentAttempts:[]})}catch(a){j(a.message||"Failed to load support snapshot")}finally{x(null)}},F=async()=>{j(null),l(null);let b=A.trim(),c=Math.max(0,Math.round(y||0));if(!b)return j("Reason is required.");if(!c)return j("Credits must be greater than zero.");if(confirm("Confirm credit grant")){x("grant");try{let d=await f(`/api/admin/users/${encodeURIComponent(a.userId)}/credits/grant`,{credits:c,reason:b});l(`Credits granted. New balance ${d?.balance??"updated"}.`),z(0),B(""),await E()}catch(a){j(a.message||"Failed to grant credits.")}finally{x(null)}}},G=async()=>{j(null),l(null);let b=q.trim();if(!b)return j("Reason is required.");if(confirm("Confirm role change")){h("role");try{await f(`/api/admin/users/${encodeURIComponent(a.userId)}/role`,{role:m,reason:b}),l("Role updated."),r("")}catch(a){j(a.message||"Failed to update role.")}finally{h(null)}}},H=async()=>{j(null),l(null);let b=s.trim();if(!b)return j("Reason is required.");if(confirm("Confirm status change")){h("status");try{await f(`/api/admin/users/${encodeURIComponent(a.userId)}/status`,{status:o,reason:b}),l("Status updated."),t("")}catch(a){j(a.message||"Failed to update status.")}finally{h(null)}}};return(0,b.jsxs)("main",{className:"mx-auto max-w-4xl px-4 py-10 md:px-6 lg:px-8 space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"Users"}),(0,b.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:a.email}),(0,b.jsxs)("p",{className:"text-xs text-slate-600 font-mono",children:["User ID: ",a.userId]})]}),(0,b.jsx)(d.default,{href:"/admin/users",className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-400",children:"Back to users"})]}),i?(0,b.jsx)("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-900",children:i}):null,k?(0,b.jsx)("div",{className:"rounded-2xl border border-emerald-200 bg-emerald-50 p-4 text-sm text-emerald-900",children:k}):null,(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Profile summary"}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Created"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-900",children:e(a.createdAt)})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Last active"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-900",children:e(a.lastActiveAt)})]})]})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Support snapshot"}),(0,b.jsx)("button",{type:"button",className:"rounded-full border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-50 disabled:opacity-60",disabled:null!==w,onClick:E,children:"snapshot"===w?"Loading...":u?"Refresh":"Load"})]}),u?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Certificate name"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-900",children:u.learnerProfile?.certificateName||"Not set"}),(0,b.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:u.learnerProfile?.lockedAt?`Locked ${e(u.learnerProfile.lockedAt)}`:""})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Credits"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-900",children:u.credits?u.credits.balance:0}),(0,b.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:u.credits?.expiresAt?`Expires ${e(u.credits.expiresAt)}`:""})]})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 space-y-3",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Grant credits"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("label",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Credits"}),(0,b.jsx)("input",{type:"number",min:0,value:y,onChange:a=>z(Number(a.target.value)||0),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2"})]}),(0,b.jsxs)("label",{className:"space-y-1 md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Reason"}),(0,b.jsx)("input",{value:A,onChange:a=>B(a.target.value),placeholder:"Required",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2"})]})]}),(0,b.jsx)("button",{type:"button",className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:bg-slate-300",disabled:null!==w,onClick:F,children:"grant"===w?"Granting...":"Grant credits"})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Recent assessment attempts"}),(u.assessmentAttempts||[]).length?(0,b.jsx)("div",{className:"space-y-2",children:(u.assessmentAttempts||[]).slice(0,6).map(a=>(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:a.passed?"Pass":"Not passed"}),(0,b.jsxs)("div",{className:"text-xs text-slate-700",children:["Score ",a.score," percent"]}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:a.courseVersion}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:e(a.completedAt)})]},a.id))}):(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"No attempts recorded."})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Certificate entitlements"}),(u.certificateEntitlements||[]).length?(0,b.jsx)("div",{className:"space-y-2",children:(u.certificateEntitlements||[]).slice(0,6).map(a=>(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:a.courseId}),(0,b.jsx)("div",{className:"text-xs text-slate-700",children:a.status}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:e(a.updatedAt)})]},a.id))}):(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"No entitlements."})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Certificates"}),(u.certificates||[]).length?(0,b.jsx)("div",{className:"space-y-2",children:(u.certificates||[]).slice(0,6).map(a=>(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:a.courseId}),(0,b.jsx)("div",{className:"text-xs text-slate-700",children:a.status}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:a.courseVersion}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:e(a.issuedAt)})]},a.id))}):(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"No certificates issued."})]})]}):(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Load a single view of credits, purchases, attempts, and certificate state for support work."})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Roles and permissions"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Role changes require a reason and are audited."}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("label",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Role"}),(0,b.jsx)("select",{value:m,onChange:a=>n(a.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2",children:C.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsxs)("label",{className:"space-y-1 md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Reason"}),(0,b.jsx)("input",{value:q,onChange:a=>r(a.target.value),placeholder:"Required",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2"})]})]}),(0,b.jsx)("button",{type:"button",className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:bg-slate-300",disabled:null!==g,onClick:G,children:"role"===g?"Updating...":"Change role"})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Account status"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:"Status changes require a reason and are audited."}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("label",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Status"}),(0,b.jsx)("select",{value:o,onChange:a=>p(a.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2",children:D.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsxs)("label",{className:"space-y-1 md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-700",children:"Reason"}),(0,b.jsx)("input",{value:s,onChange:a=>t(a.target.value),placeholder:"Required",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2"})]})]}),(0,b.jsx)("button",{type:"button",className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:bg-slate-300",disabled:null!==g,onClick:H,children:"status"===g?"Updating...":"Change status"})]})]})}a.s(["default",()=>g])}];

//# debugId=6a101772-c258-a429-b712-0630405f50bc
//# sourceMappingURL=src_app_admin_users_%5Bid%5D_ui_client_tsx_d9e816bb._.js.map