;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="5724a34c-c53a-079c-79d5-f338b4183045")}catch(e){}}();
module.exports=[685750,e=>{"use strict";let t,a;var r=e.i(124594);let i=Number.isFinite(a=(t=process.env.CREDITS_EXPIRY_DAYS)?Number(t):NaN)&&a>0?Math.floor(a):730;async function s(e){let t=await r.prisma.credits.findUnique({where:{userId:e}});return t||await r.prisma.credits.create({data:{userId:e,balance:0,expiresAt:null}})}async function n(){return{totalUsersWithCredits:await r.prisma.credits.count(),totalCredits:(await r.prisma.credits.aggregate({_sum:{balance:!0}}))._sum.balance??0}}async function o(e){let t=await r.prisma.credits.findUnique({where:{userId:e}});if(!t)return null;if(!t.expiresAt)return t;let a=new Date;return t.expiresAt.getTime()>a.getTime()?t:await r.prisma.credits.update({where:{userId:e},data:{balance:0}})}async function u(e){return r.prisma.creditUsageEvent.create({data:{userId:e.userId,toolId:e.toolId,consumed:e.consumed,units:e.units,freeUnits:e.freeUnits,paidUnits:e.paidUnits,runId:e.runId||null,baseFree:!!e.baseFree,estimatedCredits:Math.max(0,Math.round(Number(e.estimatedCredits)||0)),actualCredits:Math.max(0,Math.round(Number(e.actualCredits)||0)),meteringUnit:e.meteringUnit||"ms",durationMs:Math.max(0,Math.round(Number(e.durationMs)||0)),inputBytes:Math.max(0,Math.round(Number(e.inputBytes)||0)),outputBytes:Math.max(0,Math.round(Number(e.outputBytes)||0)),freeTierAppliedMs:Math.max(0,Math.round(Number(e.freeTierAppliedMs)||0)),paidMs:Math.max(0,Math.round(Number(e.paidMs)||0))}})}async function l(e,t=50){return r.prisma.creditUsageEvent.findMany({where:{userId:e},orderBy:{occurredAt:"desc"},take:Math.max(1,Math.min(200,t))})}function d(e=new Date){let t;return(t=new Date(e)).setDate(t.getDate()+i),t}async function c(e){let t=Math.max(0,Math.round(Number(e.credits)||0));return r.prisma.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:e.expiresAt||null}})}async function p(e){let t=Math.max(0,Math.round(Number(e.credits)||0));if(!t)return{ok:!1,balance:null};let a=d(new Date);return await r.prisma.$transaction(async r=>{let i=await r.credits.findUnique({where:{userId:e.userId}}),s=(i?.balance??0)+t,n=await r.credits.upsert({where:{userId:e.userId},update:{balance:s,expiresAt:i?.expiresAt&&i.expiresAt>a?i.expiresAt:a},create:{userId:e.userId,balance:s,expiresAt:a}});return await r.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:a}}),{ok:!0,balance:n.balance}})}e.s(["computeNewExpiry",()=>d,"createCreditLot",()=>c,"createCreditUsageEvent",()=>u,"enforceCreditExpiry",()=>o,"getCreditsAggregate",()=>n,"getOrCreateCredits",()=>s,"grantCredits",()=>p,"listCreditUsage",()=>l])},356846,e=>{"use strict";var t=e.i(124594);async function a(e){let a=Math.max(0,Math.round(Number(e.credits)||0));return a?t.prisma.$transaction(async t=>{let r=e.userId,i=await t.credits.findUnique({where:{userId:r}}),s=i?.balance??0;if(s<a)return{ok:!1,remainingBalance:s};let n=await t.creditLot.findMany({where:{userId:r,OR:[{remainingCredits:{gt:0}},{remainingCredits:0,credits:{gt:0}}]},orderBy:[{expiresAt:"asc"},{purchasedAt:"asc"},{createdAt:"asc"}],take:200}),o=a;for(let e of n){if(o<=0)break;let a=Math.max(0,e.remainingCredits||e.credits||0);if(!a)continue;let r=Math.min(a,o);o-=r,await t.creditLot.update({where:{id:e.id},data:{remainingCredits:Math.max(0,a-r),amountCredits:e.amountCredits&&e.amountCredits>0?e.amountCredits:e.credits}})}return o>0?{ok:!1,remainingBalance:s}:{ok:!0,remainingBalance:(await t.credits.update({where:{userId:r},data:{balance:s-a}})).balance}}):{ok:!0,remainingBalance:null}}e.s(["deductCreditsFromLots",()=>a])},76657,e=>{"use strict";var t=e.i(124594),a=e.i(749649);e.i(116575);var r=e.i(519894),i=e.i(969751);function s(e,t,a){let r="number"==typeof e?e:Number(e);return Number.isFinite(r)?Math.max(t,Math.min(a,Math.round(r))):t}async function n(e){var n;let o,u,l=String(e.toolId||"").trim(),d=s(e.inputBytes,0,25e6),c=(n={toolId:l,inputBytes:d,preset:e.requestedComplexityPreset},u=(o=(0,a.getToolComputeProfile)(n.toolId))?Math.max(200,120*o.typicalSteps):600,s(u*(o?Math.max(.5,n.inputBytes/Math.max(1,o.typicalInputBytes)):Math.max(.5,n.inputBytes/1e3))*("light"===n.preset?.6:"heavy"===n.preset?1.8:1),50,r.MAX_RUN_MS_HARD_CAP));if(c>r.MAX_RUN_MS_HARD_CAP)return{allowed:!1,reason:"This run is too large for safety limits. Reduce input size or use a lighter preset.",estimatedDurationMs:c,estimatedCredits:0,freeTierRemainingMs:0,willChargeCredits:!1,requiredCreditsIfAny:0};let p=e.userId,m=p?await (0,i.getUserFreeMsRemainingToday)(p):(0,i.getAnonFreeMsRemainingToday)(e.req);if(d>(p?r.MAX_UPLOAD_BYTES_PAID:r.MAX_UPLOAD_BYTES_FREE))return{allowed:!1,reason:"Input is too large for this run. Reduce the size and try again.",estimatedDurationMs:c,estimatedCredits:0,freeTierRemainingMs:m,willChargeCredits:!1,requiredCreditsIfAny:0};let h=Math.max(0,c-m),y=h>0?Math.ceil(h/r.CREDIT_MS_PER_1):0,g=y>0;if(!p&&g)return{allowed:!1,reason:"Sign in to run beyond the free tier. Free usage stays free.",estimatedDurationMs:c,estimatedCredits:y,freeTierRemainingMs:m,willChargeCredits:!0,requiredCreditsIfAny:y};if(p&&g){let e=await t.prisma.credits.findUnique({where:{userId:p}}),a=e?.balance??0,r=Math.ceil(1.25*y);if(a<r)return{allowed:!1,reason:"Not enough credits for the expected paid portion. Use a lighter preset or reduce input size.",estimatedDurationMs:c,estimatedCredits:y,freeTierRemainingMs:m,willChargeCredits:!0,requiredCreditsIfAny:r}}return{allowed:!0,reason:null,estimatedDurationMs:c,estimatedCredits:y,freeTierRemainingMs:m,willChargeCredits:g,requiredCreditsIfAny:y,freeTierMsPerDay:r.FREE_TIER_MS_PER_DAY,creditMsPer1:r.CREDIT_MS_PER_1}}e.s(["estimateRunCost",()=>n])},749649,e=>{"use strict";let t={"mentor-query":{toolId:"mentor-query",maxInputBytesFreeAnon:1e3,maxInputBytesFreeAuthed:6e3,maxRunMsHardCap:6e4,freeMsPerDayAuthed:3e4,freeMsPerDayAnon:8e3,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0},"whois-summary":{toolId:"whois-summary",maxInputBytesFreeAnon:300,maxInputBytesFreeAuthed:2e3,maxRunMsHardCap:2e4,freeMsPerDayAuthed:6e4,freeMsPerDayAnon:15e3,creditsPerMsPaid:5e-5,allowAnonymous:!0,allowAuthed:!0},"templates-request-download":{toolId:"templates-request-download",maxInputBytesFreeAnon:600,maxInputBytesFreeAuthed:2e3,maxRunMsHardCap:3e4,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:0,creditsPerMsPaid:1e-4,allowAnonymous:!1,allowAuthed:!0},"sandbox-echo":{toolId:"sandbox-echo",maxInputBytesFreeAnon:2e3,maxInputBytesFreeAuthed:1e4,maxRunMsHardCap:15e3,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:1e4,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0},"code-runner":{toolId:"code-runner",maxInputBytesFreeAnon:6500,maxInputBytesFreeAuthed:6500,maxRunMsHardCap:8e3,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:1e4,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0}};function a(e){return t[e]||null}let r={"dns-email-security-dashboard":{toolId:"dns-email-security-dashboard",label:"DNS email security",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Shorter inputs reduce retries.","Repeated checks of the same domain usually add little value. Try a different domain or a different tool."],scenarios:[{title:"Typical runs",estimateNote:"Most runs are small and fit in the free tier.",mediumRunsPerTenCredits:120,browserOnlyCostsZero:!1}]},"https-redirect-checker":{toolId:"https-redirect-checker",label:"HTTPS redirect checker",computeClass:"B",typicalInputBytes:200,typicalSteps:6,guidance:["Short redirect chains cost less.","If you only need the final destination, do one check per key entry page."],scenarios:[{title:"Redirect chains",estimateNote:"Costs rise with chain length.",mediumRunsPerTenCredits:80}]},"website-security-lab":{toolId:"website-security-lab",label:"Website security lab",computeClass:"B",typicalInputBytes:240,typicalSteps:6,guidance:["Test one representative URL per site, then expand.","Avoid long redirect chains or many subpaths unless needed."]},"email-header-phishing-lab":{toolId:"email-header-phishing-lab",label:"Email header lab",computeClass:"B",typicalInputBytes:6e3,typicalSteps:1,guidance:["Paste headers only, not the message body.","Trim the header block to the relevant hops if it is extremely long."]},"phishing-link-explainer":{toolId:"phishing-link-explainer",label:"Phishing link explainer",computeClass:"B",typicalInputBytes:300,typicalSteps:2,guidance:["Short URLs and fewer redirects reduce work.","Run a second check only if the context changed."]},"third-party-script-viewer":{toolId:"third-party-script-viewer",label:"Third party script viewer",computeClass:"B",typicalInputBytes:200,typicalSteps:4,guidance:["Use one representative page per application area.","Focus on scripts that run on authenticated pages first."]},"dns-lookup":{toolId:"dns-lookup",label:"DNS lookup",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Use one hostname at a time."]},"tls-inspect":{toolId:"tls-inspect",label:"TLS inspect",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Use a hostname rather than an IP.","Retry only after you confirm the service is up."]},"whois-summary":{toolId:"whois-summary",label:"WHOIS summary",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Compare results with context and expected registrant."]},"ip-reputation":{toolId:"ip-reputation",label:"IP reputation",computeClass:"B",typicalInputBytes:60,typicalSteps:1,guidance:["Combine with logs and behavioural indicators."]},"mentor-query":{toolId:"mentor-query",label:"Mentor",computeClass:"B",typicalInputBytes:2e3,typicalSteps:6,guidance:["Ask one focused question at a time.","Include the page link so the match is tighter.","Shorter questions usually respond faster."]},"templates-request-download":{toolId:"templates-request-download",label:"Template download request",computeClass:"B",typicalInputBytes:800,typicalSteps:3,guidance:["Choose one template at a time.","Keep the requested use clear and short."]},"model-forge-train":{toolId:"model-forge-train",label:"Model Forge training",computeClass:"B",typicalInputBytes:25e4,typicalSteps:200,fileLimits:{freeMaxBytes:358400,paidMaxBytes:2097152,absoluteMaxBytes:4194304},guidance:["Start with fewer rows and fewer epochs.","Try one target column at a time.","Avoid high-cardinality text columns in a tabular demo."],scenarios:[{title:"Small CSV",estimateNote:"A small CSV with light training usually fits in the free tier.",mediumRunsPerTenCredits:40},{title:"Bigger dataset",estimateNote:"Larger datasets and more iterations can exceed the free tier.",largeRunCredits:2}]},"software-tradeoff-sim":{toolId:"software-tradeoff-sim",label:"Engineering trade-off simulator",computeClass:"A",typicalInputBytes:400,typicalSteps:50,guidance:["Keep constraints realistic.","Change one variable at a time so you can explain causality.","Write down the decision rule you are using."]},"data-roadmap-sim":{toolId:"data-roadmap-sim",label:"Data and digitalisation roadmap simulator",computeClass:"A",typicalInputBytes:600,typicalSteps:60,guidance:["Keep the first pass simple: purpose, owners, and controls.","Improve quality at source before building bigger dashboards.","Write down your decision rule."]},"cyber-risk-sim":{toolId:"cyber-risk-sim",label:"Cyber risk mapping simulator",computeClass:"A",typicalInputBytes:700,typicalSteps:70,guidance:["Start with one asset and one realistic threat.","Pick controls you can operate and measure.","Write the acceptance criteria for residual risk."]},"ai-prompt-compare":{toolId:"ai-prompt-compare",label:"Prompt comparison playground",computeClass:"A",typicalInputBytes:2e3,typicalSteps:40,guidance:["Compare small prompt changes only.","Write what success looks like before you run.","Treat results as illustrative, not definitive."]},"ai-consistency-test":{toolId:"ai-consistency-test",label:"Output consistency tester",computeClass:"A",typicalInputBytes:2500,typicalSteps:80,guidance:["Run a few samples first, then increase.","Separate prompt quality from model randomness.","Log both the prompt and the settings."]},"ai-bias-sim":{toolId:"ai-bias-sim",label:"Bias scenario explorer",computeClass:"A",typicalInputBytes:1500,typicalSteps:90,guidance:["Bias often comes from data and labels, not intent.","Check base rates before blaming the model.","Always define who is harmed by errors."]},"ai-behaviour-compare":{toolId:"ai-behaviour-compare",label:"Model behaviour comparison (simulated)",computeClass:"A",typicalInputBytes:2200,typicalSteps:70,guidance:["Compare behaviours, not vibes.","Look for quiet failures and edge cases.","Decide when not to use AI."]},"ai-story-generator":{toolId:"ai-story-generator",label:"Story generator (safe demo)",computeClass:"A",typicalInputBytes:160,typicalSteps:40,guidance:["Keep prompts short for cheaper runs.","Add detail gradually.","Use child-friendly language for child projects."]},"ai-homework-helper":{toolId:"ai-homework-helper",label:"Homework helper (safe demo)",computeClass:"A",typicalInputBytes:220,typicalSteps:55,guidance:["Write the exact equation if possible.","Ask for steps, not just answers.","Check the final answer by substitution."]},"ai-support-bot":{toolId:"ai-support-bot",label:"Support bot (safe demo)",computeClass:"A",typicalInputBytes:220,typicalSteps:55,guidance:["Keep one intent per message (return/refund/delivery).","Avoid sensitive personal data in demos.","Save strong replies as templates."]},"studio-help-assistant":{toolId:"studio-help-assistant",label:"Studios help assistant",computeClass:"A",typicalInputBytes:420,typicalSteps:70,guidance:["Ask one clear question at a time.","Paste your requirements to tailor examples.","Use the light preset for cheaper runs."]}};function i(e){return e&&r[e]||null}e.s(["COMPUTE_TIER",0,{freeUnitsPerRun:7500,freeUnitsPerSession:3e4,creditUnitsPerCredit:25e3},"getJobRunnerToolLimits",()=>a,"getToolComputeProfile",()=>i])},969751,519894,116575,e=>{"use strict";var t=e.i(666680),a=e.i(124594);function r(e,t){let a=process.env[e],r=a?Number(a):NaN;return Number.isFinite(r)&&r>=0?Math.floor(r):t}let i=r("FREE_TIER_MS_PER_DAY",6e4),s=r("CREDIT_MS_PER_1",1e4),n=r("MAX_RUN_MS_HARD_CAP",3e5),o=r("MAX_UPLOAD_BYTES_FREE",307200),u=r("MAX_UPLOAD_BYTES_PAID",2097152);function l(e=new Date){let t=new Date(e);return t.setUTCHours(0,0,0,0),t}async function d(e){let t=l();return(await a.prisma.creditUsageEvent.findMany({where:{userId:e,occurredAt:{gte:t}},select:{freeTierAppliedMs:!0},take:1e4})).reduce((e,t)=>e+(Number(t.freeTierAppliedMs)||0),0)}async function c(e){return Math.max(0,i-await d(e))}e.s(["CREDIT_MS_PER_1",0,s,"FREE_TIER_MS_PER_DAY",0,i,"MAX_RUN_MS_HARD_CAP",0,n,"MAX_UPLOAD_BYTES_FREE",0,o,"MAX_UPLOAD_BYTES_PAID",0,u],519894),e.s([],116575);let p=new Map;function m(e){var a;let r=e.headers.get("x-forwarded-for")||"",i=r.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",s=e.headers.get("user-agent")||"unknown";return a=`${i}|${s}`,t.default.createHash("sha256").update(a).digest("hex").slice(0,24)}function h(e){let t=Date.now(),a=m(e),r=l(new Date(t+864e5)).getTime(),s=p.get(a);return!s||s.resetAt<=t?(p.set(a,{usedMs:0,resetAt:r}),i):Math.max(0,i-s.usedMs)}function y(e,t){let a=Date.now(),r=m(e),i=l(new Date(a+864e5)).getTime(),s=p.get(r);!s||s.resetAt<=a?p.set(r,{usedMs:Math.max(0,Math.round(t)),resetAt:i}):s.usedMs+=Math.max(0,Math.round(t))}e.s(["addAnonUsageMs",()=>y,"getAnonFreeMsRemainingToday",()=>h,"getUserFreeMsRemainingToday",()=>c],969751)},363984,e=>{"use strict";var t=e.i(666680),a=e.i(124594),r=e.i(76657);e.i(116575);var i=e.i(519894),s=e.i(969751),n=e.i(356846),o=e.i(685750),u=e.i(749649);function l(){return Date.now()}function d(e){let t="number"==typeof e?e:Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):0}async function c(e){let c=t.default.randomUUID(),p=String(e.toolId||"").trim(),m=d(e.inputBytes),h=await (0,r.estimateRunCost)({req:e.req,userId:e.userId,toolId:p,inputBytes:m,requestedComplexityPreset:e.requestedComplexityPreset});if(!h.allowed)return{ok:!1,status:400,message:h.reason||"Run not allowed",estimate:h};let y=e.userId?await (0,s.getUserFreeMsRemainingToday)(e.userId):(0,s.getAnonFreeMsRemainingToday)(e.req);if(h.willChargeCredits&&!e.userId)return{ok:!1,status:401,message:"Sign in required for runs above the free tier.",estimate:h};let g=l(),f=await e.execute(),I=Math.min(i.MAX_RUN_MS_HARD_CAP,Math.max(0,l()-g)),M=d(f.outputBytes),C=Math.min(I,y),A=Math.max(0,I-C),w=A>0?Math.ceil(A/i.CREDIT_MS_PER_1):0,b=(0,u.getToolComputeProfile)(p),x=b?.guidance?.slice(0,4)||["Reduce input size.","Use the light preset.","Limit iterations or scope.","Use sampling for large datasets."];if(!e.userId)return(0,s.addAnonUsageMs)(e.req,C),{ok:!0,receipt:{runId:c,toolId:p,mode:"compute",durationMs:I,inputBytes:m,outputBytes:M,freeTierAppliedMs:C,paidMs:0,creditsCharged:0,remainingCredits:null,guidanceTips:x},output:f.output};let B=e.userId;await (0,o.getOrCreateCredits)(B);let P=null;if(w>0){let e=await (0,n.deductCreditsFromLots)({userId:B,credits:w});if(!e.ok)return{ok:!1,status:402,message:"Insufficient credits for the paid portion. Use a lighter preset or reduce input size.",estimate:h};P=e.remainingBalance}else{let e=await a.prisma.credits.findUnique({where:{userId:B}});P=e?.balance??0}return await (0,o.createCreditUsageEvent)({userId:B,toolId:p,consumed:w,units:I,freeUnits:C,paidUnits:A,runId:c,baseFree:0===w,estimatedCredits:h.estimatedCredits||0,actualCredits:w,meteringUnit:"ms",durationMs:I,inputBytes:m,outputBytes:M,freeTierAppliedMs:C,paidMs:A}),{ok:!0,receipt:{runId:c,toolId:p,mode:"compute",durationMs:I,inputBytes:m,outputBytes:M,freeTierAppliedMs:C,paidMs:A,creditsCharged:w,remainingCredits:P,guidanceTips:x},output:f.output}}e.s(["runWithMetering",()=>c])}];

//# debugId=5724a34c-c53a-079c-79d5-f338b4183045
//# sourceMappingURL=src_9e473c5f._.js.map