;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="4972f76c-b981-0b21-5bbb-e1c5bf8e5930")}catch(e){}}();
module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},124594,e=>{"use strict";var t=e.i(29173);process.env.DATABASE_URL||(process.env.DATABASE_URL="file:./data/dev.db");let r=global.__prisma||new t.PrismaClient({log:["error"]});e.s(["prisma",0,r])},657194,e=>{"use strict";var t=e.i(89171),r=e.i(254799);let o=new Map;function n(e,n){var a,s;let i,l,u,c=Date.now(),p=`${n.keyPrefix}:${(a=n.keySuffix,i=e.headers.get("x-forwarded-for")||"",l=i.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",u=e.headers.get("user-agent")||"unknown",s=`${l}|${u}|${a||""}`,r.default.createHash("sha256").update(s).digest("hex").slice(0,24))}`,d=o.get(p);if(!d||d.resetAt<=c)return o.set(p,{count:1,resetAt:c+n.windowMs}),null;if(d.count+=1,d.count>n.limit){let e=Math.max(1,Math.ceil((d.resetAt-c)/1e3));return t.NextResponse.json({error:n.message||"Too many requests. Please try again shortly."},{status:429,headers:{"retry-after":String(e)}})}return null}e.s(["rateLimit",()=>n])},936426,e=>{"use strict";var t=e.i(89171);function r(e){let r=e.headers.get("origin"),o=e.headers.get("referer"),n=function(){try{return new URL(process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000").origin}catch{return"http://localhost:3000"}}(),a=r||(o?(()=>{try{return new URL(o).origin}catch{return null}})():null);return a?a!==n?t.NextResponse.json({error:"Invalid origin"},{status:403}):null:t.NextResponse.json({error:"Missing origin"},{status:403})}e.s(["requireSameOrigin",()=>r])},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},895968,e=>{"use strict";var t=e.i(254799);function r(e){return e.headers.get("x-request-id")||t.default.randomUUID()}async function o(e,t,o){let n=r(e),a=Date.now();try{let e=await o({requestId:n}),r=Date.now()-a;return console.info("req",{requestId:n,route:t.route,status:"ok",durationMs:r}),e}catch(r){let e=Date.now()-a;throw console.error("req",{requestId:n,route:t.route,status:"error",durationMs:e,message:r?.message||"error"}),r}}e.s(["getRequestId",()=>r,"withRequestLogging",()=>o])},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},751232,707986,e=>{"use strict";var t=e.i(902157),r=e.i(750227);let o=new Set(["a","an","and","are","as","at","be","by","can","do","does","for","from","how","i","in","is","it","of","on","or","the","this","to","what","when","where","why","with","you","your"]);function n(e,a,s=6){let i=String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean).filter(e=>e.length>=2&&!o.has(e)).slice(0,15);if(!(i=function(e){let t=new Set(e);for(let r of e)("digitalisation"===r||"digitalization"===r)&&(t.add("digitalisation"),t.add("digitalization"),t.add("digital"),t.add("digitize"),t.add("digitise")),"digital"===r&&(t.add("digitalisation"),t.add("digitalization"));return Array.from(t)}(i)).length)return{matches:[],weak:!0};let l=function(){let e=r.default.join(process.cwd(),"public","content-index.json");if(!t.default.existsSync(e))throw Error("Missing public/content-index.json. Run npm run build:content-index.");return JSON.parse(t.default.readFileSync(e,"utf8"))}(),u=[];for(let e of l.pages){let t=a&&e.route===a?6:a&&e.route.startsWith(a.split("/")[1]||"")?1:0,r=e.title.toLowerCase(),o=0;for(let e of i)r.includes(e)&&(o+=3);for(let r of e.sections){if(!r.anchor)continue;let n=function(e,t,r){let o=t.title.toLowerCase(),n=(t.excerpt||"").toLowerCase(),a=`${o} ${n}`,s=0;for(let t of e){if(!t)continue;o===t||o.includes(` ${t} `)||o.startsWith(`${t} `)||o.endsWith(` ${t}`)?s+=8:o.includes(t)&&(s+=5);let e=RegExp(`\\b${t}\\b`,"gi"),r=a.match(e);if(r&&(s+=1.5*r.length),t.length>=4){let e=RegExp(t,"gi"),o=a.match(e);o&&o.length>(r?.length||0)&&(s+=(o.length-(r?.length||0))*.5)}}return Math.round(s+r)}(i,r,t+o);n<=0||u.push({title:r.title,href:`${e.route}#${r.anchor}`,why:r.excerpt?r.excerpt.slice(0,200):"Relevant section in the notes.",pageTitle:e.title,pageRoute:e.route,anchor:r.anchor,score:n})}o>=3&&!u.some(t=>t.pageRoute===e.route)&&u.push({title:e.title,href:e.route,why:`Page about ${e.title}`,pageTitle:e.title,pageRoute:e.route,anchor:"",score:o})}u.sort((e,t)=>t.score-e.score);let c=u.slice(0,s),p=0===c.length||c[0].score<2;return{matches:c,weak:p}}async function a(e,t){let r=process.env.OPENAI_API_KEY,o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:t.model,messages:[{role:"system",content:"You are a helpful learning mentor for Ransford's Notes, a website about cybersecurity, AI, software architecture, data, and digitalisation. You answer questions based ONLY on the provided context from the website. You provide clear, practical explanations with links to relevant pages. You never make up information that isn't in the context. If the context doesn't contain enough information to answer the question, you say so and suggest where the user might find more information on the website."},{role:"user",content:e}],max_tokens:t.maxTokens,temperature:t.temperature})});if(!o.ok){let e=await o.text();throw Error(`OpenAI API error: ${o.status} ${e}`)}let n=await o.json();return{answer:n.choices?.[0]?.message?.content||"",tokensUsed:n.usage?.total_tokens,provider:"openai"}}async function s(e,t){let r=process.env.TOGETHER_API_KEY,o=await fetch("https://api.together.xyz/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:t.model,messages:[{role:"system",content:"You are a helpful learning mentor for Ransford's Notes, a website about cybersecurity, AI, software architecture, data, and digitalisation. You answer questions based ONLY on the provided context from the website. You provide clear, practical explanations with links to relevant pages. You never make up information that isn't in the context. If the context doesn't contain enough information to answer the question, you say so and suggest where the user might find more information on the website."},{role:"user",content:e}],max_tokens:t.maxTokens,temperature:t.temperature})});if(!o.ok){let e=await o.text();throw Error(`Together.ai API error: ${o.status} ${e}`)}let n=await o.json();return{answer:n.choices?.[0]?.message?.content||"",tokensUsed:n.usage?.total_tokens,provider:"together"}}async function i(e,t){let r=process.env.OLLAMA_BASE_URL||"http://localhost:11434",o=await fetch(`${r}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.model,messages:[{role:"system",content:"You are a helpful learning mentor for Ransford's Notes, a website about cybersecurity, AI, software architecture, data, and digitalisation. You answer questions based ONLY on the provided context from the website. You provide clear, practical explanations with links to relevant pages. You never make up information that isn't in the context. If the context doesn't contain enough information to answer the question, you say so and suggest where the user might find more information on the website."},{role:"user",content:e}],options:{num_predict:t.maxTokens,temperature:t.temperature},stream:!1})});if(!o.ok){let e=await o.text();throw Error(`Ollama API error: ${o.status} ${e}`)}let n=await o.json();return{answer:n.message?.content||"",provider:"ollama"}}async function l(e,t,r,o=15e3){let n,u,c=process.env.OPENAI_API_KEY?{provider:"openai",model:process.env.OPENAI_MODEL||"gpt-4o-mini",maxTokens:800,temperature:.3}:process.env.TOGETHER_API_KEY?{provider:"together",model:process.env.TOGETHER_MODEL||"meta-llama/Llama-3.1-8B-Instruct-Turbo",maxTokens:800,temperature:.3}:process.env.OLLAMA_BASE_URL?{provider:"ollama",model:process.env.OLLAMA_MODEL||"llama3.2",maxTokens:800,temperature:.3}:{provider:"none"};if("none"===c.provider)return null;let p=(n=[],r?.title&&n.push(`Current page: ${r.title} (${r.pathname||""})`),n.push("\nRelevant content from the website:\n"),t.forEach((e,t)=>{let r=e.excerpt||e.text||e.why||"";n.push(`
[Source ${t+1}: ${e.title}]`),n.push(`URL: ${e.href}`),n.push(`Content: ${r}`)}),u=n.join("\n"),`Answer the following question based ONLY on the context provided below. If the context doesn't contain enough information, say so clearly and suggest relevant pages from the website where the user can learn more.

Question: ${e}

${u}

Instructions:
- Answer the question using only information from the context above
- Include the exact URLs from the context in your answer using markdown links like [Page Title](URL)
- If explaining how to use a tool, provide step-by-step instructions based on the context
- If the context is about a concept (like "digitalisation"), provide a clear explanation with links
- Never make up information that isn't in the context
- If multiple sources are relevant, reference them all

Answer:`),d=new AbortController,h=setTimeout(()=>d.abort(),o);try{let e;switch(c.provider){case"openai":e=await a(p,c);break;case"together":e=await s(p,c);break;case"ollama":e=await i(p,c);break;default:return null}return clearTimeout(h),e}catch(e){if(clearTimeout(h),e instanceof Error&&"AbortError"===e.name)throw Error("LLM request timed out");throw e}}e.s(["retrieveContent",()=>n],751232),e.s(["generateAnswer",()=>l],707986)}];

//# debugId=4972f76c-b981-0b21-5bbb-e1c5bf8e5930
//# sourceMappingURL=%5Broot-of-the-server%5D__a372fe40._.js.map