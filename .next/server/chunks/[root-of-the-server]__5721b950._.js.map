{
  "version": 3,
  "sources": [],
  "debugId": "f8340dcc-eac7-74f1-c849-9cf9b385f687",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../src/lib/security/rateLimit.ts","../../../src/lib/security/origin.ts","../../../src/lib/security/requestLog.ts","../../../src/server/logger.ts","../../../src/lib/cpd/courseVersion.ts","../../../src/lib/cpd/calculations.core.js","../../../src/lib/cpd/calculations.ts","../../../src/server/http.ts","../../../src/server/errors.ts","../../../src/lib/learning/records.core.js","../../../src/lib/learning/records.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport crypto from \"crypto\";\n\ntype Options = {\n  keyPrefix: string;\n  limit: number;\n  windowMs: number;\n  keySuffix?: string;\n  message?: string;\n};\n\ntype Entry = { count: number; resetAt: number };\n\nconst buckets = new Map<string, Entry>();\n\nfunction hash(value: string) {\n  return crypto.createHash(\"sha256\").update(value).digest(\"hex\").slice(0, 24);\n}\n\nfunction getClientKey(req: Request, keySuffix?: string) {\n  // Privacy: we do not persist IPs; we only keep a short-lived hash in memory.\n  const forwarded = req.headers.get(\"x-forwarded-for\") || \"\";\n  const ip = forwarded.split(\",\")[0]?.trim() || req.headers.get(\"x-real-ip\") || \"unknown\";\n  const ua = req.headers.get(\"user-agent\") || \"unknown\";\n  return hash(`${ip}|${ua}|${keySuffix || \"\"}`);\n}\n\nexport function rateLimit(req: Request, opts: Options) {\n  const now = Date.now();\n  const key = `${opts.keyPrefix}:${getClientKey(req, opts.keySuffix)}`;\n  const existing = buckets.get(key);\n  if (!existing || existing.resetAt <= now) {\n    buckets.set(key, { count: 1, resetAt: now + opts.windowMs });\n    return null;\n  }\n  existing.count += 1;\n  if (existing.count > opts.limit) {\n    const retryAfter = Math.max(1, Math.ceil((existing.resetAt - now) / 1000));\n    return NextResponse.json(\n      { error: opts.message || \"Too many requests. Please try again shortly.\" },\n      { status: 429, headers: { \"retry-after\": String(retryAfter) } }\n    );\n  }\n  return null;\n}\n\n\n","import { NextResponse } from \"next/server\";\n\nfunction getSiteOrigin() {\n  try {\n    return new URL(process.env.NEXT_PUBLIC_SITE_URL || \"http://localhost:3000\").origin;\n  } catch {\n    return \"http://localhost:3000\";\n  }\n}\n\nexport function requireSameOrigin(req: Request) {\n  // Lightweight CSRF protection for browser-invoked state changes:\n  // require Origin/Referer to match our configured site origin.\n  const origin = req.headers.get(\"origin\");\n  const referer = req.headers.get(\"referer\");\n  const siteOrigin = getSiteOrigin();\n  let requestOrigin: string | null = null;\n  try {\n    requestOrigin = new URL(req.url).origin;\n  } catch {\n    requestOrigin = null;\n  }\n\n  const candidate = origin || (referer ? (() => { try { return new URL(referer).origin; } catch { return null; } })() : null);\n  if (!candidate) {\n    return NextResponse.json({ error: \"Missing origin\" }, { status: 403 });\n  }\n  // Accept either:\n  // - the configured canonical site origin (e.g. production custom domain), or\n  // - the request origin (e.g. Vercel preview domain), as long as the browser supplies Origin/Referer.\n  if (candidate !== siteOrigin && (!requestOrigin || candidate !== requestOrigin)) {\n    return NextResponse.json({ error: \"Invalid origin\" }, { status: 403 });\n  }\n  return null;\n}\n\n\n","import crypto from \"crypto\";\n\nexport function getRequestId(req: Request) {\n  return req.headers.get(\"x-request-id\") || crypto.randomUUID();\n}\n\nexport async function withRequestLogging<T>(\n  req: Request,\n  meta: { route: string },\n  fn: (ctx: { requestId: string }) => Promise<T>\n) {\n  const requestId = getRequestId(req);\n  const start = Date.now();\n  try {\n    const result = await fn({ requestId });\n    const durationMs = Date.now() - start;\n    console.info(\"req\", { requestId, route: meta.route, status: \"ok\", durationMs });\n    return result;\n  } catch (err: any) {\n    const durationMs = Date.now() - start;\n    console.error(\"req\", { requestId, route: meta.route, status: \"error\", durationMs, message: err?.message || \"error\" });\n    throw err;\n  }\n}\n\n\n","export type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\";\n\nexport type LogContext = {\n  requestId?: string;\n  route?: string;\n};\n\ntype LogPayload = Record<string, unknown>;\n\nfunction write(level: LogLevel, event: string, ctx: LogContext, payload?: LogPayload) {\n  const record = {\n    level,\n    event,\n    requestId: ctx.requestId,\n    route: ctx.route,\n    ...payload,\n    ts: new Date().toISOString(),\n  };\n\n  // Keep it simple and server-safe: console.* only.\n  // Never log sensitive data; callers should pass only safe fields.\n  if (level === \"error\") console.error(event, record);\n  else if (level === \"warn\") console.warn(event, record);\n  else console.info(event, record);\n}\n\nexport const logger = {\n  debug: (event: string, ctx: LogContext, payload?: LogPayload) => write(\"debug\", event, ctx, payload),\n  info: (event: string, ctx: LogContext, payload?: LogPayload) => write(\"info\", event, ctx, payload),\n  warn: (event: string, ctx: LogContext, payload?: LogPayload) => write(\"warn\", event, ctx, payload),\n  error: (event: string, ctx: LogContext, payload?: LogPayload) => write(\"error\", event, ctx, payload),\n};\n\n\n","const DEFAULT_VERSION = \"2025.01\";\n\nexport const activeCourseVersionByCourseId: Record<string, string> = {\n  ai: DEFAULT_VERSION,\n  cybersecurity: DEFAULT_VERSION,\n  \"software-architecture\": DEFAULT_VERSION,\n  data: DEFAULT_VERSION,\n  digitalisation: DEFAULT_VERSION,\n};\n\nexport function getActiveCourseVersion(courseId: string) {\n  const v = activeCourseVersionByCourseId[courseId];\n  return typeof v === \"string\" && v.trim() ? v.trim() : DEFAULT_VERSION;\n}\n\n\n","import crypto from \"crypto\";\n\nexport const CPD_RULES_VERSION = \"v1\";\n\nexport function minutesToHours(minutes) {\n  const m = Number(minutes) || 0;\n  return Math.round((m / 60) * 10) / 10;\n}\n\nexport function hoursToMinutes(hours) {\n  const h = Number(hours) || 0;\n  return Math.max(0, Math.round(h * 60));\n}\n\nexport function validateCpdState(state) {\n  if (!state || typeof state !== \"object\") return { ok: false, error: \"State must be an object\" };\n  if (!Array.isArray(state.sections) || !Array.isArray(state.activity)) {\n    return { ok: false, error: \"State must contain sections and activity arrays\" };\n  }\n  for (const s of state.sections) {\n    if (!s.trackId || !s.levelId || !s.sectionId) return { ok: false, error: \"Section missing identifiers\" };\n    if (Number(s.minutes) < 0) return { ok: false, error: \"Section minutes must be non-negative\" };\n  }\n  for (const a of state.activity) {\n    if (!a.id || !a.trackId || !a.levelId || !a.sectionId || !a.timestamp) return { ok: false, error: \"Activity missing fields\" };\n    if (!Number.isFinite(Number(a.minutesDelta))) return { ok: false, error: \"Activity minutesDelta must be numeric\" };\n  }\n  return { ok: true };\n}\n\nexport function buildEvidenceRecord(input) {\n  const payload = {\n    ...input,\n    rulesVersion: CPD_RULES_VERSION,\n  };\n  const canonical = JSON.stringify(payload);\n  const hash = crypto.createHash(\"sha256\").update(canonical).digest(\"hex\");\n  return { ...payload, hash };\n}\n\nexport function explainCredits(state, trackId) {\n  const activity = (state?.activity || []).filter((a) => a.trackId === trackId);\n  const totalMinutesFromActivity = activity.reduce((sum, a) => sum + (Number(a.minutesDelta) || 0), 0);\n  return {\n    trackId,\n    totalMinutesFromActivity,\n    totalHoursFromActivity: minutesToHours(totalMinutesFromActivity),\n    recent: activity.slice(0, 50).map((a) => ({\n      id: a.id,\n      timestamp: a.timestamp,\n      minutesDelta: a.minutesDelta,\n      note: a.note || \"\",\n      levelId: a.levelId,\n      sectionId: a.sectionId,\n    })),\n  };\n}\n\n\n","import type { CPDState, CPDTrackId } from \"@/lib/cpd\";\nimport {\n  CPD_RULES_VERSION,\n  minutesToHours,\n  hoursToMinutes,\n  validateCpdState,\n  explainCredits,\n} from \"@/lib/cpd/calculations.core\";\n\nexport { CPD_RULES_VERSION, minutesToHours, hoursToMinutes };\n\nexport type CpdValidationResult = { ok: true } | { ok: false; error: string };\n\nexport function validateCpdStateOrThrow(state: CPDState): void {\n  const result = validateCpdState(state) as CpdValidationResult;\n  if (!result.ok) throw new Error(result.error);\n}\n\nexport type CpdCreditExplanation = ReturnType<typeof explainCredits>;\n\nexport function explainTrackCredits(state: CPDState, trackId: CPDTrackId): CpdCreditExplanation {\n  return explainCredits(state as any, trackId);\n}\n\n\n","import { NextResponse } from \"next/server\";\nimport { getRequestId } from \"@/lib/security/requestLog\";\nimport { asAppError, AppError } from \"./errors\";\nimport { logger } from \"./logger\";\n\nexport type ApiErrorBody = {\n  error: {\n    code: string;\n    message: string;\n    requestId?: string;\n  };\n};\n\nexport type ApiOkBody<T> = T & { requestId?: string };\n\nexport function jsonOk<T extends Record<string, any>>(data: T, init?: { status?: number; requestId?: string }) {\n  const status = init?.status ?? 200;\n  const requestId = init?.requestId;\n  const body: ApiOkBody<T> = requestId ? ({ ...data, requestId } as any) : data;\n  const res = NextResponse.json(body, { status });\n  if (requestId) res.headers.set(\"x-request-id\", requestId);\n  return res;\n}\n\nexport function jsonError(err: unknown, ctx: { requestId?: string; route?: string }) {\n  const appErr: AppError = asAppError(err);\n  const requestId = ctx.requestId;\n\n  logger.error(\"api_error\", { requestId, route: ctx.route }, { code: appErr.code, status: appErr.status, message: appErr.message });\n\n  const body: ApiErrorBody = {\n    error: {\n      code: appErr.code,\n      message: appErr.exposeMessage,\n      requestId,\n    },\n  };\n\n  const res = NextResponse.json(body, { status: appErr.status });\n  if (requestId) res.headers.set(\"x-request-id\", requestId);\n  return res;\n}\n\nexport async function handleAppRoute(\n  req: Request,\n  meta: { route: string },\n  fn: (ctx: { requestId: string }) => Promise<NextResponse>\n) {\n  const requestId = getRequestId(req);\n  const start = Date.now();\n  try {\n    const res = await fn({ requestId });\n    const durationMs = Date.now() - start;\n    logger.info(\"api_request\", { requestId, route: meta.route }, { status: res.status, durationMs });\n    res.headers.set(\"x-request-id\", requestId);\n    return res;\n  } catch (err) {\n    const durationMs = Date.now() - start;\n    logger.error(\"api_request\", { requestId, route: meta.route }, { status: \"error\", durationMs });\n    return jsonError(err, { requestId, route: meta.route });\n  }\n}\n\n\n","export type AppErrorCode =\n  | \"UNAUTHORIZED\"\n  | \"FORBIDDEN\"\n  | \"NOT_FOUND\"\n  | \"VALIDATION_ERROR\"\n  | \"RATE_LIMITED\"\n  | \"INTERNAL_ERROR\";\n\nexport class AppError extends Error {\n  public readonly code: AppErrorCode;\n  public readonly status: number;\n  public readonly exposeMessage: string;\n  public readonly cause?: unknown;\n\n  constructor(params: { code: AppErrorCode; status: number; message: string; exposeMessage?: string; cause?: unknown }) {\n    super(params.message);\n    this.name = \"AppError\";\n    this.code = params.code;\n    this.status = params.status;\n    this.exposeMessage = params.exposeMessage ?? \"Request failed.\";\n    this.cause = params.cause;\n  }\n}\n\nexport function asAppError(err: unknown): AppError {\n  if (err instanceof AppError) return err;\n  const message = err instanceof Error ? err.message : String(err);\n  return new AppError({\n    code: \"INTERNAL_ERROR\",\n    status: 500,\n    message,\n    exposeMessage: \"Something went wrong.\",\n    cause: err,\n  });\n}\n\n\n","import fs from \"node:fs\";\nimport path from \"node:path\";\n\nconst STORE_PATH = process.env.LEARNING_RECORDS_STORE_PATH || \"data/learning-records.json\";\nconst empty = { records: [] };\n\nfunction ensureDir(filePath) {\n  const dir = path.dirname(filePath);\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n}\n\nfunction readJsonFile(filePath, fallback) {\n  try {\n    const abs = path.isAbsolute(filePath) ? filePath : path.join(process.cwd(), filePath);\n    if (!fs.existsSync(abs)) return fallback;\n    return JSON.parse(fs.readFileSync(abs, \"utf8\"));\n  } catch {\n    return fallback;\n  }\n}\n\nfunction writeJsonFile(filePath, value) {\n  const abs = path.isAbsolute(filePath) ? filePath : path.join(process.cwd(), filePath);\n  ensureDir(abs);\n  const tmp = `${abs}.tmp`;\n  fs.writeFileSync(tmp, JSON.stringify(value, null, 2), \"utf8\");\n  fs.renameSync(tmp, abs);\n}\n\nexport function calculateEarnedMinutes(params) {\n  const {\n    estimatedMinutes,\n    sectionsCompleted,\n    quizzesCompleted,\n    toolsUsed,\n  } = params;\n\n  // Conservative, deterministic crediting:\n  // - sections are the primary unit\n  // - quizzes and tools add small bounded credit\n  const fromSections = Math.max(0, Number(sectionsCompleted) || 0) * 10;\n  const fromQuizzes = Math.max(0, Number(quizzesCompleted) || 0) * 5;\n  const fromTools = Math.max(0, Number(toolsUsed) || 0) * 5;\n\n  const raw = fromSections + fromQuizzes + fromTools;\n  const cap = Math.max(0, Number(estimatedMinutes) || 0);\n  return Math.min(raw, cap);\n}\n\nexport function deriveLearningRecord(input) {\n  const {\n    userId,\n    courseId,\n    levelId,\n    totalSections,\n    completedSectionKeys,\n    quizIdsCompleted,\n    toolIdsUsed,\n    estimatedMinutes,\n  } = input;\n\n  const sectionsCompleted = completedSectionKeys.size;\n  const quizzesCompleted = quizIdsCompleted.size;\n  const toolsUsed = toolIdsUsed.size;\n\n  const earnedMinutes = calculateEarnedMinutes({\n    estimatedMinutes,\n    sectionsCompleted,\n    quizzesCompleted,\n    toolsUsed,\n  });\n\n  const completionStatus =\n    totalSections > 0 &&\n    sectionsCompleted >= totalSections &&\n    quizzesCompleted >= 1\n      ? \"completed\"\n      : sectionsCompleted > 0 || quizzesCompleted > 0 || toolsUsed > 0\n      ? \"in_progress\"\n      : \"not_started\";\n\n  const completionDate =\n    completionStatus === \"completed\" ? new Date().toISOString() : null;\n\n  return {\n    userId,\n    courseId,\n    levelId,\n    sectionsCompleted,\n    quizzesCompleted,\n    toolsUsed,\n    timeSpentMinutes: earnedMinutes,\n    completionStatus,\n    completionDate,\n    updatedAt: new Date().toISOString(),\n  };\n}\n\nexport function upsertLearningRecord(record) {\n  const s = readJsonFile(STORE_PATH, empty);\n  const key = `${record.userId}:${record.courseId}:${record.levelId}`;\n  const existingIdx = s.records.findIndex((r) => `${r.userId}:${r.courseId}:${r.levelId}` === key);\n  let stored = record;\n  if (existingIdx >= 0) {\n    // Preserve the first completionDate if already completed.\n    const existing = s.records[existingIdx];\n    const completionDate =\n      existing.completionStatus === \"completed\" && existing.completionDate\n        ? existing.completionDate\n        : record.completionDate;\n    stored = { ...record, completionDate };\n    s.records[existingIdx] = stored;\n  } else {\n    s.records.push(record);\n  }\n  writeJsonFile(STORE_PATH, s);\n  return stored;\n}\n\nexport function listLearningRecordsForUser(userId) {\n  const s = readJsonFile(STORE_PATH, empty);\n  return (s.records || []).filter((r) => r.userId === userId);\n}\n\n\n","export type CompletionStatus = \"not_started\" | \"in_progress\" | \"completed\";\n\nexport type LearningRecord = {\n  userId: string;\n  courseId: string;\n  levelId: string;\n  sectionsCompleted: number;\n  quizzesCompleted: number;\n  toolsUsed: number;\n  timeSpentMinutes: number;\n  completionStatus: CompletionStatus;\n  completionDate: string | null;\n  updatedAt: string;\n};\n\nconst core = require(\"./records.core.js\");\n\nexport const calculateEarnedMinutes: (params: {\n  estimatedMinutes: number;\n  sectionsCompleted: number;\n  quizzesCompleted: number;\n  toolsUsed: number;\n}) => number = core.calculateEarnedMinutes;\n\nexport const deriveLearningRecord: (input: any) => LearningRecord = core.deriveLearningRecord;\nexport const upsertLearningRecord: (record: LearningRecord) => LearningRecord = core.upsertLearningRecord;\nexport const listLearningRecordsForUser: (userId: string) => LearningRecord[] = core.listLearningRecordsForUser;\n\n\n"],"names":[],"mappings":"oTAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,QAYA,IAAM,EAAU,IAAI,IAcb,SAAS,EAAU,CAAY,CAAE,CAAa,UACnD,QALM,EAKA,EAAM,KAAK,GAAG,GACd,EAAM,CAAA,EAAG,EAAK,SAAS,CAAC,CAAC,EAAE,CAVC,EAUiB,EAAK,KAVJ,IAUa,CAR3D,EAAY,AAQ4B,EARxB,OAAO,CAAC,GAAG,CAAC,oBAAsB,GAClD,EAAK,EAAU,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,QAAU,EAAI,OAAO,CAAC,GAAG,CAAC,cAAgB,YACnE,EAAI,OAAO,CAAC,GAAG,CAAC,eAAiB,UARhC,EASA,CAAA,EATa,AASV,EAAG,CAAC,EAAE,EAAG,CAAC,EAAE,GAAa,GAAA,CAAI,CARrC,EAAA,OAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,GAAO,MAAM,CAAC,OAAO,KAAK,CAAC,EAAG,KAaP,CAAG,CAC9D,EAAW,EAAQ,GAAG,CAAC,GAC7B,GAAI,CAAC,GAAY,EAAS,OAAO,EAAI,EAEnC,GAFwC,IACxC,EAAQ,GAAG,CAAC,EAAK,CAAE,MAAO,EAAG,QAAS,EAAM,EAAK,QAAQ,AAAC,GACnD,KAGT,GADA,EAAS,KAAK,EAAI,EACd,EAAS,KAAK,CAAG,EAAK,KAAK,CAAE,CAC/B,IAAM,EAAa,KAAK,GAAG,CAAC,EAAG,KAAK,IAAI,CAAC,CAAC,EAAS,OAAO,CAAG,CAAA,CAAG,CAAI,MACpE,OAAO,EAAA,YAAY,CAAC,IAAI,CACtB,CAAE,MAAO,EAAK,OAAO,EAAI,8CAA+C,EACxE,CAAE,OAAQ,IAAK,QAAS,CAAE,cAAe,OAAO,EAAY,CAAE,EAElE,CACA,OAAO,IACT,mDC5CA,IAAA,EAAA,EAAA,CAAA,CAAA,OAUO,SAAS,EAAkB,CAAY,EAG5C,IAAM,EAAS,EAAI,OAAO,CAAC,GAAG,CAAC,UACzB,EAAU,EAAI,OAAO,CAAC,GAAG,CAAC,WAC1B,EAbR,AAaqB,SAbZ,EACP,GAAI,CACF,OAAO,IAAI,IAAI,QAAQ,GAAG,CAAC,oBAAoB,EAAI,yBAAyB,MAAM,AACpF,CAAE,KAAM,CACN,MAAO,uBACT,CACF,IAQM,EAA+B,KACnC,GAAI,CACF,EAAgB,IAAI,IAAI,EAAI,GAAG,EAAE,MAAM,AACzC,CAAE,KAAM,CACN,EAAgB,IAClB,CAEA,IAAM,EAAY,IAAW,EAAU,CAAC,GAAZ,EAAoB,GAAI,CAAE,OAAO,IAAI,IAAI,GAAS,MAAM,AAAE,CAAE,KAAM,CAAE,OAAO,IAAM,EAAE,CAAC,GAAM,IAAA,CAAI,QAC1H,AAAK,EAMD,EANA,EAMc,GAAe,AAAC,EANlB,CAMmC,IAAc,EAG1D,EAHyB,GACvB,EAAA,IADqE,GAAG,KAC5D,CAAC,IAAI,CAAC,CAAE,MAAO,gBAAiB,EAAG,CAAE,OAAQ,GAAI,GAN7D,EAAA,YAAY,CAAC,IAAI,CAAC,CAAE,MAAO,gBAAiB,EAAG,CAAE,OAAQ,GAAI,EASxE,2DClCA,IAAA,EAAA,EAAA,CAAA,CAAA,QAEO,SAAS,EAAa,CAAY,EACvC,OAAO,EAAI,OAAO,CAAC,GAAG,CAAC,iBAAmB,EAAA,OAAM,CAAC,UAAU,EAC7D,CAEO,eAAe,EACpB,CAAY,CACZ,CAAuB,CACvB,CAA8C,EAE9C,IAAM,EAAY,EAAa,GACzB,EAAQ,KAAK,GAAG,GACtB,GAAI,CACF,IAAM,EAAS,MAAM,EAAG,CAAE,WAAU,GAC9B,EAAa,KAAK,GAAG,GAAK,EAEhC,OADA,QAAQ,IAAI,CAAC,MAAO,WAAE,EAAW,MAAO,EAAK,KAAK,CAAE,OAAQ,gBAAM,CAAW,GACtE,CACT,CAAE,MAAO,EAAU,CACjB,IAAM,EAAa,KAAK,GAAG,GAAK,CAEhC,OADA,QAAQ,KAAK,CAAC,MAAO,CAAE,YAAW,MAAO,EAAK,KAAK,CAAE,OAAQ,mBAAS,EAAY,QAAS,GAAK,SAAW,OAAQ,GAC7G,CACR,CACF,yNCdA,SAAS,EAAM,CAAe,CAAE,CAAa,CAAE,CAAe,CAAE,CAAoB,EAClF,IAAM,EAAS,OACb,QACA,EACA,UAAW,EAAI,SAAS,CACxB,MAAO,EAAI,KAAK,CAChB,GAAG,CAAO,CACV,GAAI,IAAI,OAAO,WAAW,EAC5B,EAIc,UAAV,EAAmB,QAAQ,KAAK,CAAC,EAAO,GACzB,SAAV,EAAkB,QAAQ,IAAI,CAAC,EAAO,GAC1C,QAAQ,IAAI,CAAC,EAAO,EAC3B,iBAEsB,CACpB,MAAO,CAAC,EAAe,EAAiB,IAAyB,EAAM,QAAS,EAAO,EAAK,GAC5F,KAAM,CAAC,EAAe,EAAiB,IAAyB,EAAM,OAAQ,EAAO,EAAK,GAC1F,KAAM,CAAC,EAAe,EAAiB,IAAyB,EAAM,OAAQ,EAAO,EAAK,GAC1F,MAAO,CAAC,EAAe,EAAiB,IAAyB,EAAM,QAAS,EAAO,EAAK,EAC9F,6BC/BA,IAAM,EAAkB,UAEX,EAAwD,CACnE,GAAI,EACJ,cAAe,EACf,wBAAyB,EACzB,KAAM,EACN,eAAgB,CAClB,EAEO,SAAS,EAAuB,CAAgB,EACrD,IAAM,EAAI,CAA6B,CAAC,EAAS,CACjD,MAAoB,UAAb,OAAO,GAAkB,EAAE,IAAI,GAAK,EAAE,IAAI,GAAK,CACxD,gECbA,IAAA,EAAA,EAAA,CAAA,CAAA,QAIO,SAAS,EAAe,CAAO,EAEpC,OAAO,KAAK,KAAK,CAAE,CADT,OAAO,KAAY,EACN,GAAM,IAAM,EACrC,CAEO,SAAS,EAAe,CAAK,EAElC,OAAO,KAAK,GAAG,CAAC,EAAG,KAAK,KAAK,CAAC,AAAI,IADxB,OAAO,KAAU,GAE7B,CAEO,SAAS,EAAiB,CAAK,EACpC,GAAI,CAAC,GAA0B,UAAjB,OAAO,EAAoB,MAAO,CAAE,IAAI,EAAO,MAAO,yBAA0B,EAC9F,GAAI,CAAC,MAAM,OAAO,CAAC,EAAM,QAAQ,GAAK,CAAC,MAAM,OAAO,CAAC,EAAM,QAAQ,EACjE,CADoE,KAC7D,CAAE,IAAI,EAAO,MAAO,iDAAkD,EAE/E,IAAK,IAAM,KAAK,EAAM,QAAQ,CAAE,CAC9B,GAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,SAAS,CAAE,MAAO,CAAE,IAAI,EAAO,MAAO,6BAA8B,EACvG,GAAI,AAAoB,SAAb,EAAE,OAAO,EAAO,MAAO,CAAE,IAAI,EAAO,MAAO,sCAAuC,CAC/F,CACA,IAAK,IAAM,KAAK,EAAM,QAAQ,CAAE,CAC9B,GAAI,CAAC,EAAE,EAAE,EAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,OAAO,EAAI,CAAC,EAAE,SAAS,EAAI,CAAC,EAAE,SAAS,CAAE,MAAO,CAAE,IAAI,EAAO,MAAO,yBAA0B,EAC5H,GAAI,CAAC,OAAO,QAAQ,CAAC,OAAO,EAAE,YAAY,GAAI,MAAO,CAAE,IAAI,EAAO,MAAO,uCAAwC,CACnH,CACA,MAAO,CAAE,IAAI,CAAK,CACpB,CAEO,SAAS,EAAoB,CAAK,EACvC,IAAM,EAAU,CACd,GAAG,CAAK,CACR,cAAc,GAChB,EACM,EAAY,KAAK,SAAS,CAAC,GAC3B,EAAO,EAAA,OAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,GAAW,MAAM,CAAC,OAClE,MAAO,CAAE,GAAG,CAAO,MAAE,CAAK,CAC5B,CAEO,SAAS,EAAe,CAAK,CAAE,CAAO,EAC3C,IAAM,EAAW,CAAC,GAAO,UAAY,EAAA,AAAE,EAAE,MAAM,CAAC,AAAC,GAAM,EAAE,OAAO,GAAK,GAC/D,EAA2B,EAAS,MAAM,CAAC,CAAC,EAAK,IAAM,EAAO,IAAD,IAAQ,EAAE,YAAY,IAAK,CAAC,CAAG,GAClG,MAAO,SACL,2BACA,EACA,uBAAwB,EAAe,GACvC,OAAQ,EAAS,KAAK,CAAC,EAAG,IAAI,GAAG,CAAC,AAAC,IAAM,AAAC,CACxC,GAAI,EAAE,EAAE,CACR,UAAW,EAAE,SAAS,CACtB,aAAc,EAAE,YAAY,CAC5B,KAAM,EAAE,IAAI,EAAI,GAChB,QAAS,EAAE,OAAO,CAClB,UAAW,EAAE,SAAS,AACxB,CAAC,EACH,CACF,4BAtDiC,0JCDjC,IAAA,EAAA,EAAA,CAAA,CAAA,QAYO,SAAS,EAAwB,CAAe,EACrD,IAAM,EAAS,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,GAChC,GAAI,CAAC,EAAO,EAAE,CAAE,MAAM,AAAI,MAAM,EAAO,KAAK,CAC9C,wEChBA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCOO,OAAM,UAAiB,MACZ,IAAmB,CACnB,MAAe,AACf,cAAsB,CACtB,KAAgB,AAEhC,aAAY,CAAwG,CAAE,CACpH,KAAK,CAAC,EAAO,OAAO,EACpB,IAAI,CAAC,IAAI,CAAG,WACZ,IAAI,CAAC,IAAI,CAAG,EAAO,IAAI,CACvB,IAAI,CAAC,MAAM,CAAG,EAAO,MAAM,CAC3B,IAAI,CAAC,aAAa,CAAG,EAAO,aAAa,EAAI,kBAC7C,IAAI,CAAC,KAAK,CAAG,EAAO,KAAK,AAC3B,CACF,CAEO,SAAS,EAAW,CAAY,SACjC,AAAJ,aAAmB,EAAiB,EAE7B,IAAI,EAAS,AAFS,CAG3B,KAAM,iBACN,OAAQ,IACR,QAJc,aAAe,MAAQ,EAAI,OAAO,CAAG,OAAO,GAK1D,cAAe,wBACf,MAAO,CACT,EACF,mDD/BA,IAAA,EAAA,EAAA,CAAA,CAAA,QAYO,SAAS,EAAsC,CAAO,CAAE,CAA8C,EAC3G,IAAM,EAAS,GAAM,QAAU,IACzB,EAAY,GAAM,UAClB,EAAqB,EAAa,CAAE,GAAG,CAAI,WAAE,CAAU,EAAY,EACnE,EAAM,EAAA,YAAY,CAAC,IAAI,CAAC,EAAM,QAAE,CAAO,GAE7C,OADI,GAAW,EAAI,OAAO,CAAC,GAAG,CAAC,eAAgB,GACxC,CACT,CAqBO,eAAe,EACpB,CAAY,CACZ,CAAuB,CACvB,CAAyD,EAEzD,IAAM,EAAY,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,GACzB,EAAQ,KAAK,GAAG,GACtB,GAAI,CACF,IAAM,EAAM,MAAM,EAAG,WAAE,CAAU,GAC3B,EAAa,KAAK,GAAG,GAAK,EAGhC,OAFA,EAAA,MAAM,CAAC,IAAI,CAAC,cAAe,WAAE,EAAW,MAAO,EAAK,KAAK,AAAC,EAAG,CAAE,OAAQ,EAAI,MAAM,CAAE,YAAW,GAC9F,EAAI,OAAO,CAAC,GAAG,CAAC,eAAgB,GACzB,CACT,CAAE,MAAO,EAAK,OACZ,QA3BI,IA2BE,EAAa,KAAK,GAAG,GAAK,EAEhC,OAAO,AADP,EAAA,MAAM,CAAC,KAAK,CAAC,cAAe,WAAE,EAAW,MAAO,EAAK,KAAK,AAAC,EAAG,CAAE,OAAQ,mBAAS,CAAW,GAlCxD,EAmCd,CAnCyD,UAmCvD,EAAW,MAAO,EAAK,KAAM,AAAD,EAlChD,EAAmB,EAkCN,GAjCb,EAAY,EAAI,EADc,OACL,CAE/B,EAAA,MAAM,CAAC,KAAK,CAAC,YAAa,WAAE,EAAW,MAAO,EAAI,KAAK,AAAC,EAAG,CAAE,KAAM,EAAO,IAAI,CAAE,OAAQ,EAAO,MAAM,CAAE,QAAS,EAAO,OAAO,AAAC,KAEpG,CACzB,MAAO,CACL,KAAM,EAAO,IAAI,CACjB,QAAS,EAAO,aAAa,WAC7B,CACF,CACF,EAEM,EAAM,EAAA,YAAY,CAAC,IAAI,CAAC,EAAM,CAAE,OAAQ,EAAO,MAAM,AAAC,GACxD,GAAW,EAAI,OAAO,CAAC,GAAG,CAAC,eAAgB,GACxC,CAoBP,CACF,8EE7DA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAEA,IAAM,EAAa,QAAQ,GAAG,CAAC,2BAA2B,EAAI,6BACxD,EAAQ,CAAE,QAAS,EAAE,AAAC,EAO5B,SAAS,EAAa,CAAQ,CAAE,CAAQ,EACtC,GAAI,CACF,IAAM,EAAM,EAAA,OAAI,CAAC,UAAU,CAAC,GAAY,EAAW,EAAA,OAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAI,GAC5E,GAAI,CAAC,EAAA,OAAE,CAAC,UAAU,CAAC,GAAM,OAAO,EAChC,OAAO,KAAK,KAAK,CAAC,EAAA,OAAE,CAAC,YAAY,CAAC,EAAK,QACzC,CAAE,KAAM,CACN,OAAO,CACT,CACF,CAUO,SAAS,EAAuB,CAAM,EAC3C,GAAM,kBACJ,CAAgB,mBAChB,CAAiB,CACjB,kBAAgB,WAChB,CAAS,CACV,CAAG,EAWJ,OAAO,KAAK,GAAG,CANoD,AAIvD,AAEI,GANK,EAMA,GANK,GAAG,CAAC,EAAG,CAIN,MAJa,IAAsB,GAC1C,AAA6C,CAGxB,MAHhB,GAAG,CAAC,EAAG,OAAO,IAAqB,GACJ,EAAtC,KAAK,GAAG,CAAC,EAAG,OAAO,IAAc,GAGvC,KAAK,GAAG,CAAC,EAAG,OAAO,IAAqB,GAEtD,CAEO,SAAS,EAAqB,CAAK,EACxC,GAAM,QACJ,CAAM,UACN,CAAQ,SACR,CAAO,eACP,CAAa,sBACb,CAAoB,kBACpB,CAAgB,aAChB,CAAW,kBACX,CAAgB,CACjB,CAAG,EAEE,EAAoB,EAAqB,IAAI,CAC7C,EAAmB,EAAiB,IAAI,CACxC,EAAY,EAAY,IAAI,CAE5B,EAAgB,EAAuB,kBAC3C,EACA,qCACA,YACA,CACF,GAEM,EACJ,EAAgB,GAChB,GAAqB,GACrB,GAAoB,EAChB,YACA,EAAoB,GAAK,EAAmB,GAAK,EAAY,EAC7D,cACA,cAEA,EACJ,AAAqB,gBAAc,IAAI,OAAO,WAAW,GAAK,KAEhE,MAAO,QACL,WACA,UACA,oBACA,mBACA,YACA,EACA,iBAAkB,mBAClB,iBACA,EACA,UAAW,IAAI,OAAO,WAAW,EACnC,CACF,CAEO,SAAS,EAAqB,CAAM,EACzC,UAAM,EAAI,EAAa,EAAY,GAC7B,EAAM,CAAA,EAAG,EAAO,MAAM,CAAC,CAAC,EAAE,EAAO,QAAQ,CAAC,CAAC,EAAE,EAAO,OAAO,CAAA,CAAE,CAC7D,EAAc,EAAE,OAAO,CAAC,SAAS,CAAC,AAAC,GAAM,CAAA,EAAG,EAAE,MAAM,CAAC,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC,EAAE,EAAE,OAAO,CAAA,CAAE,GAAK,GACxF,EAAS,EACb,GAAI,GAAe,EAAG,CAEpB,IAAM,EAAW,EAAE,OAAO,CAAC,EAAY,CACjC,EAC0B,cAA9B,EAAS,gBAAgB,EAAoB,EAAS,cAAc,CAChE,EAAS,cAAc,CACvB,EAAO,cAAc,CAC3B,EAAS,CAAE,GAAG,CAAM,gBAAE,CAAe,EACrC,EAAE,OAAO,CAAC,EAAY,CAAG,CAC3B,MACE,CADK,CACH,OAAO,CAAC,IAAI,CAAC,GAGjB,OA9FM,EAAM,EAAA,OAAI,CAAC,UAAU,CA6Fb,AA7Fc,KAAuB,EAAA,KAAX,EAAe,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,EAftE,EAAM,EAAA,OAAI,CAAC,OAAO,CAgBd,AAhBe,GACpB,AAAD,EAAC,OAAE,CAAC,UAAU,CAAC,IAAM,EAAA,OAAE,CAAC,SAAS,CAAC,EAAK,CAAE,WAAW,CAAK,GAgBvD,EAAM,CAAA,EAAG,EAAI,IAAI,CAAC,CACxB,EAAA,OAAE,CAAC,aAAa,CAAC,EAAK,KAAK,SAAS,CAAC,AA0FX,EA1FkB,KAAM,GAAI,QACtD,EAAA,OAAE,CAAC,UAAU,CAAC,EAAK,GA0FZ,CACT,CAEO,SAAS,EAA2B,CAAM,EAE/C,MAAO,CADG,AACF,EADe,EAAY,GACzB,OAAO,EAAI,EAAA,AAAE,EAAE,MAAM,CAAC,AAAC,GAAM,EAAE,MAAM,GAAK,EACtD,6JC3GA,IAAM,EAAA,EAAA,CAAA,CAAA,QAOS,EAAK,sBAAsB,CAEnC,IAAM,EAAuD,EAAK,oBAAoB,CAChF,EAAmE,EAAK,oBAAoB,CAC5F,EAAmE,EAAK,0BAA0B"}}]
}