;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="64a2e25e-01e7-c839-5c7f-5d02bd825567")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},657194,e=>{"use strict";var t=e.i(89171),r=e.i(254799);let s=new Map;function a(e,a){var i,n;let o,u,d,c=Date.now(),l=`${a.keyPrefix}:${(i=a.keySuffix,o=e.headers.get("x-forwarded-for")||"",u=o.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",d=e.headers.get("user-agent")||"unknown",n=`${u}|${d}|${i||""}`,r.default.createHash("sha256").update(n).digest("hex").slice(0,24))}`,p=s.get(l);if(!p||p.resetAt<=c)return s.set(l,{count:1,resetAt:c+a.windowMs}),null;if(p.count+=1,p.count>a.limit){let e=Math.max(1,Math.ceil((p.resetAt-c)/1e3));return t.NextResponse.json({error:a.message||"Too many requests. Please try again shortly."},{status:429,headers:{"retry-after":String(e)}})}return null}e.s(["rateLimit",()=>a])},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},663775,e=>{"use strict";var t=e.i(89171),r=e.i(757660),s=e.i(568212),a=e.i(324831);async function i(e="VIEW_SYSTEM"){let n=await (0,r.getServerSession)(s.authOptions).catch(()=>null);if(!n?.user)return{ok:!1,response:t.NextResponse.json({error:"Unauthorized"},{status:401})};try{let{role:t}=(0,a.requireAdminPermission)(n.user,e);return{ok:!0,session:n,role:t}}catch(r){let e="number"==typeof r?.status?r.status:403;return{ok:!1,response:t.NextResponse.json({error:"Forbidden"},{status:e})}}}e.s(["requireAdminJson",()=>i])},187177,e=>{"use strict";var t=e.i(124594);function r(e){try{return new Date(e).toISOString()}catch{return new Date(0).toISOString()}}async function s(e){let s=Math.max(1,Math.min(50,e.take)),a={};e.status&&(a.status=e.status),e.category&&(a.category=String(e.category));let i="oldest"===e.sort?{createdAt:"asc"}:{createdAt:"desc"},n=await t.prisma.supportTicket.findMany({where:a,take:s+1,...e.cursor?{cursor:{id:e.cursor},skip:1}:{},orderBy:i,select:{id:!0,userId:!0,name:!0,email:!0,category:!0,status:!0,createdAt:!0,updatedAt:!0}}),o=n.length>s?n[s]:null;return{items:n.slice(0,s).map(e=>({id:String(e.id),userId:e.userId?String(e.userId):null,name:e.name?String(e.name):null,email:e.email?String(e.email):null,category:String(e.category||""),status:e.status,createdAt:r(e.createdAt),updatedAt:r(e.updatedAt)})),nextCursor:o?String(o.id):null}}async function a(e){let s=await t.prisma.supportTicket.findUnique({where:{id:e},select:{id:!0,userId:!0,name:!0,email:!0,category:!0,message:!0,status:!0,createdAt:!0,updatedAt:!0,attachments:{select:{id:!0,fileName:!0,mimeType:!0,sizeBytes:!0,storageKey:!0,createdAt:!0}},notes:{select:{id:!0,adminUserId:!0,note:!0,createdAt:!0},orderBy:{createdAt:"desc"}}}});return s?{id:String(s.id),userId:s.userId?String(s.userId):null,name:s.name?String(s.name):null,email:s.email?String(s.email):null,category:String(s.category||""),message:String(s.message||""),status:s.status,createdAt:r(s.createdAt),updatedAt:r(s.updatedAt),attachments:(s.attachments||[]).map(e=>({id:String(e.id),fileName:String(e.fileName),mimeType:String(e.mimeType),sizeBytes:Number(e.sizeBytes),storageKey:e.storageKey?String(e.storageKey):null,createdAt:r(e.createdAt)})),notes:(s.notes||[]).map(e=>({id:String(e.id),adminUserId:String(e.adminUserId),note:String(e.note),createdAt:r(e.createdAt)}))}:null}async function i(e,r){await t.prisma.supportTicket.update({where:{id:e},data:{status:r}})}async function n(e,r,s){await t.prisma.supportTicketNote.create({data:{ticketId:e,adminUserId:r,note:s}})}e.s(["addSupportTicketNote",()=>n,"getSupportTicketAdminSafe",()=>a,"listSupportTicketsAdminSafe",()=>s,"setSupportTicketStatus",()=>i])},37702,(e,t,r)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},60438,(e,t,r)=>{t.exports=e.x("perf_hooks",()=>require("perf_hooks"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},812057,(e,t,r)=>{t.exports=e.x("node:util",()=>require("node:util"))},687769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},154993,(e,t,r)=>{t.exports=e.x("diagnostics_channel",()=>require("diagnostics_channel"))},410430,(e,t,r)=>{t.exports=e.x("async_hooks",()=>require("async_hooks"))}];

//# debugId=64a2e25e-01e7-c839-5c7f-5d02bd825567
//# sourceMappingURL=%5Broot-of-the-server%5D__212ed2b0._.js.map