;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f02b6efe-81d9-8b8f-a596-8b715c8d5326")}catch(e){}}();
module.exports=[29173,(e,t,s)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},814747,(e,t,s)=>{t.exports=e.x("path",()=>require("path"))},522734,(e,t,s)=>{t.exports=e.x("fs",()=>require("fs"))},254799,(e,t,s)=>{t.exports=e.x("crypto",()=>require("crypto"))},902157,(e,t,s)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,s)=>{t.exports=e.x("node:path",()=>require("node:path"))},464592,e=>{"use strict";let t=new Set(["authorization","cookie","set-cookie","stripe-signature","secret","token","password","apiKey","apikey","client_secret"]);function s(e,s,r){let n={level:e,event:String(s||"").slice(0,80),ts:new Date().toISOString(),...function e(s,r=0){if(r>4)return"[TRUNCATED]";if(null==s)return s;if(Array.isArray(s))return s.slice(0,20).map(t=>e(t,r+1));if("object"!=typeof s)return s;let n={};for(let[a,i]of Object.entries(s)){let s=String(a),o=s.toLowerCase();if(t.has(o)||o.includes("secret")||o.includes("token")||o.includes("password")){n[s]=null==i?i:("string"==typeof i&&i.length,"[REDACTED]");continue}n[s]=e(i,r+1)}return n}(r&&"object"==typeof r?r:{})};"error"===e?console.error(n):"warn"===e?console.warn(n):console.log(n)}function r(e,t){s("info",e,t)}function n(e,t){s("warn",e,t)}e.s(["logInfo",()=>r,"logWarn",()=>n])},828414,(e,t,s)=>{t.exports=e.x("next-auth",()=>require("next-auth"))},241496,(e,t,s)=>{t.exports=e.x("next-auth/providers/google",()=>require("next-auth/providers/google"))},92660,(e,t,s)=>{t.exports=e.x("next-auth/providers/email",()=>require("next-auth/providers/email"))},534189,e=>{"use strict";var t=e.i(902157),s=e.i(750227);let r=process.env.ANALYTICS_STORE_PATH||"data/learning-analytics.json",n={users:{}};function a(){try{let e=s.default.isAbsolute(r)?r:s.default.join(process.cwd(),r);if(!t.default.existsSync(e))return n;let a=t.default.readFileSync(e,"utf8");return JSON.parse(a)}catch{return n}}function i(e,n){let i,o,l,u=a(),d=u.users[e]||{userId:e,events:[],updatedAt:new Date().toISOString()},p=(n||[]).filter(Boolean).map(e=>({...e,timestamp:e.timestamp||new Date().toISOString()})).slice(0,200),c={userId:e,updatedAt:new Date().toISOString(),events:[...d.events,...p].slice(-2e3)};return u.users[e]=c,i=s.default.isAbsolute(r)?r:s.default.join(process.cwd(),r),o=s.default.dirname(i),t.default.existsSync(o)||t.default.mkdirSync(o,{recursive:!0}),l=`${i}.tmp`,t.default.writeFileSync(l,JSON.stringify(u,null,2),"utf8"),t.default.renameSync(l,i),c}function o(e){return a().users[e]||{userId:e,events:[],updatedAt:new Date().toISOString()}}function l(){let e=Object.values(a().users),t={sectionsStarted:0,sectionsCompleted:0,quizAttempts:0,quizCompleted:0,toolUsed:0},s=new Map,r=new Map,n=new Map;for(let a of e)for(let e of a.events){if("section_started"===e.type&&(t.sectionsStarted+=1),"section_completed"===e.type&&(t.sectionsCompleted+=1),"quiz_attempted"===e.type&&(t.quizAttempts+=1),"quiz_completed"===e.type&&(t.quizCompleted+=1),"tool_used"===e.type&&(t.toolUsed+=1),e.sectionId&&e.trackId&&e.levelId){let t=`${e.trackId}:${e.levelId}:${e.sectionId}`;s.set(t,(s.get(t)||0)+1)}if(e.quizId){let t=r.get(e.quizId)||{attempts:0,completed:0};"quiz_attempted"===e.type&&(t.attempts+=1),"quiz_completed"===e.type&&(t.completed+=1),r.set(e.quizId,t)}e.toolId&&n.set(e.toolId,(n.get(e.toolId)||0)+1)}let i=[...s.entries()].sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({key:e,count:t}));return{totals:t,topSections:i,lowestQuizCompletion:[...r.entries()].map(([e,t])=>({quizId:e,attempts:t.attempts,completed:t.completed,completionRate:t.attempts?t.completed/t.attempts:0})).filter(e=>e.attempts>=5).sort((e,t)=>e.completionRate-t.completionRate).slice(0,20),mostUsedTools:[...n.entries()].sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({toolId:e,count:t})),usersTracked:e.length}}e.s(["appendAnalyticsEvents",()=>i,"getOwnerAnalyticsSummary",()=>l,"getUserAnalytics",()=>o])},884393,e=>{"use strict";let t=e.r(534189),s=t.appendAnalyticsEvents,r=t.getUserAnalytics;t.getOwnerAnalyticsSummary,e.s(["appendAnalyticsEvents",0,s,"getUserAnalytics",0,r])},283120,e=>{"use strict";var t=e.i(926747),s=e.i(190406),r=e.i(244898),n=e.i(262950),a=e.i(828414),i=e.i(489521),o=e.i(192489),l=e.i(884393);let u=new Map;async function d(e,t){var s;let r,n;if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});let d=await (0,a.getServerSession)(e,t,i.authOptions),p=d?.user?.id;if(!p)return t.status(401).json({message:"Authentication required"});let c=e.headers["x-forwarded-for"]||e.socket.remoteAddress||"anon";if(s=`analytics:${c}:${p}`,r=Date.now(),n=u.get(s)||{count:0,start:r},r-n.start>6e4?(u.set(s,{count:1,start:r}),!1):n.count>=60||(n.count+=1,u.set(s,n),!1))return t.status(429).json({message:"Rate limit exceeded"});let m=(0,o.getUserById)(p);if(!m)return t.status(404).json({message:"User not found"});if(!(m.consent||{}).cpdDataUseAcceptedAt)return t.status(403).json({message:"Consent required"});let f="string"==typeof e.body?JSON.parse(e.body):e.body,y=Array.isArray(f?.events)?f.events:[];return 0===y.length?t.status(400).json({message:"No events"}):((0,l.appendAnalyticsEvents)(p,y.map(e=>({type:e.type,timestamp:e.timestamp||new Date().toISOString(),trackId:e.trackId,levelId:e.levelId,sectionId:e.sectionId,quizId:e.quizId,success:"boolean"==typeof e.success?e.success:void 0,toolId:e.toolId}))),t.status(200).json({ok:!0}))}e.s(["default",()=>d],660588);var p=e.i(660588),c=e.i(7031),m=e.i(181927),f=e.i(846432);let y=(0,n.hoist)(p,"default"),g=(0,n.hoist)(p,"config"),v=new r.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/analytics/events",pathname:"/api/analytics/events",bundlePath:"",filename:""},userland:p,distDir:".next",relativeProjectDir:""});async function S(e,s,r){v.isDev&&(0,f.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/analytics/events";n=n.replace(/\/index$/,"")||"/";let a=await v.prepare(e,s,{srcPage:n});if(!a){s.statusCode=400,s.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:i,params:o,prerenderManifest:l,routerServerContext:u}=a;try{let t=e.method||"GET",r=(0,c.getTracer)(),a=r.getActiveScopeSpan(),d=v.instrumentationOnRequestError.bind(v),p=async a=>v.render(e,s,{query:{...i,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:v.isDev,page:"/api/analytics/events",internalRevalidate:null==u?void 0:u.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":s.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${t} ${i}`;a.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),a.updateName(e)}else a.updateName(`${t} ${n}`)});a?await p(a):await r.withPropagatedContext(e.headers,()=>r.trace(m.BaseServerSpan.handleRequest,{spanName:`${t} ${n}`,kind:c.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},p))}catch(e){if(v.isDev)throw e;(0,t.sendError)(s,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,g,"default",0,y,"handler",()=>S],283120)}];

//# debugId=f02b6efe-81d9-8b8f-a596-8b715c8d5326
//# sourceMappingURL=%5Broot-of-the-server%5D__1212c341._.js.map