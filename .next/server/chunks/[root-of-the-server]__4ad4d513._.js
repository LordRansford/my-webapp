;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="263b0a2e-1bf7-b638-7d3f-3ca51e1acfd1")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},657194,e=>{"use strict";var t=e.i(89171),r=e.i(254799);let s=new Map;function i(e,i){var n,a;let o,u,d,l=Date.now(),c=`${i.keyPrefix}:${(n=i.keySuffix,o=e.headers.get("x-forwarded-for")||"",u=o.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",d=e.headers.get("user-agent")||"unknown",a=`${u}|${d}|${n||""}`,r.default.createHash("sha256").update(a).digest("hex").slice(0,24))}`,p=s.get(c);if(!p||p.resetAt<=l)return s.set(c,{count:1,resetAt:l+i.windowMs}),null;if(p.count+=1,p.count>i.limit){let e=Math.max(1,Math.ceil((p.resetAt-l)/1e3));return t.NextResponse.json({error:i.message||"Too many requests. Please try again shortly."},{status:429,headers:{"retry-after":String(e)}})}return null}e.s(["rateLimit",()=>i])},936426,e=>{"use strict";var t=e.i(89171);function r(e){let r=e.headers.get("origin"),s=e.headers.get("referer"),i=function(){try{return new URL(process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000").origin}catch{return"http://localhost:3000"}}(),n=null;try{n=new URL(e.url).origin}catch{n=null}let a=r||(s?(()=>{try{return new URL(s).origin}catch{return null}})():null);return a?a===i||n&&a===n?null:t.NextResponse.json({error:"Invalid origin"},{status:403}):t.NextResponse.json({error:"Missing origin"},{status:403})}e.s(["requireSameOrigin",()=>r])},895968,e=>{"use strict";var t=e.i(254799);function r(e){return e.headers.get("x-request-id")||t.default.randomUUID()}async function s(e,t,s){let i=r(e),n=Date.now();try{let e=await s({requestId:i}),r=Date.now()-n;return console.info("req",{requestId:i,route:t.route,status:"ok",durationMs:r}),e}catch(r){let e=Date.now()-n;throw console.error("req",{requestId:i,route:t.route,status:"error",durationMs:e,message:r?.message||"error"}),r}}e.s(["getRequestId",()=>r,"withRequestLogging",()=>s])},563502,e=>{"use strict";var t=e.i(254799);function r(e){return Math.round((Number(e)||0)/60*10)/10}function s(e){return Math.max(0,Math.round(60*(Number(e)||0)))}function i(e){if(!e||"object"!=typeof e)return{ok:!1,error:"State must be an object"};if(!Array.isArray(e.sections)||!Array.isArray(e.activity))return{ok:!1,error:"State must contain sections and activity arrays"};for(let t of e.sections){if(!t.trackId||!t.levelId||!t.sectionId)return{ok:!1,error:"Section missing identifiers"};if(0>Number(t.minutes))return{ok:!1,error:"Section minutes must be non-negative"}}for(let t of e.activity){if(!t.id||!t.trackId||!t.levelId||!t.sectionId||!t.timestamp)return{ok:!1,error:"Activity missing fields"};if(!Number.isFinite(Number(t.minutesDelta)))return{ok:!1,error:"Activity minutesDelta must be numeric"}}return{ok:!0}}function n(e){let r={...e,rulesVersion:"v1"},s=JSON.stringify(r),i=t.default.createHash("sha256").update(s).digest("hex");return{...r,hash:i}}function a(e,t){let s=(e?.activity||[]).filter(e=>e.trackId===t),i=s.reduce((e,t)=>e+(Number(t.minutesDelta)||0),0);return{trackId:t,totalMinutesFromActivity:i,totalHoursFromActivity:r(i),recent:s.slice(0,50).map(e=>({id:e.id,timestamp:e.timestamp,minutesDelta:e.minutesDelta,note:e.note||"",levelId:e.levelId,sectionId:e.sectionId}))}}e.s(["CPD_RULES_VERSION",0,"v1","buildEvidenceRecord",()=>n,"explainCredits",()=>a,"hoursToMinutes",()=>s,"minutesToHours",()=>r,"validateCpdState",()=>i])},685750,e=>{"use strict";let t,r;var s=e.i(124594);let i=Number.isFinite(r=(t=process.env.CREDITS_EXPIRY_DAYS)?Number(t):NaN)&&r>0?Math.floor(r):730;async function n(e){let t=await s.prisma.credits.findUnique({where:{userId:e}});return t||await s.prisma.credits.create({data:{userId:e,balance:0,expiresAt:null}})}async function a(){return{totalUsersWithCredits:await s.prisma.credits.count(),totalCredits:(await s.prisma.credits.aggregate({_sum:{balance:!0}}))._sum.balance??0}}async function o(e){let t=await s.prisma.credits.findUnique({where:{userId:e}});if(!t)return null;if(!t.expiresAt)return t;let r=new Date;return t.expiresAt.getTime()>r.getTime()?t:await s.prisma.credits.update({where:{userId:e},data:{balance:0}})}async function u(e){return s.prisma.creditUsageEvent.create({data:{userId:e.userId,toolId:e.toolId,consumed:e.consumed,units:e.units,freeUnits:e.freeUnits,paidUnits:e.paidUnits,runId:e.runId||null,baseFree:!!e.baseFree,estimatedCredits:Math.max(0,Math.round(Number(e.estimatedCredits)||0)),actualCredits:Math.max(0,Math.round(Number(e.actualCredits)||0)),meteringUnit:e.meteringUnit||"ms",durationMs:Math.max(0,Math.round(Number(e.durationMs)||0)),inputBytes:Math.max(0,Math.round(Number(e.inputBytes)||0)),outputBytes:Math.max(0,Math.round(Number(e.outputBytes)||0)),freeTierAppliedMs:Math.max(0,Math.round(Number(e.freeTierAppliedMs)||0)),paidMs:Math.max(0,Math.round(Number(e.paidMs)||0))}})}async function d(e,t=50){return s.prisma.creditUsageEvent.findMany({where:{userId:e},orderBy:{occurredAt:"desc"},take:Math.max(1,Math.min(200,t))})}function l(e=new Date){let t;return(t=new Date(e)).setDate(t.getDate()+i),t}async function c(e){let t=Math.max(0,Math.round(Number(e.credits)||0));return s.prisma.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:e.expiresAt||null}})}async function p(e){let t=Math.max(0,Math.round(Number(e.credits)||0));if(!t)return{ok:!1,balance:null};let r=l(new Date);return await s.prisma.$transaction(async s=>{let i=await s.credits.findUnique({where:{userId:e.userId}}),n=(i?.balance??0)+t,a=await s.credits.upsert({where:{userId:e.userId},update:{balance:n,expiresAt:i?.expiresAt&&i.expiresAt>r?i.expiresAt:r},create:{userId:e.userId,balance:n,expiresAt:r}});return await s.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:r}}),{ok:!0,balance:a.balance}})}e.s(["computeNewExpiry",()=>l,"createCreditLot",()=>c,"createCreditUsageEvent",()=>u,"enforceCreditExpiry",()=>o,"getCreditsAggregate",()=>a,"getOrCreateCredits",()=>n,"grantCredits",()=>p,"listCreditUsage",()=>d])},356846,e=>{"use strict";var t=e.i(124594);async function r(e){let r=Math.max(0,Math.round(Number(e.credits)||0));return r?t.prisma.$transaction(async t=>{let s=e.userId,i=await t.credits.findUnique({where:{userId:s}}),n=i?.balance??0;if(n<r)return{ok:!1,remainingBalance:n};let a=await t.creditLot.findMany({where:{userId:s,OR:[{remainingCredits:{gt:0}},{remainingCredits:0,credits:{gt:0}}]},orderBy:[{expiresAt:"asc"},{purchasedAt:"asc"},{createdAt:"asc"}],take:200}),o=r;for(let e of a){if(o<=0)break;let r=Math.max(0,e.remainingCredits||e.credits||0);if(!r)continue;let s=Math.min(r,o);o-=s,await t.creditLot.update({where:{id:e.id},data:{remainingCredits:Math.max(0,r-s),amountCredits:e.amountCredits&&e.amountCredits>0?e.amountCredits:e.credits}})}return o>0?{ok:!1,remainingBalance:n}:{ok:!0,remainingBalance:(await t.credits.update({where:{userId:s},data:{balance:n-r}})).balance}}):{ok:!0,remainingBalance:null}}e.s(["deductCreditsFromLots",()=>r])},199355,e=>{"use strict";var t=e.i(89171),r=e.i(757660),s=e.i(568212),i=e.i(124594),n=e.i(685750);async function a(e,t=1.25){let o=await (0,r.getServerSession)(s.authOptions);if(!o?.user?.id)return{ok:!1,status:401,message:"Authentication required. Please sign in to use this feature."};let u=o.user.id;if(e<=0)return{ok:!0,userId:u,balance:0,remainingAfter:0};await (0,n.enforceCreditExpiry)(u);let d=await i.prisma.credits.findUnique({where:{userId:u}}),l=d?.balance??0;if(d?.expiresAt&&d.expiresAt.getTime()<=Date.now())return{ok:!1,status:402,message:"Your credits have expired. Please purchase more credits to continue.",requiredCredits:e,currentBalance:0};let c=Math.ceil(e*t);return l<c?{ok:!1,status:402,message:`Insufficient credits. This operation requires approximately ${e} credits (${c} with safety buffer), but you only have ${l} credits available.`,requiredCredits:c,currentBalance:l}:{ok:!0,userId:u,balance:l,remainingAfter:l-c}}function o(e){return t.NextResponse.json({code:401===e.status?"UNAUTHORIZED":"INSUFFICIENT_CREDITS",message:e.message,requiredCredits:e.requiredCredits,currentBalance:e.currentBalance},{status:e.status})}e.s(["creditGateErrorResponse",()=>o,"enforceCreditGate",()=>a])},986225,e=>{"use strict";let t="2025.01",r={ai:t,cybersecurity:t,"software-architecture":t,data:t,digitalisation:t};function s(e){let s=r[e];return"string"==typeof s&&s.trim()?s.trim():t}e.s(["getActiveCourseVersion",()=>s])},51662,e=>{"use strict";let t={"cybersecurity:foundations":80,"cybersecurity:applied":80,"cybersecurity:practice":80};function r(e){let r=t[`${e.courseId}:${e.levelId}`];return Math.max(0,Math.round("number"==typeof r?r:80))}e.s(["getAssessmentAttemptCredits",()=>r])},338303,e=>{"use strict";e.i(563502);var t=e.i(124594);async function r(e){let r=String(e.userId||"").trim(),s=String(e.courseId||"").trim(),i=e.evidenceType,n=function e(t,r=0){if(r>4||null==t)return null;if("string"==typeof t){let e=t.length>2e3?t.slice(0,2e3):t,r=e.toLowerCase();return r.includes("sk_")||r.includes("whsec_")||r.includes("bearer ")?"[redacted]":e}if("number"==typeof t)return Number.isFinite(t)?t:0;if("boolean"==typeof t)return t;if(Array.isArray(t))return t.slice(0,50).map(t=>e(t,r+1));if("object"==typeof t){let s={};for(let i of Object.keys(t).slice(0,50))s[i]=e(t[i],r+1);return s}return null}(e.payload),a=e.requestMeta?.ip?String(e.requestMeta.ip).slice(0,128):null,o=e.requestMeta?.userAgent?String(e.requestMeta.userAgent).slice(0,256):null,u=t.prisma.courseCompletionEvidence,d=t.prisma.auditEvent,l=await u.create({data:{userId:r,courseId:s,evidenceType:i,payload:n}});return await d.create({data:{actorUserId:r,action:"EVIDENCE_RECORDED",entityType:"evidence",entityId:l.id,details:{courseId:s,evidenceType:i},ip:a,userAgent:o}}),l}e.s(["recordEvidence",()=>r],338303)},75138,e=>{"use strict";var t=e.i(747909),r=e.i(174017),s=e.i(996250),i=e.i(759756),n=e.i(561916),a=e.i(114444),o=e.i(837092),u=e.i(869741),d=e.i(316795),l=e.i(487718),c=e.i(995169),p=e.i(47587),m=e.i(666012),f=e.i(570101),h=e.i(626937),g=e.i(10372),y=e.i(193695);e.i(52474);var w=e.i(600220),I=e.i(89171),v=e.i(757660),x=e.i(568212),A=e.i(124594),b=e.i(895968),C=e.i(936426),R=e.i(657194),M=e.i(199355),E=e.i(356846),N=e.i(685750),S=e.i(51662),q=e.i(338303),k=e.i(986225);function T(e){try{return JSON.stringify(e??null)}catch{return"{}"}}function U(e){if(null==e)return null;if("number"==typeof e||"string"==typeof e||Array.isArray(e))return e;if("object"==typeof e){let t=e.choice;if("number"==typeof t||"string"==typeof t||Array.isArray(t))return t}return null}async function P(e){return(0,b.withRequestLogging)(e,{route:"POST /api/assessments/submit"},async()=>{let t=(0,C.requireSameOrigin)(e);if(t)return t;let r=(0,R.rateLimit)(e,{keyPrefix:"assessments-submit",limit:20,windowMs:6e4});if(r)return r;let s=await (0,v.getServerSession)(x.authOptions).catch(()=>null),i=s?.user?.id||"";if(!i)return I.NextResponse.json({message:"Unauthorized"},{status:401});let n=await e.json().catch(()=>null),a="string"==typeof n?.sessionId?n.sessionId.trim():"",o=n?.answers&&"object"==typeof n.answers?n.answers:null;if(!a||!o)return I.NextResponse.json({message:"Invalid request"},{status:400});let u=await A.prisma.assessmentSession.findUnique({where:{id:a},select:{id:!0,userId:!0,assessmentId:!0,questionIds:!0,startedAt:!0,expiresAt:!0}});if(!u||u.userId!==i)return I.NextResponse.json({message:"Session not found"},{status:404});let d=new Date;if(u.expiresAt.getTime()<=d.getTime())return await A.prisma.assessmentSession.delete({where:{id:u.id}}).catch(()=>null),I.NextResponse.json({message:"Session expired"},{status:409});let l=await A.prisma.assessment.findUnique({where:{id:u.assessmentId},select:{id:!0,courseId:!0,levelId:!0,passThreshold:!0,timeLimit:!0}});if(!l)return await A.prisma.assessmentSession.delete({where:{id:u.id}}).catch(()=>null),I.NextResponse.json({message:"Assessment not found"},{status:404});let c=(0,S.getAssessmentAttemptCredits)({courseId:l.courseId,levelId:l.levelId}),p=await (0,M.enforceCreditGate)(c,1);if(!p.ok)return(0,M.creditGateErrorResponse)(p);let m=JSON.parse(u.questionIds||"[]"),f=new Map((await A.prisma.question.findMany({where:{id:{in:m}},select:{id:!0,question:!0,options:!0,correctAnswer:!0,explanation:!0,tags:!0,type:!0}})).map(e=>[e.id,e])),h=m.map(e=>f.get(e)).filter(Boolean),g=function(e){let t=0,r=[];for(let s of e.questions){let i=e.answers[s.id],n=U(i),a=JSON.parse(s.correctAnswer),o=!1;"number"==typeof a&&"number"==typeof n&&n===a&&(o=!0),"string"==typeof a&&"string"==typeof n&&n===a&&(o=!0),Array.isArray(a)&&Array.isArray(n)&&a.slice().sort().join("|")===n.slice().sort().join("|")&&(o=!0),o&&(t+=1),r.push({questionId:s.id,correct:o,answer:i})}let s=e.questions.length||1,i=Math.round(t/s*100);return{correct:t,total:s,percent:i,perQuestion:r}}({questions:h,answers:o}),y=g.percent>=l.passThreshold,w=Math.max(0,Math.round((d.getTime()-u.startedAt.getTime())/1e3)),b=(0,k.getActiveCourseVersion)(l.courseId);if(!(await (0,E.deductCreditsFromLots)({userId:i,credits:c})).ok)return I.NextResponse.json({message:"Insufficient credits"},{status:402});let P=await A.prisma.assessmentAttempt.create({data:{userId:i,assessmentId:l.id,courseVersion:b,questionIds:u.questionIds||"[]",score:g.percent,passed:y,answers:T(o),timeSpent:w},select:{id:!0,score:!0,passed:!0,completedAt:!0}});Array.isArray(g.perQuestion)&&g.perQuestion.length&&await A.prisma.assessmentAttemptItem.createMany({data:g.perQuestion.map(e=>({attemptId:P.id,questionId:e.questionId,correct:!!e.correct,answer:void 0===e.answer?null:T(e.answer)})),skipDuplicates:!0}).catch(()=>null),await A.prisma.assessmentSession.delete({where:{id:u.id}}).catch(()=>null),await (0,N.createCreditUsageEvent)({userId:i,toolId:"assessment-attempt",consumed:c,units:c,freeUnits:0,paidUnits:c,runId:P.id,baseFree:!1,estimatedCredits:c,actualCredits:c,meteringUnit:"fixed",durationMs:1e3*w,inputBytes:0,outputBytes:0,freeTierAppliedMs:0,paidMs:0}).catch(()=>null);let D=e.headers.get("x-forwarded-for")||"",O=D.split(",")[0]?.trim()||e.headers.get("x-real-ip")||null,_=e.headers.get("user-agent")||null;await (0,q.recordEvidence)({userId:i,courseId:l.courseId,evidenceType:"quiz",payload:{kind:"assessment",levelId:l.levelId,assessmentId:l.id,attemptId:P.id,score:P.score,passed:P.passed,timeSpentSeconds:w},requestMeta:{ip:O,userAgent:_}}).catch(()=>null);let j=!1;if(y){let e=`${l.courseId}:${l.levelId}`;await A.prisma.courseCompletion.upsert({where:{userId_courseId_courseVersion:{userId:i,courseId:e,courseVersion:b}},create:{userId:i,courseId:e,courseVersion:b,completedAt:d,score:g.percent,passed:!0},update:{completedAt:d,score:g.percent,passed:!0}}).catch(()=>null),j=!0}let L=h.map(e=>{let t=o[e.id],r=U(t),s=JSON.parse(e.correctAnswer),i="number"==typeof s&&"number"==typeof r&&r===s||"string"==typeof s&&"string"==typeof r&&r===s||Array.isArray(s)&&Array.isArray(r)&&s.slice().sort().join("|")===r.slice().sort().join("|");return{id:e.id,question:e.question,options:e.options?JSON.parse(e.options):null,userAnswer:t,correctAnswer:s,correct:i,explanation:e.explanation,tags:e.tags,type:e.type}});return I.NextResponse.json({ok:!0,attempt:{id:P.id,score:P.score,passed:P.passed,completedAt:P.completedAt.toISOString(),timeSpentSeconds:w},assessment:{courseId:l.courseId,levelId:l.levelId,passThreshold:l.passThreshold,timeLimitMinutes:l.timeLimit??75},completionWritten:j,certificateCourseId:y?`${l.courseId}:${l.levelId}`:null,review:L},{status:200})})}e.s(["POST",()=>P],58890);var D=e.i(58890);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/assessments/submit/route",pathname:"/api/assessments/submit",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/assessments/submit/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:_,workUnitAsyncStorage:j,serverHooks:L}=O;function $(){return(0,s.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:j})}async function B(e,t,s){O.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let I="/api/assessments/submit/route";I=I.replace(/\/index$/,"")||"/";let v=await O.prepare(e,t,{srcPage:I,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:x,params:A,nextConfig:b,parsedUrl:C,isDraftMode:R,prerenderManifest:M,routerServerContext:E,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,resolvedPathname:q,clientReferenceManifest:k,serverActionsManifest:T}=v,U=(0,u.normalizeAppPath)(I),P=!!(M.dynamicRoutes[U]||M.routes[q]),D=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,C,!1):t.end("This page could not be found"),null);if(P&&!R){let e=!!M.routes[q],t=M.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await D();throw new y.NoFallbackError}}let _=null;!P||O.isDev||R||(_="/index"===(_=q)?"/":_);let j=!0===O.isDev||!P,L=P&&!j;T&&k&&(0,a.setReferenceManifestsSingleton)({page:I,clientReferenceManifest:k,serverActionsManifest:T,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:T})});let $=e.method||"GET",B=(0,n.getTracer)(),H=B.getActiveScopeSpan(),F={params:A,prerenderManifest:M,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>O.onRequestError(e,t,s,E)},sharedContext:{buildId:x}},V=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),G=l.NextRequestAdapter.fromNodeNextRequest(V,(0,l.signalFromNodeResponse)(t));try{let a=async e=>O.handle(G,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${$} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${I}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var n,u;let d=async({previousCacheEntry:r})=>{try{if(!o&&N&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let u=F.renderOpts.pendingWaitUntil;u&&s.waitUntil&&(s.waitUntil(u),u=void 0);let d=F.renderOpts.collectedTags;if(!P)return await (0,m.sendResponse)(V,K,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,s=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:N})},E),t}},l=await O.handleResponse({req:e,nextConfig:b,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:M,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:s.waitUntil,isMinimalMode:o});if(!P)return null;if((null==l||null==(n=l.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",N?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&P||c.delete(g.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,h.getCacheControlHeader)(l.cacheControl)),await (0,m.sendResponse)(V,K,new Response(l.value.body,{headers:c,status:l.value.status||200})),null};H?await u(H):await B.withPropagatedContext(e.headers,()=>B.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${I}`,kind:n.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},u))}catch(t){if(t instanceof y.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:N})}),P)throw t;return await (0,m.sendResponse)(V,K,new Response(null,{status:500})),null}}e.s(["handler",()=>B,"patchFetch",()=>$,"routeModule",()=>O,"serverHooks",()=>L,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>j],75138)}];

//# debugId=263b0a2e-1bf7-b638-7d3f-3ca51e1acfd1
//# sourceMappingURL=%5Broot-of-the-server%5D__4ad4d513._.js.map