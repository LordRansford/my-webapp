;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="dc090ff2-6689-a3e7-0e30-0cf6ba6b7063")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},769890,e=>{"use strict";function t(){return"true"===process.env.BILLING_ENABLED}e.s(["BILLING_DISABLED_MESSAGE",0,"Payments are not enabled yet. You can still use the free tools today.","isBillingEnabled",()=>t])},868154,e=>{"use strict";var t=e.i(902157),r=e.i(750227);let a=process.env.LEARNING_RECORDS_STORE_PATH||"data/learning-records.json",n={records:[]};function s(e,a){try{let n=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);if(!t.default.existsSync(n))return a;return JSON.parse(t.default.readFileSync(n,"utf8"))}catch{return a}}function i(e){let{estimatedMinutes:t,sectionsCompleted:r,quizzesCompleted:a,toolsUsed:n}=e;return Math.min(10*Math.max(0,Number(r)||0)+5*Math.max(0,Number(a)||0)+5*Math.max(0,Number(n)||0),Math.max(0,Number(t)||0))}function o(e){let{userId:t,courseId:r,levelId:a,totalSections:n,completedSectionKeys:s,quizIdsCompleted:o,toolIdsUsed:l,estimatedMinutes:u}=e,d=s.size,c=o.size,p=l.size,f=i({estimatedMinutes:u,sectionsCompleted:d,quizzesCompleted:c,toolsUsed:p}),h=n>0&&d>=n&&c>=1?"completed":d>0||c>0||p>0?"in_progress":"not_started",R="completed"===h?new Date().toISOString():null;return{userId:t,courseId:r,levelId:a,sectionsCompleted:d,quizzesCompleted:c,toolsUsed:p,timeSpentMinutes:f,completionStatus:h,completionDate:R,updatedAt:new Date().toISOString()}}function l(e){let i,o,l,u=s(a,n),d=`${e.userId}:${e.courseId}:${e.levelId}`,c=u.records.findIndex(e=>`${e.userId}:${e.courseId}:${e.levelId}`===d),p=e;if(c>=0){let t=u.records[c],r="completed"===t.completionStatus&&t.completionDate?t.completionDate:e.completionDate;p={...e,completionDate:r},u.records[c]=p}else u.records.push(e);return i=r.default.isAbsolute(a)?a:r.default.join(process.cwd(),a),o=r.default.dirname(i),t.default.existsSync(o)||t.default.mkdirSync(o,{recursive:!0}),l=`${i}.tmp`,t.default.writeFileSync(l,JSON.stringify(u,null,2),"utf8"),t.default.renameSync(l,i),p}function u(e){return(s(a,n).records||[]).filter(t=>t.userId===e)}e.s(["calculateEarnedMinutes",()=>i,"deriveLearningRecord",()=>o,"listLearningRecordsForUser",()=>u,"upsertLearningRecord",()=>l])},946628,e=>{"use strict";let t=e.r(868154);t.calculateEarnedMinutes;let r=t.deriveLearningRecord,a=t.upsertLearningRecord,n=t.listLearningRecordsForUser;e.s(["deriveLearningRecord",0,r,"listLearningRecordsForUser",0,n,"upsertLearningRecord",0,a])},441510,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),n=e.i(759756),s=e.i(561916),i=e.i(114444),o=e.i(837092),l=e.i(869741),u=e.i(316795),d=e.i(487718),c=e.i(995169),p=e.i(47587),f=e.i(666012),h=e.i(570101),R=e.i(626937),m=e.i(10372),E=e.i(193695);e.i(52474);var g=e.i(600220),I=e.i(89171),v=e.i(822880),x=e.i(757660),w=e.i(568212),S=e.i(124594),_=e.i(946628),y=e.i(769890);async function C(e){let t=S.prisma.courseCompletion;return!!await t.findFirst({where:{userId:e.userId,courseId:e.courseId,passed:!0}})||(0,_.listLearningRecordsForUser)(e.userId).some(t=>t.courseId===e.courseId&&"completed"===t.completionStatus)}async function N(e){if(!(0,y.isBillingEnabled)())return I.NextResponse.json({message:y.BILLING_DISABLED_MESSAGE},{status:503});let t=await (0,x.getServerSession)(w.authOptions).catch(()=>null),r=t?.user?.id||"";if(!r)return I.NextResponse.json({message:"Unauthorized"},{status:401});let a=await e.json().catch(()=>null),n="string"==typeof a?.courseId?a.courseId.trim():"";if(!n)return I.NextResponse.json({message:"Missing courseId"},{status:400});let s=S.prisma.certificateEntitlement,i=S.prisma.auditEvent,o=await s.findUnique({where:{userId_courseId:{userId:r,courseId:n}}});if(o&&("eligible"===o.status||"issued"===o.status))return I.NextResponse.json(o,{status:200});await C({userId:r,courseId:n});let l=process.env.STRIPE_SECRET_KEY||"",u=process.env.STRIPE_CERTIFICATE_PRICE_ID||"";if(!l||!u)return I.NextResponse.json({message:"Certificates are not configured"},{status:503});await s.upsert({where:{userId_courseId:{userId:r,courseId:n}},create:{userId:r,courseId:n,status:"pending_payment",stripeSessionId:null},update:{status:"pending_payment"}}),await i.create({data:{actorUserId:r,action:"CERT_REQUESTED",entityType:"certificate",entityId:o?.id||null,details:{courseId:n},ip:(e.headers.get("x-forwarded-for")||"").split(",")[0]?.trim()||e.headers.get("x-real-ip")||null,userAgent:e.headers.get("user-agent")||null}});let d=new v.default(l),c=process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000",p=await d.checkout.sessions.create({mode:"payment",success_url:`${c}/certificates/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${c}/certificates/cancel`,line_items:[{price:u,quantity:1}],metadata:{userId:r,courseId:n,type:"certificate"}});return await s.update({where:{userId_courseId:{userId:r,courseId:n}},data:{stripeSessionId:p.id}}),I.NextResponse.json({url:p.url},{status:200})}e.s(["POST",()=>N],625995);var A=e.i(625995);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/certificates/request/route",pathname:"/api/certificates/request",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/certificates/request/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:b,workUnitAsyncStorage:O,serverHooks:P}=T;function D(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:O})}async function L(e,t,a){T.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let I="/api/certificates/request/route";I=I.replace(/\/index$/,"")||"/";let v=await T.prepare(e,t,{srcPage:I,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:w,nextConfig:S,parsedUrl:_,isDraftMode:y,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:A,revalidateOnlyGenerated:b,resolvedPathname:O,clientReferenceManifest:P,serverActionsManifest:D}=v,L=(0,l.normalizeAppPath)(I),M=!!(C.dynamicRoutes[L]||C.routes[O]),U=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,_,!1):t.end("This page could not be found"),null);if(M&&!y){let e=!!C.routes[O],t=C.dynamicRoutes[L];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await U();throw new E.NoFallbackError}}let q=null;!M||T.isDev||y||(q="/index"===(q=O)?"/":q);let j=!0===T.isDev||!M,H=M&&!j;D&&P&&(0,i.setReferenceManifestsSingleton)({page:I,clientReferenceManifest:P,serverActionsManifest:D,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:D})});let $=e.method||"GET",k=(0,s.getTracer)(),F=k.getActiveScopeSpan(),B={params:w,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>T.onRequestError(e,t,a,N)},sharedContext:{buildId:x}},K=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let i=async e=>T.handle(z,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=k.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${$} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${I}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&A&&b&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!M)return await (0,f.sendResponse)(K,G,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:A})},N),t}},d=await T.handleResponse({req:e,nextConfig:S,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:b,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!M)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&M||c.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)(K,G,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};F?await l(F):await k.withPropagatedContext(e.headers,()=>k.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${I}`,kind:s.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof E.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:L,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:A})}),M)throw t;return await (0,f.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>L,"patchFetch",()=>D,"routeModule",()=>T,"serverHooks",()=>P,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>O],441510)}];

//# debugId=dc090ff2-6689-a3e7-0e30-0cf6ba6b7063
//# sourceMappingURL=%5Broot-of-the-server%5D__dad5984c._.js.map