;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="0f213e62-1da4-b446-fc71-5be45179a682")}catch(e){}}();
module.exports=[814747,(e,t,n)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,n)=>{t.exports=e.x("fs",()=>require("fs"))},406461,(e,t,n)=>{t.exports=e.x("zlib",()=>require("zlib"))},688947,(e,t,n)=>{t.exports=e.x("stream",()=>require("stream"))},657194,e=>{"use strict";var t=e.i(89171),n=e.i(254799);let r=new Map;function s(e,s){var o,a;let i,u,l,d=Date.now(),p=`${s.keyPrefix}:${(o=s.keySuffix,i=e.headers.get("x-forwarded-for")||"",u=i.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",l=e.headers.get("user-agent")||"unknown",a=`${u}|${l}|${o||""}`,n.default.createHash("sha256").update(a).digest("hex").slice(0,24))}`,c=r.get(p);if(!c||c.resetAt<=d)return r.set(p,{count:1,resetAt:d+s.windowMs}),null;if(c.count+=1,c.count>s.limit){let e=Math.max(1,Math.ceil((c.resetAt-d)/1e3));return t.NextResponse.json({error:s.message||"Too many requests. Please try again shortly."},{status:429,headers:{"retry-after":String(e)}})}return null}e.s(["rateLimit",()=>s])},936426,e=>{"use strict";var t=e.i(89171);function n(e){let n=e.headers.get("origin"),r=e.headers.get("referer"),s=function(){try{return new URL(process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000").origin}catch{return"http://localhost:3000"}}(),o=n||(r?(()=>{try{return new URL(r).origin}catch{return null}})():null);return o?o!==s?t.NextResponse.json({error:"Invalid origin"},{status:403}):null:t.NextResponse.json({error:"Missing origin"},{status:403})}e.s(["requireSameOrigin",()=>n])},666680,(e,t,n)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},679061,e=>{"use strict";var t=e.i(33822);let n=process.env.TEMPLATE_STORE_PATH||"data/templates-store.json",r={permissionTokens:[],downloads:[],donations:[]};function s(){return(0,t.readJsonFile)(n,r)}function o(e){(0,t.writeJsonFile)(n,e)}function a(e){let t=s(),n={...e,userId:e.userId||null,anonymousUserId:e.anonymousUserId||null,templateId:e.templateId||null,expiresAt:e.expiresAt||null,notes:e.notes||null};t.permissionTokens=t.permissionTokens.filter(t=>t.tokenId!==e.tokenId),t.permissionTokens.push(n),o(t)}function i(e=200){return[...s().permissionTokens].sort((e,t)=>(t.issuedAt||"").localeCompare(e.issuedAt||"")).slice(0,e)}function u(e){let t=s();t.permissionTokens=t.permissionTokens.filter(t=>t.tokenId!==e),o(t)}function l(e){let t=s();t.downloads.push({...e,fileVariantId:e.fileVariantId||null,userId:e.userId||null,anonymousUserId:e.anonymousUserId||null,donationId:e.donationId||null,permissionTokenId:e.permissionTokenId||null}),o(t)}function d(e){return[...s().donations].filter(e=>"completed"===e.status).filter(t=>t.userId&&t.userId===(e.userId||null)||t.anonymousUserId&&t.anonymousUserId===(e.anonymousUserId||null)).sort((e,t)=>(t.donatedAt||"").localeCompare(e.donatedAt||""))[0]||null}e.s(["deletePermissionToken",()=>u,"getLatestCompletedDonation",()=>d,"listPermissionTokens",()=>i,"saveDownload",()=>l,"savePermissionToken",()=>a])},302e3,e=>{"use strict";var t=e.i(747909),n=e.i(174017),r=e.i(996250),s=e.i(759756),o=e.i(561916),a=e.i(114444),i=e.i(837092),u=e.i(869741),l=e.i(316795),d=e.i(487718),p=e.i(995169),c=e.i(47587),m=e.i(666012),g=e.i(570101),f=e.i(626937),h=e.i(10372),w=e.i(193695);e.i(52474);var I=e.i(600220),v=e.i(89171),y=e.i(493458),R=e.i(254799),x=e.i(679061),T=e.i(657194),S=e.i(936426),k=e.i(757660),A=e.i(568212),E=e.i(363984);let q="rn_anonymous_id";async function N(){let e=await (0,y.cookies)(),t=e.get?.(q)?.value;if(t)return t;let n=R.default.randomUUID();return e.set?.(q,n,{httpOnly:!1,sameSite:"lax",path:"/",maxAge:63072e3}),n}async function _(e){let t=(0,S.requireSameOrigin)(e);if(t)return t;let n=(0,T.rateLimit)(e,{keyPrefix:"templates-request-download",limit:30,windowMs:6e4});if(n)return n;let r=await e.json().catch(()=>null);if(!r||"object"!=typeof r)return v.NextResponse.json({error:"Invalid request body"},{status:400});if("string"!=typeof r.templateId)return v.NextResponse.json({error:"templateId is required"},{status:400});if("string"!=typeof r.requestedUse)return v.NextResponse.json({error:"requestedUse is required"},{status:400});let s=r.templateId,o=r.requestedUse;if("internal_use"!==o&&"commercial_use_keep_signature"!==o&&"commercial_use_remove_signature"!==o)return v.NextResponse.json({error:"requestedUse is invalid"},{status:400});let a=await (0,k.getServerSession)(A.authOptions).catch(()=>null),i=a?.user?.id||null,u=await (0,E.runWithMetering)({req:e,userId:i,toolId:"templates-request-download",inputBytes:Buffer.byteLength(JSON.stringify(r)),requestedComplexityPreset:"light",execute:async()=>{var e;let t,n=await N(),r=function(e){var t;let n,r,s,o,{requestedUse:a,permissionTokens:i,donationQualification:u}=e;if("internal_use"===a)return{allowed:!0,reason:"internal-use",uiMessage:"You can use and remove the signature for internal work.",mustKeepSignature:!1,needsSupport:!1};if("commercial_use_keep_signature"===a)return{allowed:!0,reason:"commercial-keep-signature",uiMessage:"Commercial use is fine as long as the signature stays.",mustKeepSignature:!0,needsSupport:!1};let l=i?.[0],d=u??(t={userId:e.userId,anonymousUserId:e.anonymousUserId},n=(0,x.getLatestCompletedDonation)(t),o=Number.isFinite(s=(r=process.env.TEMPLATE_DONATION_MIN_AMOUNT)?Number(r):5)&&s>0?s:5,n?{qualifying:"number"==typeof n.amount&&n.amount>=o,donationId:n.donationId,donatedAt:n.donatedAt}:{qualifying:!1,donationId:null,donatedAt:null}),p=d?.qualifying,c=!!l;return p||c?{allowed:!0,reason:p?"commercial-remove-with-donation":"commercial-remove-with-permission-token",uiMessage:"You can remove the signature because you are supported.",mustKeepSignature:!1,needsSupport:!0,appliedSupportMethod:p?"donation":"written_permission",appliedDonationId:p&&d?.donationId||null,appliedPermissionTokenId:l?.tokenId||null}:{allowed:!1,reason:"commercial-remove-requires-support",uiMessage:"To remove the signature, add a donation or provide your permission token.",mustKeepSignature:!1,needsSupport:!0}}({templateId:s,requestedUse:o,userId:i,anonymousUserId:n});if(!r.allowed)return{output:{allowed:!1,message:r.uiMessage,reason:r.reason},outputBytes:Buffer.byteLength(r.uiMessage||"")};let a=r.appliedSupportMethod||(r.appliedDonationId?"donation":r.appliedPermissionTokenId?"written_permission":"none"),u=r.mustKeepSignature?"kept":"removed",l=R.default.randomUUID();(0,x.saveDownload)({downloadId:l,templateId:s,fileVariantId:r.mustKeepSignature?"signed":"unsigned",userId:i,anonymousUserId:n,requestedUse:o,supportMethod:a,donationId:r.appliedDonationId||null,permissionTokenId:r.appliedPermissionTokenId||null,issuedAt:new Date().toISOString(),signaturePolicyApplied:u});let d={allowed:!0,downloadId:l,signedUrl:(e=r.mustKeepSignature?"signed":"unsigned",t=Buffer.from(JSON.stringify({templateId:s,variant:e,ts:Date.now()})).toString("base64url"),`/api/templates/download?token=${t}`),mustKeepSignature:r.mustKeepSignature,message:r.uiMessage};return{output:d,outputBytes:Buffer.byteLength(JSON.stringify(d))}}});return u.ok?u.output?.allowed===!1?v.NextResponse.json({...u.output,receipt:u.receipt},{status:403}):v.NextResponse.json({...u.output,receipt:u.receipt},{status:200}):v.NextResponse.json({message:u.message,estimate:u.estimate},{status:u.status})}e.s(["POST",()=>_],621489);var C=e.i(621489);let U=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/templates/request-download/route",pathname:"/api/templates/request-download",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/templates/request-download/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:P,workUnitAsyncStorage:b,serverHooks:M}=U;function O(){return(0,r.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:b})}async function D(e,t,r){U.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/templates/request-download/route";v=v.replace(/\/index$/,"")||"/";let y=await U.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:x,nextConfig:T,parsedUrl:S,isDraftMode:k,prerenderManifest:A,routerServerContext:E,isOnDemandRevalidate:q,revalidateOnlyGenerated:N,resolvedPathname:_,clientReferenceManifest:C,serverActionsManifest:P}=y,b=(0,u.normalizeAppPath)(v),M=!!(A.dynamicRoutes[b]||A.routes[_]),O=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,S,!1):t.end("This page could not be found"),null);if(M&&!k){let e=!!A.routes[_],t=A.dynamicRoutes[b];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await O();throw new w.NoFallbackError}}let D=null;!M||U.isDev||k||(D="/index"===(D=_)?"/":D);let j=!0===U.isDev||!M,H=M&&!j;P&&C&&(0,a.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:C,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let L=e.method||"GET",K=(0,o.getTracer)(),$=K.getActiveScopeSpan(),B={params:x,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r)=>U.onRequestError(e,t,r,E)},sharedContext:{buildId:R}},F=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let a=async e=>U.handle(J,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=K.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${L} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${v}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var o,u;let l=async({previousCacheEntry:n})=>{try{if(!i&&q&&N&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await a(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let u=B.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let l=B.renderOpts.collectedTags;if(!M)return await (0,m.sendResponse)(F,V,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);l&&(t[h.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:I.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await U.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:q})},E),t}},d=await U.handleResponse({req:e,nextConfig:T,cacheKey:D,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:q,revalidateOnlyGenerated:N,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:i});if(!M)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==I.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",q?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&M||p.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(F,V,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};$?await u($):await K.withPropagatedContext(e.headers,()=>K.trace(p.BaseServerSpan.handleRequest,{spanName:`${L} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},u))}catch(t){if(t instanceof w.NoFallbackError||await U.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:q})}),M)throw t;return await (0,m.sendResponse)(F,V,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>O,"routeModule",()=>U,"serverHooks",()=>M,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>b],302e3)}];

//# debugId=0f213e62-1da4-b446-fc71-5be45179a682
//# sourceMappingURL=%5Broot-of-the-server%5D__547b7219._.js.map