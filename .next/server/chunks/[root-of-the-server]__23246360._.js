;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="488b1779-d3e6-c653-27fc-e81b579cdbaa")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},769890,e=>{"use strict";function t(){return"true"===process.env.BILLING_ENABLED}e.s(["BILLING_DISABLED_MESSAGE",0,"Payments are not enabled yet. You can still use the free tools today.","isBillingEnabled",()=>t])},868154,e=>{"use strict";var t=e.i(902157),r=e.i(750227);let a=process.env.LEARNING_RECORDS_STORE_PATH||"data/learning-records.json",s={records:[]};function n(e,a){try{let s=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);if(!t.default.existsSync(s))return a;return JSON.parse(t.default.readFileSync(s,"utf8"))}catch{return a}}function i(e){let{estimatedMinutes:t,sectionsCompleted:r,quizzesCompleted:a,toolsUsed:s}=e;return Math.min(10*Math.max(0,Number(r)||0)+5*Math.max(0,Number(a)||0)+5*Math.max(0,Number(s)||0),Math.max(0,Number(t)||0))}function o(e){let{userId:t,courseId:r,levelId:a,totalSections:s,completedSectionKeys:n,quizIdsCompleted:o,toolIdsUsed:l,estimatedMinutes:u}=e,d=n.size,c=o.size,p=l.size,f=i({estimatedMinutes:u,sectionsCompleted:d,quizzesCompleted:c,toolsUsed:p}),h=s>0&&d>=s&&c>=1?"completed":d>0||c>0||p>0?"in_progress":"not_started",R="completed"===h?new Date().toISOString():null;return{userId:t,courseId:r,levelId:a,sectionsCompleted:d,quizzesCompleted:c,toolsUsed:p,timeSpentMinutes:f,completionStatus:h,completionDate:R,updatedAt:new Date().toISOString()}}function l(e){let i,o,l,u=n(a,s),d=`${e.userId}:${e.courseId}:${e.levelId}`,c=u.records.findIndex(e=>`${e.userId}:${e.courseId}:${e.levelId}`===d),p=e;if(c>=0){let t=u.records[c],r="completed"===t.completionStatus&&t.completionDate?t.completionDate:e.completionDate;p={...e,completionDate:r},u.records[c]=p}else u.records.push(e);return i=r.default.isAbsolute(a)?a:r.default.join(process.cwd(),a),o=r.default.dirname(i),t.default.existsSync(o)||t.default.mkdirSync(o,{recursive:!0}),l=`${i}.tmp`,t.default.writeFileSync(l,JSON.stringify(u,null,2),"utf8"),t.default.renameSync(l,i),p}function u(e){return(n(a,s).records||[]).filter(t=>t.userId===e)}e.s(["calculateEarnedMinutes",()=>i,"deriveLearningRecord",()=>o,"listLearningRecordsForUser",()=>u,"upsertLearningRecord",()=>l])},946628,e=>{"use strict";let t=e.r(868154);t.calculateEarnedMinutes;let r=t.deriveLearningRecord,a=t.upsertLearningRecord,s=t.listLearningRecordsForUser;e.s(["deriveLearningRecord",0,r,"listLearningRecordsForUser",0,s,"upsertLearningRecord",0,a])},441510,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),s=e.i(759756),n=e.i(561916),i=e.i(114444),o=e.i(837092),l=e.i(869741),u=e.i(316795),d=e.i(487718),c=e.i(995169),p=e.i(47587),f=e.i(666012),h=e.i(570101),R=e.i(626937),m=e.i(10372),E=e.i(193695);e.i(52474);var g=e.i(600220),x=e.i(89171),I=e.i(822880),v=e.i(757660),w=e.i(568212),S=e.i(124594),_=e.i(946628),y=e.i(769890);async function C(e){let t=S.prisma.courseCompletion;return!!await t.findFirst({where:{userId:e.userId,courseId:e.courseId,passed:!0}})||(0,_.listLearningRecordsForUser)(e.userId).some(t=>t.courseId===e.courseId&&"completed"===t.completionStatus)}async function N(e){if(!(0,y.isBillingEnabled)())return x.NextResponse.json({message:y.BILLING_DISABLED_MESSAGE},{status:503});let t=await (0,v.getServerSession)(w.authOptions).catch(()=>null),r=t?.user?.id||"";if(!r)return x.NextResponse.json({message:"Unauthorized"},{status:401});let a=await e.json().catch(()=>null),s="string"==typeof a?.courseId?a.courseId.trim():"";if(!s)return x.NextResponse.json({message:"Missing courseId"},{status:400});let n=S.prisma.certificateEntitlement,i=S.prisma.auditEvent,o=await n.findUnique({where:{userId_courseId:{userId:r,courseId:s}}});if(o&&("eligible"===o.status||"issued"===o.status))return x.NextResponse.json(o,{status:200});await C({userId:r,courseId:s});let l=process.env.STRIPE_SECRET_KEY||"",u=process.env.STRIPE_CERTIFICATE_PRICE_ID||"";if(!l||!u)return x.NextResponse.json({message:"Certificates are not configured"},{status:503});await n.upsert({where:{userId_courseId:{userId:r,courseId:s}},create:{userId:r,courseId:s,status:"pending_payment",stripeSessionId:null},update:{status:"pending_payment"}}),await i.create({data:{actorUserId:r,action:"CERT_REQUESTED",entityType:"certificate",entityId:o?.id||null,details:{courseId:s},ip:(e.headers.get("x-forwarded-for")||"").split(",")[0]?.trim()||e.headers.get("x-real-ip")||null,userAgent:e.headers.get("user-agent")||null}});let d=new I.default(l),c=process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000",p=await d.checkout.sessions.create({mode:"payment",success_url:`${c}/certificates/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${c}/certificates/cancel`,line_items:[{price:u,quantity:1}],metadata:{userId:r,courseId:s,type:"certificate"}});return await n.update({where:{userId_courseId:{userId:r,courseId:s}},data:{stripeSessionId:p.id}}),x.NextResponse.json({url:p.url},{status:200})}e.s(["POST",()=>N],625995);var A=e.i(625995);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/certificates/request/route",pathname:"/api/certificates/request",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/certificates/request/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:b,workUnitAsyncStorage:O,serverHooks:P}=T;function q(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:O})}async function D(e,t,a){T.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/certificates/request/route";x=x.replace(/\/index$/,"")||"/";let I=await T.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!I)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:w,nextConfig:S,parsedUrl:_,isDraftMode:y,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:A,revalidateOnlyGenerated:b,resolvedPathname:O,clientReferenceManifest:P,serverActionsManifest:q}=I,D=(0,l.normalizeAppPath)(x),L=!!(C.dynamicRoutes[D]||C.routes[O]),M=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,_,!1):t.end("This page could not be found"),null);if(L&&!y){let e=!!C.routes[O],t=C.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await M();throw new E.NoFallbackError}}let U=null;!L||T.isDev||y||(U="/index"===(U=O)?"/":U);let j=!0===T.isDev||!L,H=L&&!j;q&&P&&(0,i.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:P,serverActionsManifest:q,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:q})});let $=e.method||"GET",k=(0,n.getTracer)(),F=k.getActiveScopeSpan(),B={params:w,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>T.onRequestError(e,t,a,N)},sharedContext:{buildId:v}},K=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let i=async e=>T.handle(z,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=k.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${$} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${x}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&A&&b&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!L)return await (0,f.sendResponse)(K,G,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:A})},N),t}},d=await T.handleResponse({req:e,nextConfig:S,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:b,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!L)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&L||c.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)(K,G,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};F?await l(F):await k.withPropagatedContext(e.headers,()=>k.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${x}`,kind:n.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof E.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:A})}),L)throw t;return await (0,f.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>q,"routeModule",()=>T,"serverHooks",()=>P,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>O],441510)}];

//# debugId=488b1779-d3e6-c653-27fc-e81b579cdbaa
//# sourceMappingURL=%5Broot-of-the-server%5D__23246360._.js.map