;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="2a0e70a8-8600-5e8b-5ea9-7a632559cd98")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},199355,e=>{"use strict";var t=e.i(89171),r=e.i(757660),a=e.i(568212),i=e.i(124594),n=e.i(685750);async function s(e,t=1.25){let o=await (0,r.getServerSession)(a.authOptions);if(!o?.user?.id)return{ok:!1,status:401,message:"Authentication required. Please sign in to use this feature."};let u=o.user.id;if(e<=0)return{ok:!0,userId:u,balance:0,remainingAfter:0};await (0,n.enforceCreditExpiry)(u);let d=await i.prisma.credits.findUnique({where:{userId:u}}),l=d?.balance??0;if(d?.expiresAt&&d.expiresAt.getTime()<=Date.now())return{ok:!1,status:402,message:"Your credits have expired. Please purchase more credits to continue.",requiredCredits:e,currentBalance:0};let c=Math.ceil(e*t);return l<c?{ok:!1,status:402,message:`Insufficient credits. This operation requires approximately ${e} credits (${c} with safety buffer), but you only have ${l} credits available.`,requiredCredits:c,currentBalance:l}:{ok:!0,userId:u,balance:l,remainingAfter:l-c}}function o(e){return t.NextResponse.json({code:401===e.status?"UNAUTHORIZED":"INSUFFICIENT_CREDITS",message:e.message,requiredCredits:e.requiredCredits,currentBalance:e.currentBalance},{status:e.status})}e.s(["creditGateErrorResponse",()=>o,"enforceCreditGate",()=>s])},685750,e=>{"use strict";let t,r;var a=e.i(124594);let i=Number.isFinite(r=(t=process.env.CREDITS_EXPIRY_DAYS)?Number(t):NaN)&&r>0?Math.floor(r):730;async function n(e){let t=await a.prisma.credits.findUnique({where:{userId:e}});return t||await a.prisma.credits.create({data:{userId:e,balance:0,expiresAt:null}})}async function s(){return{totalUsersWithCredits:await a.prisma.credits.count(),totalCredits:(await a.prisma.credits.aggregate({_sum:{balance:!0}}))._sum.balance??0}}async function o(e){let t=await a.prisma.credits.findUnique({where:{userId:e}});if(!t)return null;if(!t.expiresAt)return t;let r=new Date;return t.expiresAt.getTime()>r.getTime()?t:await a.prisma.credits.update({where:{userId:e},data:{balance:0}})}async function u(e){return a.prisma.creditUsageEvent.create({data:{userId:e.userId,toolId:e.toolId,consumed:e.consumed,units:e.units,freeUnits:e.freeUnits,paidUnits:e.paidUnits,runId:e.runId||null,baseFree:!!e.baseFree,estimatedCredits:Math.max(0,Math.round(Number(e.estimatedCredits)||0)),actualCredits:Math.max(0,Math.round(Number(e.actualCredits)||0)),meteringUnit:e.meteringUnit||"ms",durationMs:Math.max(0,Math.round(Number(e.durationMs)||0)),inputBytes:Math.max(0,Math.round(Number(e.inputBytes)||0)),outputBytes:Math.max(0,Math.round(Number(e.outputBytes)||0)),freeTierAppliedMs:Math.max(0,Math.round(Number(e.freeTierAppliedMs)||0)),paidMs:Math.max(0,Math.round(Number(e.paidMs)||0))}})}async function d(e,t=50){return a.prisma.creditUsageEvent.findMany({where:{userId:e},orderBy:{occurredAt:"desc"},take:Math.max(1,Math.min(200,t))})}function l(e=new Date){let t;return(t=new Date(e)).setDate(t.getDate()+i),t}async function c(e){let t=Math.max(0,Math.round(Number(e.credits)||0));return a.prisma.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:e.expiresAt||null}})}async function p(e){let t=Math.max(0,Math.round(Number(e.credits)||0));if(!t)return{ok:!1,balance:null};let r=l(new Date);return await a.prisma.$transaction(async a=>{let i=await a.credits.findUnique({where:{userId:e.userId}}),n=(i?.balance??0)+t,s=await a.credits.upsert({where:{userId:e.userId},update:{balance:n,expiresAt:i?.expiresAt&&i.expiresAt>r?i.expiresAt:r},create:{userId:e.userId,balance:n,expiresAt:r}});return await a.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:r}}),{ok:!0,balance:s.balance}})}e.s(["computeNewExpiry",()=>l,"createCreditLot",()=>c,"createCreditUsageEvent",()=>u,"enforceCreditExpiry",()=>o,"getCreditsAggregate",()=>s,"getOrCreateCredits",()=>n,"grantCredits",()=>p,"listCreditUsage",()=>d])},356846,e=>{"use strict";var t=e.i(124594);async function r(e){let r=Math.max(0,Math.round(Number(e.credits)||0));return r?t.prisma.$transaction(async t=>{let a=e.userId,i=await t.credits.findUnique({where:{userId:a}}),n=i?.balance??0;if(n<r)return{ok:!1,remainingBalance:n};let s=await t.creditLot.findMany({where:{userId:a,OR:[{remainingCredits:{gt:0}},{remainingCredits:0,credits:{gt:0}}]},orderBy:[{expiresAt:"asc"},{purchasedAt:"asc"},{createdAt:"asc"}],take:200}),o=r;for(let e of s){if(o<=0)break;let r=Math.max(0,e.remainingCredits||e.credits||0);if(!r)continue;let a=Math.min(r,o);o-=a,await t.creditLot.update({where:{id:e.id},data:{remainingCredits:Math.max(0,r-a),amountCredits:e.amountCredits&&e.amountCredits>0?e.amountCredits:e.credits}})}return o>0?{ok:!1,remainingBalance:n}:{ok:!0,remainingBalance:(await t.credits.update({where:{userId:a},data:{balance:n-r}})).balance}}):{ok:!0,remainingBalance:null}}e.s(["deductCreditsFromLots",()=>r])},154642,e=>{"use strict";var t=e.i(356846),r=e.i(685750);async function a(e){let a=Math.max(0,Math.round(Number(e.credits)||0));if(a<=0)return{ok:!0,remainingBalance:null};try{let i=await (0,t.deductCreditsFromLots)({userId:e.userId,credits:a});if(!i.ok)return{ok:!1,remainingBalance:i.remainingBalance,error:"Insufficient credits for deduction"};return await (0,r.createCreditUsageEvent)({userId:e.userId,toolId:e.toolId,consumed:a,units:a,freeUnits:0,paidUnits:a,baseFree:!1,estimatedCredits:a,actualCredits:a,meteringUnit:"fixed",durationMs:0,inputBytes:0,outputBytes:0,freeTierAppliedMs:0,paidMs:0}).catch(()=>null),{ok:!0,remainingBalance:i.remainingBalance??0}}catch(e){return{ok:!1,remainingBalance:null,error:e instanceof Error?e.message:"Unknown error during credit deduction"}}}e.s(["deductCredits",()=>a])},589853,e=>{"use strict";var t=e.i(254799),r=e.i(757660),a=e.i(568212),i=e.i(670655),n=e.i(65684),s=e.i(98085),o=e.i(333248);async function u(u){let d=await (0,r.getServerSession)(a.authOptions),l=d?.user?.id||null;if(!l){let e=Error("Sign in required");throw e.status=401,e}let c=await (0,n.getUserPlan)(l),p=await (0,s.estimateCredits)(u);if(!p){let e=Error("Failed to estimate credits for tool");throw e.status=500,e}let m=await (0,s.hasSufficientCredits)(l,p.max);if(!m.sufficient){let e=Error("Insufficient credits");throw e.status=402,e.code="INSUFFICIENT_CREDITS",e.balance=m.balance,e.required=p.max,e.shortfall=m.shortfall,e}let h=await (0,s.getUserSpendLimits)(l),f=await (0,s.validateSpendLimits)(l,p.max,h);if(!f.allowed){let e=Error("Daily credit limit reached");throw e.status=429,e.code="SPEND_LIMIT_EXCEEDED",e.reason=f.reason,e.action=f.action,e.limit=h.dailyCap,e}let g=await (0,o.getCreditBalance)(l),{getDailyCreditsConsumed:w}=await e.A(549292),C=await w(l),x=Math.max(0,h.dailyCap-C);return(0,i.addToolRun)({id:t.default.randomUUID(),userId:l||null,anonymousUserId:null,toolId:u,timestamp:new Date().toISOString()}),{plan:c,balance:g,estimatedCredits:p.typical,dailyCap:h.dailyCap,dailyUsed:C,remainingDailyCap:x}}e.s(["assertToolRunAllowed",()=>u])},681072,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),i=e.i(759756),n=e.i(561916),s=e.i(114444),o=e.i(837092),u=e.i(869741),d=e.i(316795),l=e.i(487718),c=e.i(995169),p=e.i(47587),m=e.i(666012),h=e.i(570101),f=e.i(626937),g=e.i(10372),w=e.i(193695);e.i(52474);var C=e.i(600220),x=e.i(89171),I=e.i(504446),v=e.i(469719),R=e.i(589853),y=e.i(757660),E=e.i(568212),b=e.i(199355),M=e.i(154642);let A=new Map,N=v.z.object({target:v.z.string().trim().min(1)});async function P(e){var t;let r,a,i;if(t=e.headers.get("x-forwarded-for")||"anon",a=Date.now(),i=A.get(t)||{count:0,start:a},a-i.start>6e4?(A.set(t,{count:1,start:a}),!1):i.count>=20||(i.count+=1,A.set(t,i),!1))return x.NextResponse.json({message:"Rate limit exceeded"},{status:429});try{await (0,R.assertToolRunAllowed)("ip-reputation")}catch(e){return x.NextResponse.json({message:e.message||"Limit reached"},{status:e.status||429})}try{r=N.parse(await e.json())}catch{return x.NextResponse.json({message:"Invalid input"},{status:400})}let n=r.target.trim();if(!I.default.isIP(n)||(e=>{let t=I.default.isIP(e)?e:null;if(!t)return!1;let r=t.split(".").map(e=>parseInt(e,10));return 10===r[0]||172===r[0]&&!!(r[1]>=16)&&!!(r[1]<=31)||192===r[0]&&168===r[1]||127===r[0]})(n))return x.NextResponse.json({message:"Provide a valid public IP address"},{status:400});let s=await (0,y.getServerSession)(E.authOptions).catch(()=>null);if(!s?.user?.id)return x.NextResponse.json({message:"Authentication required. Please sign in to use this tool."},{status:401});let o=await (0,b.enforceCreditGate)(1);if(!o.ok)return(0,b.creditGateErrorResponse)(o);try{return await (0,M.deductCredits)({userId:o.userId,credits:1,toolId:"ip-reputation"}),x.NextResponse.json({target:n,fallback:!0,reputation:"No automated reputation feed configured. Check trusted threat intel sources.",guidance:"Combine IP checks with context, logs, and behavioural indicators."})}catch(e){return console.error("[ip-reputation] Error:",e),x.NextResponse.json({message:"Failed to check IP reputation"},{status:500})}}e.s(["POST",()=>P],306450);var U=e.i(306450);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/tools/ip-reputation/route",pathname:"/api/tools/ip-reputation",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/tools/ip-reputation/route.js",nextConfigOutput:"",userland:U}),{workAsyncStorage:S,workUnitAsyncStorage:T,serverHooks:q}=k;function D(){return(0,a.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:T})}async function O(e,t,a){k.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/tools/ip-reputation/route";x=x.replace(/\/index$/,"")||"/";let I=await k.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!I)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:y,parsedUrl:E,isDraftMode:b,prerenderManifest:M,routerServerContext:A,isOnDemandRevalidate:N,revalidateOnlyGenerated:P,resolvedPathname:U,clientReferenceManifest:S,serverActionsManifest:T}=I,q=(0,u.normalizeAppPath)(x),D=!!(M.dynamicRoutes[q]||M.routes[U]),O=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,E,!1):t.end("This page could not be found"),null);if(D&&!b){let e=!!M.routes[U],t=M.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await O();throw new w.NoFallbackError}}let _=null;!D||k.isDev||b||(_="/index"===(_=U)?"/":_);let B=!0===k.isDev||!D,j=D&&!B;T&&S&&(0,s.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:S,serverActionsManifest:T,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:T})});let F=e.method||"GET",H=(0,n.getTracer)(),L=H.getActiveScopeSpan(),$={params:R,prerenderManifest:M,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>k.onRequestError(e,t,a,A)},sharedContext:{buildId:v}},K=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),z=l.NextRequestAdapter.fromNodeNextRequest(K,(0,l.signalFromNodeResponse)(t));try{let s=async e=>k.handle(z,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${x}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var n,u;let d=async({previousCacheEntry:r})=>{try{if(!o&&N&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=$.renderOpts.fetchMetrics;let u=$.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let d=$.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(K,G,n,$.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,a=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:N})},A),t}},l=await k.handleResponse({req:e,nextConfig:y,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:M,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!D)return null;if((null==l||null==(n=l.value)?void 0:n.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",N?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&D||c.delete(g.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(l.cacheControl)),await (0,m.sendResponse)(K,G,new Response(l.value.body,{headers:c,status:l.value.status||200})),null};L?await u(L):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${x}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},u))}catch(t){if(t instanceof w.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:N})}),D)throw t;return await (0,m.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>D,"routeModule",()=>k,"serverHooks",()=>q,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>T],681072)},549292,e=>{e.v(e=>Promise.resolve().then(()=>e(333248)))},118191,e=>{e.v(e=>Promise.resolve().then(()=>e(685750)))},119949,e=>{e.v(e=>Promise.resolve().then(()=>e(124594)))}];

//# debugId=2a0e70a8-8600-5e8b-5ea9-7a632559cd98
//# sourceMappingURL=%5Broot-of-the-server%5D__ada94a50._.js.map