;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="62baad5b-58f5-3323-6107-066116646ac1")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},657194,e=>{"use strict";var t=e.i(89171),r=e.i(254799);let a=new Map;function s(e,s){var i,n;let o,u,l,d=Date.now(),c=`${s.keyPrefix}:${(i=s.keySuffix,o=e.headers.get("x-forwarded-for")||"",u=o.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",l=e.headers.get("user-agent")||"unknown",n=`${u}|${l}|${i||""}`,r.default.createHash("sha256").update(n).digest("hex").slice(0,24))}`,p=a.get(c);if(!p||p.resetAt<=d)return a.set(c,{count:1,resetAt:d+s.windowMs}),null;if(p.count+=1,p.count>s.limit){let e=Math.max(1,Math.ceil((p.resetAt-d)/1e3));return t.NextResponse.json({error:s.message||"Too many requests. Please try again shortly."},{status:429,headers:{"retry-after":String(e)}})}return null}e.s(["rateLimit",()=>s])},936426,e=>{"use strict";var t=e.i(89171);function r(e){let r=e.headers.get("origin"),a=e.headers.get("referer"),s=function(){try{return new URL(process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000").origin}catch{return"http://localhost:3000"}}(),i=r||(a?(()=>{try{return new URL(a).origin}catch{return null}})():null);return i?i!==s?t.NextResponse.json({error:"Invalid origin"},{status:403}):null:t.NextResponse.json({error:"Missing origin"},{status:403})}e.s(["requireSameOrigin",()=>r])},895968,e=>{"use strict";var t=e.i(254799);function r(e){return e.headers.get("x-request-id")||t.default.randomUUID()}async function a(e,t,a){let s=r(e),i=Date.now();try{let e=await a({requestId:s}),r=Date.now()-i;return console.info("req",{requestId:s,route:t.route,status:"ok",durationMs:r}),e}catch(r){let e=Date.now()-i;throw console.error("req",{requestId:s,route:t.route,status:"error",durationMs:e,message:r?.message||"error"}),r}}e.s(["getRequestId",()=>r,"withRequestLogging",()=>a])},685750,e=>{"use strict";let t,r;var a=e.i(124594);let s=Number.isFinite(r=(t=process.env.CREDITS_EXPIRY_DAYS)?Number(t):NaN)&&r>0?Math.floor(r):730;async function i(e){let t=await a.prisma.credits.findUnique({where:{userId:e}});return t||await a.prisma.credits.create({data:{userId:e,balance:0,expiresAt:null}})}async function n(){return{totalUsersWithCredits:await a.prisma.credits.count(),totalCredits:(await a.prisma.credits.aggregate({_sum:{balance:!0}}))._sum.balance??0}}async function o(e){let t=await a.prisma.credits.findUnique({where:{userId:e}});if(!t)return null;if(!t.expiresAt)return t;let r=new Date;return t.expiresAt.getTime()>r.getTime()?t:await a.prisma.credits.update({where:{userId:e},data:{balance:0}})}async function u(e){return a.prisma.creditUsageEvent.create({data:{userId:e.userId,toolId:e.toolId,consumed:e.consumed,units:e.units,freeUnits:e.freeUnits,paidUnits:e.paidUnits,runId:e.runId||null,baseFree:!!e.baseFree,estimatedCredits:Math.max(0,Math.round(Number(e.estimatedCredits)||0)),actualCredits:Math.max(0,Math.round(Number(e.actualCredits)||0)),meteringUnit:e.meteringUnit||"ms",durationMs:Math.max(0,Math.round(Number(e.durationMs)||0)),inputBytes:Math.max(0,Math.round(Number(e.inputBytes)||0)),outputBytes:Math.max(0,Math.round(Number(e.outputBytes)||0)),freeTierAppliedMs:Math.max(0,Math.round(Number(e.freeTierAppliedMs)||0)),paidMs:Math.max(0,Math.round(Number(e.paidMs)||0))}})}async function l(e,t=50){return a.prisma.creditUsageEvent.findMany({where:{userId:e},orderBy:{occurredAt:"desc"},take:Math.max(1,Math.min(200,t))})}function d(e=new Date){let t;return(t=new Date(e)).setDate(t.getDate()+s),t}async function c(e){let t=Math.max(0,Math.round(Number(e.credits)||0));return a.prisma.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:e.expiresAt||null}})}async function p(e){let t=Math.max(0,Math.round(Number(e.credits)||0));if(!t)return{ok:!1,balance:null};let r=d(new Date);return await a.prisma.$transaction(async a=>{let s=await a.credits.findUnique({where:{userId:e.userId}}),i=(s?.balance??0)+t,n=await a.credits.upsert({where:{userId:e.userId},update:{balance:i,expiresAt:s?.expiresAt&&s.expiresAt>r?s.expiresAt:r},create:{userId:e.userId,balance:i,expiresAt:r}});return await a.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:r}}),{ok:!0,balance:n.balance}})}e.s(["computeNewExpiry",()=>d,"createCreditLot",()=>c,"createCreditUsageEvent",()=>u,"enforceCreditExpiry",()=>o,"getCreditsAggregate",()=>n,"getOrCreateCredits",()=>i,"grantCredits",()=>p,"listCreditUsage",()=>l])},749649,e=>{"use strict";let t={"mentor-query":{toolId:"mentor-query",maxInputBytesFreeAnon:1e3,maxInputBytesFreeAuthed:6e3,maxRunMsHardCap:6e4,freeMsPerDayAuthed:3e4,freeMsPerDayAnon:8e3,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0},"whois-summary":{toolId:"whois-summary",maxInputBytesFreeAnon:300,maxInputBytesFreeAuthed:2e3,maxRunMsHardCap:2e4,freeMsPerDayAuthed:6e4,freeMsPerDayAnon:15e3,creditsPerMsPaid:5e-5,allowAnonymous:!0,allowAuthed:!0},"templates-request-download":{toolId:"templates-request-download",maxInputBytesFreeAnon:600,maxInputBytesFreeAuthed:2e3,maxRunMsHardCap:3e4,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:0,creditsPerMsPaid:1e-4,allowAnonymous:!1,allowAuthed:!0},"sandbox-echo":{toolId:"sandbox-echo",maxInputBytesFreeAnon:2e3,maxInputBytesFreeAuthed:1e4,maxRunMsHardCap:15e3,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:1e4,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0},"code-runner":{toolId:"code-runner",maxInputBytesFreeAnon:6500,maxInputBytesFreeAuthed:6500,maxRunMsHardCap:8e3,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:1e4,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0}};function r(e){return t[e]||null}let a={"dns-email-security-dashboard":{toolId:"dns-email-security-dashboard",label:"DNS email security",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Shorter inputs reduce retries.","Repeated checks of the same domain usually add little value. Try a different domain or a different tool."],scenarios:[{title:"Typical runs",estimateNote:"Most runs are small and fit in the free tier.",mediumRunsPerTenCredits:120,browserOnlyCostsZero:!1}]},"https-redirect-checker":{toolId:"https-redirect-checker",label:"HTTPS redirect checker",computeClass:"B",typicalInputBytes:200,typicalSteps:6,guidance:["Short redirect chains cost less.","If you only need the final destination, do one check per key entry page."],scenarios:[{title:"Redirect chains",estimateNote:"Costs rise with chain length.",mediumRunsPerTenCredits:80}]},"website-security-lab":{toolId:"website-security-lab",label:"Website security lab",computeClass:"B",typicalInputBytes:240,typicalSteps:6,guidance:["Test one representative URL per site, then expand.","Avoid long redirect chains or many subpaths unless needed."]},"email-header-phishing-lab":{toolId:"email-header-phishing-lab",label:"Email header lab",computeClass:"B",typicalInputBytes:6e3,typicalSteps:1,guidance:["Paste headers only, not the message body.","Trim the header block to the relevant hops if it is extremely long."]},"phishing-link-explainer":{toolId:"phishing-link-explainer",label:"Phishing link explainer",computeClass:"B",typicalInputBytes:300,typicalSteps:2,guidance:["Short URLs and fewer redirects reduce work.","Run a second check only if the context changed."]},"third-party-script-viewer":{toolId:"third-party-script-viewer",label:"Third party script viewer",computeClass:"B",typicalInputBytes:200,typicalSteps:4,guidance:["Use one representative page per application area.","Focus on scripts that run on authenticated pages first."]},"dns-lookup":{toolId:"dns-lookup",label:"DNS lookup",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Use one hostname at a time."]},"tls-inspect":{toolId:"tls-inspect",label:"TLS inspect",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Use a hostname rather than an IP.","Retry only after you confirm the service is up."]},"whois-summary":{toolId:"whois-summary",label:"WHOIS summary",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Compare results with context and expected registrant."]},"ip-reputation":{toolId:"ip-reputation",label:"IP reputation",computeClass:"B",typicalInputBytes:60,typicalSteps:1,guidance:["Combine with logs and behavioural indicators."]},"mentor-query":{toolId:"mentor-query",label:"Mentor",computeClass:"B",typicalInputBytes:2e3,typicalSteps:6,guidance:["Ask one focused question at a time.","Include the page link so the match is tighter.","Shorter questions usually respond faster."]},"templates-request-download":{toolId:"templates-request-download",label:"Template download request",computeClass:"B",typicalInputBytes:800,typicalSteps:3,guidance:["Choose one template at a time.","Keep the requested use clear and short."]},"model-forge-train":{toolId:"model-forge-train",label:"Model Forge training",computeClass:"B",typicalInputBytes:25e4,typicalSteps:200,fileLimits:{freeMaxBytes:358400,paidMaxBytes:2097152,absoluteMaxBytes:4194304},guidance:["Start with fewer rows and fewer epochs.","Try one target column at a time.","Avoid high-cardinality text columns in a tabular demo."],scenarios:[{title:"Small CSV",estimateNote:"A small CSV with light training usually fits in the free tier.",mediumRunsPerTenCredits:40},{title:"Bigger dataset",estimateNote:"Larger datasets and more iterations can exceed the free tier.",largeRunCredits:2}]},"software-tradeoff-sim":{toolId:"software-tradeoff-sim",label:"Engineering trade-off simulator",computeClass:"A",typicalInputBytes:400,typicalSteps:50,guidance:["Keep constraints realistic.","Change one variable at a time so you can explain causality.","Write down the decision rule you are using."]},"data-roadmap-sim":{toolId:"data-roadmap-sim",label:"Data and digitalisation roadmap simulator",computeClass:"A",typicalInputBytes:600,typicalSteps:60,guidance:["Keep the first pass simple: purpose, owners, and controls.","Improve quality at source before building bigger dashboards.","Write down your decision rule."]},"cyber-risk-sim":{toolId:"cyber-risk-sim",label:"Cyber risk mapping simulator",computeClass:"A",typicalInputBytes:700,typicalSteps:70,guidance:["Start with one asset and one realistic threat.","Pick controls you can operate and measure.","Write the acceptance criteria for residual risk."]},"ai-prompt-compare":{toolId:"ai-prompt-compare",label:"Prompt comparison playground",computeClass:"A",typicalInputBytes:2e3,typicalSteps:40,guidance:["Compare small prompt changes only.","Write what success looks like before you run.","Treat results as illustrative, not definitive."]},"ai-consistency-test":{toolId:"ai-consistency-test",label:"Output consistency tester",computeClass:"A",typicalInputBytes:2500,typicalSteps:80,guidance:["Run a few samples first, then increase.","Separate prompt quality from model randomness.","Log both the prompt and the settings."]},"ai-bias-sim":{toolId:"ai-bias-sim",label:"Bias scenario explorer",computeClass:"A",typicalInputBytes:1500,typicalSteps:90,guidance:["Bias often comes from data and labels, not intent.","Check base rates before blaming the model.","Always define who is harmed by errors."]},"ai-behaviour-compare":{toolId:"ai-behaviour-compare",label:"Model behaviour comparison (simulated)",computeClass:"A",typicalInputBytes:2200,typicalSteps:70,guidance:["Compare behaviours, not vibes.","Look for quiet failures and edge cases.","Decide when not to use AI."]}};function s(e){return e&&a[e]||null}e.s(["COMPUTE_TIER",0,{freeUnitsPerRun:7500,freeUnitsPerSession:3e4,creditUnitsPerCredit:25e3},"getJobRunnerToolLimits",()=>r,"getToolComputeProfile",()=>s])},814458,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),s=e.i(759756),i=e.i(561916),n=e.i(114444),o=e.i(837092),u=e.i(869741),l=e.i(316795),d=e.i(487718),c=e.i(995169),p=e.i(47587),m=e.i(666012),h=e.i(570101),y=e.i(626937),f=e.i(10372),g=e.i(193695);e.i(52474);var b=e.i(600220),I=e.i(89171),w=e.i(757660),C=e.i(568212),x=e.i(936426),M=e.i(657194),R=e.i(895968),v=e.i(124594),A=e.i(749649);function P(e,t,r){let a="number"==typeof e?e:Number(e);return Number.isFinite(a)?Math.max(t,Math.min(r,Math.round(a))):t}var S=e.i(685750),T=e.i(967291);let E="false"===process.env.CREDITS_METERING_ENABLED;function B(e,t=400){return I.NextResponse.json({message:e},{status:t})}async function U(e){return(0,R.withRequestLogging)(e,{route:"POST /api/credits/consume"},async()=>{if(E)return B("Credits metering is disabled right now.",503);let t=(0,x.requireSameOrigin)(e);if(t)return t;let r=(0,M.rateLimit)(e,{keyPrefix:"credits-consume",limit:30,windowMs:6e4});if(r)return r;let a=await (0,w.getServerSession)(C.authOptions);if(!a?.user?.id)return B("Unauthorized",401);let s=await e.json().catch(()=>null),i="string"==typeof s?.toolId?s.toolId.trim().slice(0,80):"",n="number"==typeof s?.inputBytes?s.inputBytes:Number(s?.inputBytes||0),o="number"==typeof s?.durationMs?s.durationMs:Number(s?.durationMs||0),u=s?.featureFlags&&"object"==typeof s.featureFlags?s.featureFlags:void 0,l=!!s?.hadPreview;if(!i)return B("Missing toolId");if(!l)return B("Preview required before consume",400);if(!Number.isFinite(n)||n<0)return B("Invalid inputBytes");if(!Number.isFinite(o)||o<0)return B("Invalid durationMs");let d=function(e){let t=String(e.toolId||"").trim(),r=P(e.inputBytes,0,25e6),a=P(e.durationMs,0,3e5),s=(0,A.getToolComputeProfile)(t),i=[];s?.label&&i.push(`Tool: ${s.label}.`);let{units:n,computeClass:o,advanced:u}=function(e,t,r,a){let s=(0,A.getToolComputeProfile)(e),i=s?.computeClass||"A",n=P(t,0,25e6),o=P(r,0,3e5),u=a||{},l=!!(u.advanced||u.expensiveMode||u.serverAssistPlus);if("A"===i)return{units:Math.max(200,Math.round(n/4)),computeClass:i,advanced:l};if("B"===i){let e=Math.max(500,Math.round(2*o)+Math.round(n/2));return{units:l?Math.round(1.35*e):e,computeClass:i,advanced:l}}let d=Math.max(1500,Math.round(6*o)+Math.round(n/2));return{units:l?Math.round(1.4*d):d,computeClass:i,advanced:l}}(t,r,a,e.featureFlags);if("A"===o)return i.push("Browser-only compute does not consume credits."),{toolId:t,computeClass:o,units:n,freeUnitsUsed:n,paidUnitsUsed:0,creditsToConsume:0,reasons:i};let l=Math.min(A.COMPUTE_TIER.freeUnitsPerRun,n),d=Math.max(0,n-l),c=d>0?Math.ceil(d/A.COMPUTE_TIER.creditUnitsPerCredit):0;return i.push(`Runtime: ${a} ms.`),i.push(`Input size: ${r} bytes.`),u&&i.push("Advanced features increased compute."),d>0&&i.push("Above free tier compute is credit-eligible."),{toolId:t,computeClass:o,units:n,freeUnitsUsed:l,paidUnitsUsed:d,creditsToConsume:c,reasons:i}}({toolId:i,inputBytes:n,durationMs:o,featureFlags:u});if(d.creditsToConsume<=0)return I.NextResponse.json({ok:!0,consumed:0,remaining:null,metered:d});let c=a.user.id;await (0,S.enforceCreditExpiry)(c);let p=await v.prisma.$transaction(async e=>{let t=await e.credits.findUnique({where:{userId:c}}),r=t?.balance??0,a=t?.expiresAt??null;return a&&a.getTime()<=Date.now()?{ok:!1,balance:0,metered:d}:r<d.creditsToConsume?{ok:!1,balance:r,metered:d}:{ok:!0,balance:(await e.credits.upsert({where:{userId:c},update:{balance:r-d.creditsToConsume},create:{userId:c,balance:Math.max(0,r-d.creditsToConsume)}})).balance,metered:d}});if(!p.ok){let e={code:"INSUFFICIENT_CREDITS",message:"Insufficient credits for the paid portion of this run.",hint:"Reduce input size, disable expensive options, or run a free tier preview first."};return(0,T.logWarn)("credits.consume_insufficient",{userId:c,toolId:i,required:d.creditsToConsume,balance:p.balance}),I.NextResponse.json({message:`${e.message} ${e.hint}`,failureReason:"credits_insufficient",errorObj:e,metered:p.metered,remaining:p.balance},{status:402})}return(0,S.createCreditUsageEvent)({userId:c,toolId:d.toolId,consumed:d.creditsToConsume,units:d.units,freeUnits:d.freeUnitsUsed,paidUnits:d.paidUnitsUsed}).catch(()=>null),I.NextResponse.json({ok:!0,consumed:d.creditsToConsume,remaining:p.balance,metered:d})})}e.s(["POST",()=>U],353799);var N=e.i(353799);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/credits/consume/route",pathname:"/api/credits/consume",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/credits/consume/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:q,workUnitAsyncStorage:D,serverHooks:_}=k;function O(){return(0,a.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:D})}async function F(e,t,a){k.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let I="/api/credits/consume/route";I=I.replace(/\/index$/,"")||"/";let w=await k.prepare(e,t,{srcPage:I,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:C,params:x,nextConfig:M,parsedUrl:R,isDraftMode:v,prerenderManifest:A,routerServerContext:P,isOnDemandRevalidate:S,revalidateOnlyGenerated:T,resolvedPathname:E,clientReferenceManifest:B,serverActionsManifest:U}=w,N=(0,u.normalizeAppPath)(I),q=!!(A.dynamicRoutes[N]||A.routes[E]),D=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,R,!1):t.end("This page could not be found"),null);if(q&&!v){let e=!!A.routes[E],t=A.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(M.experimental.adapterPath)return await D();throw new g.NoFallbackError}}let _=null;!q||k.isDev||v||(_="/index"===(_=E)?"/":_);let O=!0===k.isDev||!q,F=q&&!O;U&&B&&(0,n.setReferenceManifestsSingleton)({page:I,clientReferenceManifest:B,serverActionsManifest:U,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:U})});let H=e.method||"GET",L=(0,i.getTracer)(),$=L.getActiveScopeSpan(),j={params:x,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!M.experimental.authInterrupts},cacheComponents:!!M.cacheComponents,supportsDynamicResponse:O,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:M.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>k.onRequestError(e,t,a,P)},sharedContext:{buildId:C}},K=new l.NodeNextRequest(e),W=new l.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let n=async e=>k.handle(V,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${I}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var i,u;let l=async({previousCacheEntry:r})=>{try{if(!o&&S&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await n(s);e.fetchMetrics=j.renderOpts.fetchMetrics;let u=j.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let l=j.renderOpts.collectedTags;if(!q)return await (0,m.sendResponse)(K,W,i,j.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,a=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:S})},P),t}},d=await k.handleResponse({req:e,nextConfig:M,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:T,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!q)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",S?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),v&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&q||c.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(K,W,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};$?await u($):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${I}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(t){if(t instanceof g.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:S})}),q)throw t;return await (0,m.sendResponse)(K,W,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>O,"routeModule",()=>k,"serverHooks",()=>_,"workAsyncStorage",()=>q,"workUnitAsyncStorage",()=>D],814458)}];

//# debugId=62baad5b-58f5-3323-6107-066116646ac1
//# sourceMappingURL=%5Broot-of-the-server%5D__e871fd26._.js.map