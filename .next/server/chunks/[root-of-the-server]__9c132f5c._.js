;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="9499b7c1-1525-5dd7-b586-7620f61fa775")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},685750,e=>{"use strict";let t,r;var a=e.i(124594);let s=Number.isFinite(r=(t=process.env.CREDITS_EXPIRY_DAYS)?Number(t):NaN)&&r>0?Math.floor(r):730;async function n(e){let t=await a.prisma.credits.findUnique({where:{userId:e}});return t||await a.prisma.credits.create({data:{userId:e,balance:0,expiresAt:null}})}async function i(){return{totalUsersWithCredits:await a.prisma.credits.count(),totalCredits:(await a.prisma.credits.aggregate({_sum:{balance:!0}}))._sum.balance??0}}async function o(e){let t=await a.prisma.credits.findUnique({where:{userId:e}});if(!t)return null;if(!t.expiresAt)return t;let r=new Date;return t.expiresAt.getTime()>r.getTime()?t:await a.prisma.credits.update({where:{userId:e},data:{balance:0}})}async function u(e){return a.prisma.creditUsageEvent.create({data:{userId:e.userId,toolId:e.toolId,consumed:e.consumed,units:e.units,freeUnits:e.freeUnits,paidUnits:e.paidUnits,runId:e.runId||null,baseFree:!!e.baseFree,estimatedCredits:Math.max(0,Math.round(Number(e.estimatedCredits)||0)),actualCredits:Math.max(0,Math.round(Number(e.actualCredits)||0)),meteringUnit:e.meteringUnit||"ms",durationMs:Math.max(0,Math.round(Number(e.durationMs)||0)),inputBytes:Math.max(0,Math.round(Number(e.inputBytes)||0)),outputBytes:Math.max(0,Math.round(Number(e.outputBytes)||0)),freeTierAppliedMs:Math.max(0,Math.round(Number(e.freeTierAppliedMs)||0)),paidMs:Math.max(0,Math.round(Number(e.paidMs)||0))}})}async function l(e,t=50){return a.prisma.creditUsageEvent.findMany({where:{userId:e},orderBy:{occurredAt:"desc"},take:Math.max(1,Math.min(200,t))})}function d(e=new Date){let t;return(t=new Date(e)).setDate(t.getDate()+s),t}async function c(e){let t=Math.max(0,Math.round(Number(e.credits)||0));return a.prisma.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:e.expiresAt||null}})}async function p(e){let t=Math.max(0,Math.round(Number(e.credits)||0));if(!t)return{ok:!1,balance:null};let r=d(new Date);return await a.prisma.$transaction(async a=>{let s=await a.credits.findUnique({where:{userId:e.userId}}),n=(s?.balance??0)+t,i=await a.credits.upsert({where:{userId:e.userId},update:{balance:n,expiresAt:s?.expiresAt&&s.expiresAt>r?s.expiresAt:r},create:{userId:e.userId,balance:n,expiresAt:r}});return await a.creditLot.create({data:{userId:e.userId,credits:t,amountCredits:t,remainingCredits:t,source:e.source,stripeEventId:e.stripeEventId||null,stripePriceId:e.stripePriceId||null,stripeCheckoutSessionId:e.stripeCheckoutSessionId||null,stripePaymentIntentId:e.stripePaymentIntentId||null,expiresAt:r}}),{ok:!0,balance:i.balance}})}e.s(["computeNewExpiry",()=>d,"createCreditLot",()=>c,"createCreditUsageEvent",()=>u,"enforceCreditExpiry",()=>o,"getCreditsAggregate",()=>i,"getOrCreateCredits",()=>n,"grantCredits",()=>p,"listCreditUsage",()=>l])},356846,e=>{"use strict";var t=e.i(124594);async function r(e){let r=Math.max(0,Math.round(Number(e.credits)||0));return r?t.prisma.$transaction(async t=>{let a=e.userId,s=await t.credits.findUnique({where:{userId:a}}),n=s?.balance??0;if(n<r)return{ok:!1,remainingBalance:n};let i=await t.creditLot.findMany({where:{userId:a,OR:[{remainingCredits:{gt:0}},{remainingCredits:0,credits:{gt:0}}]},orderBy:[{expiresAt:"asc"},{purchasedAt:"asc"},{createdAt:"asc"}],take:200}),o=r;for(let e of i){if(o<=0)break;let r=Math.max(0,e.remainingCredits||e.credits||0);if(!r)continue;let a=Math.min(r,o);o-=a,await t.creditLot.update({where:{id:e.id},data:{remainingCredits:Math.max(0,r-a),amountCredits:e.amountCredits&&e.amountCredits>0?e.amountCredits:e.credits}})}return o>0?{ok:!1,remainingBalance:n}:{ok:!0,remainingBalance:(await t.credits.update({where:{userId:a},data:{balance:n-r}})).balance}}):{ok:!0,remainingBalance:null}}e.s(["deductCreditsFromLots",()=>r])},857657,e=>{"use strict";var t=e.i(666680),r=e.i(124594);function a(e){return t.default.createHmac("sha256",process.env.WORKSPACE_COOKIE_SECRET||process.env.NEXTAUTH_SECRET||"dev-workspace-secret-change-me").update(e).digest("hex")}function s(e){let t=a(e);return`${e}.${t}`}function n(e){let r=String(e||"").split(".");if(2!==r.length)return null;let[s,n]=r;if(!s||!n)return null;let i=a(s);try{let e=Buffer.from(n,"hex"),r=Buffer.from(i,"hex");if(e.length!==r.length)return null;return t.default.timingSafeEqual(e,r)?s:null}catch{return null}}async function i(e){var a;let s=(a=e.tokenRaw,t.default.createHash("sha256").update(a).digest("hex"));return r.prisma.workspaceSession.upsert({where:{tokenHash:s},create:{tokenHash:s},update:{updatedAt:new Date}})}function o(){return t.default.randomUUID()}e.s(["WORKSPACE_COOKIE",0,{name:"workspace_session",maxAgeSeconds:5184e3},"getOrCreateWorkspaceSession",()=>i,"newWorkspaceTokenRaw",()=>o,"signWorkspaceToken",()=>s,"verifyWorkspaceToken",()=>n])},699384,e=>{"use strict";var t=e.i(124594);async function r(e){return t.prisma.project.create({data:{ownerId:e.ownerId,workspaceSessionId:e.workspaceSessionId,title:e.title,topic:e.topic}})}async function a(e){let r=t.prisma.project,a=e.ownerId?{ownerId:e.ownerId}:{ownerId:null,workspaceSessionId:e.workspaceSessionId};return e.q&&(a.title={contains:e.q}),r.findMany({where:a,orderBy:{updatedAt:"desc"},take:50})}async function s(e){return t.prisma.project.findUnique({where:{id:e.projectId},include:{runs:{orderBy:{startedAt:"desc"}},notes:{orderBy:{createdAt:"desc"}}}})}async function n(e){return t.prisma.run.create({data:{projectId:e.projectId,toolId:e.toolId,status:e.status,startedAt:new Date,inputJson:e.inputJson??null}})}async function i(e){return t.prisma.run.update({where:{id:e.runId},data:{status:e.status,finishedAt:new Date,outputJson:e.outputJson??null,metricsJson:e.metricsJson??null,errorJson:e.errorJson??null}})}async function o(e){return t.prisma.note.create({data:{projectId:e.projectId,runId:e.runId,content:e.content.slice(0,8e3)}})}async function u(e){return t.prisma.project.updateMany({where:{ownerId:null,workspaceSessionId:e.workspaceSessionId},data:{ownerId:e.ownerId}})}e.s(["claimWorkspace",()=>u,"createNote",()=>o,"createProject",()=>r,"createRun",()=>n,"getProject",()=>s,"listProjects",()=>a,"updateRun",()=>i])},416810,e=>{"use strict";var t=e.i(757660),r=e.i(568212),a=e.i(857657);async function s(e){let s=await (0,t.getServerSession)(r.authOptions).catch(()=>null),n=s?.user?.id||null,i=null,o=null;if(!n){let t=function(e,t){for(let r of(e.headers.get("cookie")||"").split(";").map(e=>e.trim())){let e=r.indexOf("=");if(e<=0)continue;let a=r.slice(0,e),s=r.slice(e+1);if(a===t)return decodeURIComponent(s)}return null}(e,a.WORKSPACE_COOKIE.name),r=t?(0,a.verifyWorkspaceToken)(t):null,s=r||(0,a.newWorkspaceTokenRaw)();try{let e=await (0,a.getOrCreateWorkspaceSession)({tokenRaw:s});i=String(e.id)}catch{i=null}r||(o=(0,a.signWorkspaceToken)(s))}return{userId:n,workspaceSessionId:i,setCookieValue:o}}function n(e,t){return t&&e.headers.append("set-cookie",`${a.WORKSPACE_COOKIE.name}=${encodeURIComponent(t)}; Path=/; HttpOnly; SameSite=Lax; Max-Age=${a.WORKSPACE_COOKIE.maxAgeSeconds}`),e}e.s(["attachWorkspaceCookie",()=>n,"getWorkspaceIdentity",()=>s])},76657,e=>{"use strict";var t=e.i(124594),r=e.i(749649);e.i(116575);var a=e.i(519894),s=e.i(969751);function n(e,t,r){let a="number"==typeof e?e:Number(e);return Number.isFinite(a)?Math.max(t,Math.min(r,Math.round(a))):t}async function i(e){var i;let o,u,l=String(e.toolId||"").trim(),d=n(e.inputBytes,0,25e6),c=(i={toolId:l,inputBytes:d,preset:e.requestedComplexityPreset},u=(o=(0,r.getToolComputeProfile)(i.toolId))?Math.max(200,120*o.typicalSteps):600,n(u*(o?Math.max(.5,i.inputBytes/Math.max(1,o.typicalInputBytes)):Math.max(.5,i.inputBytes/1e3))*("light"===i.preset?.6:"heavy"===i.preset?1.8:1),50,a.MAX_RUN_MS_HARD_CAP));if(c>a.MAX_RUN_MS_HARD_CAP)return{allowed:!1,reason:"This run is too large for safety limits. Reduce input size or use a lighter preset.",estimatedDurationMs:c,estimatedCredits:0,freeTierRemainingMs:0,willChargeCredits:!1,requiredCreditsIfAny:0};let p=e.userId,m=p?await (0,s.getUserFreeMsRemainingToday)(p):(0,s.getAnonFreeMsRemainingToday)(e.req);if(d>(p?a.MAX_UPLOAD_BYTES_PAID:a.MAX_UPLOAD_BYTES_FREE))return{allowed:!1,reason:"Input is too large for this run. Reduce the size and try again.",estimatedDurationMs:c,estimatedCredits:0,freeTierRemainingMs:m,willChargeCredits:!1,requiredCreditsIfAny:0};let h=Math.max(0,c-m),y=h>0?Math.ceil(h/a.CREDIT_MS_PER_1):0,f=y>0;if(!p&&f)return{allowed:!1,reason:"Sign in to run beyond the free tier. Free usage stays free.",estimatedDurationMs:c,estimatedCredits:y,freeTierRemainingMs:m,willChargeCredits:!0,requiredCreditsIfAny:y};if(p&&f){let e=await t.prisma.credits.findUnique({where:{userId:p}}),r=e?.balance??0,a=Math.ceil(1.25*y);if(r<a)return{allowed:!1,reason:"Not enough credits for the expected paid portion. Use a lighter preset or reduce input size.",estimatedDurationMs:c,estimatedCredits:y,freeTierRemainingMs:m,willChargeCredits:!0,requiredCreditsIfAny:a}}return{allowed:!0,reason:null,estimatedDurationMs:c,estimatedCredits:y,freeTierRemainingMs:m,willChargeCredits:f,requiredCreditsIfAny:y,freeTierMsPerDay:a.FREE_TIER_MS_PER_DAY,creditMsPer1:a.CREDIT_MS_PER_1}}e.s(["estimateRunCost",()=>i])},749649,e=>{"use strict";let t={"mentor-query":{toolId:"mentor-query",maxInputBytesFreeAnon:1e3,maxInputBytesFreeAuthed:6e3,maxRunMsHardCap:6e4,freeMsPerDayAuthed:3e4,freeMsPerDayAnon:8e3,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0},"whois-summary":{toolId:"whois-summary",maxInputBytesFreeAnon:300,maxInputBytesFreeAuthed:2e3,maxRunMsHardCap:2e4,freeMsPerDayAuthed:6e4,freeMsPerDayAnon:15e3,creditsPerMsPaid:5e-5,allowAnonymous:!0,allowAuthed:!0},"templates-request-download":{toolId:"templates-request-download",maxInputBytesFreeAnon:600,maxInputBytesFreeAuthed:2e3,maxRunMsHardCap:3e4,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:0,creditsPerMsPaid:1e-4,allowAnonymous:!1,allowAuthed:!0},"sandbox-echo":{toolId:"sandbox-echo",maxInputBytesFreeAnon:2e3,maxInputBytesFreeAuthed:1e4,maxRunMsHardCap:15e3,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:1e4,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0},"code-runner":{toolId:"code-runner",maxInputBytesFreeAnon:6500,maxInputBytesFreeAuthed:6500,maxRunMsHardCap:8e3,freeMsPerDayAuthed:2e4,freeMsPerDayAnon:1e4,creditsPerMsPaid:1e-4,allowAnonymous:!0,allowAuthed:!0}};function r(e){return t[e]||null}let a={"dns-email-security-dashboard":{toolId:"dns-email-security-dashboard",label:"DNS email security",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Shorter inputs reduce retries.","Repeated checks of the same domain usually add little value. Try a different domain or a different tool."],scenarios:[{title:"Typical runs",estimateNote:"Most runs are small and fit in the free tier.",mediumRunsPerTenCredits:120,browserOnlyCostsZero:!1}]},"https-redirect-checker":{toolId:"https-redirect-checker",label:"HTTPS redirect checker",computeClass:"B",typicalInputBytes:200,typicalSteps:6,guidance:["Short redirect chains cost less.","If you only need the final destination, do one check per key entry page."],scenarios:[{title:"Redirect chains",estimateNote:"Costs rise with chain length.",mediumRunsPerTenCredits:80}]},"website-security-lab":{toolId:"website-security-lab",label:"Website security lab",computeClass:"B",typicalInputBytes:240,typicalSteps:6,guidance:["Test one representative URL per site, then expand.","Avoid long redirect chains or many subpaths unless needed."]},"email-header-phishing-lab":{toolId:"email-header-phishing-lab",label:"Email header lab",computeClass:"B",typicalInputBytes:6e3,typicalSteps:1,guidance:["Paste headers only, not the message body.","Trim the header block to the relevant hops if it is extremely long."]},"phishing-link-explainer":{toolId:"phishing-link-explainer",label:"Phishing link explainer",computeClass:"B",typicalInputBytes:300,typicalSteps:2,guidance:["Short URLs and fewer redirects reduce work.","Run a second check only if the context changed."]},"third-party-script-viewer":{toolId:"third-party-script-viewer",label:"Third party script viewer",computeClass:"B",typicalInputBytes:200,typicalSteps:4,guidance:["Use one representative page per application area.","Focus on scripts that run on authenticated pages first."]},"dns-lookup":{toolId:"dns-lookup",label:"DNS lookup",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Use one hostname at a time."]},"tls-inspect":{toolId:"tls-inspect",label:"TLS inspect",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Use a hostname rather than an IP.","Retry only after you confirm the service is up."]},"whois-summary":{toolId:"whois-summary",label:"WHOIS summary",computeClass:"B",typicalInputBytes:120,typicalSteps:1,guidance:["Compare results with context and expected registrant."]},"ip-reputation":{toolId:"ip-reputation",label:"IP reputation",computeClass:"B",typicalInputBytes:60,typicalSteps:1,guidance:["Combine with logs and behavioural indicators."]},"mentor-query":{toolId:"mentor-query",label:"Mentor",computeClass:"B",typicalInputBytes:2e3,typicalSteps:6,guidance:["Ask one focused question at a time.","Include the page link so the match is tighter.","Shorter questions usually respond faster."]},"templates-request-download":{toolId:"templates-request-download",label:"Template download request",computeClass:"B",typicalInputBytes:800,typicalSteps:3,guidance:["Choose one template at a time.","Keep the requested use clear and short."]},"model-forge-train":{toolId:"model-forge-train",label:"Model Forge training",computeClass:"B",typicalInputBytes:25e4,typicalSteps:200,fileLimits:{freeMaxBytes:358400,paidMaxBytes:2097152,absoluteMaxBytes:4194304},guidance:["Start with fewer rows and fewer epochs.","Try one target column at a time.","Avoid high-cardinality text columns in a tabular demo."],scenarios:[{title:"Small CSV",estimateNote:"A small CSV with light training usually fits in the free tier.",mediumRunsPerTenCredits:40},{title:"Bigger dataset",estimateNote:"Larger datasets and more iterations can exceed the free tier.",largeRunCredits:2}]},"software-tradeoff-sim":{toolId:"software-tradeoff-sim",label:"Engineering trade-off simulator",computeClass:"A",typicalInputBytes:400,typicalSteps:50,guidance:["Keep constraints realistic.","Change one variable at a time so you can explain causality.","Write down the decision rule you are using."]},"data-roadmap-sim":{toolId:"data-roadmap-sim",label:"Data and digitalisation roadmap simulator",computeClass:"A",typicalInputBytes:600,typicalSteps:60,guidance:["Keep the first pass simple: purpose, owners, and controls.","Improve quality at source before building bigger dashboards.","Write down your decision rule."]},"cyber-risk-sim":{toolId:"cyber-risk-sim",label:"Cyber risk mapping simulator",computeClass:"A",typicalInputBytes:700,typicalSteps:70,guidance:["Start with one asset and one realistic threat.","Pick controls you can operate and measure.","Write the acceptance criteria for residual risk."]},"ai-prompt-compare":{toolId:"ai-prompt-compare",label:"Prompt comparison playground",computeClass:"A",typicalInputBytes:2e3,typicalSteps:40,guidance:["Compare small prompt changes only.","Write what success looks like before you run.","Treat results as illustrative, not definitive."]},"ai-consistency-test":{toolId:"ai-consistency-test",label:"Output consistency tester",computeClass:"A",typicalInputBytes:2500,typicalSteps:80,guidance:["Run a few samples first, then increase.","Separate prompt quality from model randomness.","Log both the prompt and the settings."]},"ai-bias-sim":{toolId:"ai-bias-sim",label:"Bias scenario explorer",computeClass:"A",typicalInputBytes:1500,typicalSteps:90,guidance:["Bias often comes from data and labels, not intent.","Check base rates before blaming the model.","Always define who is harmed by errors."]},"ai-behaviour-compare":{toolId:"ai-behaviour-compare",label:"Model behaviour comparison (simulated)",computeClass:"A",typicalInputBytes:2200,typicalSteps:70,guidance:["Compare behaviours, not vibes.","Look for quiet failures and edge cases.","Decide when not to use AI."]}};function s(e){return e&&a[e]||null}e.s(["COMPUTE_TIER",0,{freeUnitsPerRun:7500,freeUnitsPerSession:3e4,creditUnitsPerCredit:25e3},"getJobRunnerToolLimits",()=>r,"getToolComputeProfile",()=>s])},969751,519894,116575,e=>{"use strict";var t=e.i(666680),r=e.i(124594);function a(e,t){let r=process.env[e],a=r?Number(r):NaN;return Number.isFinite(a)&&a>=0?Math.floor(a):t}let s=a("FREE_TIER_MS_PER_DAY",6e4),n=a("CREDIT_MS_PER_1",1e4),i=a("MAX_RUN_MS_HARD_CAP",3e5),o=a("MAX_UPLOAD_BYTES_FREE",307200),u=a("MAX_UPLOAD_BYTES_PAID",2097152);function l(e=new Date){let t=new Date(e);return t.setUTCHours(0,0,0,0),t}async function d(e){let t=l();return(await r.prisma.creditUsageEvent.findMany({where:{userId:e,occurredAt:{gte:t}},select:{freeTierAppliedMs:!0},take:1e4})).reduce((e,t)=>e+(Number(t.freeTierAppliedMs)||0),0)}async function c(e){return Math.max(0,s-await d(e))}e.s(["CREDIT_MS_PER_1",0,n,"FREE_TIER_MS_PER_DAY",0,s,"MAX_RUN_MS_HARD_CAP",0,i,"MAX_UPLOAD_BYTES_FREE",0,o,"MAX_UPLOAD_BYTES_PAID",0,u],519894),e.s([],116575);let p=new Map;function m(e){var r;let a=e.headers.get("x-forwarded-for")||"",s=a.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown",n=e.headers.get("user-agent")||"unknown";return r=`${s}|${n}`,t.default.createHash("sha256").update(r).digest("hex").slice(0,24)}function h(e){let t=Date.now(),r=m(e),a=l(new Date(t+864e5)).getTime(),n=p.get(r);return!n||n.resetAt<=t?(p.set(r,{usedMs:0,resetAt:a}),s):Math.max(0,s-n.usedMs)}function y(e,t){let r=Date.now(),a=m(e),s=l(new Date(r+864e5)).getTime(),n=p.get(a);!n||n.resetAt<=r?p.set(a,{usedMs:Math.max(0,Math.round(t)),resetAt:s}):n.usedMs+=Math.max(0,Math.round(t))}e.s(["addAnonUsageMs",()=>y,"getAnonFreeMsRemainingToday",()=>h,"getUserFreeMsRemainingToday",()=>c],969751)},363984,e=>{"use strict";var t=e.i(666680),r=e.i(124594),a=e.i(76657);e.i(116575);var s=e.i(519894),n=e.i(969751),i=e.i(356846),o=e.i(685750),u=e.i(749649);function l(){return Date.now()}function d(e){let t="number"==typeof e?e:Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):0}async function c(e){let c=t.default.randomUUID(),p=String(e.toolId||"").trim(),m=d(e.inputBytes),h=await (0,a.estimateRunCost)({req:e.req,userId:e.userId,toolId:p,inputBytes:m,requestedComplexityPreset:e.requestedComplexityPreset});if(!h.allowed)return{ok:!1,status:400,message:h.reason||"Run not allowed",estimate:h};let y=e.userId?await (0,n.getUserFreeMsRemainingToday)(e.userId):(0,n.getAnonFreeMsRemainingToday)(e.req);if(h.willChargeCredits&&!e.userId)return{ok:!1,status:401,message:"Sign in required for runs above the free tier.",estimate:h};let f=l(),g=await e.execute(),w=Math.min(s.MAX_RUN_MS_HARD_CAP,Math.max(0,l()-f)),I=d(g.outputBytes),C=Math.min(w,y),A=Math.max(0,w-C),M=A>0?Math.ceil(A/s.CREDIT_MS_PER_1):0,R=(0,u.getToolComputeProfile)(p),x=R?.guidance?.slice(0,4)||["Reduce input size.","Use the light preset.","Limit iterations or scope.","Use sampling for large datasets."];if(!e.userId)return(0,n.addAnonUsageMs)(e.req,C),{ok:!0,receipt:{runId:c,toolId:p,durationMs:w,inputBytes:m,outputBytes:I,freeTierAppliedMs:C,paidMs:0,creditsCharged:0,remainingCredits:null,guidanceTips:x},output:g.output};let b=e.userId;await (0,o.getOrCreateCredits)(b);let S=null;if(M>0){let e=await (0,i.deductCreditsFromLots)({userId:b,credits:M});if(!e.ok)return{ok:!1,status:402,message:"Insufficient credits for the paid portion. Use a lighter preset or reduce input size.",estimate:h};S=e.remainingBalance}else{let e=await r.prisma.credits.findUnique({where:{userId:b}});S=e?.balance??0}return await (0,o.createCreditUsageEvent)({userId:b,toolId:p,consumed:M,units:w,freeUnits:C,paidUnits:A,runId:c,baseFree:0===M,estimatedCredits:h.estimatedCredits||0,actualCredits:M,meteringUnit:"ms",durationMs:w,inputBytes:m,outputBytes:I,freeTierAppliedMs:C,paidMs:A}),{ok:!0,receipt:{runId:c,toolId:p,durationMs:w,inputBytes:m,outputBytes:I,freeTierAppliedMs:C,paidMs:A,creditsCharged:M,remainingCredits:S,guidanceTips:x},output:g.output}}e.s(["runWithMetering",()=>c])},968868,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),s=e.i(759756),n=e.i(561916),i=e.i(114444),o=e.i(837092),u=e.i(869741),l=e.i(316795),d=e.i(487718),c=e.i(995169),p=e.i(47587),m=e.i(666012),h=e.i(570101),y=e.i(626937),f=e.i(10372),g=e.i(193695);e.i(52474);var w=e.i(600220),I=e.i(89171),C=e.i(504446),A=e.i(469719),M=e.i(757660),R=e.i(568212),x=e.i(363984),b=e.i(416810),S=e.i(699384);let P=new Map,E=A.z.object({target:A.z.string().trim().min(1),projectId:A.z.string().trim().optional(),note:A.z.string().optional()});async function k(e){var t;let r,a,s;if(t=e.headers.get("x-forwarded-for")||"anon",a=Date.now(),s=P.get(t)||{count:0,start:a},a-s.start>6e4?(P.set(t,{count:1,start:a}),!1):s.count>=20||(s.count+=1,P.set(t,s),!1))return I.NextResponse.json({message:"Rate limit exceeded"},{status:429});try{r=E.parse(await e.json())}catch{return I.NextResponse.json({message:"Invalid input"},{status:400})}let n="string"==typeof r?.projectId?r.projectId.trim():"",i="string"==typeof r?.note?String(r.note).slice(0,8e3):"",o=r.target.trim().toLowerCase();if(!(/^[a-zA-Z0-9.-]+$/.test(o)&&o.includes("."))||(e=>{let t=C.default.isIP(e)?e:null;if(!t)return!1;let r=t.split(".").map(e=>parseInt(e,10));return 10===r[0]||172===r[0]&&!!(r[1]>=16)&&!!(r[1]<=31)||192===r[0]&&168===r[1]||127===r[0]})(o))return I.NextResponse.json({message:"Provide a valid public hostname"},{status:400});let u=await (0,M.getServerSession)(R.authOptions).catch(()=>null),l=u?.user?.id||null,d=await (0,b.getWorkspaceIdentity)(e),c=null;if(n){let e=await (0,S.getProject)({projectId:n}),t=l?e?.ownerId===l:e?.ownerId==null&&e?.workspaceSessionId===d.workspaceSessionId;e&&t&&(c=String((await (0,S.createRun)({projectId:n,toolId:"whois-summary",status:"running",inputJson:{target:o}})).id))}let p=await (0,x.runWithMetering)({req:e,userId:l,toolId:"whois-summary",inputBytes:Buffer.byteLength(o),requestedComplexityPreset:"light",execute:async()=>{let e={target:o,fallback:!0,registrar:"Use your registrar WHOIS portal",ageHint:"Check creation and expiry dates via WHOIS or RDAP",tip:"Compare domain age to the context. Newly registered domains can be higher risk."};return{output:e,outputBytes:Buffer.byteLength(JSON.stringify(e))}}});if(!p.ok){let e=I.NextResponse.json({message:p.message,estimate:p.estimate},{status:p.status});return(0,b.attachWorkspaceCookie)(e,d.setCookieValue)}c&&n&&(await (0,S.updateRun)({runId:c,status:"succeeded",outputJson:p.output,metricsJson:{durationMs:p.receipt?.durationMs??0,chargedCredits:p.receipt?.creditsCharged??0}}).catch(()=>null),i.trim()&&await (0,S.createNote)({projectId:n,runId:c,content:i.trim()}).catch(()=>null));let m=I.NextResponse.json({...p.output||{},receipt:p.receipt});return(0,b.attachWorkspaceCookie)(m,d.setCookieValue)}e.s(["POST",()=>k],146674);var v=e.i(146674);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/tools/whois-summary/route",pathname:"/api/tools/whois-summary",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/tools/whois-summary/route.js",nextConfigOutput:"",userland:v}),{workAsyncStorage:T,workUnitAsyncStorage:B,serverHooks:U}=_;function D(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:B})}async function N(e,t,a){_.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let I="/api/tools/whois-summary/route";I=I.replace(/\/index$/,"")||"/";let C=await _.prepare(e,t,{srcPage:I,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:M,nextConfig:R,parsedUrl:x,isDraftMode:b,prerenderManifest:S,routerServerContext:P,isOnDemandRevalidate:E,revalidateOnlyGenerated:k,resolvedPathname:v,clientReferenceManifest:T,serverActionsManifest:B}=C,U=(0,u.normalizeAppPath)(I),D=!!(S.dynamicRoutes[U]||S.routes[v]),N=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,x,!1):t.end("This page could not be found"),null);if(D&&!b){let e=!!S.routes[v],t=S.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await N();throw new g.NoFallbackError}}let O=null;!D||_.isDev||b||(O="/index"===(O=v)?"/":O);let q=!0===_.isDev||!D,F=D&&!q;B&&T&&(0,i.setReferenceManifestsSingleton)({page:I,clientReferenceManifest:T,serverActionsManifest:B,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:B})});let H=e.method||"GET",j=(0,n.getTracer)(),W=j.getActiveScopeSpan(),L={params:M,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>_.onRequestError(e,t,a,P)},sharedContext:{buildId:A}},K=new l.NodeNextRequest(e),$=new l.NodeNextResponse(t),X=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let i=async e=>_.handle(X,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${I}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var n,u;let l=async({previousCacheEntry:r})=>{try{if(!o&&E&&k&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let u=L.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let l=L.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(K,$,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:E})},P),t}},d=await _.handleResponse({req:e,nextConfig:R,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:E,revalidateOnlyGenerated:k,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!D)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",E?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&D||c.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(K,$,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};W?await u(W):await j.withPropagatedContext(e.headers,()=>j.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${I}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(t){if(t instanceof g.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:E})}),D)throw t;return await (0,m.sendResponse)(K,$,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>D,"routeModule",()=>_,"serverHooks",()=>U,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>B],968868)}];

//# debugId=9499b7c1-1525-5dd7-b586-7620f61fa775
//# sourceMappingURL=%5Broot-of-the-server%5D__9c132f5c._.js.map