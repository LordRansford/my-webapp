;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f1e9a79b-baca-4c16-3994-862b57ff43ad")}catch(e){}}();
module.exports=[666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},278821,e=>{"use strict";var t=e.i(902157),r=e.i(750227),i=e.i(666680);let a=process.env.CERTIFICATES_STORE_PATH||"data/certificates.json",n={certificates:[]};function s(e,i){try{let a=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);if(!t.default.existsSync(a))return i;return JSON.parse(t.default.readFileSync(a,"utf8"))}catch{return i}}function o(e,i){let a,n=r.default.isAbsolute(e)?e:r.default.join(process.cwd(),e);a=r.default.dirname(n),t.default.existsSync(a)||t.default.mkdirSync(a,{recursive:!0});let s=`${n}.tmp`;t.default.writeFileSync(s,JSON.stringify(i,null,2),"utf8"),t.default.renameSync(s,n)}function d(e){let{userId:t,courseId:r,levelId:d,courseTitle:u,hoursEarned:c,completionDate:l,learnerName:f}=e,p=s(a,n),v=`${t}:${r}:${d}`,m=(p.certificates||[]).find(e=>`${e.userId}:${e.courseId}:${e.levelId}`===v);if(m)return m;let y={certificateId:i.default.randomUUID(),userId:t,courseId:r,levelId:d,courseTitle:u,hoursEarned:c,completionDate:l,issuedAt:new Date().toISOString(),version:1,learnerName:f||"",revokedAt:null};return p.certificates.push(y),o(a,p),y}function u(e){return(s(a,n).certificates||[]).find(t=>t.certificateId===e)||null}function c(e,t=""){let r=s(a,n),i=(r.certificates||[]).findIndex(t=>t.certificateId===e);return i<0?null:(r.certificates[i].revokedAt||(r.certificates[i]={...r.certificates[i],revokedAt:new Date().toISOString(),revokedReason:t||void 0},o(a,r)),r.certificates[i])}e.s(["getCertificateById",()=>u,"issueCertificate",()=>d,"revokeCertificate",()=>c])},898957,e=>{"use strict";let t=e.r(278821);t.issueCertificate;let r=t.getCertificateById;t.revokeCertificate,e.s(["getCertificateById",0,r])},721017,e=>{"use strict";var t=e.i(926747),r=e.i(190406),i=e.i(244898),a=e.i(262950),n=e.i(898957);let s=new Map;function o(e,t){var r;let i,a;if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});if(r=e.headers["x-forwarded-for"]?.split(",")[0]?.trim()||e.socket.remoteAddress||"unknown",i=Date.now(),a=s.get(r)||{count:0,windowStart:i},i-a.windowStart>6e4&&(a.count=0,a.windowStart=i),a.count+=1,s.set(r,a),a.count>30)return t.status(429).json({message:"Too many requests"});let o=String(e.query.certificateId||"").trim();if(!o)return t.status(400).json({message:"Missing certificateId"});let d=(0,n.getCertificateById)(o);if(!d)return console.info("certificate:verify_lookup",{certificateId:o,found:!1}),t.status(404).json({message:"Not found"});let u=d.revokedAt?"revoked":"valid";return console.info("certificate:verify_lookup",{certificateId:o,found:!0,status:u}),t.status(200).json({certificateId:d.certificateId,courseId:d.courseId,levelId:d.levelId,courseTitle:d.courseTitle,hoursEarned:d.hoursEarned,completionDate:d.completionDate,issuedAt:d.issuedAt,version:d.version,status:u,revokedAt:d.revokedAt||null})}e.s(["default",()=>o],384066);var d=e.i(384066),u=e.i(7031),c=e.i(181927),l=e.i(846432);let f=(0,a.hoist)(d,"default"),p=(0,a.hoist)(d,"config"),v=new i.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/certificates/verify",pathname:"/api/certificates/verify",bundlePath:"",filename:""},userland:d,distDir:".next",relativeProjectDir:""});async function m(e,r,i){v.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/certificates/verify";a=a.replace(/\/index$/,"")||"/";let n=await v.prepare(e,r,{srcPage:a});if(!n){r.statusCode=400,r.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve());return}let{query:s,params:o,prerenderManifest:d,routerServerContext:f}=n;try{let t=e.method||"GET",i=(0,u.getTracer)(),n=i.getActiveScopeSpan(),l=v.instrumentationOnRequestError.bind(v),p=async n=>v.render(e,r,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:v.isDev,page:"/api/certificates/verify",internalRevalidate:null==f?void 0:f.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${t} ${s}`;n.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),n.updateName(e)}else n.updateName(`${t} ${a}`)});n?await p(n):await i.withPropagatedContext(e.headers,()=>i.trace(c.BaseServerSpan.handleRequest,{spanName:`${t} ${a}`,kind:u.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},p))}catch(e){if(v.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==i.waitUntil||i.waitUntil.call(i,Promise.resolve())}}e.s(["config",0,p,"default",0,f,"handler",()=>m],721017)}];

//# debugId=f1e9a79b-baca-4c16-3994-862b57ff43ad
//# sourceMappingURL=%5Broot-of-the-server%5D__537496ae._.js.map