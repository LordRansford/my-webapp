;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f2e86861-3dfa-62d7-e606-cac3b21bae6b")}catch(e){}}();
module.exports=[814747,(e,t,s)=>{t.exports=e.x("path",()=>require("path"))},522734,(e,t,s)=>{t.exports=e.x("fs",()=>require("fs"))},29173,(e,t,s)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},254799,(e,t,s)=>{t.exports=e.x("crypto",()=>require("crypto"))},902157,(e,t,s)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,s)=>{t.exports=e.x("node:path",()=>require("node:path"))},464592,e=>{"use strict";let t=new Set(["authorization","cookie","set-cookie","stripe-signature","secret","token","password","apiKey","apikey","client_secret"]);function s(e,s,n){let i={level:e,event:String(s||"").slice(0,80),ts:new Date().toISOString(),...function e(s,n=0){if(n>4)return"[TRUNCATED]";if(null==s)return s;if(Array.isArray(s))return s.slice(0,20).map(t=>e(t,n+1));if("object"!=typeof s)return s;let i={};for(let[r,a]of Object.entries(s)){let s=String(r),o=s.toLowerCase();if(t.has(o)||o.includes("secret")||o.includes("token")||o.includes("password")){i[s]=null==a?a:("string"==typeof a&&a.length,"[REDACTED]");continue}i[s]=e(a,n+1)}return i}(n&&"object"==typeof n?n:{})};"error"===e?console.error(i):"warn"===e?console.warn(i):console.log(i)}function n(e,t){s("info",e,t)}function i(e,t){s("warn",e,t)}e.s(["logInfo",()=>n,"logWarn",()=>i])},534189,e=>{"use strict";var t=e.i(902157),s=e.i(750227);let n=process.env.ANALYTICS_STORE_PATH||"data/learning-analytics.json",i={users:{}};function r(){try{let e=s.default.isAbsolute(n)?n:s.default.join(process.cwd(),n);if(!t.default.existsSync(e))return i;let r=t.default.readFileSync(e,"utf8");return JSON.parse(r)}catch{return i}}function a(e,i){let a,o,l,d=r(),u=d.users[e]||{userId:e,events:[],updatedAt:new Date().toISOString()},p=(i||[]).filter(Boolean).map(e=>({...e,timestamp:e.timestamp||new Date().toISOString()})).slice(0,200),c={userId:e,updatedAt:new Date().toISOString(),events:[...u.events,...p].slice(-2e3)};return d.users[e]=c,a=s.default.isAbsolute(n)?n:s.default.join(process.cwd(),n),o=s.default.dirname(a),t.default.existsSync(o)||t.default.mkdirSync(o,{recursive:!0}),l=`${a}.tmp`,t.default.writeFileSync(l,JSON.stringify(d,null,2),"utf8"),t.default.renameSync(l,a),c}function o(e){return r().users[e]||{userId:e,events:[],updatedAt:new Date().toISOString()}}function l(){let e=Object.values(r().users),t={sectionsStarted:0,sectionsCompleted:0,quizAttempts:0,quizCompleted:0,toolUsed:0},s=new Map,n=new Map,i=new Map;for(let r of e)for(let e of r.events){if("section_started"===e.type&&(t.sectionsStarted+=1),"section_completed"===e.type&&(t.sectionsCompleted+=1),"quiz_attempted"===e.type&&(t.quizAttempts+=1),"quiz_completed"===e.type&&(t.quizCompleted+=1),"tool_used"===e.type&&(t.toolUsed+=1),e.sectionId&&e.trackId&&e.levelId){let t=`${e.trackId}:${e.levelId}:${e.sectionId}`;s.set(t,(s.get(t)||0)+1)}if(e.quizId){let t=n.get(e.quizId)||{attempts:0,completed:0};"quiz_attempted"===e.type&&(t.attempts+=1),"quiz_completed"===e.type&&(t.completed+=1),n.set(e.quizId,t)}e.toolId&&i.set(e.toolId,(i.get(e.toolId)||0)+1)}let a=[...s.entries()].sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({key:e,count:t}));return{totals:t,topSections:a,lowestQuizCompletion:[...n.entries()].map(([e,t])=>({quizId:e,attempts:t.attempts,completed:t.completed,completionRate:t.attempts?t.completed/t.attempts:0})).filter(e=>e.attempts>=5).sort((e,t)=>e.completionRate-t.completionRate).slice(0,20),mostUsedTools:[...i.entries()].sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({toolId:e,count:t})),usersTracked:e.length}}e.s(["appendAnalyticsEvents",()=>a,"getOwnerAnalyticsSummary",()=>l,"getUserAnalytics",()=>o])},884393,e=>{"use strict";let t=e.r(534189),s=t.appendAnalyticsEvents,n=t.getUserAnalytics;t.getOwnerAnalyticsSummary,e.s(["appendAnalyticsEvents",0,s,"getUserAnalytics",0,n])},114852,e=>{"use strict";var t=e.i(926747),s=e.i(190406),n=e.i(244898),i=e.i(262950),r=e.i(828414),a=e.i(489521),o=e.i(192489),l=e.i(884393);async function d(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});let s=await (0,r.getServerSession)(e,t,a.authOptions),n=s?.user?.id;if(!n)return t.status(401).json({message:"Authentication required"});let i=(0,o.getUserById)(n);if(!i)return t.status(404).json({message:"User not found"});let d=!!(i.consent||{}).cpdDataUseAcceptedAt,u=function(e){let t=new Set,s=new Set,n=new Set,i=new Set,r=new Set;for(let a of e)if(a.toolId&&t.add(a.toolId),a.quizId&&"quiz_attempted"===a.type&&s.add(a.quizId),a.quizId&&"quiz_completed"===a.type&&n.add(a.quizId),a.trackId&&a.levelId&&a.sectionId){let e=`${a.trackId}:${a.levelId}:${a.sectionId}`;"section_started"===a.type&&i.add(e),"section_completed"===a.type&&r.add(e)}return{toolsExplored:t.size,quizzesAttempted:s.size,quizzesCompleted:n.size,sectionsStarted:i.size,sectionsCompleted:r.size}}((0,l.getUserAnalytics)(n).events),p=(0,o.getCpdState)(n),c=p?.updatedAt||null;return t.status(200).json({consented:d,summary:u,cpdUpdatedAt:c})}e.s(["default",()=>d],653874);var u=e.i(653874),p=e.i(7031),c=e.i(181927),m=e.i(846432);let f=(0,i.hoist)(u,"default"),y=(0,i.hoist)(u,"config"),g=new n.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/analytics/me",pathname:"/api/analytics/me",bundlePath:"",filename:""},userland:u,distDir:".next",relativeProjectDir:""});async function S(e,s,n){g.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/analytics/me";i=i.replace(/\/index$/,"")||"/";let r=await g.prepare(e,s,{srcPage:i});if(!r){s.statusCode=400,s.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve());return}let{query:a,params:o,prerenderManifest:l,routerServerContext:d}=r;try{let t=e.method||"GET",n=(0,p.getTracer)(),r=n.getActiveScopeSpan(),u=g.instrumentationOnRequestError.bind(g),m=async r=>g.render(e,s,{query:{...a,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:g.isDev,page:"/api/analytics/me",internalRevalidate:null==d?void 0:d.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":s.statusCode,"next.rsc":!1});let e=n.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=e.get("next.route");if(a){let e=`${t} ${a}`;r.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),r.updateName(e)}else r.updateName(`${t} ${i}`)});r?await m(r):await n.withPropagatedContext(e.headers,()=>n.trace(c.BaseServerSpan.handleRequest,{spanName:`${t} ${i}`,kind:p.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},m))}catch(e){if(g.isDev)throw e;(0,t.sendError)(s,500,"Internal Server Error")}finally{null==n.waitUntil||n.waitUntil.call(n,Promise.resolve())}}e.s(["config",0,y,"default",0,f,"handler",()=>S],114852)}];

//# debugId=f2e86861-3dfa-62d7-e606-cac3b21bae6b
//# sourceMappingURL=%5Broot-of-the-server%5D__feda081c._.js.map